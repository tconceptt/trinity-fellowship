;/*FB_PKG_DELIM*/

__d("Cache",["TimeSlice"],(function(t,n,r,o,a,i,l){"use strict";var e=6e4,s=(function(){function t(){this.$1=new Map}var n=t.prototype;return n.has=function(t){return this.$1.has(t)},n.get=function(t,n){var e=this.__getRaw(t);return e?e.$2:n},n.getAll=function(t,n){var e=this,r=new Map;return t.forEach(function(t){return r.set(t,e.get(t,n))}),r},n.delete=function(t){var e=this.__getRaw(t);return e&&e.$3&&clearTimeout(e.$3),this.$1.delete(t)},n.clear=function(){this.$1.forEach(function(e){e&&e.$3&&clearTimeout(e.$3)}),this.$1.clear()},n.set=function(n,o,a,i){if(!this.shouldUpdate(n,a))return!1;var t=this.__getRaw(n);return t||(t=this.__getNewRawObject()),delete t.$2,delete t.$4,t.$3&&clearTimeout(t.$3),delete t.$3,t.$2=o,a!=null&&(t.$4=a),i!=null&&i>=0&&(t.$3=setTimeout(r("TimeSlice").guard(this.delete.bind(this,n),"Cache expiration timeout"),i*e)),this.__setRaw(n,t),!0},n.shouldUpdate=function(t,n){var e=this.__getRaw(t);return e==null||e.$4==null||n==null||n>e.$4},n.size=function(){return this.$1.size},n.__getRaw=function(t){return this.$1.get(t)},n.__setRaw=function(t,n){this.$1.set(t,n)},n.__getNewRawObject=function(){return{$2:null,$3:null,$4:null,$5:null,$6:null}},n.__keys=function(){return this.$1.keys()},t})();l.default=s}),98);
__d("EBDBConsistencyApi",["$InternalEnum","EBDB","FBLogger","I64","QPLUserFlow","ReQL","asyncToGeneratorRuntime","getErrorSafe","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],u=null;function c(){return u}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var a=yield o("EBDB").getEBDB(),l=BigInt((e||(e=o("I64"))).to_string(n));yield a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:l,env:t}])},"EBDB - AddDevice",i.id+":54"),u=l}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on EBDB - AddDevice")}}),m.apply(this,arguments)}function p(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)).then(function(e){return e==null?void 0:e.deviceId})}function _(e,t,n){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){if(n!=null)return d(t,n);try{var o=yield p(e);return o==null?void 0:d(t,o)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on fetching secure_encrypted_backups_client_state")}}),f.apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){r("QPLUserFlow").addPoint(t,"track_overprompting_start");try{var a=yield o("EBDB").getEBDB(),l=!1;yield a.runInTransaction(["device_state"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t.stores.device_state.get(e);(n==null?void 0:n.deviceId)!=null&&(l=!0)});return function(e){return t.apply(this,arguments)}})(),"EBDB - AddDevice",i.id+":107"),r("QPLUserFlow").addAnnotations(t,{bool:{overprompting:l}}),r("QPLUserFlow").addPoint(t,"track_overprompting_end")}catch(e){r("QPLUserFlow").addPoint(t,"track_overprompting_fail"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on track overpropting")}}),h.apply(this,arguments)}var y=n("$InternalEnum")({Disabled:0,EbsmInconsistent:1,EbdbInconsistent:2,Enabled:3,Inconsistent:4});function C(e){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield p(t),r=n!=null?BigInt((e||(e=o("I64"))).to_string(n)):null;return r==null&&u==null?y.Disabled:r==null&&u!=null?y.EbsmInconsistent:r!=null&&u==null?y.EbdbInconsistent:r===u?y.Enabled:y.Inconsistent}),b.apply(this,arguments)}function v(e,t,n,r){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,o){var a=1/r("justknobx")._("3914");if(!(Math.random()>=a)){var i=r("qpl")._(521471316,"2831");try{r("QPLUserFlow").start(i);var l=yield C(e);o!=null&&r("QPLUserFlow").addAnnotations(i,o()),r("QPLUserFlow").endSuccess(i,{annotations:{int:{consistency:l,env:t,operation:n}}})}catch(e){r("QPLUserFlow").endFailure(i,"error"),r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Error on trackConsistency in %s",t)}}}),S.apply(this,arguments)}function R(){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o("EBDB").clearDeviceState(),u=null}),L.apply(this,arguments)}var E;function k(e,t){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){E!=null&&E(),yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(e){e!=null&&((e==null?void 0:e.backupId)==null||(e==null?void 0:e.isUserOptedOut)===!0)&&R()}).catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDBApi: EBLS error on fetching data from encrypted_backups")}),E=t.tables.encrypted_backups.subscribe(function(e,t){t.operation!=="delete"&&(t.value.backupId==null||t.value.isUserOptedOut===!0)&&R()});var a=yield o("EBDB").getEBDB(),l=yield a.runInTransaction(["device_state"],"readonly",function(e){return e.stores.device_state.get(n)},"EBDB - readDeviceState",i.id+":250").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: fetching device_state")});if(u=T(l==null?void 0:l.deviceId),u==null){var s=yield p(t);if(s==null)return;var c=BigInt((e||(e=o("I64"))).to_string(s));u=c,yield a.runInTransaction(["device_state"],"readwrite",function(e){return e.stores.device_state.bulkPut([{deviceId:c,env:n}])},"EBDB - writeDeviceState",i.id+":272").catch(function(e){r("FBLogger")("wmi_eb").catching(e).mustfix("EBDB error: write device_state")})}}),I.apply(this,arguments)}function T(t){if(t!=null){if(typeof t=="bigint")return t;if(typeof t=="number")return BigInt(t);if(typeof t=="string")try{return BigInt(t)}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing string as BigInt"),R();return}if(Array.isArray(t))try{return BigInt((e||(e=o("I64"))).to_string(t))}catch(e){r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("EBDBApi: Parsing I64 as BigInt"),R();return}r("FBLogger")("wmi_eb").mustfix("EBDBApi: Parsing unknown as BigInt %s",String(t)),R()}}l.EB_STORES=s,l.getDeviceId=c,l.addNewDevice=_,l.trackOverprompting=g,l.EBConsistencyResult=y,l.checkRegistrationConsistency=C,l.trackConsistency=v,l.clearDeviceState=R,l.startListeningDeviceRegistrations=k}),98);
__d("EBEpochChangeListener",["EBIsEbEnabled","EBIsEbEnabledSubscriber","Promise","ReQL","WAPubSub","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function e(e){this.$1=o("WAPubSub").simplePubSub(),this.$3=e}var t=e.prototype;return t.initialize=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=this;(yield o("EBIsEbEnabled").isEbEnabledLS(this.$3.tables))&&this.$4(this.$3),yield o("EBIsEbEnabledSubscriber").isEbEnabledSubscriber().then(function(t){t.subscribe(function(t){t?e.$4(e.$3):e.$2==null||e.$2()})})});function t(){return e.apply(this,arguments)}return t})(),t.$4=function(t){var e=this;return this.$2==null&&(this.$2=o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs).subscribe(function(t,n){e.$1.publish(n)})),this.$2},t.subscribe=function(t){return this.$1.subscribe(t)},e})(),u;function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(u!=null)return(e||(e=n("Promise"))).resolve();u=new s(t),yield u.initialize()}),d.apply(this,arguments)}function m(e){if(u==null)throw r("err")("EBEpochChangeListener is not initialized");return u.subscribe(e)}l.initEBEpochChangeListener=c,l.subscribeToEpochChanges=m}),98);
__d("EBSMAPI",["EBDeps","Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(){return s!=null||(s=o("EBDeps").getDeps().getEBSMAPI()),s}var c={addDeviceWithEBKeys:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).addDeviceWithEBKeys.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),addDeviceWithRecoveryCode:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).addDeviceWithRecoveryCode.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),addVirtualDevice:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).addVirtualDevice.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),deleteBackupsOnClient:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).deleteBackupsOnClient.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),deleteEncryptedBackup:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).deleteEncryptedBackup.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),ebOptOut:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).ebOptOut.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),fetchBackupIds:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).fetchBackupIds.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),generateRecoveryCode:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).generateRecoveryCode.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),getEBState:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield u()).getEBState()});function t(){return e.apply(this,arguments)}return t})(),getLSVirtualDevices:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return(yield u()).getLSVirtualDevices(e)});function t(t){return e.apply(this,arguments)}return t})(),initializeBackup:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).initializeBackup.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),isEbEnabled:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).isEbEnabled.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),optOutOfBackup:function(){return(e||(e=n("Promise"))).resolve()},otcAddDevice:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).otcAddDevice.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),repairEpochs:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield u()).repairEpochs()});function t(){return e.apply(this,arguments)}return t})(),revokeVirtualDevice:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e;return(e=yield u()).revokeVirtualDevice.apply(e,arguments)});function t(){return e.apply(this,arguments)}return t})(),syncEpochs:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield u()).syncEpochs()});function t(){return e.apply(this,arguments)}return t})()},d=c;l.default=d}),98);
__d("RecoveryCodeDB",["MAWCurrentUser","MAWIndexedDbMetadata","MAWODSProxy","MessengerWebInitData","QPLFlow","WAHex","WALogger","WAOdsEnums","WAResolvable","Worm","WormEAR","WormIDbDriver","asyncToGeneratorRuntime","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u={persisted_recovery_code:{indexes:{},primaryKey:"pk"}},c=1e4,d=new(o("WAResolvable")).Resolvable;function m(){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=o("MAWIndexedDbMetadata").ebRecoveryCodeDBName(o("MAWCurrentUser").getID()),n=o("WAHex").parseHex(r("MessengerWebInitData").accountKeyV2),a={log:function(t){return o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_RECOVERY_CODE_DB,key:t})}},i=r("qpl")._(1056840657,"2716"),l=o("QPLFlow").startQPLFlow(i,{annotations:{string:{dbType:"recovery_code_db",operationType:"initRecoveryCodeDB"}},timeoutInMs:c});try{var m="recovery_code_db",p=new(o("WormEAR")).WormEAR(u,m,n),_=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(t,m,u,p,a,{onTransactionError:function(n){n instanceof o("WormEAR").DecryptionError&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error decrypting RecoveryCodeDB"])))},safeToDeleteStores:new Set(["migration"])}),i);yield _.init({eventFlow:l}),l.endSuccess(),d.resolve(_)}catch(e){throw l.endFail("error"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error initializing RecoveryCodeDB: ",""])),e),d.reject(e),e}}),p.apply(this,arguments)}function _(){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d.resolveWasCalled()||(yield m()),d.promise}),f.apply(this,arguments)}l.schema=u,l.getOrCreateRecoveryCodeDB=_}),98);
__d("EBOnboardDeviceWithAutomaticEB",["EBIsEbEnabled","EBLogger","EBSMAPI","LSAuthorityLevel","MAWCurrentUser","MAWODSProxy","RecoveryCodeDB","WAOdsEnums","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("EBLogger").EBLogger().tags(["EBOnboardDeviceWithAutomaticEB"]);function m(){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var t=yield o("EBIsEbEnabled").isEBEnabled();if(t){d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["EB is already enabled, skipping onboard with recovery code"])));return}d.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["EB is not enabled, checking for recovery code in database"])));var a=yield o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),i=yield a.runInTransaction(["persisted_recovery_code"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.authorityLevel===r("LSAuthorityLevel").AUTHORITATIVE});return n==null?void 0:n.recoveryCode});return function(t){return e.apply(this,arguments)}})(),"RecoveryCodeDB - read recovery code for adding device");if(i==null){d.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No recovery code found in database"])));return}d.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Found recovery code in database, attempting to add device"]))),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.attempt"});var l=yield r("EBSMAPI").addDeviceWithRecoveryCode({recoveryCode:i,userId:o("MAWCurrentUser").getID()});l.success?(d.info("Successfully added device with recovery code from database"),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.success"})):(d.warn("Failed to add device with recovery code: "+l.error),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.failure."+l.error}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.AUTOMATIC_EB,key:"onboard_device_with_recovery_code.failure"}))}catch(e){d.catching(r("getErrorSafe")(e)).warn("Failed to onboard device with automatic EB after EBLS init")}}),p.apply(this,arguments)}l.onboardDeviceWithAutomaticEB=m}),98);
__d("EBResumeAutomaticEBInitialisation",["EBLogger","EBSMAPI","LSAuthorityLevel","LSIntEnum","RecoveryCodeDB","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var t=yield o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),a=yield t.runInTransaction(["persisted_recovery_code"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.virtualDeviceType===16&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});return n!=null});return function(t){return e.apply(this,arguments)}})(),"FetchOptimisticRecoveryCode");a&&(o("EBLogger").EBLogger().info("Found existing optimistic recovery code, resuming backup initialization"),yield r("EBSMAPI").initializeBackup({virtualDeviceId:null,virtualDeviceType:(e||(e=o("LSIntEnum"))).ofNumber(16)}))}catch(e){o("EBLogger").EBLogger().catching(r("getErrorSafe")(e)).warn("Failed to resume initialization from optimistic recovery code")}}),u.apply(this,arguments)}l.resumeAutomaticEBInitialisation=s}),98);
__d("EBSMProperties",[],(function(t,n,r,o,a,i){"use strict";var e=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","auto_restore_opt_out"],l=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]),s={dbVersion:5,mandatoryTables:l,persistedTables:new Set(e),persistedTablesArray:e},u=s;i.default=u}),66);
__d("MWEBODSEntityKey.enum",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({START:"start",SUCCESS:"success",FAIL:"fail",INCORRECT_PIN_CODE:"incorrect_pin_code",INCORRECT_RECOVERY_CODE:"incorrect_recovery_code",TIMEOUT:"timeout",CANCEL:"cancel"}),l=e;i.default=l}),66);
__d("MWEncryptedBackupsFirstRestoreUpsellTime",["EBAPIWorkerCheck","FBLogger","WebStorage","getErrorSafe","getMWEncryptedBackupsIsLocalStorageSupported"],(function(t,n,r,o,a,i,l){"use strict";var e,s="mw_encrypted_backups_restore_upsell_first_impression_time_key";function u(){var t=Date.now().toString();if(o("EBAPIWorkerCheck").runningInWorker())return d(t);if(!o("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported())return t;try{var n,a=(n=(e||(e=r("WebStorage"))).getLocalStorage())==null?void 0:n.getItem(s);if(a==null){var i;return(i=(e||(e=r("WebStorage"))).getLocalStorage())==null||i.setItem(s,t),t}return a}catch(e){return r("FBLogger")("wmi_eb").warn("[labyrinth][web] Failed to set EB session identifier due to %s",r("getErrorSafe")(e).message),t}}var c=null;function d(e){return c==null&&(c=e),c}l.getFirstRestoreUpsellTime=u,l.getFirstRestoreUpsellTimeForEBLS=d}),98);
__d("QPLMemoryUtils",["MemoryUtils","QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=o("MemoryUtils").getCurrentMemory(),n=t.usedJSHeapSize;r("QPLUserFlow").addAnnotations(e,{int:{usedJSHeapSizeStart:n}})}function s(e){var t=o("MemoryUtils").getCurrentMemory(),n=t.usedJSHeapSize;r("QPLUserFlow").addAnnotations(e,{int:{usedJSHeapSizeEnd:n}})}l.logMemoryForQPLStart=e,l.logMemoryForQPLEnd=s}),98);
__d("createReStoreEBSMTablesPersistence",["CurrentMessengerUser","EBLogger","MAWUnrecoverableDbErrors","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","ODS","Promise","QPLMemoryUtils","QPLUserFlow","Random","ReStorePersistence","ReStoreTabNotifier","WebSession","asyncToGeneratorRuntime","getErrorSafe","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("CurrentMessengerUser").getIDorEIMU(),m=r("ReStoreTabNotifier")==null?void 0:r("ReStoreTabNotifier")("mwChat-"+d),p=null,_=!1,f=!1,g=o("EBLogger").EBLogger().tags(["EBSM","Pesistence","MainThread"]);function h(e,t,n){var r=e.get(t);if(r!==void 0)return r;var o=n();return e.set(t,o),o}function y(t){var a=(c||(c=n("Promise"))).resolve(),i="flushChangesV2",l=new Map;function d(e){return h(l,e,function(){return new Map})}var y=o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();r("QPLUserFlow").start(r("qpl")._(521481876,"1407"),{annotations:{string:{ebSessionIdentifier:y,sessionTabId:o("WebSession").getId()}}}),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").START),o("QPLMemoryUtils").logMemoryForQPLStart(r("qpl")._(521481876,"1407"));function C(){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield t.rehydrateEBSMFromEBDB(d),o("QPLMemoryUtils").logMemoryForQPLEnd(r("qpl")._(521481876,"1407")),r("QPLUserFlow").endSuccess(r("qpl")._(521481876,"1407")),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").SUCCESS)}catch(t){r("QPLUserFlow").addPoint(r("qpl")._(521481876,"1407"),"EBSM_HYDRATION_FAILED");var e=r("getErrorSafe")(t);g.MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["An error occured in EBSM hydration when loading EB data: ",""])),e.message),r("QPLUserFlow").endFailure(r("qpl")._(521481876,"1407"),"Hydration failed."),(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_HYDRATION,r("MWEBODSEntityKey.enum").FAIL)}}),b.apply(this,arguments)}return p=C(),m==null||m.onEventReceive("flushChangesV2",function(n){var a=n.changeSet,l=new Map;if(a.forEach(function(e,t){l.set(t,{toAdd:[],toDelete:[]});var n=d(t);e.forEach(function(e,r){if(o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)){var a;(a=l.get(t))==null||a.toDelete.push(n.get(r))}else{var i;(i=l.get(t))==null||i.toAdd.push(e)}})}),t.updateEBSM==null){g.MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ebdbEbsmApi.updateEBSM is not defined"])));return}r("promiseDone")(t.updateEBSM(l,i))}),{flush:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,n){var a,l;if(e.size!==0&&(e.size>0&&e.forEach(function(t,n){t.size===0&&e.delete(n)}),e.size!==0)){var s=((a=n.actionSource)==null?void 0:a.type)==="user_initiated"&&((l=n.actionSource)==null?void 0:l.source)===i;if(s){e.forEach(function(e,t){var n=d(t);e.forEach(function(e,t){o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)?n.delete(t):n.set(t,e)})});return}var u=new Map;e.forEach(function(e,t){u.set(t,{toAdd:[],toDelete:[]});var n=d(t);e.forEach(function(e,r){if(o("ReStorePersistence").isDeletedValue(e,o("ReStorePersistence").sentinelDeleted)){var a;(a=u.get(t))==null||a.toDelete.push(n.get(r)),n.delete(r)}else{var i;(i=u.get(t))==null||i.toAdd.push(e),n.set(r,e)}})}),m==null||m.postMessage("flushChangesV2",{changeSet:e,fromVersion:"",sentinelDeleted:o("ReStorePersistence").sentinelDeleted,version:""});var c=o("Random").uint32(),_=Array.from(e.keys());r("QPLUserFlow").start(r("qpl")._(521485383,"2200"),{annotations:{bool:{ebsmv2:!0},string_array:{tables:_}},instanceKey:c}),yield p,yield t.flushEBSMtoEBDB(u).catch(function(){})}});function a(t,n){return e.apply(this,arguments)}return a})(),get:function(t,r,o){var e=d(r);return _?e.get(o):p==null?(c||(c=n("Promise"))).reject("rehydration is not complete"):p.then(function(){return _=!0,e.get(o)})},logError:function(n,a,i,l){if((u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_RESTORE_PERSISTENCE_ERROR,n),i==="dbCorruption"){var e,s;(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,n);var c="Got unexpected undefined in ebsm, mode: "+a+", table: "+n+", id: "+((e=l==null?void 0:l.id)!=null?e:"")+", deletedInThisTxn: "+((s=l==null?void 0:l.deletedInThisTxn)!=null?s:"")+". Deleting EBSM db";g.mustfix(c);var d=o("Random").uint32();o("MAWUnrecoverableDbErrors").setError(new(o("MAWUnrecoverableDbErrors")).EbsmHydrationError(c,!0,d,n),function(){r("promiseDone")(t.clearEbStores(),function(){(u||(u=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),r("MWEBODSEntityName.enum").MW_EBSM_CORRUPTION,"db_deleted.main_thread")})}),f||(f=!0,o("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE,"full"))}},queueCommitWork:void 0,runExclusively:function(t){return new(c||(c=n("Promise")))(function(e,r){a=a.then(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield t(),o=n[0],a=n[1];try{e(yield o())}catch(e){r(e)}}))})},shouldApplySync:function(){return!1},shouldInline:function(t,n){return!1},shouldSync:function(t,n){return t!=="notifyInMemoryTable"},tabTablesNotifier:function(){return m},types:["ephemeral"],uniqueId:""}}l.default=y}),98);
__d("createReStoreTableNameAllowListPersistence",["Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";var e;function l(t,r,o){var a;return{clearCache:function(){t.clearCache==null||t.clearCache(),r.clearCache==null||r.clearCache()},close:function(){t.close==null||t.close(),r.close==null||r.close()},flush:(function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(a,i){var l=new Map,s=new Map;a.forEach(function(e,t){o.has(t)?s.set(t,e):l.set(t,e)}),yield(e||(e=n("Promise"))).all([t.flush(l,i),r.flush(s,i)])});function i(e,t){return a.apply(this,arguments)}return i})(),get:function(n,a,i,l){return o.has(a)?r.get(n,a,i,l):t.get(n,a,i,l)},isClosed:function(){return(t.isClosed==null?void 0:t.isClosed())||!1},isPersistenceSupported:t.isPersistenceSupported,logError:function(n,a,i,l){o.has(n)?r.logError==null||r.logError(n,a,i,l):t.logError==null||t.logError(n,a,i,l)},permitsSynchronousIO:function(n){if(o.has(n)){var e;return(e=r.permitsSynchronousIO==null?void 0:r.permitsSynchronousIO(n))!=null?e:!1}else{var a;return(a=t.permitsSynchronousIO==null?void 0:t.permitsSynchronousIO(n))!=null?a:!1}},runExclusively:function(a,i){return t.runExclusively(function(){return new(e||(e=n("Promise")))(function(t,o){var l=r.runExclusively(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var r=yield a(),o=r[0],i=r[1],s=new(e||(e=n("Promise")))(function(e){t([function(){return e(),l},i])});return[n("asyncToGeneratorRuntime").asyncToGenerator(function*(){return yield s,o()}),i]}),i);l.catch(o)})},i)},shouldApplySync:function(n,a){return o.has(a)?r.shouldApplySync(n,a):t.shouldApplySync(n,a)},shouldInline:function(n,a){return o.has(n)?r.shouldInline(n,a):t.shouldInline(n,a)},shouldSync:function(n,a){return o.has(a)?r.shouldSync(n,a):t.shouldSync(n,a)},tabTablesNotifier:(a=t.tabTablesNotifier)!=null?a:r.tabTablesNotifier,types:[].concat(t.types,r.types),uniqueId:r.uniqueId+t.uniqueId}}i.default=l}),66);
__d("LSJSEBInMemoryStorage",["EBSMProperties","createLSReStoreEphemeralPersistence","createReStoreEBSMTablesPersistence","createReStoreTableNameAllowListPersistence"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=r("createReStoreTableNameAllowListPersistence")(o("createLSReStoreEphemeralPersistence").createLSReStoreEphemeralPersistence(),r("createReStoreEBSMTablesPersistence")(e),r("EBSMProperties").persistedTables);return t}l.makeReStorePersistence=e}),98);
__d("EBWorkerAddDeviceUtils",["EBDB","EBDBEbsmApi","EBSMProperties","I64","LSAuthorityLevel","LSIntEnum","LSJSEBInMemoryStorage","LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","Promise","ReQL","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a){var l=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state));if(l!=null)return"dest_table_not_empty";var c={clearEbStores:o("EBDB").clearEbStores,flushEBSMtoEBDB:o("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:o("EBDBEbsmApi").rehydrateEBSMFromEBDB,updateEBSM:function(){return(u||(u=n("Promise"))).resolve()}},d=yield o("LSJSEBInMemoryStorage").makeReStorePersistence(c);if(d==null)throw r("err")("persistence is null");var m=o("LSReStoreWrapper").createLSReStore(d,o("LSMetadata").schema,[r("MAWLSVaultingHooks")],void 0),p=yield o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(m.tables.secure_encrypted_backups_epochs));return p.filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).length===0?"source_epoch_not_authoritative":m.runInTransaction(function(e){return a.runInTransaction((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var o=yield(u||(u=n("Promise"))).all(t.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=e[t],o=n.entries(new WeakMap),a=yield o.next();if(a.done)return"source_table_empty";for(var i=r[t];!a.done;){var l=a.value,s=l[0],u=l[1];yield i.upsert(s,u),a=yield o.next()}return"success"});return function(e){return t.apply(this,arguments)}})())),a=new Set(o);return a.has("source_table_empty")?"source_table_empty":a.has("success")&&a.size===1?"success":"fail"});return function(e){return r.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":91")},"readonly",void 0,void 0,i.id+":89")}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield e.runInTransaction(function(e){return(u||(u=n("Promise"))).all(r("EBSMProperties").persistedTablesArray.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){for(var n=e[t],r=n.entries(new WeakMap),o=yield r.next();!o.done;)yield n.delete.apply(n,o.value[0]),o=yield r.next()});return function(e){return t.apply(this,arguments)}})()))},"readwrite",void 0,void 0,i.id+":131")}),p.apply(this,arguments)}l.copyEBStateTablesFromMainthreadToWorker=c,l.clearLSEBSMTables=m}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(t,n,r,o,a,i,l){"use strict";function e(){n("cr:1232")!=null&&n("cr:1232").shutdownAndClear()}function s(e,t,o,a,i,l){return function(s){return n("cr:1232")!=null?n("cr:1232").getInstance(s,e,t,o,a,i,l):r("FBMqttChannel")}}l.shutdownAndClear=e,l.getInstance=s}),98);
__d("MAWEBLSInWorkerSwitch",["MAWEBEnabledStateManager"],(function(t,n,r,o,a,i,l){"use strict";var e=new(o("MAWEBEnabledStateManager")).MAWEBEnabledStateManager,s=e;l.default=s}),98);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),r[11]=t.i64.cast([0,0]),r[7]=r[11],r[8]=new t.Map,r[8].set("backup_tenancy",e[0]),r[8].set("trace_id",void 0),r[9]=t.toJSON(r[8]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50008]),r[9],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,r[7]).then(function(e){var t;return t=e,r[10]=t[0],t})},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure",e.__tables__=["encrypted_backups"],a.exports=e}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSFetchBackupIds"),a.backupTenancy,a.traceId,a.isUiBlocking);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=e.cancelEndPoint,n=e.event,o=e.instanceKey,a=e.source;a!=null&&r("QPLUserFlow").addAnnotations(n,{string:{source:a}},{instanceKey:o}),r("QPLUserFlow").addPoint(n,"cancel",{instanceKey:o}),r("QPLUserFlow").addAnnotations(n,{string:{cancel_end_point:t}},{instanceKey:o}),r("QPLUserFlow").endCancel(n,{instanceKey:o})}function u(e){var t=e.event,n=e.instanceKey,o=e.onClose,a=e.source;a!=null&&r("QPLUserFlow").addAnnotations(t,{string:{source:a}},{instanceKey:n}),s({cancelEndPoint:"dialog_x_button",event:t,instanceKey:n}),o()}function c(t){var n=t.annotations,a=t.event,i=t.instanceKey,l=t.odsEntityName;r("QPLUserFlow").addPoint(a,"success",{instanceKey:i}),r("QPLUserFlow").endSuccess(a,{annotations:n,instanceKey:i}),l&&(e||(e=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),l,r("MWEBODSEntityKey.enum").SUCCESS)}function d(t){var n=t.annotations,a=t.errorName,i=t.event,l=t.instanceKey,s=t.odsEntityKey,u=t.odsEntityName;r("QPLUserFlow").addPoint(i,"failure",{instanceKey:l}),r("QPLUserFlow").endFailure(i,a,{annotations:n,instanceKey:l}),u&&(e||(e=o("ODS"))).bumpEntityKey(r("MWEBODSCategory"),u,s!=null?s:r("MWEBODSEntityKey.enum").FAIL)}l.cancelFlow=s,l.closeDialogCancelFlow=u,l.endSuccess=c,l.endFailure=d}),98);
__d("isInstamadilloEB",["qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("670")===!0}l.default=e}),98);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath",["EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","ReQL","WebSession","isInstamadilloEB","promiseDone","qex"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=r("qex")._("121")===!0;function d(t){function n(){r("promiseDone")(r("EBSMAPI").fetchBackupIds("MWEncryptedBackupsListenForChangesToBackupStateInitPath"),function(){return void 0})}function a(){var n=o("ReQL").fromTableAscending(t.tables.encrypted_backups),a=n.subscribe(function(t,n){n.operation==="delete"||!(e||(e=o("I64"))).equal(n.value.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))||(a(),r("QPLUserFlow").getActiveFlowIDs().includes((u||(u=o("QPLEvent"))).getMarkerId(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent}))}),l=o("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();r("QPLUserFlow").getActiveFlowIDs().includes((u||(u=o("QPLEvent"))).getMarkerId(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||r("QPLUserFlow").start(o("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:l,fetchBackupIdsVersion:"msys",sessionTabId:o("WebSession").getId()}}}),r("promiseDone")(t.runInTransaction(function(e){return r("LSFetchBackupIdsStoredProcedure")(r("LSFactory")(e),{backupTenancy:(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,i.id+":86"),function(){return void 0})}var l=n;(c||r("isInstamadilloEB")())&&(l=a,l());var d=o("ReQL").fromTableAscending(t.tables.encrypted_backups_status_trigger);return d.subscribe(l)}function m(e){}var p={listenForChangesToBackupState:d,preloadEBData:m};l.default=p}),98);
__d("EBLS",["EBDB","EBDBEbsmApi","EBEpochChangeListener","EBIsEbEnabled","EBIsEbEnabledSubscriber","EBLogger","EBOnboardDeviceWithAutomaticEB","EBReadyNotifier","EBReenrollmentTriggerListener","EBResumeAutomaticEBInitialisation","EBWorkerAddDeviceUtils","I64","LSAuthorityLevel","LSDataTraceFlushDeferred","LSDatascriptEvaluatorMaybeDeferred","LSDedicatedMqttChannel","LSDefaultSyncGroups","LSDeleteAllAndInsertConnectivityStatusStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSInternetConnectionState","LSJSEBInMemoryStorage","LSMetadata","LSPlatformDeviceId","LSPlatformMessengerSyncParams","LSPlatformMqttRealtimeTransport","LSPlatformRealtimeTransport","LSPlatformTaskSystemTransport","LSReStoreWrapper","LSVersion","MAWBridge","MAWEBLSInWorkerSwitch","MAWLSVaultingHooks","MAWODSProxy","MAWVaultMaterialsStorage","MWEncryptedBackupsListenForChangesToBackupStateInitPath","MWPlatformTaskSystem","MqttEnv","Promise","QPLUserFlow","ReQL","ServerAppID","WAAssertUnreachable","WAOdsEnums","WAPromiseDelays","WAResolvable","asyncToGeneratorRuntime","emptyFunction","err","getMWLSRegion","justknobx","nullthrows","promiseDone","qpl","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P=o("EBLogger").EBLogger().tags(["EBLS"]),N=r("qpl")._(521478817,"2806");function M(){return O()}var w,A,F;function O(){return w?w.promise:B({copyKeys:!0,getNewDB:!1}).promise}function B(e){w!=null&&!w.isSettled&&w.reject(r("err")("LSClient is not settled")),A!=null&&!A.isSettled&&A.reject(r("err")("LSDBStorage is not settled"));var t=new(o("WAResolvable")).Resolvable;return w=t,A=null,W(e).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t}function W(e){return q.apply(this,arguments)}function q(){return q=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,a=e.getNewDB;o("EBReadyNotifier").resetEBReady(),(t=r("QPLUserFlow")).start(N,{timeoutInMs:6e4}),t.addPoint(N,"ls_storage_creation_start");var i=yield H(a);t.addPoint(N,"ls_storage_creation_end"),t.addPoint(N,"eb_worker_add_device_skipped"),t.endSuccess(N),o("EBReadyNotifier").markEBReady(),P.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Initialised db"])));var l={appId:r("nullthrows")(r("ServerAppID").app_id),executeGraphQLLightSpeedRequest:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){r("vulture")("ZrOlCWyJ0L0hG2xX4QdNxz1doLM=");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=yield o("MAWBridge").getBridge().sendAndReceive("event","executeGraphQLLightSpeedRequest",{args:t});return a});function t(){return e.apply(this,arguments)}return t})(),getDb:H,getEval:function(){return r("LSDatascriptEvaluatorMaybeDeferred")()},platformName:"Messenger",realtimeUnderylingTransport:function(){return($||($=n("Promise"))).resolve(function(e,t){var n;return r("LSPlatformMqttRealtimeTransport")(r("LSVersion"),t,{getInstance:o("LSDedicatedMqttChannel").getInstance(function(){return!0},(n={},n[o("MqttEnv").MqttGkNames.mqttweb_global_connection_counter]=!1,n),function(e,t){return t},r("emptyFunction")),shutdownAndClear:o("LSDedicatedMqttChannel").shutdownAndClear})})},region:r("getMWLSRegion")(),schemaVersion:r("LSVersion"),sendHardcodedInitSync:!1,syncParams:r("LSPlatformMessengerSyncParams")};P.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["created config"]))),r("QPLUserFlow").addAnnotations(N,{string:{appId:l.appId}});var s=o("LSPlatformDeviceId").getDeviceIdForProviderType("ephemeral");r("QPLUserFlow").addPoint(N,"platform_client_init_start");var u=yield X(i,l,s);return r("QPLUserFlow").addPoint(N,"platform_client_init_end"),F=yield U(i),P.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["finished init successfully"]))),u}),q.apply(this,arguments)}function U(e){return V.apply(this,arguments)}function V(){return V=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=J(e);return yield o("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(e),yield o("EBEpochChangeListener").initEBEpochChangeListener(e),yield o("EBReenrollmentTriggerListener").initEBReenrollmentTriggerListener(e),o("EBResumeAutomaticEBInitialisation").resumeAutomaticEBInitialisation(),r("justknobx")._("862")&&o("EBOnboardDeviceWithAutomaticEB").onboardDeviceWithAutomaticEB(),t}),V.apply(this,arguments)}function H(e){return G.apply(this,arguments)}function G(){return G=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e===void 0&&(e=!1),!e&&A!=null)return A.promise;var t=new(o("WAResolvable")).Resolvable;A=t,yield o("MAWVaultMaterialsStorage").setupVaultMaterials();var a={clearEbStores:o("EBDB").clearEbStores,flushEBSMtoEBDB:o("EBDBEbsmApi").flushEBSMtoEBDB,rehydrateEBSMFromEBDB:o("EBDBEbsmApi").rehydrateEBSMFromEBDB},l=yield o("LSJSEBInMemoryStorage").makeReStorePersistence(a),s=o("LSReStoreWrapper").createLSReStore(l,o("LSMetadata").schema,[r("MAWLSVaultingHooks")],void 0);return a.updateEBSM=o("EBDBEbsmApi").updateEBSM(s),yield s.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("LSDefaultSyncGroups").seedDb(e,void 0)});return function(t){return e.apply(this,arguments)}})(),"readwrite","ui",void 0,i.id+":245"),t.resolve(s),s}),G.apply(this,arguments)}function z(){return j.apply(this,arguments)}function j(){return j=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){w!=null&&(yield o("EBWorkerAddDeviceUtils").clearLSEBSMTables(yield H()))}),j.apply(this,arguments)}function K(e){var t=r("MWEncryptedBackupsListenForChangesToBackupStateInitPath").listenForChangesToBackupState(e);return function(){t()}}function Q(t,n){var a=n==="Connected"?(D||(D=o("LSIntEnum"))).ofNumber(r("LSInternetConnectionState").CONNECTED):(D||(D=o("LSIntEnum"))).ofNumber(r("LSInternetConnectionState").NOT_CONNECTED);P.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status: ",""])),n),r("promiseDone")(t.runInTransaction(function(e){return r("LSDeleteAllAndInsertConnectivityStatusStoredProcedure")(r("LSFactory")(e),{internetConnectionState:a})},"readwrite",void 0,void 0,i.id+":283"),function(){P.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set successfully"])))},function(e){throw P.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync connection status set failed: ",""])),e==null?void 0:e.message),e})}function X(e,t,n){return Y.apply(this,arguments)}function Y(){return Y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){P.DEBUG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting..."])));var a=yield t.getEval();P.DEBUG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Getting datascript evaluator success"])));var i=a()(e);P.DEBUG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Clearing epoch before resume sync..."]))),P.DEBUG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["Starting realtime transport"])));var l=yield t.realtimeUnderylingTransport(),s=o("LSPlatformRealtimeTransport").LSPlatformRealtimeTransport(l,t.appId,n);P.DEBUG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["Starting task system"])));var u=new(r("MWPlatformTaskSystem"))(e,new(r("LSPlatformTaskSystemTransport"))(e,s,i,t.schemaVersion));P.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["Starting backup state listeners"])));var c=null;r("QPLUserFlow").addPoint(N,"sync_system_creation_skipped");var d=K(e);P.DEBUG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["Watching for expired traces"])));var m;return r("promiseDone")(o("LSDataTraceFlushDeferred").watchForExpiredTraces(e).then(function(e){m=e})),P.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Subscribing to mqtt sync status change events"]))),s.onConnectionStatusChange(function(t){Q(e,t)}),P.DEBUG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync starting sucess"]))),{cleanup:function(){P.DEBUG(T||(T=babelHelpers.taggedTemplateLiteralLoose(["Platform client sync cleaning up"]))),u==null||u.cleanup(),s.cleanup(),c==null||c.cleanup(),d(),m==null||m(),F.forEach(function(e){return e()})},db:e}}),Y.apply(this,arguments)}function J(e){var t=[],n=Z(e);return t.push(n),t}function Z(e){var t=null;function a(e){var a=t===null?"null":String(t),i=String(e);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.state_transition."+a+"_to_"+i}),P.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state transition: "," -> ",""])),a,i),t===!0&&e===!1&&(P.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch detected true->false transition, setting timeout to check self-correction"]))),o("WAPromiseDelays").delayMs(1e3).then(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBIsEbEnabled").isEBEnabled(),t=e===!0;P.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch true->false correction check: corrected=",", current_state=",""])),String(t),String(e)),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_correction."+(t?"corrected":"not_corrected")});var n=r("MAWEBLSInWorkerSwitch").isEnabled(),a=e===n?"match":"mismatch";o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"ebls_switch.true_to_false_check."+a})})).catch(function(e){P.catching(e).MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch failed to check true->false correction"])))})),r("MAWEBLSInWorkerSwitch").set(e),t=e}return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state)).then(function(e){e!=null?a(ee(e)):a(!1)}).catch(function(e){P.catching(e).MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to get initial state for EBLS Switch"])))}),e.tables.secure_encrypted_backups_client_state.subscribe(function(e,t){switch(P.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["EBLS Switch state changed. operation: ",""])),t.operation),t.operation){case"delete":a(!1);break;case"add":case"put":a(ee(t.value));break;default:throw t.operation,r("WAAssertUnreachable")(t.operation)}})}function ee(e){var t=e.authorityLevel,n=e.backupTenancy;if(t==null)return!1;var a=n!=null?n:(D||(D=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION);return(x||(x=o("I64"))).equal(a,(D||(D=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION))&&(x||(x=o("I64"))).equal(t,(D||(D=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}l.init=M,l.genLSClient=O,l.getLSStorage=H,l.clearEBSMStorage=z,l.platformClientInit=X}),98);
__d("EBMinosWasmDeriveAttachmentAccessTokenSecret",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.attachmentAccessTokenSecret;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToAttachmentAccessTokenSecret(t))}return(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.mediaKey;return yield o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretResultSpec,validateResult:e},{deriveAttachmentAccessTokenSecret:{mediaKey:n}})});function r(e){return t.apply(this,arguments)}return r})()}var s=e();l.deriveAttachmentAccessTokenSecret=s}),98);
__d("EBMinosWasmDeriveAttachmentPrimaryKeySecret",["EBMinosTypes","EBMinosWasm.pb","EBMinosWasmReactorSingleton","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(){function e(e){var t=e.attachmentPrimaryKeySecret;return o("WAResultOrError").makeResult(o("EBMinosTypes").unsafeCastToAttachmentPrimaryKeySecret(t))}return(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.mediaKey;return yield o("EBMinosWasmReactorSingleton").DEPRECATED_minosCommand({InputSpec:o("EBMinosWasm.pb").MinosCommandSpec,ResultSpec:o("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretResultSpec,validateResult:e},{deriveAttachmentPrimaryKeySecret:{mediaKey:n}})});function r(e){return t.apply(this,arguments)}return r})()}var s=e();l.deriveAttachmentPrimaryKeySecret=s}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","WALogger","WAResolvable","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;function u(){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("EBLS").genLSClient();try{yield o("EBDBConsistencyApi").startListeningDeviceRegistrations(t.db,o("EBDB").EBDBEnvironment.Worker)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""])),t)}finally{s.resolve(t.db)}}),c.apply(this,arguments)}function d(e){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("EBDBConsistencyApi").trackOverprompting(o("EBDB").EBDBEnvironment.Worker,e)}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s.promise;yield o("EBDBConsistencyApi").addNewDevice(t,o("EBDB").EBDBEnvironment.Worker,e)}),_.apply(this,arguments)}function f(e){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s.promise;return o("EBDBConsistencyApi").trackConsistency(t,o("EBDB").EBDBEnvironment.Worker,e),o("EBDBConsistencyApi").getDeviceId()}),g.apply(this,arguments)}function h(){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBDB").getEBDB(),t=yield e.store("secure_encrypted_backups_client_state").readAll();return t[0]}),y.apply(this,arguments)}function C(){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("EBDB").getEBDB(),t=yield e.store("secure_encrypted_backups_client_state").readAll();if((t==null?void 0:t.length)===0)return!1;var n=t[0],a=n.authorityLevel,i=n.backupTenancy;if(a==null)return!1;var l=i!=null?i:r("LSEncryptedBackupsBackupTenancy").PRODUCTION;return Number(l)===r("LSEncryptedBackupsBackupTenancy").PRODUCTION&&Number(a)===r("LSAuthorityLevel").AUTHORITATIVE}),b.apply(this,arguments)}l.startListeningEBDeviceRegistrations=u,l.trackOverprompting=d,l.addNewDevice=p,l.trackConsistency=f,l.getSecureEBClientState=h,l.isEBEnabledEBDB=C}),98);
__d("EncryptedBackupsUtils",["FBLogger","WAJids","WAStanzaUtils","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return Date.now()-t>o("WATimeUtils").DAY_MILLISECONDS*30},s=function(t){return Date.now()-t>o("WATimeUtils").DAY_MILLISECONDS*30};function u(e,t,n,r,o){var a={frankingTag:r==null?void 0:r.frankingTag,reportingTag:r==null?void 0:r.reportingTag},i={frankingMetadata:a,messageId:t,senderId:e,timestampMs:n};return{encryptedTransportMessage:o,metadata:i}}function c(e){return JSON.stringify([e.author,e.chat,e.externalId])}function d(e){var t=JSON.parse(e);if(!Array.isArray(t))throw r("FBLogger")("wmi_eb").mustfixThrow("Unable to parse msg id string as proper json");if(t.length!==3)throw r("FBLogger")("wmi_eb").mustfixThrow("Parsed array should have 3 components");var n=o("WAJids").unsafeCoerceToUserJid(t[0]),a=o("WAJids").unsafeCoerceToChatJid(t[1]),i=o("WAStanzaUtils").toStanzaId(t[2]);return{author:n,chat:a,externalId:i}}l.entryOlderThan30Days=e,l.timestampOlderThan30Days=s,l.asBackupMessage=u,l.convertWAMsgIdToStringId=c,l.convertStringIdToWAMsgId=d}),98);
__d("LFUCache",["Cache","ExecutionEnvironment"],(function(t,n,r,o,a,i,l){"use strict";var e,s=15,u=1,c=6e4,d=(function(t){function n(n,o){var a;return a=t.call(this)||this,a.$LFUCache2=n&&n>0?n:s,a.$LFUCache3=o&&o>0?o:u,((e||(e=r("ExecutionEnvironment"))).canUseDOM||(e||(e=r("ExecutionEnvironment"))).isInWorker)&&a.$LFUCache4(),a}babelHelpers.inheritsLoose(n,t);var o=n.prototype;return o.$LFUCache4=function(){clearTimeout(this.$LFUCache1),this.$LFUCache1=setTimeout(this.purge.bind(this),this.$LFUCache2*c)},o.destroy=function(){clearTimeout(this.$LFUCache1)},o.get=function(n,r){return this.has(n)&&this.$LFUCache5(n),t.prototype.get.call(this,n,r)},o.set=function(n,r,o,a){var e=this.has(n),i=t.prototype.set.call(this,n,r,o,a);return i&&(e?this.$LFUCache5(n):this.$LFUCache6(n,this.$LFUCache3)),i},o.purge=function(){var e=this,t=Array.from(this.__keys());t.forEach(function(t){e.$LFUCache7(t)<e.$LFUCache3?e.delete(t):e.$LFUCache6(t,0)}),this.$LFUCache4()},o.$LFUCache5=function(t){var e=this.$LFUCache7(t)+1;return this.$LFUCache6(t,e),e},o.$LFUCache7=function(t){var e=this.__getRaw(t);return e&&e.$LFUCache8?e.$LFUCache8:0},o.$LFUCache6=function(t,n){var e=this.__getRaw(t);return e||(e=this.__getNewRawObject()),e.$LFUCache8=n,this.__setRaw(t,e),!0},n})(r("Cache"));l.default=d}),98);
__d("MAWArmadilloAppDataTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={},R={},L={};s.name="ProtocolMsgId",s.internalSpec={externalId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],chat:[3,e.TYPES.STRING]},u.name="MetaSyncMessageKeyProto",u.internalSpec={fromMe:[1,e.TYPES.BOOL],id:[2,e.TYPES.STRING]},c.name="MetaSyncMessageProto",c.internalSpec={key:[1,e.TYPES.MESSAGE,u],ts:[2,e.TYPES.INT64]},d.name="MetaSyncMessageRangeProto",d.internalSpec={lastMessageTimestamp:[1,e.TYPES.INT64],lastSystemMessageTimestamp:[2,e.TYPES.INT64],messages:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c]},m.name="MetaSyncChatActionProto",m.internalSpec={type:[1,e.TYPES.STRING],chatJid:[2,e.TYPES.STRING],archived:[3,e.TYPES.BOOL],ts:[4,e.TYPES.INT64],messageRange:[5,e.TYPES.MESSAGE,d],read:[6,e.TYPES.BOOL]},p.name="MetaSyncMessageActionProto",p.internalSpec={type:[1,e.TYPES.STRING],protocolMsgId:[2,e.TYPES.MESSAGE,s]},_.name="MetaSyncActionProto",_.internalSpec={chatAction:[1,e.TYPES.MESSAGE,m],messageAction:[2,e.TYPES.MESSAGE,p],__oneofs__:{action:["chatAction","messageAction"]}},f.name="MetaSyncAppDataProto",f.internalSpec={actions:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_]},g.name="EncryptedBackupsSecretsEpochProto",g.internalSpec={id:[1,e.TYPES.UINT64],anonId:[2,e.TYPES.BYTES],rootKey:[3,e.TYPES.BYTES],status:[4,e.TYPES.INT32]},h.name="EncryptedBackupsSecretsProto",h.internalSpec={backupId:[1,e.TYPES.UINT64],serverDataId:[2,e.TYPES.UINT64],epoch:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,g],tempOcmfClientState:[4,e.TYPES.BYTES],mailboxRootKey:[5,e.TYPES.BYTES],obliviousValidationToken:[6,e.TYPES.BYTES]},y.name="FingerprintProto",y.internalSpec={currentIndex:[1,e.TYPES.UINT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.UINT32],rawId:[3,e.TYPES.UINT32]},C.name="SyncKeyDataProto",C.internalSpec={keyId:[1,e.TYPES.BYTES],keyData:[2,e.TYPES.BYTES],keyEpoch:[3,e.TYPES.UINT32],timestamp:[4,e.TYPES.INT64],fingerprint:[5,e.TYPES.MESSAGE,y]},b.name="SyncKeyShareProto",b.internalSpec={keys:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,C],orphanKeys:[2,e.FLAGS.REPEATED|e.TYPES.BYTES]},v.name="SyncKeyRequestProto",v.internalSpec={keyIds:[1,e.FLAGS.REPEATED|e.TYPES.BYTES]},S.name="AppDataProto",S.internalSpec={type:[1,e.TYPES.STRING],actions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],encryptedBackupsSecrets:[3,e.TYPES.MESSAGE,h],syncKeyShare:[4,e.TYPES.MESSAGE,b],syncKeyRequest:[5,e.TYPES.MESSAGE,v]},R.name="IdentitiesPerDeviceProto",R.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},L.name="AppDataTableSchemaProto",L.internalSpec={externalId:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],contents:[3,e.TYPES.MESSAGE,S],permittedIdentitiesPerDevice:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,R],ack:[5,e.TYPES.INT32],appDataId:[6,e.TYPES.INT32],recipientDevices:[7,e.FLAGS.REPEATED|e.TYPES.STRING],sendPartial:[8,e.TYPES.BOOL]},l.ProtocolMsgIdSpec=s,l.MetaSyncMessageKeyProtoSpec=u,l.MetaSyncMessageProtoSpec=c,l.MetaSyncMessageRangeProtoSpec=d,l.MetaSyncChatActionProtoSpec=m,l.MetaSyncMessageActionProtoSpec=p,l.MetaSyncActionProtoSpec=_,l.MetaSyncAppDataProtoSpec=f,l.EncryptedBackupsSecretsEpochProtoSpec=g,l.EncryptedBackupsSecretsProtoSpec=h,l.FingerprintProtoSpec=y,l.SyncKeyDataProtoSpec=C,l.SyncKeyShareProtoSpec=b,l.SyncKeyRequestProtoSpec=v,l.AppDataProtoSpec=S,l.IdentitiesPerDeviceProtoSpec=R,l.AppDataTableSchemaProtoSpec=L}),98);
__d("MAWArmadilloAppMetaTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DbAppMetaValuesProto",s.internalSpec={msgTypeVersion:[1,(e=o("WAProtoConst")).TYPES.INT32],hmacKey:[2,e.TYPES.BYTES],allowSecurityAlert:[3,e.TYPES.BOOL],hotlikeSticker:[4,e.TYPES.BYTES],isBackfilledForOccamadillo:[5,e.TYPES.BOOL],allowSecurityAlertForSelf:[11,e.TYPES.BOOL],hasMigratedFromDexie:[12,e.TYPES.BOOL],restoreMigrationAttempts:[13,e.TYPES.INT32],deviceJid:[14,e.TYPES.STRING],restoreToDexieMigrationComplete:[15,e.TYPES.BOOL],dbMigrationVersion:[16,e.TYPES.INT32]},u.name="AppMetaTableSchemaProto",u.internalSpec={key:[1,e.TYPES.STRING],value:[2,e.TYPES.MESSAGE,s]},l.DbAppMetaValuesProtoSpec=s,l.AppMetaTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloCollectionVersionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="CollectionVersionsTableSchemaProto",s.internalSpec={collection:[1,(e=o("WAProtoConst")).TYPES.STRING],version:[2,e.TYPES.INT32],state:[3,e.TYPES.STRING],finiteFailureStartTime:[4,e.TYPES.INT64],ltHash:[5,e.TYPES.BYTES],isCollectionInMacMismatchFatal:[6,e.TYPES.BOOL],isCollectionLthashInconsistent:[7,e.TYPES.BOOL]},l.CollectionVersionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloContactsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="EphemeralSettingProto",s.internalSpec={ephemeralExpirationInSec:[1,(e=o("WAProtoConst")).TYPES.UINT32],ephemeralLastUpdatedOrSetTimestamp:[2,e.TYPES.INT64]},u.name="EphemeralSyncResponseBackoffInfo",u.internalSpec={syncResponseRetries:[1,e.TYPES.INT32],syncResponseSentTs:[2,e.TYPES.INT64]},l.EphemeralSettingProtoSpec=s,l.EphemeralSyncResponseBackoffInfoSpec=u}),98);
__d("MAWArmadilloDeletedMessagesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeletedMessagesTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],chat:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reason:[4,e.TYPES.STRING]},l.DeletedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDeviceChangeAlertsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="DeviceChangeAlertsTableSchemaProto",s.internalSpec={action:[1,(e=o("WAProtoConst")).TYPES.STRING],isArchived:[2,e.TYPES.BOOL],deviceChangeAlertsId:[3,e.TYPES.INT64],location:[4,e.TYPES.STRING],model:[5,e.TYPES.STRING],ts:[6,e.TYPES.INT64],loggedOut:[7,e.TYPES.BOOL],deviceJid:[8,e.TYPES.STRING],identity:[9,e.TYPES.BYTES],platform:[10,e.TYPES.STRING],latitude:[11,e.TYPES.STRING],longitude:[12,e.TYPES.STRING],isConfirmed:[13,e.TYPES.BOOL],isNotified:[14,e.TYPES.BOOL]},l.DeviceChangeAlertsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloDyiBatchTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={BACKUP_RESTORE:0,E2E_DYI:1},u={};u.name="DyiBatchTableSchemaProto",u.internalSpec={batchId:[1,(e=o("WAProtoConst")).TYPES.INT32],numMessages:[2,e.TYPES.INT32],oldestTs:[3,e.TYPES.INT64],threadId:[4,e.TYPES.STRING],isThread:[5,e.TYPES.BOOL],numMessagesRestored:[6,e.TYPES.INT32],qplInstanceKeyForThread:[7,e.TYPES.INT64],qplFlowDescriptor:[8,e.TYPES.ENUM,s],qplInstanceKeyE2E:[9,e.TYPES.INT64],numThreadsRestored:[10,e.TYPES.INT64]},l.DYI_BATCH_TABLE_SCHEMA_PROTO_QPL_FLOW_DESCRIPTOR=s,l.DyiBatchTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloEBMsgRangesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EBMsgRangesTableSchemaProto",s.internalSpec={rangeId:[1,(e=o("WAProtoConst")).TYPES.UINT32],threadJid:[2,e.TYPES.STRING],minMsgExternalId:[3,e.TYPES.STRING],maxMsgExternalId:[4,e.TYPES.STRING],minMsgSortOrderMs:[5,e.TYPES.UINT64],maxMsgSortOrderMs:[6,e.TYPES.UINT64],creationTime:[7,e.TYPES.INT64]},l.EBMsgRangesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={};s.name="MsgContentProto",s.internalSpec={content:[1,(e=o("WAProtoConst")).TYPES.STRING],adminMsgContent:[2,e.FLAGS.REPEATED|e.TYPES.STRING],adminType:[3,e.TYPES.STRING],obsoleteExpiration:[4,e.TYPES.INT32],obsoleteTs:[5,e.TYPES.INT64],subtype:[6,e.TYPES.STRING],protobuf:[7,e.TYPES.BYTES],screenshotActionType:[8,e.TYPES.INT32],authorName:[9,e.TYPES.STRING],version:[10,e.TYPES.INT32],mentionedJids:[11,e.FLAGS.REPEATED|e.TYPES.STRING],commands:[12,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u]},u.name="MsgContentCommandProto",u.internalSpec={commandType:[1,e.TYPES.INT32],offset:[2,e.TYPES.INT32],length:[3,e.TYPES.INT32],validationToken:[4,e.TYPES.STRING]},c.name="ReportingMetaProto",c.internalSpec={frankingTag:[1,e.TYPES.BYTES],frankingVersion:[2,e.TYPES.INT32],reportingContent:[3,e.TYPES.BYTES],reportingTag:[4,e.TYPES.BYTES],frankingKey:[5,e.TYPES.BYTES]},d.name="DbQuotedMsgProto",d.internalSpec={remoteJid:[1,e.TYPES.STRING],content:[2,e.TYPES.MESSAGE,h]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.INT32],width:[2,e.TYPES.INT32],height:[3,e.TYPES.INT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.INT32],jpegThumbnailWidth:[7,e.TYPES.INT32]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.INT32],jpegThumbnailWidth:[5,e.TYPES.INT32]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.INT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="QuotedDbMediaProto",g.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.INT32],ts:[4,e.TYPES.INT64],mediaEntry:[5,e.TYPES.BYTES],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],validatedDocumentFileInfo:[9,e.TYPES.MESSAGE,f]},h.name="DbQuotedMsgContentProto",h.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],msgContent:[5,e.TYPES.MESSAGE,s],obsoleteMedia:[6,e.TYPES.MESSAGE,g],msgId:[7,e.TYPES.STRING],mediaId:[8,e.TYPES.INT32],sourceId:[9,e.TYPES.STRING],xmaMessageType:[10,e.TYPES.INT32],specialTextSize:[11,e.TYPES.INT32],plaintextHash:[12,e.TYPES.STRING],expirationTs:[13,e.TYPES.INT64]},y.name="MessagesTableSchemaProto",y.internalSpec={type:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],msgContent:[8,e.TYPES.MESSAGE,s],altIndex:[9,e.TYPES.STRING],forwardingScore:[10,e.TYPES.INT32],quote:[11,e.TYPES.MESSAGE,d],messageExpirationTs:[12,e.TYPES.INT64],ephemeralSetting:[13,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],revokedExternalId:[14,e.TYPES.STRING],isForwarded:[15,e.TYPES.BOOL],originalTs:[17,e.TYPES.INT64],sortOrderMs:[18,e.TYPES.INT64],reportingMeta:[19,e.TYPES.MESSAGE,c],messageDeleteTs:[20,e.TYPES.INT64],ephemeralCounterStarted:[21,e.TYPES.BOOL],quoteExternalId:[22,e.TYPES.STRING],unsendMsgContentDeleteTs:[23,e.TYPES.INT64],rowId:[24,e.TYPES.INT32],thread:[25,e.TYPES.INT32],mediaId:[26,e.TYPES.INT32],ephemeralMsgDisappeared:[27,e.TYPES.BOOL],threadJid:[28,e.TYPES.STRING],xmaId:[29,e.TYPES.INT32],specialTextSize:[30,e.TYPES.INT32],xmaMessageType:[31,e.TYPES.INT32],isExpiredXmaMsg:[32,e.TYPES.BOOL],ravenEphemeralType:[33,e.TYPES.INT32],ravenEphemeralMediaState:[34,e.TYPES.INT32],editCount:[35,e.TYPES.INT32],groupId:[36,e.TYPES.STRING],groupIndex:[37,e.TYPES.INT64],groupSize:[38,e.TYPES.INT64],receiverFetchId:[39,e.TYPES.STRING],source:[40,e.TYPES.STRING],quoteExpirationTs:[41,e.TYPES.INT64],applicationErrorCode:[42,e.TYPES.INT32],hdType:[43,e.TYPES.INT32],pollStanzaId:[44,e.TYPES.STRING],collapsibleId:[45,e.TYPES.STRING],isCollapsed:[46,e.TYPES.BOOL]},l.MsgContentProtoSpec=s,l.MsgContentCommandProtoSpec=u,l.ReportingMetaProtoSpec=c,l.DbQuotedMsgProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.QuotedDbMediaProtoSpec=g,l.DbQuotedMsgContentProtoSpec=h,l.MessagesTableSchemaProtoSpec=y}),98);
__d("MAWArmadilloEditMsgHistoryTableSchema.pb",["MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="EditMsgHistoryTableSchemaProto",s.internalSpec={author:[1,(e=o("WAProtoConst")).TYPES.STRING],editMsgHistoryId:[2,e.TYPES.INT32],editTs:[3,e.TYPES.INT64],msgContent:[4,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").MsgContentProtoSpec],originalMsgExternalId:[5,e.TYPES.STRING],specialTextSize:[6,e.TYPES.INT32],threadJid:[7,e.TYPES.STRING],editExternalId:[8,e.TYPES.STRING],sendStatus:[9,e.TYPES.INT32]},l.EditMsgHistoryTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInfoSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadId:[2,e.TYPES.INT32],creator:[3,e.TYPES.STRING],creationTs:[4,e.TYPES.INT64],name:[5,e.TYPES.STRING],nameOwner:[6,e.TYPES.STRING],nameTs:[7,e.TYPES.INT64],msgExpiration:[8,e.TYPES.INT32],participantVersion:[9,e.TYPES.STRING],inviter:[10,e.TYPES.STRING],memberAddMode:[11,e.TYPES.STRING]},l.GroupInfoSchemaProtoSpec=s}),98);
__d("MAWArmadilloGroupInvitesTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="GroupInvitesTableSchemaProto",s.internalSpec={inviterJid:[1,(e=o("WAProtoConst")).TYPES.STRING],invitedParticipantId:[2,e.TYPES.STRING],inviteCode:[3,e.TYPES.STRING],inviteExpirationTs:[4,e.TYPES.INT64],caption:[5,e.TYPES.STRING]},l.GroupInvitesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloMediaTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={NONE:0,LQ_4K:1,HQ_4K:2},u={},c={},d={},m={},p={},_={},f={},g={},h={};u.name="ChunkTableSchemaProto",u.internalSpec={plaintextHash:[1,(e=o("WAProtoConst")).TYPES.STRING],blobData:[2,e.TYPES.BYTES],mimetype:[3,e.TYPES.STRING],hashedPlaintextHash:[4,e.TYPES.STRING],chunkId:[5,e.TYPES.INT32]},c.name="MediaBackupSchemaProto",c.internalSpec={mediaBackupId:[1,e.TYPES.INT32],mediaId:[2,e.TYPES.INT32],objectId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],fbid:[5,e.TYPES.STRING]},d.name="MediaEntriesProto",d.internalSpec={msgId:[1,e.TYPES.STRING],mediaEntryData:[2,e.TYPES.BYTES]},m.name="VideoMsgContentProto",m.internalSpec={duration:[1,e.TYPES.UINT32],width:[2,e.TYPES.UINT32],height:[3,e.TYPES.UINT32],mimetype:[4,e.TYPES.STRING],jpegThumbnail:[5,e.TYPES.BYTES],jpegThumbnailHeight:[6,e.TYPES.UINT32],jpegThumbnailWidth:[7,e.TYPES.UINT32],thumbnailPlaintextHash:[8,e.TYPES.STRING],gifPlayback:[9,e.TYPES.BOOL]},p.name="ImageMsgContentProto",p.internalSpec={width:[1,e.TYPES.UINT32],height:[2,e.TYPES.UINT32],jpegThumbnail:[3,e.TYPES.BYTES],jpegThumbnailHeight:[4,e.TYPES.UINT32],jpegThumbnailWidth:[5,e.TYPES.UINT32],thumbnailPlaintextHash:[6,e.TYPES.STRING],hdType:[7,e.TYPES.ENUM,s]},_.name="AudioMsgContentProto",_.internalSpec={duration:[1,e.TYPES.UINT32],mimetype:[2,e.TYPES.STRING],played:[3,e.TYPES.BOOL],waveform:[4,e.TYPES.BYTES]},f.name="DocumentFileMsgContentProto",f.internalSpec={filename:[1,e.TYPES.STRING],mimetype:[2,e.TYPES.STRING]},g.name="ValidatedResult",g.internalSpec={validatedMimeType:[1,e.TYPES.STRING],videoStreamType:[2,e.TYPES.STRING],videoCalculatedFps:[3,e.TYPES.UINT32],videoNominalFps:[4,e.TYPES.UINT32],videoWidth:[5,e.TYPES.UINT32],videoHeight:[6,e.TYPES.UINT32],videoDuration:[7,e.TYPES.UINT32],videoAvgBitsPerSecond:[8,e.TYPES.UINT32],audioStreamType:[9,e.TYPES.STRING],audioSamplingRate:[10,e.TYPES.UINT32],audioNumberOfChannels:[11,e.TYPES.UINT32],audioAvgBitsPerSecond:[12,e.TYPES.UINT32]},h.name="MediaTableSchemaProto",h.internalSpec={mediaType:[1,e.TYPES.STRING],plaintextHash:[2,e.TYPES.STRING],size:[3,e.TYPES.UINT64],mediaEntries:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],ts:[5,e.TYPES.INT64],validatedVideoInfo:[6,e.TYPES.MESSAGE,m],validatedImageInfo:[7,e.TYPES.MESSAGE,p],validatedAudioInfo:[8,e.TYPES.MESSAGE,_],hashedPlaintextHash:[9,e.TYPES.STRING],mediaId:[10,e.TYPES.INT32],msgIds:[11,e.FLAGS.REPEATED|e.TYPES.STRING],objectId:[12,e.TYPES.STRING],fbid:[13,e.TYPES.STRING],validatedDocumentFileInfo:[14,e.TYPES.MESSAGE,f],validatedResult:[15,e.TYPES.MESSAGE,g],accessibilitySummaryText:[16,e.TYPES.STRING],isVideoGif:[17,e.TYPES.BOOL]},l.HD_TYPE=s,l.ChunkTableSchemaProtoSpec=u,l.MediaBackupSchemaProtoSpec=c,l.MediaEntriesProtoSpec=d,l.VideoMsgContentProtoSpec=m,l.ImageMsgContentProtoSpec=p,l.AudioMsgContentProtoSpec=_,l.DocumentFileMsgContentProtoSpec=f,l.ValidatedResultSpec=g,l.MediaTableSchemaProtoSpec=h}),98);
__d("MAWArmadilloMissingKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="DeviceResponse",s.internalSpec={deviceId:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceResponse:[2,e.TYPES.BOOL]},u.name="MissingKeysTableSchemaProto",u.internalSpec={keyHex:[1,e.TYPES.STRING],keyId:[2,e.TYPES.BYTES],timestamp:[3,e.TYPES.INT64],deviceResponses:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},l.DeviceResponseSpec=s,l.MissingKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloParticipantsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ParticipantsTableSchemaProto",s.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.STRING],userJid:[2,e.TYPES.STRING],deliveredWatermarkTs:[3,e.TYPES.INT64],lastReadWatermarkTs:[4,e.TYPES.INT64],type:[5,e.TYPES.STRING],addressable:[6,e.TYPES.BOOL],lastReadActionTs:[7,e.TYPES.INT64],threadId:[9,e.TYPES.INT32],threadJid:[10,e.TYPES.STRING]},l.ParticipantsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPendingMutationsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={SET:0,REMOVE:1},u={};u.name="PendingMutationsTableSchemaProto",u.internalSpec={id:[1,(e=o("WAProtoConst")).TYPES.INT32],collection:[2,e.TYPES.STRING],index:[3,e.TYPES.STRING],binarySyncAction:[4,e.TYPES.BYTES],version:[5,e.TYPES.INT32],operation:[6,e.TYPES.ENUM,s],timestamp:[7,e.TYPES.INT64],action:[8,e.TYPES.STRING]},l.SYNCD_MUTATION_SYNCD_OPERATION=s,l.PendingMutationsTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="PersonalSenderKeyStatusTableSchemaProto",s.internalSpec={groupJid:[1,(e=o("WAProtoConst")).TYPES.STRING],senderKeyId:[2,e.TYPES.INT32],rotateSenderKey:[4,e.TYPES.BOOL],senderKeyTs:[5,e.TYPES.INT64],hasSenderKey:[6,e.FLAGS.REPEATED|e.TYPES.STRING]},l.PersonalSenderKeyStatusTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloPollTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={OPEN:0,FROZEN:1},u={},c={},d={},m={};u.name="PollOptionProto",u.internalSpec={optionText:[1,(e=o("WAProtoConst")).TYPES.STRING],voteAuthors:[2,e.FLAGS.REPEATED|e.TYPES.STRING]},c.name="PollOptionsProto",c.internalSpec={pollOptionHash:[1,e.TYPES.STRING],pollOption:[2,e.TYPES.MESSAGE,u]},d.name="LatestSenderTimestampsMsProto",d.internalSpec={author:[1,e.TYPES.STRING],latestSenderTimestampMs:[2,e.TYPES.INT64]},m.name="PollTableSchemaProto",m.internalSpec={chatJid:[1,e.TYPES.STRING],encKey:[2,e.TYPES.BYTES],pollAuthor:[3,e.TYPES.STRING],pollStanzaId:[4,e.TYPES.STRING],pollOptions:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],pollParticipantCount:[6,e.TYPES.UINT32],pollState:[7,e.TYPES.ENUM,s],selectableOptionsCount:[8,e.TYPES.UINT32],title:[9,e.TYPES.STRING],latestSenderTimestampsMs:[10,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d]},l.POLL_STATE=s,l.PollOptionProtoSpec=u,l.PollOptionsProtoSpec=c,l.LatestSenderTimestampsMsProtoSpec=d,l.PollTableSchemaProtoSpec=m}),98);
__d("MAWArmadilloReactionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReactionsTableSchemaProto",s.internalSpec={ack:[1,(e=o("WAProtoConst")).TYPES.INT32],author:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],reactionId:[4,e.TYPES.STRING],reactToExternalId:[5,e.TYPES.STRING],reactToAuthor:[6,e.TYPES.STRING],reactToMsgId:[7,e.TYPES.STRING],threadJid:[8,e.TYPES.STRING],reaction:[9,e.TYPES.STRING],groupingKey:[10,e.TYPES.STRING],ts:[11,e.TYPES.INT64],rowId:[12,e.TYPES.INT32],senderTimestampMs:[13,e.TYPES.INT64]},l.ReactionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloReceiptTablesSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={};s.name="DbUserStatusTsProto",s.internalSpec={deliveredTs:[1,(e=o("WAProtoConst")).TYPES.INT64],readTs:[2,e.TYPES.INT64]},u.name="StatusTsPerUserProto",u.internalSpec={userJid:[1,e.TYPES.STRING],dbUserStatusTs:[2,e.TYPES.MESSAGE,s]},c.name="IdentitiesPerDeviceProto",c.internalSpec={deviceJid:[1,e.TYPES.STRING],serializedPubKey:[2,e.TYPES.BYTES],baseKey:[3,e.TYPES.BYTES]},d.name="RetryCountPerDeviceProto",d.internalSpec={deviceJid:[1,e.TYPES.STRING],count:[2,e.TYPES.INT32]},m.name="ReceiptsTableSchemaProto",m.internalSpec={msgId:[1,e.TYPES.STRING],statusTsPerUser:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],permittedIdentitiesPerDevice:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,c],recipientDevices:[4,e.FLAGS.REPEATED|e.TYPES.STRING],retryCountsPerDevice:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],waMsgId:[6,e.TYPES.STRING]},p.name="Receipts",p.internalSpec={device:[1,e.TYPES.STRING],ts:[2,e.TYPES.INT64]},_.name="PendingReceiptsTableSchemaProto",_.internalSpec={pendingReceiptId:[1,e.TYPES.STRING],thread:[2,e.TYPES.STRING],externalId:[3,e.TYPES.STRING],author:[4,e.TYPES.STRING],deliveryReceipts:[5,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p],readReceipts:[6,e.FLAGS.REPEATED|e.TYPES.MESSAGE,p]},l.DbUserStatusTsProtoSpec=s,l.StatusTsPerUserProtoSpec=u,l.IdentitiesPerDeviceProtoSpec=c,l.RetryCountPerDeviceProtoSpec=d,l.ReceiptsTableSchemaProtoSpec=m,l.ReceiptsSpec=p,l.PendingReceiptsTableSchemaProtoSpec=_}),98);
__d("MAWArmadilloReceiverFetchInfoTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ReceiverFetchInfoTableSchemaProto",s.internalSpec={mimetype:[1,(e=o("WAProtoConst")).TYPES.STRING],previewHeight:[2,e.TYPES.UINT32],previewWidth:[3,e.TYPES.UINT32],receiverFetchId:[4,e.TYPES.STRING],type:[5,e.TYPES.STRING],previewUrl:[6,e.TYPES.STRING],previewUrlExpirationTimestampMs:[7,e.TYPES.UINT64],accessibilitySummaryText:[8,e.TYPES.STRING]},l.ReceiverFetchInfoTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncActionsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="SyncActionsTableSchemaProto",s.internalSpec={index:[1,(e=o("WAProtoConst")).TYPES.STRING],binarySyncData:[2,e.TYPES.BYTES],actionState:[3,e.TYPES.STRING],version:[4,e.TYPES.INT32],keyId:[5,e.TYPES.BYTES],modelId:[6,e.TYPES.STRING],modelType:[7,e.TYPES.STRING],indexMac:[8,e.TYPES.BYTES],valueMac:[9,e.TYPES.BYTES],collection:[10,e.TYPES.STRING],timestamp:[11,e.TYPES.INT64],action:[12,e.TYPES.STRING]},l.SyncActionsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloSyncKeysTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="SyncKeyFingerprint",s.internalSpec={currentIndex:[1,(e=o("WAProtoConst")).TYPES.INT32],deviceIndexes:[2,e.FLAGS.REPEATED|e.TYPES.INT32],rawId:[3,e.TYPES.INT64]},u.name="SyncKeysTableSchemaProto",u.internalSpec={id:[1,e.TYPES.BYTES],keyId:[2,e.TYPES.BYTES],keyData:[3,e.TYPES.BYTES],keyEpoch:[4,e.TYPES.INT64],timestamp:[5,e.TYPES.INT64],fingerprint:[6,e.TYPES.MESSAGE,s]},l.SyncKeyFingerprintSpec=s,l.SyncKeysTableSchemaProtoSpec=u}),98);
__d("MAWArmadilloTasksTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e={};e.name="TasksTableSchemaProto",e.internalSpec={taskName:[1,o("WAProtoConst").TYPES.STRING],scheduledTime:[2,o("WAProtoConst").TYPES.INT64]},l.TasksTableSchemaProtoSpec=e}),98);
__d("MAWArmadilloThreadsTableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="ThreadsTableSchemaProto",s.internalSpec={jid:[1,(e=o("WAProtoConst")).TYPES.STRING],threadOrder:[2,e.TYPES.STRING],folder:[4,e.TYPES.INT32],newestMsg:[5,e.TYPES.STRING],oldestMsg:[6,e.TYPES.STRING],lastReadMsg:[7,e.TYPES.STRING],lastReadMsgReceiptSent:[8,e.TYPES.STRING],lastReadMsgTs:[9,e.TYPES.INT64],newestMsgTs:[10,e.TYPES.INT64],muteExpireTimeMs:[11,e.TYPES.INT64],muteCallsExpireTimeMs:[12,e.TYPES.INT64],archived:[13,e.TYPES.BOOL],cannotReplyReason:[14,e.TYPES.STRING],chatId:[15,e.TYPES.INT32],optimisticThreadKey:[16,e.TYPES.STRING],isMigratedLocally:[17,e.TYPES.BOOL],snippetMsg:[18,e.TYPES.STRING],deduplicationKey:[19,e.TYPES.STRING],authoritativeThreadKey:[20,e.TYPES.STRING],snippetMsgTs:[21,e.TYPES.INT64],didInsertDualThreadCutoverAdminMsg:[22,e.TYPES.BOOL],unbumpFromTs:[23,e.TYPES.INT64],unbumpToTs:[24,e.TYPES.INT64]},l.ThreadsTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloUnrenderedMessagesTableSchema.pb",["MAWArmadilloContactsTableSchema.pb","MAWArmadilloMessagesTableSchema.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={};s.name="UnrenderedMessagesTableSchemaProto",s.internalSpec={type:[1,(e=o("WAProtoConst")).TYPES.STRING],ts:[2,e.TYPES.INT64],externalId:[3,e.TYPES.STRING],msgId:[4,e.TYPES.STRING],author:[5,e.TYPES.STRING],ack:[6,e.TYPES.INT32],resendCount:[7,e.TYPES.INT32],ephemeralSetting:[8,e.TYPES.MESSAGE,o("MAWArmadilloContactsTableSchema.pb").EphemeralSettingProtoSpec],messageDeleteForMeTs:[9,e.TYPES.INT64],rowId:[10,e.TYPES.INT32],thread:[11,e.TYPES.INT32],mediaId:[12,e.TYPES.INT32],msgContent:[13,e.TYPES.STRING],threadJid:[14,e.TYPES.STRING],reportingMeta:[15,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").ReportingMetaProtoSpec],invitedParticipantUserJid:[16,e.TYPES.STRING],groupName:[17,e.TYPES.STRING],quote:[18,e.TYPES.MESSAGE,o("MAWArmadilloMessagesTableSchema.pb").DbQuotedMsgProtoSpec],xmaMessageType:[19,e.TYPES.INT32],sortOrderMs:[20,e.TYPES.INT64]},l.UnrenderedMessagesTableSchemaProtoSpec=s}),98);
__d("MAWArmadilloXMATableSchema.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="XMATableSchemaProto",s.internalSpec={associatedMessageId:[1,(e=o("WAProtoConst")).TYPES.STRING],author:[2,e.TYPES.STRING],ctas:[3,e.FLAGS.REPEATED|e.TYPES.MESSAGE,u],defaultCTA:[4,e.TYPES.MESSAGE,u],defaultPreviewMediaId:[5,e.TYPES.INT32],externalId:[6,e.TYPES.STRING],faviconMediaId:[7,e.TYPES.INT32],headerMediaId:[8,e.TYPES.INT32],headerTitle:[9,e.TYPES.STRING],isTombstoned:[10,e.TYPES.BOOL],maxSubtitleNumOfLines:[11,e.TYPES.INT32],maxTitleNumOfLines:[12,e.TYPES.INT32],msgId:[13,e.TYPES.STRING],overlayDescription:[14,e.TYPES.STRING],overlayIconGlyph:[15,e.TYPES.INT32],overlayTitle:[16,e.TYPES.STRING],previewMediaIds:[17,e.FLAGS.REPEATED|e.TYPES.INT32],subtitleText:[18,e.TYPES.STRING],targetExpiringAtSec:[19,e.TYPES.INT64],targetId:[20,e.TYPES.STRING],targetType:[21,e.TYPES.INT32],targetUsername:[22,e.TYPES.STRING],threadJid:[23,e.TYPES.STRING],titleText:[24,e.TYPES.STRING],xmaId:[25,e.TYPES.INT32],xmaLayoutType:[26,e.TYPES.INT32],defaultPreviewMediaPlaintextHash:[27,e.TYPES.STRING],faviconPlaintextHash:[28,e.TYPES.STRING],headerMediaPlaintextHash:[29,e.TYPES.STRING]},u.name="CTAProto",u.internalSpec={buttonType:[1,e.TYPES.INT32],title:[2,e.TYPES.STRING],actionUrl:[3,e.TYPES.STRING],nativeUrl:[4,e.TYPES.STRING],ctaType:[5,e.TYPES.STRING]},l.XMATableSchemaProtoSpec=s,l.CTAProtoSpec=u}),98);
__d("MAWAuthoritativeThreadsCache",[],(function(t,n,r,o,a,i){"use strict";var e=new Set;i.AuthoritativeThreadsCache=e}),66);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n,r,o){var a=o.accessibilitySummaryText,i=o.mimetype,l=o.previewHeight,s=o.previewUrl,u=o.previewUrlExpirationTimestampMs,m=o.previewWidth,p=o.receiverFetchId,_=o.type;return{accessibilitySummaryText:a,mimetype:i,msgId:t,previewHeight:l,previewUrl:s,previewUrlExpirationTimestampMs:d(u),previewWidth:m,receiverFetchId:p,sortOrderMs:c(n,r),threadJid:e,type:_}}function u(e,t,n,r,o){var a=o.mimetype,i=o.previewHeight,l=o.previewWidth,s=o.receiverFetchId,u=o.type;return{mimetype:a,msgId:t,previewHeight:i,previewWidth:l,receiverFetchId:s,sortOrderMs:c(n,r),threadJid:e,type:u}}function c(e,t){return o("WATimeUtils").castToMillisTime(e!=null?e:t*1e3)}function d(t){if(t!=null)try{return o("WATimeUtils").castLongIntToMillisTime(t)}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""])),t);return}}l.createBridgeReceiverFetchInfoPayloadFromDbInfo=s,l.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=u}),98);
__d("MAWBridgeTypesCreators",["FBLogger","MAWAudioUtils","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{threadJid:e}}function s(e){var t,n=e.ts;switch(e.type){case o("MAWMsgType").MSG_TYPE.REVOKED:n=(t=e.originalTs)!=null?t:e.ts;break;default:n=o("MAWDbMsg").getCanonicalTsFromMsg(e)}return{msgId:e.msgId,ts:n}}function u(e,t){var n=t.map(s);return{messages:n,threadJid:e}}function c(e){return{ravenMsgId:e.msgId,threadJid:e.threadJid}}function d(e,t){return e.filter(function(e){return t===e.threadJid}).map(function(e){return e.msgId})}function m(e){var t,n,a,i,l,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R=e.chatJid,L=e.filteredMsgIds,E=e.hasMediaForUI,k=e.hdTypes,I=e.media,T=e.offlineAttachmentId,D=e.ravenSettings,x=e.sortOrderMs,$=e.transportKey;switch(I.mediaType){case"Image":return{duration:null,ephemeralMediaState:D==null?void 0:D.ephemeralMediaState,ephemeralMediaViewMode:D==null?void 0:D.ephemeralMediaViewMode,filesize:I.size,hasMedia:E,hasPreviewMedia:((t=I.validatedImageInfo)==null?void 0:t.jpegThumbnail)!=null,hdTypes:k,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(n=I.validatedImageInfo)==null?void 0:n.jpegThumbnailHeight,previewHeightLarge:(a=I.validatedImageInfo)==null?void 0:a.height,previewWidth:(i=I.validatedImageInfo)==null?void 0:i.jpegThumbnailWidth,previewWidthLarge:(l=I.validatedImageInfo)==null?void 0:l.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Video":return{duration:((s=I.validatedVideoInfo)==null?void 0:s.duration)!=null?((u=I.validatedVideoInfo)==null?void 0:u.duration)*1e3:0,ephemeralMediaState:D==null?void 0:D.ephemeralMediaState,ephemeralMediaViewMode:D==null?void 0:D.ephemeralMediaViewMode,filesize:I.size,gifPlayback:((c=I.validatedVideoInfo)==null?void 0:c.gifPlayback)===!0||I.isVideoGif===!0,hasMedia:E,hasPreviewMedia:((d=I.validatedVideoInfo)==null?void 0:d.jpegThumbnail)!=null,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(m=I.validatedVideoInfo)==null?void 0:m.jpegThumbnailHeight,previewHeightLarge:(p=I.validatedVideoInfo)==null?void 0:p.height,previewWidth:(_=I.validatedVideoInfo)==null?void 0:_.jpegThumbnailWidth,previewWidthLarge:(f=I.validatedVideoInfo)==null?void 0:f.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Ptt":return{duration:(g=I.validatedAudioInfo)!=null&&g.duration?I.validatedAudioInfo.duration*1e3:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts),waveformData:((h=I.validatedAudioInfo)==null?void 0:h.waveform)!=null?o("MAWAudioUtils").serializeWaveform(I.validatedAudioInfo.waveform):void 0};case"Gif":return{accessibilitySummaryText:(y=I.accessibilitySummaryText)!=null?y:void 0,duration:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:I.msgIds,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:(C=I.validatedImageInfo)==null?void 0:C.jpegThumbnailHeight,previewHeightLarge:(b=I.validatedImageInfo)==null?void 0:b.height,previewWidth:(v=I.validatedImageInfo)==null?void 0:v.jpegThumbnailWidth,previewWidthLarge:(S=I.validatedImageInfo)==null?void 0:S.width,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)};case"Sticker":{var P,N,M,w=o("MAWImageUtils").boundHeightWidth((P=I.validatedImageInfo)==null?void 0:P.jpegThumbnailHeight,(N=I.validatedImageInfo)==null?void 0:N.jpegThumbnailWidth,o("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE),A=w.height,F=w.width;return{accessibilitySummaryText:(M=I.accessibilitySummaryText)!=null?M:void 0,duration:null,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:I.msgIds,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:A,previewHeightLarge:A,previewWidth:F,previewWidthLarge:F,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)}}case"DocumentFile":{var O,B={};for(var W of I.mediaEntries){var q=W[0],U=W[1],V=o("WAMediaUtils").mediaEntryDataToRawData(I.plaintextHash,U),H=V.filename;H!=null&&(B[q]=H)}return{defaultFilename:(O=I.validatedDocumentFileInfo)==null?void 0:O.filename,duration:null,filenames:B,filesize:I.size,hasMedia:E,mediaId:I.mediaId,mediaType:I.mediaType,msgIds:L,offlineAttachmentId:T,plaintextHash:I.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:o("WATimeUtils").castToMillisTime(x!=null?x:I.ts*1e3),threadJid:R,transportKey:$,ts:o("WATimeUtils").castToUnixTime(x!=null?x/1e3:I.ts)}}default:throw I.mediaType,r("FBLogger")("messenger_web").mustfixThrow("[createBridgeMedia] Unsupported media type: "+I.mediaType)}}function p(e,t,n){return{chatJid:e,deliveredWatermarkTs:n!=null?n:o("WATimeUtils").castToUnixTime(0),fbid:t,lastReadActionTs:o("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:o("WATimeUtils").castToUnixTime(0)}}function _(e){var t=e.cannotReplyReason,n=e.folder,r=e.snippetParams,o=e.snippetSenderContactId,a=e.snippetType,i=e.threadJid;return{cannotReplyReason:t,folder:n,snippetContactIDs:r==null?void 0:r.contactIDs,snippetMentionJIDs:r==null?void 0:r.mentionJIDs,snippetParams:r==null?void 0:r.strings,snippetSenderContactId:o,snippetType:a,threadJid:i}}function f(e){return{chatJid:e.groupJid,memberAddMode:e.memberAddMode,threadName:e.name}}var g={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function h(e){var t,n=e.bumpTimestampMs,r=e.description,o=e.isMessageAuthorMe,a=e.isUnbump,i=e.skipBumpTimestampValidation,l=e.skipServerThreadBump,s=e.snippetData,u=e.threadJid,c=s==null?g:{snippetContactIDs:s.params.contactIDs,snippetMentionJIDs:(t=s.params.mentionJIDs)!=null?t:[],snippetParams:s.params.strings,snippetSenderContactId:s.senderContactId,snippetType:s.type};return babelHelpers.extends({},c,{bumpTimestampMs:n,description:r,isMessageAuthorMe:o,isUnbump:a,skipBumpTimestampValidation:i!=null?i:!1,skipServerThreadBump:l!=null?l:!1,threadJid:u})}function y(e){var t=e.author,n=e.chatJid,r=e.reaction,a=e.reactToMsgId,i=e.ts;return{actorId:o("WAJids").authorToUserId(t,o("WAJids").extractUserId(o("MAWUserJidWrapper").getMyUserJid())),chatJid:n,messageId:a,reaction:r,ts:i}}function C(e){var t=o("WAJids").extractUserId(o("MAWUserJidWrapper").getMyUserJid()),n=e.author,r=e.chatJid,a=e.reactToMsgId;return{actorId:o("WAJids").authorToUserId(n,t),chatJid:r,messageId:a}}function b(e){return{creationTs:e.creationTs,creator:e.creator,groupJid:e.groupJid,msgExpiration:e.msgExpiration,name:e.name,nameOwner:e.nameOwner,nameTs:e.nameTs,participantVersion:e.participantVersion}}function v(e){var t=e.threadJid,n=e.inviteeJid;return{caption:e.caption,inviteCode:e.inviteCode,inviteeId:n,inviteExpireTs:e.inviteExpirationTs,inviterId:o("WAJids").extractUserId(e.inviterJid),threadJid:t}}function S(e){return{threadJid:e}}function R(e,t,n){return{senderId:o("WAJids").extractUserId(t),state:n,threadJid:e}}l.createBridgeUpdateE2EEMetadataParticipants=e,l.createBridgeDeletedMessage=s,l.createBridgeDeleteMessages=u,l.createBridgeRavenAction=c,l.getMsgIdsFilteredByJid=d,l.createBridgeMedia=m,l.createBridgeReceivedReceipt=p,l.createBridgeUpdatedThread=_,l.createBridgeUpdatedGroupInfo=f,l.createBridgeBumpedThreadV2=h,l.createBridgeUpsertReaction=y,l.createBridgeDeleteReaction=C,l.createBridgeGroupInfo=b,l.createBridgeGroupInvite=v,l.createBridgeDeleteGroupInvite=S,l.createBridgeReceivedChatState=R}),98);
__d("MAWCacheServiceQPL",["ExecutionEnvironment","MAWCurrentUser","MAWQplProxy","QPLUserFlow","performanceAbsoluteNow","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=new Set,c=new Set,d=3e3,m=r("qpl")._(1056836703,"2955");function p(t,n){var a=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(a){if(c.has(t))return;f(t),o("MAWQplProxy").startQplUserFlow(m,{},{callBridgeWithTimestamp:!0,providedInstanceKey:t})}else{if(u.has(t))return;_(t),r("QPLUserFlow").start(m,{annotations:{string:{service:n}},instanceKey:t})}}function _(e){u.add(e)}function f(e){c.add(e)}function g(t,n,a){var i=b(a),l=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(l){if(!c.has(t))return;o("MAWQplProxy").sendQplPointThroughBridge(m,"worker@"+i+n,{instanceKey:t},!0)}else{if(!u.has(t))return;var p=(s||(s=r("performanceAbsoluteNow")))();a==="realtime-update"?window.setTimeout(function(){r("QPLUserFlow").addPoint(m,"ui@"+n,{instanceKey:t,timestamp:p})},d):r("QPLUserFlow").addPoint(m,"ui@"+n,{instanceKey:t})}}function h(t,n){var a=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(a){if(!c.has(t))return;o("MAWQplProxy").sendQPLAnnotationsThroughBridge(m,n,t)}else{if(!u.has(t))return;r("QPLUserFlow").addAnnotations(m,n,{instanceKey:t})}}function y(t){var n=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(n){if(!c.has(t))return;c.delete(t),o("MAWQplProxy").sendQPLSuccessThroughBridge(m,{},t,!0)}else{if(!u.has(t))return;var a=(s||(s=r("performanceAbsoluteNow")))();window.setTimeout(function(){u.delete(t),r("QPLUserFlow").endSuccess(m,{instanceKey:t,timestamp:a})},d)}}function C(t,n,a){var i=b(a),l=(e||(e=r("ExecutionEnvironment"))).isInWorker||(e||(e=r("ExecutionEnvironment"))).isInSharedWorker;if(l){if(!c.has(t))return;o("MAWQplProxy").sendQPLFailThroughBridge(m,"worker@"+i+n,{},t,!0)}else{if(!u.has(t))return;var p=(s||(s=r("performanceAbsoluteNow")))();window.setTimeout(function(){u.delete(t),r("QPLUserFlow").endFailure(m,"ui@"+n,{instanceKey:t,timestamp:p})},d),u.delete(t)}}function b(e){return e?e.replace(/-/g,"_")+"_":""}function v(e){return o("MAWCurrentUser").isEmployee()||o("MAWCurrentUser").isTestUser()?e:void 0}var S={addAnnotationsQPL:h,addPointQPL:g,endFailureQPL:C,endSuccessQPL:y,redactKeysForNonEmployee:v,registerInstanceKeyInUI:_,registerInstanceKeyInWorker:f,startQPL:p};l.default=S}),98);
__d("MAWUICacheServicesBase",["FBLogger","MAWCacheServiceDB","MAWCacheServiceQPL","MAWMpsGating","Promise","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s;function u(e){return o("MAWMpsGating").isMpsSnippetsCacheServiceEnabled()?e+"_mps_reactive":e}var c=(function(){function t(e){this.$1=new Map,this.QPLMetadata=new Map,this.$2=e}var a=t.prototype;return a.resetInMemoryCache=function(t,n){var e=this.$1.get(t);e!=null&&(n==null||n.length===0||(r("FBLogger")("MAWUICacheServices").info("Reset in memory cache. Namespace: %s",t),n.forEach(function(t){e.delete(t)})))},a.updateInMemoryCacheAndTriggerCallback=function(t,n,o,a,i){this.$3(t,n);var e=this.$2[t];e!=null&&(a!=null&&(r("MAWCacheServiceQPL").addPointQPL(a,"triggering_callback",o),(o==="cache-invalidation"||o==="realtime-update"||o==="from-scratch"&&this.QPLMetadata.get(a)==="all-from-scratch"||o==="in-memory"&&i===!0)&&(r("MAWCacheServiceQPL").endSuccessQPL(a),this.QPLMetadata.delete(a))),e.onCacheChange(n,o))},a.checkInMemoryCacheAndTriggerCallback=function(t,n,o){var e=this,a=[],i=[];n.forEach(function(n){var r=e.$4(t,n);r==null?a.push(n):i.push([n,r])});var l=a.length===0;return l&&o!=null&&r("MAWCacheServiceQPL").addPointQPL(o,"all_in_memory"),i.length>0&&this.updateInMemoryCacheAndTriggerCallback(t,i,"in-memory",o,l),a},a.checkPersistedCacheAndTriggerCallback=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,a,i){var l=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),c=yield l.runInTransaction([t],"readonly",function(e){return(s||(s=n("Promise"))).all(a.map(function(n){return e.stores[t].getByIndex("key",[u(n)])}))},"read_from_persisted_"+t),d=[],m=[];return c.forEach(function(t,n){if(t==null)d.push(a[n]);else{var r=t.id,o=babelHelpers.objectWithoutPropertiesLoose(t,e);m.push([a[n],o])}}),i!=null&&r("MAWCacheServiceQPL").addAnnotationsQPL(i,{int:{numPersistedHit:m.length,numPersistedMiss:d.length}}),d.length===0&&i!=null&&r("MAWCacheServiceQPL").addPointQPL(i,"all_in_persisted"),m.length>0&&this.updateInMemoryCacheAndTriggerCallback(t,m,"persisted",i),d});function a(e,n,r){return t.apply(this,arguments)}return a})(),a.$3=function(t,n){var e,r=(e=this.$1.get(t))!=null?e:new Map;n.forEach(function(e){var t=e[0],n=e[1];r.set(t,n)}),this.$1.set(t,r)},a.$4=function(t,n){var e=this.$1.get(t);if(e==null)return null;var r;return(r=e.get(n))!=null?r:null},t})();l.adjustCacheKey=u,l.MAWUICacheServicesBase=c}),98);
__d("MAWCacheServiceBase",["MAWCacheServiceDB","MAWUICacheServicesBase","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["id"],s=(function(){function t(e){this.$1=new Map,this.namespace=e}var r=t.prototype;return r.$2=function(t){var e;return(e=this.$1.get(t))!=null?e:null},r.updateInMemoryCache=function(t,n){this.$1.set(t,n)},r.updateInMemoryCacheBulk=function(t){var e=this;t.forEach(function(t){var n=t[0],r=t[1];e.updateInMemoryCache(n,r)})},r.getValueFromCache=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=this,r=this.$2(t);if(r!=null)return r;var a=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB(),i=yield a.runInTransaction([this.namespace],"readonly",function(e){return e.stores[n.namespace].getByIndex("key",[o("MAWUICacheServicesBase").adjustCacheKey(t)])},"read_from_persisted_"+this.namespace);if(i==null)return null;var l=i.id,s=babelHelpers.objectWithoutPropertiesLoose(i,e);return this.updateInMemoryCache(t,s),s});function r(e){return t.apply(this,arguments)}return r})(),t})();l.default=s}),98);
__d("MAWDbParticipant",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e+"_"+t}i.craftParticipantId=e}),66);
__d("MAWDbThread",["MAWHexUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("MAWHexUtils").orderPreservingHex(e)+"_"+t}l.craftThreadOrder=e}),98);
__d("MAWDexie",["cr:10766"],(function(t,n,r,o,a,i,l){"use strict";i.exports=n("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","Promise","asyncToGeneratorRuntime","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return(e||(e=n("Promise"))).resolve(t)}function u(e){return e.reduce(function(e,t,n){return e.then(function(e){return t(n).then(function(t){return e.push(t),e})})},g([]))}function c(e){return r("MAWDexie").Promise.all(e)}function d(e){return r("MAWDexie").Promise.allSettled(e)}function m(e){return r("MAWDexie").Promise.PSD[e]}function p(e,t){r("MAWDexie").Promise.PSD[e]=t}function _(e){r("MAWDexie").Promise.PSD[e]=void 0}var f=(function(){function e(e,t,n,o){n===void 0&&(n=!0);var a=new(r("MAWDexie"))(e,babelHelpers.extends({},o,{chromeTransactionDurability:"relaxed",modifyChunkSize:r("justknobx")._("3166")}));t(a),this.name=e,this.stores=a,n&&this.open()}var t=e.prototype;return t.open=function(){this.stores.open()},t.close=function(){this.stores.close()},t.transact=function(t,r,o){var e=this;return s(this.stores.transaction(t,r.map(function(t){return e.stores[t]}),n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o();return e})))},babelHelpers.createClass(e,[{key:"tables",get:function(){return this.stores.tables}}])})();function g(e){return r("MAWDexie").Promise.resolve(e)}l.DEXIE_MIN_KEY=o("MAWDexie").Dexie.minKey,l.DEXIE_MAX_KEY=o("MAWDexie").Dexie.maxKey,l.undexify=s,l.dexieSequentialAll=u,l.dexieAll=c,l.dexieAllSettled=d,l.getDexiePSDItem=m,l.setDexiePSDItem=p,l.clearDexiePSDItem=_,l.DexieTable=f,l.dexieResolve=g}),98);
__d("MAWDbSchema.dexie",["FBLogger","MAWDbMsg","MAWDbParticipant","MAWDbThread","MAWDbVersionList","MAWDexie","MAWDexieTable","MAWFolderTypes","MAWLocalizationType","MAWODSProxy","MAWTimeUtils","WAJids","WALogger","WAMsg","WAMsgType","WAOdsEnums","WAStanzaUtils","WATimeUtils","emptyFunction","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t){var e=function(t){var e,n=(e=t.quote)==null?void 0:e.content;return t.quoteExternalId!=null&&(n==null?void 0:n.media)!=null};return t.messages.where("quoteExternalId").between(o("WAStanzaUtils").toStanzaId("0"),o("WAStanzaUtils").toStanzaId("["),!0,!0).filter(e).toArray().catch(function(){return t.messages.filter(e).toArray()}).then(function(e){var n=new Set(e.map(function(e){var t,n,r=(t=e.quote)==null?void 0:t.content;return r==null||(n=r.media)==null?void 0:n.plaintextHash}).filter(Boolean)),r=e.map(function(e){var t=e.msgId;return t});return t.media.filter(function(e){var t=e.plaintextHash;return n.has(t)}).toArray().then(function(e){var n=new Map(e.map(function(e){var t=e.mediaId,n=e.plaintextHash;return[n,t]}));return t.messages.where("msgId").anyOf(r).modify(function(e){var t=e.quote;if(t!=null&&t.content!=null){var r=t.content;r.mediaId=n.get(r.media.plaintextHash),delete r.media}})})})},c=function(t){return t.groupInfo.toCollection().modify(function(e){typeof e.inviter=="number"&&delete e.inviter})},d=function(){return o("MAWDexieTable").dexieResolve()},m=function(t){return t.threads.filter(function(e){return o("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return!1},user:function(){return e.oldestMsg!=null}})}).toArray().then(function(e){var n=[];return e.forEach(function(e){n.push(e.oldestMsg),n.push(o("MAWDbMsg").toMsgId__UNSAFE_DO_NOT_USE(e.newestMsg))}),t.messages.where("msgId").anyOf(n.filter(Boolean)).toArray().then(function(n){var r=new Map,a=[],i=[];n.forEach(function(e){r.set(e.msgId,e)}),e.forEach(function(e){var n=r.get(e.oldestMsg),l=r.get(e.newestMsg);return(n==null?void 0:n.type)==="Admin"&&(l==null?void 0:l.type)==="Admin"&&(n.msgId===l.msgId?i.push(e.chatId):a.push(e)),o("MAWDexieTable").dexieAll(a.map(function(e){return t.messages.where("thread").equals(e.chatId).toArray()})).then(function(e){return e.forEach(function(e){if(e.length!==0){var t=e[0].thread,n=e.filter(function(e){return e.type!=="Admin"});n.length>0||i.push(t)}}),o("MAWDexieTable").dexieAll([t.threads.bulkDelete(i),t.messages.where("thread").anyOf(i).delete()])})})})})},p=function(t){return t.unrenderedMessages.toCollection().modify(function(e){if(e.type===o("WAMsgType").MSG_TYPE.DELETE_FOR_ME){var t=e.messageDeleteForMeTs;e.messageDeleteForMeTs=t}})},_=function(t){var e=0,n=0,a=r("MAWDexie").currentTransaction;if(a==null)throw r("FBLogger")("maw_db").mustfixThrow("transaction does not exist");return a.on("complete",function(){e>0&&o("MAWODSProxy").odsBumpEntityKey({amount:e,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING_THREAD_JID,key:"fail"}),n>0&&o("MAWODSProxy").odsBumpEntityKey({amount:n,entity:o("WAOdsEnums").Entity.MESSAGE_MISSING,key:"fail"})}),t.threads.toArray().then(function(r){var a=r.reduce(function(e,t){return t!=null&&e.set(t.chatId,t),e},new Map);return o("MAWDexieTable").dexieAll([t.messages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1}),t.unrenderedMessages.toCollection().modify(function(t){if(t!=null){var r=a.get(t.thread);r!=null?t.threadJid=r.jid:e+=1}else n+=1})])})},f=function(t){return t.isDualSend.toCollection().modify(function(e){e.version==null&&(e.version=1)})},g=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION&&(e.altIndex=o("MAWDbMsg").craftE2eeAdminMsgAltIndex(e.thread))})},h=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},y=function(t){return t.threads.toCollection().modify(function(e){e.folder==null&&(e.folder=o("MAWFolderTypes").FOLDER_ID.INBOX)})},C=function(t){return t.messages.toCollection().modify(function(e){e.sortOrderMs=o("MAWDbMsg").getSortOrderWithFallback(e)})},b=function(t){return t.personalSenderKeyStatuses.toCollection().modify(function(e){e.rotateSenderKey=!0,e.hasSenderKey=new Set})},v=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&e.sortOrderMs!=null&&e.sortOrderMs>0&&(e.sortOrderMs=0)})},S=function(t){return t.messages.toCollection().modify(function(e){!(e.type===o("WAMsgType").MSG_TYPE.ADMIN&&(e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE||e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION))&&e.sortOrderMs!=null&&e.sortOrderMs<1661204086&&(e.sortOrderMs=o("MAWDbMsg").getCanonicalTsFromMsg(e)*1e3)})},R=function(t){return t.threads.filter(function(e){return e.isMigratedLocally===!0&&e.newestMsg!=null}).toArray().then(function(e){var n=e.map(function(e){return e.chatId}),r=new Map;return o("MAWDexieTable").dexieAll(e.map(function(e){return t.messages.where(["thread","sortOrderMs"]).between([e.chatId,0],[e.chatId,Number.MAX_VALUE]).last().then(function(e){e!=null&&r.set(e.thread,e.msgId)})})).then(function(){return t.threads.where("chatId").anyOf(n)})})},L=function(){return o("MAWDexieTable").dexieResolve()},E=function(t){return t.threads.toCollection().modify(function(e){if(e.lastReadMsgTs!=null&&e.lastReadMsgTs<o("WATimeUtils").MAX_INT&&(e.lastReadMsgTs=o("MAWTimeUtils").ensureValidMillisTime(e.lastReadMsgTs)),e.newestMsgTs!=null&&e.newestMsgTs<o("WATimeUtils").MAX_INT){var t=o("MAWTimeUtils").ensureValidMillisTime(e.newestMsgTs);e.newestMsgTs=t,t!=null&&(e.threadOrder=o("MAWDbThread").craftThreadOrder(t,e.jid))}})},k=function(t){return t.messages.toCollection().modify(function(e){e.type===o("WAMsgType").MSG_TYPE.ADMIN&&e.msgContent.adminType===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE&&(e.altIndex=o("MAWDbMsg").craftCutoverAdminMsgAltIndex(e.thread))})},I=function(){return o("MAWDexieTable").dexieResolve()},T=function(){return o("MAWDexieTable").dexieResolve()},D=function(){return o("MAWDexieTable").dexieResolve()},x=function(t){return t.participants.toCollection().modify(function(e){var t;e==null||!((t=e.userJid)!=null&&t.includes("@msgr@msgr"))||(e.id=e.id.replace("@msgr@msgr","@msgr"),e.userJid=e.userJid.replace("@msgr@msgr","@msgr"))}).then(r("emptyFunction"))},$=function(t){var e=t.threads.filter(function(e){return e.snippetMsg!=null&&e.snippetMsgTs==null});return e.toArray().then(function(n){var r=n.reduce(function(e,t){return t!=null&&t.snippetMsg!=null&&e.set(t.jid,t.snippetMsg),e},new Map),a=Array.from(r.values());return t.messages.where("msgId").anyOf(a).toArray().then(function(t){var n=t.reduce(function(e,t){return t!=null&&t.serverTs!=null&&e.set(t.msgId,t.serverTs),e},new Map);e.modify(function(e){var t=r.get(e.jid);if(t!=null){var a=n.get(t);a!=null&&(e.snippetMsgTs=o("WATimeUtils").castUnixTimeToMillisTime(a))}})})})},P=function(t){return t.threads.toArray().then(function(e){return o("MAWDexieTable").dexieAll(e.map(function(e){return t.participants.where("threadId").equals(e.chatId).modify(function(t){var n;t.threadJid=(n=t.threadJid)!=null?n:e.jid})}))})},N=P,M=function(t){var e=[];return t.groupInvites.toArray().then(function(n){var o=n.map(function(e){return e.invitedParticipantId});return t.participants.bulkGet(o).then(function(o){o.forEach(function(t,r){if(t==null){var o=n[r];e.push(o)}});var a=o.filter(Boolean);return t.groupInvites.bulkPut(n.map(function(t){r("vulture")("ENZBv3M2AdQWc64Uu-LwyNOTxR0=");var n=a.find(function(e){return e.id===t.invitedParticipantId});return n!=null?(t.inviteeJid=n.userJid,t.threadJid=n.threadJid,babelHelpers.extends({},t,{inviteeJid:n.userJid,threadJid:n.threadJid})):(e.push(t),t)}))})}).then(function(){return t.groupInvites.bulkDelete(e.map(function(e){return[e.invitedParticipantId,e.inviterJid]}))})},w=function(n){var t=new Map;return n.receipts.toArray().then(function(a){return o("MAWDexieTable").dexieAll(a.map(function(a){return n.messages.get({msgId:a.msgId}).then(function(i){if(i==null)return n.receipts.delete(a.msgId).then(r("emptyFunction"));var l=o("WAMsg").craftWAMsgIdString({author:i.author,chat:i.threadJid,externalId:i.externalId});if(t.has(l)){var s,u=(s=t.get(l))!=null?s:1;return t.set(l,u),o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Duplicate waMsgId found for receipt, number of duplicates: ",""])),u),n.receipts.delete(a.msgId).then(r("emptyFunction"))}else return t.set(l,1),n.receipts.where("msgId").equals(i.msgId).modify(function(e){e.waMsgId=l}).then(r("emptyFunction"))})}))})},A=function(){return o("MAWDexieTable").dexieResolve()},F=function(t){return t.participants.toArray().then(function(e){var n=e.map(function(e){return babelHelpers.extends({},e,{id:o("MAWDbParticipant").craftParticipantId(e.threadJid,e.userJid)})}),r=e.map(function(e){return e.id});return t.participants.bulkDelete(r).then(function(){t.participants.bulkPut(n)})})},O=function(t){return t.reactions.toCollection().modify(function(e){e.ts=e.ts})},B=new Map([[(s=o("MAWDbVersionList")).VERSION.V26,u],[s.VERSION.V27,c],[s.VERSION.V28,d],[s.VERSION.V29,m],[s.VERSION.V30,p],[s.VERSION.V31,_],[s.VERSION.V43,f],[s.VERSION.V44,g],[s.VERSION.V45,h],[s.VERSION.V46,y],[s.VERSION.V47,C],[s.VERSION.V53,b],[s.VERSION.V54,v],[s.VERSION.V55,S],[s.VERSION.V56,R],[s.VERSION.V57,L],[s.VERSION.V58,E],[s.VERSION.V60,k],[s.VERSION.V66,I],[s.VERSION.V68,T],[s.VERSION.V71,D],[s.VERSION.V72,x],[s.VERSION.V82,$],[s.VERSION.V85,P],[s.VERSION.V87,N],[s.VERSION.V90,M],[s.VERSION.V91,w],[s.VERSION.V101,A],[s.VERSION.V104,F],[s.VERSION.V116,O]]);l.dbUpgrades=B}),98);
__d("MAWDbSchemaReStoreDexieUtils",["FBLogger","MAWDbSchema","MAWDbSchema.dexie","sortBy"],(function(t,n,r,o,a,i,l){"use strict";var e=r("sortBy")(Array.from(new Set([].concat(Array.from(o("MAWDbSchema").dbSchema.keys()),Array.from(o("MAWDbSchema.dexie").dbUpgrades.keys())))).map(function(e){return{schema:o("MAWDbSchema").dbSchema.get(e),upgrade:o("MAWDbSchema.dexie").dbUpgrades.get(e),version:e}}),function(e){var t=e.version;return t}),s=function(t,n){return Array.from(t.filter(function(e){return e.version<=n&&e.schema!=null}).reduce(function(e,t){var n;return(n=t.schema)==null||n.forEach(function(t){e.set(t.name,t)}),e},new Map).values())},u=function(t,n){return s(t,n).reduce(function(e,t){var n=t.autoIncrement,o=t.dexieOnly_primaryKeyUnique,a=t.name,i=t.primaryKey,l=t.removed,s=a.replace(/^e2ee_/,"");if(l===!0)return e[s]=null,e;if(n&&o===!0)throw r("FBLogger")("messenger_web").mustfixThrow("Invalid schema, cannot have both autoincremnet and unique constraints "+JSON.stringify(t));var u=n?"++":"",c=o===!0?"&":"",d=(i.length>1?"[":"")+i.join("+")+(i.length>1?"]":""),m=Object.values(t.indexes).map(function(e){var t=e.columns,n=e.unique!==!1,r=t.length>1,o=e.multiEntry_DO_NOT_USE===!0,a=n&&!o?"&":"",i=o?"*":"",l=""+a+i;return""+l+(r?"[":"")+t.join("+")+(r?"]":"")}).join(",");return e[s]=[""+u+c+d,m].filter(Boolean).join(","),e},{})},c=function(n){return u(e,n)};l.MAW_DB_VERSION_CHANGES=e,l.getDexieSchemaForVersion=u,l.getCompleteDexieSchemaForVersion=c}),98);
__d("MAWDbVersion",["MAWCurrentUser","MAWDbSchemaReStoreDexieUtils","MAWDbVersionList","MAWGetDbVersion","MAWIndexedDbMetadata","MAWODSProxy","MWFBLogger","Promise","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h=o("MWFBLogger").MWLogger().tags(["db","getDexieDbVersion"]),y=o("MAWGetDbVersion").getArmadilloDbVersion(),C=o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(Math.min(o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,y>0?y:1/0));function b(e,t){var n=t.schema,r=t.upgrade,o=t.version;return n!=null&&r!=null?e.version(o).stores(n).upgrade(r):n!=null?e.version(o).stores(n):r!=null?e.version(o).upgrade(r):e.version(o),o}function v(t){return new(g||(g=n("Promise")))(function(n){if(!indexedDB){n();return}var r=indexedDB.open(t);r.onupgradeneeded=function(r){r.target.transaction.abort();var o=r.target.result;h.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose([""," onupgradeneeded - closing db"])),t),o==null||o.close(),n()},r.onsuccess=function(e){var r=e.target.result,a=r==null?void 0:r.version;h.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose([""," version: ",""])),t,a!=null?a:"null"),r==null||r.close(),a!=null?(a%10>=1&&o("MAWODSProxy").odsBumpEntityKey({amount:1,entity:o("WAOdsEnums").Entity.MAW_DB_UNEXPECTED_VERSION,key:"fail_"+a%10}),n(o("MAWDbVersionList").toVersion(a/10))):n()},r.onerror=function(e){var r;h.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose([""," error ",""])),t,e==null||(r=e.target)==null||(r=r.error)==null?void 0:r.message),n()},r.onblocked=function(e){var n=e.target.result,r=n==null?void 0:n.version;h.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," blocked, version: ",""])),t,r!=null?r:"null"),n==null||n.close()}})}function S(){var e=o("MAWCurrentUser").getID();return v(o("MAWIndexedDbMetadata").dbName(e))}function R(e,t){if(e.upgrade!=null||t.upgrade!=null)return!0;var n=Object.keys((e==null?void 0:e.schema)||{}),r=Object.keys((t==null?void 0:t.schema)||{}),o=[].concat(n,r),a=new Set(o);return a.size!==o.length}function L(e){return e.reduce(function(e,t,n){if(n===0)return[babelHelpers.extends({},t,{schema:o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(t.version)})];var r=e[e.length-1],a=babelHelpers.extends({},t,{schema:t.schema!=null?o("MAWDbSchemaReStoreDexieUtils").getDexieSchemaForVersion([t],t.version):null});return R(r,a)?(e.push(a),e):(e.splice(e.length-1,1,babelHelpers.extends({},r,a,{schema:babelHelpers.extends({},r==null?void 0:r.schema,a==null?void 0:a.schema)})),e)},[])}function E(e,t,n,r){var a=r!=null?r:o("MAWGetDbVersion").getArmadilloDbVersion==null?void 0:o("MAWGetDbVersion").getArmadilloDbVersion();h.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["current db version: ",", target db version: ",""])),n,a),a==null&&h.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["version is not set in QE"]))),n!=null&&n>a&&(h.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["current db version is greater than target db version"]))),a=n);var i=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return n==null||t>n}).filter(function(e){var t=e.version;return a==null||a>=t}),l=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.filter(function(e){var t=e.version;return a==null||a>=t});if(i.length===0||i.length===l.length){h.DEBUG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Skipping db upgrade and just applying latest schema"]))),t.addAnnotations({bool:{isUpgradeNeeded:!1}});var s=o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES[o("MAWDbSchemaReStoreDexieUtils").MAW_DB_VERSION_CHANGES.length-1].version,u=Math.min(a!=null&&a>0?a:s,s);return e.version(u).stores(o("MAWDbSchemaReStoreDexieUtils").getCompleteDexieSchemaForVersion(u)),u}var c=L(i);h.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Applying "," updates between "," and ",""])),c.length,i[0].version,i[i.length-1].version);var g=c.filter(function(e){return!!e.upgrade}).map(function(e){return e.version.toString()}),y=c.filter(function(e){return!!e.schema}).map(function(e){return e.version.toString()});g.length&&t.addAnnotations({string_array:{dataMigrationVersions:g}}),y.length&&t.addAnnotations({string_array:{schemaUpgradeVersions:y}}),t.addAnnotations({bool:{isUpgradeNeeded:!0}});var C=0;return c.forEach(function(t){var n;C=Math.max((n=b(e,t))!=null?n:0,C!=null?C:0)}),C}l.CURRENT_MAW_STORES=C,l.getDexieDbVersion=v,l.getDBVersion=S,l.updateDB=E}),98);
__d("MAWDexieError",[],(function(t,n,r,o,a,i){"use strict";var e="ModifyError",l="BulkError",s="OpenFailedError",u="VersionChangeError",c="SchemaError",d="UpgradeError",m="InvalidTableError",p="MissingAPIError",_="NoSuchDatabaseError",f="InvalidArgumentError",g="SubTransactionError",h="UnsupportedError",y="InternalError",C="DatabaseClosedError",b="PrematureCommitError",v="ForeignAwaitError",S="UnknownError",R="ConstraintError",L="DataError",E="TransactionInactiveError",k="ReadOnlyError",I="VersionError",T="NotFoundError",D="InvalidStateError",x="InvalidAccessError",$="AbortError",P="TimeoutError",N="QuotaExceededError",M="SyntaxError",w="DataCloneError",A={AbortError:$,BulkError:l,ConstraintError:R,DatabaseClosedError:C,DataCloneError:w,DataError:L,ForeignAwaitError:v,InternalError:y,InvalidAccessError:x,InvalidArgumentError:f,InvalidStateError:D,InvalidTableError:m,MissingAPIError:p,ModifyError:e,NoSuchDatabaseError:_,NotFoundError:T,OpenFailedError:s,PrematureCommitError:b,QuotaExceededError:N,ReadOnlyError:k,SchemaError:c,SubTransactionError:g,SyntaxError:M,TimeoutError:P,TransactionInactiveError:E,UnknownError:S,UnsupportedError:h,UpgradeError:d,VersionChangeError:u,VersionError:I};i.DEXIE_ERROR=A}),66);
__d("MAWIDbSetupQplEventListener",["MAWDexieError","MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=null;function u(t){var n=new Set(Object.keys(o("MAWDexieError").DEXIE_ERROR));n.has(t.reason)&&e!=null&&(e.endFail(t.reason),o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25310776,"6155"),"database_setup_failed"),s!=null&&(s(),s=null))}var c=function(r,o){return e=r,s=o,t.addEventListener("unhandledrejection",u),function(){return t.removeEventListener("unhandledrejection",u)}};l.trackDbSetupFailure=c}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"},l={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"},s=n("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});i.WRITE_GROUP_INVITE_ERROR=e,i.GET_GROUP_INVITE_ERROR=l,i.DatabaseState=s}),66);
__d("MAWDbFactory",["ClientConsistencyEventEmitter","Deferred","MAWCurrentUser","MAWDbVersion","MAWDexieTable","MAWGetDbVersion","MAWIDbSetupQplEventListener","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWLowLevelApiTypes","MAWQplProxy","MAWReliabilityMonitor","MWFBLogger","Promise","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=["backendInitPromise","middleware","onDbPopulate"],h;function y(t,a){var i=null,l=o("MWFBLogger").MWLogger().tags(["db",t,a]),y=new(r("Deferred")),C=!1,b=!1,v,S=!1,R=null,L=a!=="worker"?null:o("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("DB_"+t+"_"+a,function(){return{extra:{isMakingDB:String(C),willBeSetup:String(b)},reason:String(R),state:(function(){if(R==null)return o("MAWReliabilityMonitor").HealthReportState.UNKNOWN;switch(R){case o("MAWLowLevelApiTypes").DatabaseState.Initializing:case o("MAWLowLevelApiTypes").DatabaseState.Upgrading:return o("MAWReliabilityMonitor").HealthReportState.PENDING;case o("MAWLowLevelApiTypes").DatabaseState.Open:return o("MAWReliabilityMonitor").HealthReportState.OK;case o("MAWLowLevelApiTypes").DatabaseState.Closed:case o("MAWLowLevelApiTypes").DatabaseState.Error:return o("MAWReliabilityMonitor").HealthReportState.ERROR}})()}});function E(){y=new(r("Deferred")),v==null||v(),C=!1,b=!1}function k(){return b}function I(){return y.getPromise().then(function(){return S})}function T(e,t,n){return D.apply(this,arguments)}function D(){return D=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n,h,k){var I=h.backendInitPromise,T=h.middleware,D=h.onDbPopulate,x=babelHelpers.objectWithoutPropertiesLoose(h,g),$=o("MAWCurrentUser").getID(),P=o("MAWIndexedDbMetadata").dbName($),N=r("qpl")._(25310776,"6155");function M(e){R=e,L==null||L.updateState()}if(i!=null){l.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DB exists"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_exsists");return}var w=o("MAWQplProxy").startQplUserFlow(r("qpl")._(1056836116,"905"),{string:{db:t,name:P}});if(b=!0,C)return o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_in_progress"),y.getPromise();l.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Starting DB Setup"]))),C=!0,o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_started"),v=o("MAWIDbSetupQplEventListener").trackDbSetupFailure(w,function(){M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("DB setup failed"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_setup_failed"),E()}),M(o("MAWLowLevelApiTypes").DatabaseState.Initializing);var A=yield o("MAWDbVersion").getDexieDbVersion(P);A==null&&(S=!0),w.addAnnotations({int:{currentVersion:A}});var F=k!=null?k:o("MAWGetDbVersion").getArmadilloDbVersion();if(w.addAnnotations({int:{targetVersion:F}}),I&&(A||0)<F){w.addPoint("separate_read_waiting_on_worker_upgrade"),l.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Waiting for worker to upgrade schema..."])));try{yield I}catch(e){throw l.catching(r("getErrorSafe")(e)).mustfixThrow("Worker startup promise rejected, schema upgrade failed.")}var O=yield o("MAWDbVersion").getDexieDbVersion(P);if(O!==F)throw l.mustfixThrow("Main thread waiting on worker schema upgrade from %s to %s, upgrade failed with version %s",A,F,O);A=O}else a==="worker"&&(o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbVersion",A!=null?A:0),o("MAWQplProxy").sendQPLIntAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"useSentBytesCache",r("gkx")("33008")?1:0));var B=function(n){var e=o("MAWDbVersion").updateDB(n,w,A,k);return!I&&a==="worker"&&o("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(r("qpl")._(1056839232,"112"),"dbUpgradeNeeded",A!==e),l.DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["latest pushed version: ",", current: ",", requested: ",""])),e,A,k!=null?k:"<latest>"),a==="worker"&&(A!==e?o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgraded"):o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_version_upgrade_not_required")),e};return i=new(o("MAWDexieTable")).DexieTable(P,function(e){T.forEach(function(t){e.use(t(n))});var i=B(e);e.on("populate",function(e){if(!e){M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("Missing DB for populate event"),w.endFail("on_populata-missing_txn"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_on_populate_missing_txn");return}l.info("MAWDB populated. HasPopulateEvent: %s",!!D),D==null||D(e)}),e.on("blocked",function(){l.MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["DB Open blocked"]))),M(o("MAWLowLevelApiTypes").DatabaseState.Error),y.reject("DB Open blocked"),w.endFail("db_blocked"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_blocked"),E()}),e.on("ready",function(e){if(l.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAW DB setup complete"]))),C=!1,e==null){M(o("MAWLowLevelApiTypes").DatabaseState.Error),l.MUSTFIX(p||(p=babelHelpers.taggedTemplateLiteralLoose(["DB is null"]))),y.reject("DB is null"),w.endFail("db_null"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_null"),E();return}M(o("MAWLowLevelApiTypes").DatabaseState.Open),v==null||v(),y.resolve(),w.endSuccess({int:{dbVersion:i}}),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_ready")}),e.on("close",function(){M(o("MAWLowLevelApiTypes").DatabaseState.Closed),l.WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["DB forcibly closed"]))),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_forcibly_closed")}),e.on("versionchange",function(e){l.WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Versionchange detected: ("," -> "," (event version: ",", highestUsed: (","), name: ",""])),e==null?void 0:e.oldVersion,e==null?void 0:e.newVersion,String(e==null?void 0:e.version),i,e==null?void 0:e.name),M(o("MAWLowLevelApiTypes").DatabaseState.Upgrading),a!=="worker"&&r("ClientConsistencyEventEmitter").emit("softRefresh","mawdb_versionchange"),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_versionchange")})},void 0,x),o("MAWQplProxy").sendQplPointThroughBridge(N,"database_"+t+"_make_requested"),y.getPromise()}),D.apply(this,arguments)}function x(e){if(i==null)throw l.mustfixThrow('IndexDB has not been initialized before executing "'+(e!=null?e:"unnamed")+'"');return i}function $(e){return i!=null&&!C?(h||(h=n("Promise"))).resolve(i):(y=y||new(r("Deferred")),y.getPromise().then(function(){return x(e)}))}function P(){return N.apply(this,arguments)}function N(){return N=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield $();e!=null&&(e.close(),i=null),E()}),N.apply(this,arguments)}function M(){i=null,E()}function w(e){r("promiseDone")(P());var t=o("MAWIndexedDbMetadata").dbName(e!=null?e:o("MAWCurrentUser").getID());r("promiseDone")(o("MAWIndexedDBDeletion").deleteDB(t,"maw")),L==null||L.stopMonitoring()}return{closeDB:P,deleteDb:w,getDB:$,getDBExn:x,isNewDb:I,makeDB:T,reset_singleton_INTERNAL_ONLY:M,setupPromise:function(){return y.getPromise()},willSetupDB:k}}l.makeIDBFactory=y}),98);
__d("MAWIndexedDbUI",["ExecutionEnvironment","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDexieTable","MAWIndexedDb","MAWTransactor","Promise","cr:3527","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(){var e=o("MAWDbFactory").makeIDBFactory("ui_idb","main");return{closeDB:e.closeDB,deleteDb:e.deleteDb,getDB:e.getDB,makeDB:function(a,i,l){var t=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];r("gkx")("1760")&&t.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),n("cr:3527")!=null&&t.push(n("cr:3527"));var s=e.makeDB(a,{autoOpen:r("gkx")("6817"),backendInitPromise:i.backendInitPromise,cache:"disabled",middleware:t,onDbPopulate:i.onDbPopulate},l);return s},reset_singleton_INTERNAL_ONLY:e.reset_singleton_INTERNAL_ONLY}}var d=c(),m=d.makeDB,p=d.closeDB,_=d.getDB,f=d.deleteDb,g=d.reset_singleton_INTERNAL_ONLY,h=(s||(s=r("ExecutionEnvironment"))).isInBrowser?_("MawDbInUISingleton_INTERNAL_ONLY").then(function(e){return{openReadonlyTransaction:function(n,a,i){return e.stores.transaction("r",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})},openReadWriteTransaction:function(n,a,i){return e.stores.transaction("rw",a,function(){return o("MAWDexieTable").setDexiePSDItem("transactorName",n),o("MAWDexieTable").setDexiePSDItem("transactionRequested",(u||(u=r("performance"))).now()+u.timeOrigin),i(e.stores)})}}}):new(e||(e=n("Promise")))(function(){});l.makeMsgrTransactor=o("MAWTransactor").makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD,l.afterTransaction=o("MAWIndexedDb").afterTransaction,l.makeMAWIndexedDBFactory=c,l.makeDB=m,l.closeDB=p,l.getDB=_,l.deleteDb=f,l.reset_singleton_INTERNAL_ONLY=g,l.MawDbInUISingleton=h}),98);
__d("MAWWorkerCacheServiceRegistry",["MAWSnippetsCacheService"],(function(t,n,r,o,a,i,l){"use strict";var e={snippets:o("MAWSnippetsCacheService").getMAWSnippetsCacheService()};function s(){return e}l.getWorkerRegistry=s}),98);
__d("MAWCacheServiceUtils",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e="maw_cache_service_broadcast",s=typeof window!="undefined"?window:self,u=function(){return s.BroadcastChannel?new s.BroadcastChannel(e):(r("FBLogger")("messenger_e2ee_web").warn("BroadcastChannel is not supported in this browser"),null)},c={concurrency:1,maxTaskLimit:1,maxThrottleMs:500};function d(e){return"maw-cache-service-"+e}function m(e,t){var n=new Set,r=[];return e.forEach(function(e){var o=t(e);if(n.has(o)){r.push(e);return}n.add(o)}),r}l.MAW_CACHE_SERVICE_BROADCAST_CHANNEL=e,l.globalScope=s,l.getMAWCacheServiceBroadcastChannel=u,l.SCHEDULER_CONFIG=c,l.getSchedulerName=d,l.findDuplicates=m}),98);
__d("MAWDbMsgOrReaction",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function l(e,t){return e==null?t.forNull():e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function s(e,t){return e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}function u(e,t){return e==null?t.forNull():e.reactToExternalId!=null?t.forReaction(e):t.forMessage(e)}i.switchOnMsgOrReaction=e,i.switchOnMsgOrReactionNullish=l,i.switchOnMsgOrReactionMaybeUnstored=s,i.switchOnMsgOrReactionMaybeUnstoredNullish=u}),66);
__d("MAWWorkerCacheServices",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWDbMsgOrReaction","MAWLoggerUtils","MAWSnippetsCacheCalculateDelta","MAWWorkerCacheServiceRegistry","Promise","WorkerScheduler","asyncToGeneratorRuntime","cr:2354","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=o("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel();var e=o("MAWWorkerCacheServiceRegistry").getWorkerRegistry();this.registry=e,this.schedulerRegistry=Object.keys(e).reduce(function(e,t){var n;return babelHelpers.extends({},e,(n={},n[t]=o("WorkerScheduler").makeScheduler(o("MAWCacheServiceUtils").getSchedulerName(t),o("MAWCacheServiceUtils").SCHEDULER_CONFIG),n))},{})}var a=t.prototype;return a.$2=function(t,n,r,a){var e={cache:n,instanceKey:a,namespace:t,source:r};this.$1==null?o("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:e},namespace:o("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(e)},a.$3=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,i){var l=o("MAWCacheServiceUtils").findDuplicates(t,function(e){var t=e[0],n=e[1];return t});if(l.length>0&&(r("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",l.map(function(e){var t=e[0],n=e[1];return t}).join(", "),t.map(function(e){var t=e[0],n=e[1];return t}).join(", "),e,n),a!=null&&r("MAWCacheServiceQPL").addAnnotationsQPL(a,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:r("MAWCacheServiceQPL").redactKeysForNonEmployee(l.map(function(e){var t=e[0],n=e[1];return t}))}})),t.length===0){a!=null&&(r("MAWCacheServiceQPL").addPointQPL(a,"nothing_to_update_in_cache",n),r("MAWCacheServiceQPL").endSuccessQPL(a));return}a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_start",n);var s=this.registry[e];s.updateInMemoryCacheBulk(t);try{var u=o("MAWCacheServiceDB").convertCacheValueToDBRawValue(t),c=yield o("MAWCacheServiceDB").getOrSetupMAWCacheDB();yield c.runInTransaction([e],"readwrite",function(t){var n=u.map(function(e){return{item:e,selector:[e.key]}});return t.stores[e].bulkUpsert("key",n)},"update_cache_"+e),i==null||i(u.map(function(e){var t=e.key;return t})),a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_end",n)}catch(e){var d=r("getErrorSafe")(e);a!=null&&(r("MAWCacheServiceQPL").addAnnotationsQPL(a,{string:{error:d.message}}),r("MAWCacheServiceQPL").addPointQPL(a,"updating_cache_in_persisted_failed",n)),r("FBLogger")("MAWCacheService").catching(d).mustfix("Failed to update persisted cache")}a!=null&&r("MAWCacheServiceQPL").addPointQPL(a,"broadcasting_to_ui_start",n),this.$2(e,t,n,a)});function t(t,n,r,o,a){return e.apply(this,arguments)}return t})(),a.calculateDelta=function(a){var t=this,i=Object.values(this.registry).map(function(e){var i=e.shouldDropDelta(a);return i.then(function(i){if(!i){var l=t.schedulerRegistry[e.namespace];return l.runTask({fn:function(){return e.calculateDelta(a).then(function(i){var s=i.map(function(e){var t=e[0],n=e[1];return t}),c=o("MAWLoggerUtils").getInstanceKey();i.length!==0&&(r("MAWCacheServiceQPL").startQPL(c,e.namespace),r("MAWCacheServiceQPL").addAnnotationsQPL(c,{bool:{isRealtimeUpdate:!0},int:{instanceKey:c},string_array:{realtimeUpdatedKeys:s}}));var d=u(a);return t.$3(e.namespace,i,"realtime-update",c,function(e){n("cr:2354")==null||n("cr:2354").notifyCacheWrite(e,l,d)})}).catch(function(t){r("FBLogger")("MAWCacheService").catching(t).warn("Failed to calculate delta for: %s",e.namespace)})},name:"maw_calculate_delta",priority:o("WorkerScheduler").REGULAR_PRIORITY})}})});(e||(e=n("Promise"))).all([].concat(i)).catch(function(e){r("FBLogger")("MAWCacheService").catching(e).mustfix("Failed to calculate delta for all services")})},a.computeCachePayloadFromScratch=function(t,n,a,i){var e=this;i!=null&&r("MAWCacheServiceQPL").registerInstanceKeyInWorker(i),r("MAWCacheServiceQPL").addPointQPL(i,"compute_from_scratch_start",a),r("MAWCacheServiceQPL").addAnnotationsQPL(i,{string_array:{keysReceivedInWorker:r("MAWCacheServiceQPL").redactKeysForNonEmployee(n)}});var l=this.registry[t],s=this.schedulerRegistry[l.namespace];if(l==null)throw r("FBLogger")("messenger_web").mustfixThrow("No service found for namespace: "+t);return s.runTask({fn:function(s){var o=s.metric;return l.computeCachePayloadFromScratch(n,o).then(function(n){return r("MAWCacheServiceQPL").addPointQPL(i,"compute_from_scratch_end",a),e.$3(t,n,a,i)}).catch(function(e){r("MAWCacheServiceQPL").endFailureQPL(i,"compute_from_scratch_failed",a),r("FBLogger")("MAWCacheService").catching(e).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:o("WorkerScheduler").REGULAR_PRIORITY})},t})();function u(e){var t=e.filter(function(e){var t=e[0];return["messages","reactions"].includes(t)}),n=o("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(t.map(function(e){var t=e[0],n=e[1];return n})),r=n.values().every(function(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e.value,{forMessage:function(t){return t.source==="eb_restore"},forReaction:function(){return!0}})});return r?"eb_restore":"whatsapp"}var c=null,d=function(){return c==null&&(c=new s),c};l.getMAWWorkerCacheServices=d}),98);
__d("MAWExtractMsFromExternalId",["I64","MAWExternalId","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=2199023255551;function c(t){try{var n=(s||(s=o("I64"))).of_string_opt(t);if(n!=null){var r;return(r=d(n))!=null?r:0}}catch(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert externalId to number: ",""])),t)}return 0}function d(e){var t=Number((s||(s=o("I64"))).to_string(s.and_(s.lsr_(e,22),s.of_float(u))));return o("MAWExternalId").getThreeMostSignificantDigitsForSortOrderTimestamp(t)}l.extractMsFromStanzaId=c,l.extractMsFromExternalId=d}),98);
__d("MAWGetBumpTimestampMs",["I64","MAWAckLevel","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){var r=n==null?null:o("MAWExtractMsFromExternalId").extractMsFromExternalId(n);return(e||(e=o("I64"))).add(o("MAWTimeUtils").millisTimeToTimestamp(t),e.of_int32(r!=null?r:0))}function u(t){var n=t.msg,a=t.throwIfNoServerTs,i=a?r("nullthrows")(n.serverTs):n.serverTs;return s(o("WATimeUtils").castUnixTimeToMillisTime(i!=null?i:n.ts),(e||(e=o("I64"))).of_string(n.externalId))}function c(t){return t.senderTimestampMs!=null?(e||(e=o("I64"))).of_string(o("WALongInt").longIntToDecimalString(t.senderTimestampMs)):s(o("WATimeUtils").castUnixTimeToMillisTime(t.ts),(e||(e=o("I64"))).of_string(t.externalId))}function d(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(t,{forMessage:function(n){return o("MAWAckLevel").isMsgAuthoritative(n.ack)&&n.sortOrderMs!=null?(e||(e=o("I64"))).of_float(n.sortOrderMs):u({msg:n,throwIfNoServerTs:!1})},forNull:function(){return(e||(e=o("I64"))).zero},forReaction:c})}l.calculateBumpTimestampMs=s,l.getBumpTimestampMs=d}),98);
__d("MAWSnippetsCacheServiceUtils",["I64","MAWDbMsgOrReaction","MAWGetBumpTimestampMs"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(t,{forMessage:function(n){return{msgAckLevel:n.ack,msgId:n.msgId,reactionId:void 0,timestamp:n.sortOrderMs!=null?n.sortOrderMs:(e||(e=o("I64"))).to_float(o("MAWGetBumpTimestampMs").getBumpTimestampMs(n))}},forNull:function(){return{msgAckLevel:void 0,msgId:void 0,reactionId:void 0,timestamp:Number.MIN_SAFE_INTEGER}},forReaction:function(n){return{msgAckLevel:void 0,msgId:void 0,reactionId:n.reactionId,timestamp:(e||(e=o("I64"))).to_float(o("MAWGetBumpTimestampMs").getBumpTimestampMs(n))}}})}l.getMsgOrReactionIdAndTimestamp=s}),98);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(e,{forMessage:function(t){return t.altIndex===o("MAWDbMsg").SPAM_ALT_INDEX||t.altIndex===o("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function s(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(e,{forMessage:function(t){return t.ack===o("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function u(e){var t;return e.msgId!=null&&e.type===o("MAWMsgType").MSG_TYPE.XMA&&((t=e.msgContent)==null?void 0:t.content)===""}function c(e){return e.type===o("MAWMsgType").MSG_TYPE.XMA&&o("MAWXMAUtils").isRtcXMA(e==null?void 0:e.xmaMessageType)}l.isSpamMessage=e,l.isOptimisticMessage=s,l.isXMAThreadSnippet=u,l.isRTCXMAMessage=c}),98);
__d("MAWSnippetsCacheCalculateDelta",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateType","MAWSnippetsCacheServiceUtils","MAWUpdateThreadListItemUtils"],(function(t,n,r,o,a,i,l){"use strict";var e="[SnippetsCacheService][Worker]";function s(e){var t=new Set(e.map(function(e){var t,n,r=(t=e.decryptedValues)!=null?t:[],o=(n=e.deletedValues)!=null?n:[];return[].concat(r,o)}).flat().map(function(e){return o("MAWUpdateThreadListItemUtils").isOptimisticMessage(e)?null:e.msgId}).filter(Boolean));return e.reduce(function(e,n){var r=n.type==="delete"?n.deletedValues:n.decryptedValues,o=p(r);return o=_(t,o),o.length===0||o.forEach(function(t){var r=t.threadJid,o=e.get(r),a=m({type:n.type,value:t},o);e.set(r,a)}),e},new Map)}function u(e){return e.some(function(e){var t=e.chatJid,n=e.lastComputedCacheValue,r=e.mutateReq;return!c(r)||d(r.value)})}function c(e){return!(e.type==="delete"||e.type==="deleteRange"||o("MAWUpdateThreadListItemUtils").isXMAThreadSnippet(e.value)||h(e.value)||y(e.value))}function d(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return!1},forReaction:function(t){return t.reaction!=null&&o("MAWGetThreadUpdateType").canReactionAffectBump(t)}})}function m(e,t){if(t==null)return e;var n=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(e.value),r=n.timestamp,a=e.value.externalId,i=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t.value),l=i.timestamp,s=t.value.externalId;return r===l?e.type==="delete"||e.type==="deleteRange"?e:t.type==="delete"||t.type==="deleteRange"?t:a.localeCompare(s)>0?e:t:r==null?t:l==null||r>l?e:t}function p(e){return e==null||e.length===0?[]:e.filter(function(e){return f(e)})}function _(e,t){return t.reduce(function(t,n){var r=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(n),a=r.msgId;return a!=null&&o("MAWUpdateThreadListItemUtils").isOptimisticMessage(n)&&e.has(a)?t:[].concat(t,[n])},[])}function f(e){var t=g(e)&&!o("MAWUpdateThreadListItemUtils").isSpamMessage(e);return t||C(e),t}function g(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(n){return o("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(e)},forReaction:function(n){return o("MAWGetThreadUpdateType").canReactionAffectBump(n)&&h(n)||o("MAWGetThreadUpdateType").isThreadUpdateTypeEligibleForSnippet(e)}})}function h(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return!1},forReaction:function(t){return t.reaction==null}})}function y(e){return o("MAWDbMsgOrReaction").switchOnMsgOrReaction(e,{forMessage:function(t){return t.ephemeralMsgDisappeared===!0},forReaction:function(t){return!1}})}function C(t){var n=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t),a=n.msgId,i=n.reactionId;r("FBLogger")("MAWCacheService").info(e+" msg or reaction is not eligible for snippet update, msgId: %s, reactionId: %s",a,i)}l.parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids=s,l.isDbTransactionRequiredForSnippetUpdate=u,l.canCalculateSnippetUpdateFromDelta=c,l.isNeededToCheckMessageExistence=d}),98);
__d("MAWSnippetsCacheService",["FBLogger","MAWAckLevel","MAWCacheServiceBase","MAWDbMsgOrReaction","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSnippetsCacheCalculateDelta","MAWSnippetsCacheServiceUtils","MAWThreadSnippetBuildTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUpdateThreadListItemUtils","MAWVault","Promise","WAJids","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=["messages","reactions"],u="[SnippetsCacheService][Worker]",c=(function(t){function r(){return t.call(this,"snippets")||this}babelHelpers.inheritsLoose(r,t);var a=r.prototype;return a.$MAWSnippetsCacheService$p_1=function(r){var t=this,a=r.filter(function(e){var t=e[0];return s.includes(t)}),i=o("MAWSnippetsCacheCalculateDelta").parseAndGetMostRecentSnippetUpdateMutateRequestForChatJids(a.map(function(e){var t=e[0],n=e[1];return n}));return(e||(e=n("Promise"))).all(Array.from(i.entries()).map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e[0],r=e[1],o=yield t.getValueFromCache(n);return{chatJid:n,lastComputedCacheValue:o,mutateReq:r}});return function(t){return e.apply(this,arguments)}})()))},a.calculateDelta=function(r){var t=this;return this.$MAWSnippetsCacheService$p_1(r).then(function(r){return r.length===0?(e||(e=n("Promise"))).resolve([]):o("MAWSnippetsCacheCalculateDelta").isDbTransactionRequiredForSnippetUpdate(r)?o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:calculateDelta",function(e){return(function(n){return t.$MAWSnippetsCacheService$p_2(e,n)})})(r):t.$MAWSnippetsCacheService$p_3(r)})},a.computeCachePayloadFromScratch=function(t,n){var e=this;return o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY,reactions:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"MAWSnippetsCacheService:computeCachePayloadFromScratch",function(t){return function(r){return o("MAWDexieTable").dexieAll(r.map(function(r,a){var i=o("WAJids").unsafeCoerceToChatJid(r);return e.$MAWSnippetsCacheService$p_4(t,i,"from-scratch",a,n)})).then(function(e){return e.filter(Boolean)})}})(t)},a.$MAWSnippetsCacheService$p_5=function(t,n){if(n==null)return"no-value-calculated-from-scratch";if(o("MAWUpdateThreadListItemUtils").isOptimisticMessage(t.value))return null;var e=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(t.value),r=e.msgAckLevel,a=e.msgId,i=e.reactionId,l=e.timestamp;return l==null?"missing-timestamp":a!=null&&a===n.value.snippetMsgId||i!=null&&i===n.value.snippetReactionId?null:a!=null&&r!==o("MAWAckLevel").ACK.received&&n.value.snippetMsgAckLevel===o("MAWAckLevel").ACK.clock?"optimistic-snippet-in-cache":l<n.timestamp?"older-than-last-snippet-value":null},a.shouldDropDelta=function(r){var t=this;return this.$MAWSnippetsCacheService$p_1(r).then(function(r){return r.length===0?(e||(e=n("Promise"))).resolve(!0):(e||(e=n("Promise"))).all(r.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=e.chatJid,r=e.lastComputedCacheValue,o=e.mutateReq,a=yield t.$MAWSnippetsCacheService$p_5(o,r);return a!=null?(m({dropReason:a,key:n,msgOrReaction:o.value,operation:o.type}),!0):!1});return function(t){return e.apply(this,arguments)}})())).then(function(e){return!!e.every(function(e){return e===!0})})})},a.$MAWSnippetsCacheService$p_4=function(t,n,r,a,i){var e=this;return o("MAWThreadSnippetUtils").getThreadSnippetFromScratch(t,n,a,i).then(function(t){var a=e.$MAWSnippetsCacheService$p_6(n,t,r);if(a!=null)return o("MAWDexieTable").dexieResolve([n,a])})},a.$MAWSnippetsCacheService$p_3=function(t){var e=this;return t.map(function(t){var n=e.$MAWSnippetsCacheService$p_7(t);if(n!=null)return[t.chatJid,n]}).filter(Boolean)},a.$MAWSnippetsCacheService$p_2=function(t,n){var e=this;return o("MAWDexieTable").dexieAll(n.map(function(n){return o("MAWSnippetsCacheCalculateDelta").canCalculateSnippetUpdateFromDelta(n.mutateReq)?e.$MAWSnippetsCacheService$p_8(t,n.mutateReq.value).then(function(t){if(!t){var r=e.$MAWSnippetsCacheService$p_7(n);if(r!=null)return o("MAWDexieTable").dexieResolve([n.chatJid,r])}}):e.$MAWSnippetsCacheService$p_4(t,n.chatJid,"realtime-from-scratch")})).then(function(e){return e.filter(Boolean)})},a.$MAWSnippetsCacheService$p_7=function(t){var e=o("MAWThreadSnippetBuildTxns").buildThreadSnippetForMsgOrIncomingReaction(t.chatJid,t.mutateReq.value),n=this.$MAWSnippetsCacheService$p_6(t.chatJid,{snippet:e,snippetMsgOrReaction:t.mutateReq.value},"realtime-calculate-delta");return n},a.$MAWSnippetsCacheService$p_6=function(t,n,r){if(n==null){d({flow:r,key:t,threadSnippetResult:n});return}var e=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(n.snippetMsgOrReaction),a=e.msgAckLevel,i=e.msgId,l=e.reactionId,s=e.timestamp;if(d({flow:r,key:t,msgAckLevel:a,msgId:i,reactionId:l,threadSnippetResult:n,timestamp:s}),s!=null){var u=babelHelpers.extends({},n.snippet.snippetParams,{strings:n.snippet.snippetParams.strings.map(function(e){return o("MAWVault").unvault(e)})});return{key:t,timestamp:s,value:{snippet:babelHelpers.extends({},n.snippet,{snippetParams:u}),snippetMsgAckLevel:a,snippetMsgId:i,snippetReactionId:l}}}},a.$MAWSnippetsCacheService$p_8=function(t,n){if(!o("MAWSnippetsCacheCalculateDelta").isNeededToCheckMessageExistence(n))return o("MAWDexieTable").dexieResolve(!1);var e=o("MAWDbMsgOrReaction").switchOnMsgOrReaction(n,{forMessage:function(t){return null},forReaction:function(t){return t.reactToMsgId}});return e==null?o("MAWDexieTable").dexieResolve(!0):o("MAWDbMsgTxns").getMsgsByMsgIds(t,[e]).then(function(e){return e.length===0})},r})(r("MAWCacheServiceBase"));function d(e){var t=e.flow,n=e.key,o=e.msgAckLevel,a=e.msgId,i=e.reactionId,l=e.threadSnippetResult,s=e.timestamp;if(l==null){r("FBLogger")("MAWCacheService").warn(u+"["+t+"] Failed to calculate thread snippet, key: %s",n);return}if(s==null){r("FBLogger")("MAWCacheService").warn(u+"["+t+"] No timestamp found for the thread snippet, key: %s,\n      msgId: %s, reactionId: %s",n,a,i);return}r("FBLogger")("MAWCacheService").info(u+"["+t+"] Snippet successfully calculated, key: %s,\n    timestamp: %s, msgId: %s, reactionId: %s, ack level %s",n,s,a,i,o)}function m(e){var t=e.dropReason,n=e.key,a=e.msgOrReaction,i=e.operation,l=o("MAWSnippetsCacheServiceUtils").getMsgOrReactionIdAndTimestamp(a),s=l.msgAckLevel,c=l.msgId,d=l.reactionId,m=l.timestamp;r("FBLogger")("MAWCacheService").info(u+" Drop update for msg or reaction, reason: %s, key: %s, msgId: %s, reactionId: %s, timestamp: %s, ackLevel: %s, operation: %s",t,n,c,d,m,s,i)}var p=new c,_=function(){return p};l.getMAWSnippetsCacheService=_}),98);
__d("MAWDataSyncQueue",["Promise","WALogger","asyncToGeneratorRuntime","getErrorSafe","qex","throttle"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=r("qex")._("853")||1e3,d=r("qex")._("855")||1e3,m=function(){return f=!1,b({isUnloading:!0})},p=[],_=[],f=!1,g=[],h=function(){var e,t=p.splice(0,p.length);(e=_).push.apply(e,t)},y=function(){return _.splice(0,c)},C=function(r){var t=y();if(t.length!==0)return(u||(u=n("Promise"))).all(g.map(function(n,a){return n(t,r).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unhandled exception caught in middleware "," sync: ",""])),a,t)})})).then(function(){return C(r)})},b=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(!f){f=!0,h();try{yield C(e)}catch(e){var t,n=r("getErrorSafe")(e);throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWIndexedDbMiddleware] error handling queue batch: ",""])),(t=n==null?void 0:n.message)!=null?t:n.toString()),e}finally{f=!1,p.length>0&&v()}}});return function(n){return e.apply(this,arguments)}})(),v=r("throttle")(b,d),S=function(t,n){p.push({type:t,value:n}),v()},R=function(t){g.some(function(e){return e===t})||g.push(t)},L=function(){g=[]},E=function(){p=[],_=[]},k=function(){return p};l.forceFlushDataSyncQueue=m,l.addSyncItem=S,l.registerDataSyncCallback=R,l.clearDataSyncCallbacks=L,l.clearDataSyncQueue_FOR_TESTING_ONLY=E,l.getDataSyncQueue_FOR_TESTING_ONLY=k}),98);
__d("MAWDataSyncMiddleware",["FBLogger","MAWDataSyncQueue","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(["contacts","groupInfo","messages","participants","threads","reactions","xma","pendingStanzas"]);function s(t,n){var r=t.table(n);return e.has(n)?babelHelpers.extends({},r,{mutate:function(t){return r.mutate(t).then(function(e){return t.type==="delete"?(t.keys.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n})}),e):(e.results!=null?e.results.forEach(function(e){o("MAWDataSyncQueue").addSyncItem(t.type,{key:e,tableName:n,values:t.values})}):e.lastResult!=null&&o("MAWDataSyncQueue").addSyncItem(t.type,{key:e.lastResult,tableName:n,values:t.values}),e)})}}):r}function u(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return s(t,n)}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying DataSync Middleware, messages made during this session will not be properly synced to registered consumers"),t}},name:"MAWDataSyncMiddleware",stack:"dbcore"}}l.getDataSyncMiddleware=u}),98);
__d("MAWIndexedDb",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCacheServiceMiddleware","MAWDataSyncMiddleware","MAWDbFactory","MAWDbMutationMiddleware","MAWDbProtocolMsgIdMiddleware","MAWDbSchema","MAWDexie","MAWLSDataSyncMiddleware","MAWLoadDbMigrationVersion","MAWMpsGating","MAWTransactor","MWFBLogger","asyncToGeneratorRuntime","cr:10181","cr:10182","cr:3527","gkx","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){e===void 0&&(e="idb");var t=o("MAWDbFactory").makeIDBFactory(e,"worker");function a(e){return t.setupPromise().then(function(){return t.getDBExn(e)})}return babelHelpers.extends({},t,{getSignalDB:a,makeDB:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,a,i){var l=[o("MAWDbMutationMiddleware").getMAWDbMutationMiddleware];return o("MAWMpsGating").isMpsMessageRendering()||l.push(o("MAWLSDataSyncMiddleware").getMAWLSDataSyncMiddleware),r("gkx")("1760")&&l.push(o("MAWDbProtocolMsgIdMiddleware").MAWDbProtocolMsgIdMiddleware),l.push(r("MAWCacheServiceMiddleware")),a.enableDataSyncMiddleware&&l.push(o("MAWDataSyncMiddleware").getDataSyncMiddleware),n("cr:3527")!=null&&l.push(n("cr:3527")),r("justknobx")._("4087")&&(yield r("MAWLoadDbMigrationVersion")(e)),t.makeDB(e,{autoOpen:!0,middleware:l,onDbPopulate:a.onDbPopulate},i)});function a(t,n,r){return e.apply(this,arguments)}return a})()})}var c=u(),d="idle",m=c.isNewDb,p=c.willSetupDB,_=function(t,n,r){return c.makeDB(t,n,r).then(function(){d="ready"})},f=c.closeDB,g=c.getDBExn,h=c.getSignalDB,y=c.getDB,C=function(t){return c.reset_singleton_INTERNAL_ONLY()},b=c.deleteDb;function v(){return d}function S(e){var t=d;return d="migrating",e.finally(function(){d=t})}var R=new WeakMap,L=new WeakMap,E=o("MWFBLogger").MWLogger().tags(["db","afterTransaction"]);function k(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransactionEffect called outside of dexie transaction");if(typeof e=="function"){var n=R.get(t)||[];n.push(e),R.set(t,n),n.length===1&&t.on("complete",function(){var e=R.get(t)||[];e.forEach(function(e){e()}),R.delete(t)})}}function I(e){var t=r("MAWDexie").currentTransaction;if(t==null)throw E.mustfixThrow("afterTransaction called outside of dexie transaction","maw_db");var a=L.get(t);if(a!=null)a.push(e);else{var i=[e];L.set(t,i),t.on("complete",function(){L.delete(t),r("gkx")("5675")&&(s||(s=r("ExecutionEnvironment"))).isInMainThread&&n("cr:10182")!==null&&n("cr:10181")!==null?n("cr:10182").handleEvents(n("cr:10181").LSDatabaseSingleton,i):o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:i})})}}var T=new Set(["NewMsg","NewMsgs","MsgUpdated","NewMedia","NewMediaRange","MediaExpired","XMAShareExpired","DeleteMessagesOfThread","UpsertReaction","DeleteReaction","DeleteMessages","NewXMA","EditMsgHistoryAdded","MsgsStartCountdown","MsgClearCountdown","XMAShareTombstoned","NewReceiverFetchInfo","NewXMAs","NewPoll","RavenActionUpdate"]);function D(t,n){if(n!==!0&&o("MAWMpsGating").isMpsMessageRendering()&&T.has(t.tag)){r("FBLogger")("wmi").INFO(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MpsMessageRendering] Ignoring afterTxn event: ",""])),t.tag);return}if(t.tag==="UpdateThreadActivity"&&r("FBLogger")("wmi").mustfix("Thread consistency uses MAW DB mechanism instead of new one"),t.tag==="ThreadUpdated")try{var a=t.value.snippetContactIDs;a!=null&&a.some(function(e){return e==="Facebook User"})&&(E.mustfix('Something is still setting a contact id as "Facebook User"'),t.value=babelHelpers.extends({},t.value,{snippetContactIDs:a.map(function(e){return e==="Facebook User"?"0":e})}))}catch(e){}I(t)}function x(e,t){var n=r("MAWDexie").currentTransaction;if(n==null)throw E.mustfixThrow("afterTransactionForThreadEvent called outside of dexie transaction","maw_db");n.on("complete",function(){o("MAWBridge").getBridge().fireAndForget("threadEvent",t,e)})}l.TABLES_TO_ENCRYPT=o("MAWDbSchema").TABLES_TO_ENCRYPT,l.makeMsgrTransactor=o("MAWTransactor").makeMsgrTransactor,l.makeMAWIndexedDBFactory=u,l.isNewDb=m,l.willSetupDB=p,l.makeDB=_,l.closeDB=f,l.getDBExn=g,l.getSignalDB=h,l.getDB=y,l.setDB_INTERNAL_USE_ONLY=C,l.deleteDb=b,l.getDbStatus=v,l.updateStatusDuringMigration=S,l.afterTransactionEffect=k,l.afterTransaction=D,l.afterTransactionThreadEvent=x}),98);
__d("MAWDbAppMeta",[],(function(t,n,r,o,a,i){"use strict";var e={allowSecurityAlert:"allowSecurityAlert",allowSecurityAlertForSelf:"allowSecurityAlertForSelf",dbMigrationVersion:"dbMigrationVersion",deviceJid:"deviceJid",hasMigratedFromDexie:"hasMigratedFromDexie",hmacKey:"hmacKey",hotlikeSticker:"hotlikeSticker",isBackfilledForOccamadillo:"isBackfilledForOccamadillo",msgTypeVersion:"msgTypeVersion",restoreMigrationAttempts:"restoreMigrationAttempts",restoreToDexieMigrationComplete:"restoreToDexieMigrationComplete"};i.AppMetaKeysEnum=e}),66);
__d("MAWLoadDbMigrationVersion",["ExecutionEnvironment","MAWBridge","MAWCurrentUser","MAWDBMigrationUtils","MAWDbAppMeta","MAWDbObjEncryption","MAWIndexedDbMetadata","MAWUnrecoverableDbErrors","MWFBLogger","Promise","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=o("MWFBLogger").MWLogger().tags(["db","MAWLoadDbMigrationVersion"]);function h(t){var a=o("MAWCurrentUser").getID(),i=o("MAWIndexedDbMetadata").dbName(a);return new(f||(f=n("Promise")))(function(n){if(!indexedDB){n();return}var a=indexedDB.open(i);a.onupgradeneeded=function(t){t.target.transaction.abort();var r=t.target.result;g.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," onupgradeneeded - closing db"])),i),r==null||r.close(),n()},a.onsuccess=function(e){var a=e.target.result;if(a==null){n();return}try{var i=a.transaction("appMeta","readonly");i.onerror=function(e){var t;g.DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Transaction error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()};var l=i.objectStore("appMeta"),m=l.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion);m.onerror=function(e){var t;g.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Request error: ",""])),(t=e.target.error)==null?void 0:t.message),a.close(),n()},m.onsuccess=function(e){a.close();var i=e.target.result;if(i!=null)try{var l=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},i),"appMeta",t),s=l.value.dbMigrationVersion;s!=null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version=s)}catch(e){var u=r("getErrorSafe")(e);g.catching(u).MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Failed to decrypt appMeta row"]))),(_||(_=r("ExecutionEnvironment"))).isInWorker&&o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError})}n()}}catch(e){var p=r("getErrorSafe")(e);g.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] Error accessing appMeta: ",""])),p.message),a.close(),n()}},a.onerror=function(e){var t;g.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," error ",""])),i,e==null||(t=e.target)==null||(t=t.error)==null?void 0:t.message),n()},a.onblocked=function(e){var t=e.target.result;g.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["[MAWLoadDbMigrationVersion] "," blocked"])),i),t==null||t.close()}})}l.default=h}),98);
__d("MAWLLAMigrationUtils",["Random","gkx","justknobx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("652"),s=Math.max(e,10),u=s*10,c=new Map([["FTS",u]]);function d(e){if(r("gkx")("9340"))return 1;var t=c.get(e);return t!=null?t:s}function m(e,t){t===void 0&&(t={});var n=d(e);return e==="debug"||e==="test"?[]:r("gkx")("23956")&&o("Random").coinflip(n)?[r("qpl")._(1056839327,"560"),babelHelpers.extends({double:{sampleRate:1/n},string:{transactor:e}},t)]:[]}l.getTransactorQPLParam=m}),98);
__d("MAWTransactor",["MAWDexie","MAWDexieTable","MAWErrorObject","MAWIndexedDb","MAWIndexedDbUI","MAWLLAMigrationUtils","MAWQplProxy","MAWTransactionMode","MWFBLogger","WAExceededStorageQuota","WALogger","gkx","performance"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=["MWPTransactor"],d=o("MWFBLogger").MWLogger();function m(t,n,a,i,l,s){return i!=null&&r("MAWDexie").currentTransaction!=null&&i.endFail("invoked_in_nested_transaction",{string:{current_transaction_mode:r("MAWDexie").currentTransaction.mode},string_array:{current_transaction_store_names:r("MAWDexie").currentTransaction.storeNames}}),r("MAWDexie").currentTransaction!=null&&o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["makeMsgrTransactor "," should not be called inside another transaction. The transaction will be forced to execute on top-level"])),l),t.transact(n,a,s)}function p(e){var t=o("MAWLLAMigrationUtils").getTransactorQPLParam(e),n=t.length===2?t:[null,void 0],r=n[0],a=n[1];return r!=null?o("MAWQplProxy").startQplUserFlow(r,a,{sendThroughBridge:!1}):null}function _(e,t,n,r){return C(e,t,function(e){return o("MAWIndexedDb").getDB(e)},n,r)}function f(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}function g(e,t,n){return C(e,t,o("MAWIndexedDbUI").getDB,n)}var h=0,y=new Map;function C(e,t,n,a,i){var l=Object.keys(e),_=l.some(function(t){return e[t]===o("MAWTransactionMode").READWRITE})?o("MAWTransactionMode").READWRITE:o("MAWTransactionMode").READONLY;return function(){for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];var C=p(t),S=null,R=function(){return self.clearInterval(S)};if(C!=null&&(C.addAnnotations({string:{mode:_===o("MAWTransactionMode").READWRITE?"readwrite":"readonly"},string_array:{stores:l}}),r("gkx")("1006")&&t==="bulkCreateThreadByJid")){var L=1e3,E=Date.now();S=self.setInterval(function(){C.addAnnotations({int:{heartbeatLatestAliveSinceStartMs:Date.now()-E}})},L),self.setTimeout(R,o("MAWQplProxy").DEFAULT_WORKER_QPL_TIMEOUT_MS)}var k=(u||(u=r("performance"))).now()+u.timeOrigin;return n(t).then(function(e){var n=Array.from(y.values());C==null||C.addPoint("lock_wait_start",{string_array:{maybeLockedOn:n}});var p=(u||(u=r("performance"))).now();return i==null||i.onTxnRequestedCb==null||i.onTxnRequestedCb.apply(i,f),m(e,_,l,C,t,function(){o("MAWDexieTable").setDexiePSDItem("transactionRequested",k),o("MAWDexieTable").setDexiePSDItem("transactorName",t),C==null||C.addPoint("dexie_transaction_start"),h+=1;var m=h;y.set(m,t);var _=C!=null?e.stores[l[0]].get("").then(function(){C==null||C.addPoint("lock_wait_end"),C==null||C.addPoint("transaction_opened"),C==null||C.addPoint("transactor_execution_start")}):o("MAWDexieTable").dexieResolve();return _.then(function(){return a(e.stores).apply(void 0,f)}).then(function(e){if(r("gkx")("6795")&&(i==null?void 0:i.explicitlyCloseTxn)===!0){var a;(a=r("MAWDexie").currentTransaction)==null||(a=a.idbtrans)==null||a.commit==null||a.commit()}y.delete(m),C==null||C.addPoint("transactor_execution_end"),C==null||C.endSuccess(),R();var l=(u||(u=r("performance"))).now()-p;return l>5e3&&(o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[Slow maw transaction] "," took ","ms to complete. Potentially waiting for locks on ",""])),t,l,n.join(", ")),d.mustfix("[Slow maw transaction] %s took long to complete. Potentially waiting for locks on $s",t,n.join(", "))),e}).catch(function(e){y.delete(m),o("WAExceededStorageQuota").checkQuotaExceededError(e);var n=e.name==="AbortError"?e==null?void 0:e.inner:null,r=b(n);if(C==null||C.markError("transaction_error",null,e),e instanceof Error){var a=e,i=typeof(a==null?void 0:a.stack)=="string"?a.stack:typeof(a==null?void 0:a.stack),l=typeof(a==null?void 0:a.message)=="string"?a.message:typeof(a==null?void 0:a.message);C==null||C.addAnnotations({string:{errMessage:l,errStack:i,innerError:r}})}C==null||C.endFail("transaction_fail"),R();var s=o("MAWErrorObject").getErrorObject(e);throw v(s).mustfixThrow("[%s] Error performing %s transaction. Inner error: %s",c.join("|"),t!=null?t:"",r!=null?r:"unknown")})})}).catch(function(e){o("WAExceededStorageQuota").checkQuotaExceededError(e),C==null||C.endFail("transaction_fail"),R();var n=o("MAWErrorObject").getErrorObject(e);throw v(n).mustfixThrow("[%s] Error performing %s transaction",c.join("|"),t!=null?t:"")})}}function b(e){if(typeof e=="string")return e;if(e instanceof Error)return e.name+": "+e.message;if(typeof e=="object")try{return JSON.stringify(e)}catch(e){}return null}function v(e){return e?d.catching(e):d}l.makeMsgrTransactor=_,l.makeMsgrUITransactor_IMPORT_FROM_MAWIndexedDbUI_INSTEAD=f,l.makeMsgrUIWritableTransactor=g}),98);
__d("MAWThreadUpdateType",[],(function(t,n,r,o,a,i){"use strict";var e=0,l=1,s=2,u=3,c=Object.freeze({BUMP_THREAD:s,MARK_THREAD_AS_UNREAD:u,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:e,SNIPPET_ONLY:l});i.THREAD_UPDATE_TYPE=c}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e;return t==null?(r("FBLogger")("messenger_web").mustfix("nullAdminType"),o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE):s(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:u(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:c(t)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:(d(t)||r("FBLogger")("messenger_web").mustfix("unsupportedAdminMsgType"),o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE)}function s(e){return o("MAWAdminMsgTypesGrouped").otherUserAddRemoveParticipant.includes(e)||o("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(e)||o("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(e)||o("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(e)||o("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(e)||o("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(e)||e===o("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function u(e){return o("MAWAdminMsgTypesGrouped").currentUserAddRemoveParticipant.includes(e)||o("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(e)||o("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(e)||o("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(e)||o("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(e)||o("MAWAdminMsgTypesGrouped").limitSharingUpdate.includes(e)}function c(e){return e===o("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||o("MAWAdminMsgTypesGrouped").dualThreadCutoverAdminMsgs.includes(e)||o("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(e)||o("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(e)||o("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(e)||o("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(e)}function d(e){return o("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(e)||o("MAWAdminMsgTypesGrouped").deviceChanges.includes(e)||o("MAWAdminMsgTypesGrouped").icdcAlerts.includes(e)||o("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(e)||e===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||e===o("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||e===o("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||e===o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}l.getThreadUpdateTypeForAdminMsg=e}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.reaction==null;return u(e,t)}function s(e){return c(e.reactToAuthor)&&!c(e.author)}function u(e,t){return s(e)&&!t?e.senderTimestampMs==null?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function c(e){return e===o("WAJids").AUTHOR_ME||e===o("MAWUserJidWrapper").getMyUserJid()}function d(e){var t=e.adminType,n=e.author,a=e.msgType,i=e.xmaMessageType,l=function(t){var e=t.me,r=t.other;return o("WAJids").isAuthorMe(n)?e:r};switch(a){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":case"BumpExistingMessage":return l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return o("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(i)?o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"DeleteForMe":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"EditAction":return l({me:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":{if(a==="Admin")return o("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(t);throw r("FBLogger")("messenger_web").mustfixThrow("Non-admin msg passed in "+(a!=null?a:"UNKNOWN"))}case"SenderKeyDistribution":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWGetThreadUpdateType] Unexpected message type: %s",a!=null?a:"UNKNOWN")}}function m(t){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstoredNullish(t,{forMessage:function(t){var e;return d({adminType:(e=t.msgContent)==null?void 0:e.adminType,author:t.author,msgType:t.type,xmaMessageType:t.xmaMessageType})},forNull:function(){return o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(n){return e(n)}})}function p(e){var t=m(e);switch(t){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][snippet] Unhandled threadUpdateType: "+t)}}function _(e){var t=m(e);switch(t){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return!0;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate][bump] Unhandled threadUpdateType: "+t)}}l.getThreadUpdateTypeForReaction=e,l.canReactionAffectBump=s,l.getReactionThreadUpdateType=u,l.getThreadUpdateTypeForMsg=d,l.getThreadUpdateTypeForMsgOrReaction=m,l.isThreadUpdateTypeEligibleForSnippet=p,l.isThreadUpdateTypeEligibleForBump=_}),98);
__d("MAWCacheServiceMiddleware",["FBLogger","MAWIndexedDb","MAWMpsGating","MAWWorkerCacheServices","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=["messages","reactions"],s=["messages","reactions"];function u(e,t,n){var r,o,a=n.trans,i=(r=(o=a._transactorMeta)==null?void 0:o.mawCacheServiceAccumulatedRequests)!=null?r:[];if(n.type==="delete"&&s.includes(t.name))return p(e,t.name,n).then(function(e){var r=babelHelpers.extends({},n,{deletedValues:e});return i.push([t.name,r]),a._transactorMeta=babelHelpers.extends({},a._transactorMeta,{mawCacheServiceAccumulatedRequests:i}),t.mutate(n)});var l=babelHelpers.extends({},n,{decryptedValues:n.values?n.values:void 0});return i.push([t.name,l]),a._transactorMeta=babelHelpers.extends({},a._transactorMeta,{mawCacheServiceAccumulatedRequests:i}),t.mutate(n)}function c(e){var t,n=e.trans;((t=n._transactorMeta)==null?void 0:t.mawCacheServiceAfterTransactionScheduled)!==!0&&(o("MAWIndexedDb").afterTransactionEffect(function(){var e,t,r=(e=(t=n._transactorMeta)==null?void 0:t.mawCacheServiceAccumulatedRequests)!=null?e:[];r.length!==0&&o("MAWWorkerCacheServices").getMAWWorkerCacheServices().calculateDelta(r)}),n._transactorMeta=babelHelpers.extends({},n._transactorMeta,{mawCacheServiceAfterTransactionScheduled:!0}))}function d(t,n){var r=t.table(n);return!e.includes(n)||o("MAWMpsGating").isMpsSnippetsCacheServiceEnabled()?r:babelHelpers.extends({},r,{mutate:function(n){return c(n),u(t,r,n)}})}function m(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return d(t,n)}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("MAWCacheService").catching(e).mustfix("Error applying MAW Cache Service Middleware"),t}},name:"MAWCacheServiceMiddleware",stack:"dbcore"}}function p(e,t,n){var r=n.keys,o=n.trans;return e.table(t).getMany({keys:r,trans:o}).then(function(e){return e.filter(Boolean)})}l.default=m}),98);
__d("MAWVaultDb",["FBLogger","MAWQplProxy","MAWVault","getErrorSafe","gkx","isObject","isPlainObject","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=.001,s=new WeakMap;function u(e,t){return t[e]!=null}var c=r("gkx")("23909");function d(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=s.get(t);if(i!=null)return i;var l=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(25301509,"119")):null;try{var d=a[n],m=p(t,d,o("MAWVault").vault);return l==null||l.endSuccess(),s.set(t,m),m}catch(e){l==null||l.endFail("vault_fail");var _=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Failed to vault an entity in the table: %s",_.message,n)}}function m(t,n,a){if(!r("isPlainObject")(t)||!c||!u(n,a)||t==null)return t;var i=Math.random()<e?o("MAWQplProxy").startQplUserFlow(r("qpl")._(741087294,"2028")):null;try{var l=p(t,a[n],o("MAWVault").unvault);return i==null||i.endSuccess(),l}catch(e){i==null||i.endFail("unvault_fail");var s=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("%s - Unvaulting failed for an entity in the table: %s",s.message,n)}}function p(e,t,n){if(e==null)return e;var o=Object.entries(t).filter(function(t){var n=t[0];return e[n]!=null});return o.length===0?e:o.reduce(function(e,t){var o=t[0],a=t[1];return typeof a!="boolean"&&r("isObject")(a)?e[o]=p(e[o],a,n):a===!0&&(e[o]=n(e[o])),e},babelHelpers.extends({},e))}l.vaultDbRow=d,l.unvaultDbRow=m,l.setInPath=p}),98);
__d("MAWVaultDefinitions",[],(function(t,n,r,o,a,i){"use strict";var e={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}},l={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};i.ARMADILLO_IDB_VAULT_DEFINITIONS=e,i.PERSISTED_DB_VAULT_DEFINITIONS=l}),66);
__d("isEncryptionAtRestEnabled",["isInstamadillo","qex"],(function(t,n,r,o,a,i,l){"use strict";function e(){return r("qex")._("507")===!0?!0:r("isInstamadillo")()}l.default=e}),98);
__d("MAWDbMiddlewareMutations",["MAWDbObjEncryption","MAWVaultDb","MAWVaultDefinitions","gkx","isEncryptionAtRestEnabled"],(function(t,n,r,o,a,i,l){"use strict";var e=r("gkx")("23909");function s(t,n,a){if(!e&&!(r("isEncryptionAtRestEnabled")()||r("gkx")("23910")))return t;var i=babelHelpers.extends({},t);return i=o("MAWVaultDb").unvaultDbRow(i,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS),i=o("MAWDbObjEncryption").encryptDbObj(i,n,a),i}function u(t,n){return e?o("MAWVaultDb").unvaultDbRow(babelHelpers.extends({},t),n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}function c(t,n,r){var a=o("MAWDbObjEncryption").decryptDbObj(babelHelpers.extends({},t),n,r);return e?o("MAWVaultDb").vaultDbRow(a,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):a}function d(t,n){if(t!=null)return e?o("MAWVaultDb").vaultDbRow(t,n,o("MAWVaultDefinitions").ARMADILLO_IDB_VAULT_DEFINITIONS):t}l.mutateValue=s,l.mutateVaultedValue=u,l.getValue=c,l.getVaultedValue=d}),98);
__d("MAWDbProtocolMsgIdMiddleware",["FBLogger","MAWDBMigrationUtils","MAWJidUtils","MAWODSProxy","Random","WAOdsEnums","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("3300");function s(t){return babelHelpers.extends({},t,{get:function(n){return t.get(n).then(function(e){return d(e,"get"),e})},getMany:function(n){return t.getMany(n).then(function(e){return e==null?void 0:e.map(function(e){return d(e,"getMany"),e})})},mutate:function(r){return r.type==="add"?r.values.map(function(e){return u(e)}):r.type==="put"&&r.values.map(function(t){t.protocolMsgId==null&&(o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_after_migration_complete.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue?(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_below_migration_cursor.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)):o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.isRunning&&t.rowId<o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.cursorValue+o("MAWDBMigrationUtils").mawDbDedupeMsgsMigrationStatus.batchSize&&(o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.put_operation_in_current_migration_batch.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version}),u(t)))}),t.mutate(r)},query:function(n){return t.query(n).then(function(e){var t;return e==null||(t=e.result)==null||t.map(function(e){d(e,"query")}),e})}})}function u(e){e.protocolMsgId=o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(e)}function c(e){return(e==null?void 0:e.rowId)==null&&(e==null?void 0:e.externalId)==null}function d(t,n){try{if(c(t)){n!=="get"&&o("Random").coinflip(e)&&r("FBLogger")("messenger_web").warn("Corrupted message row returned from DB, msg is null:%s, queryType: %s",t==null,n);return}(t==null?void 0:t.protocolMsgId)==null&&o("Random").coinflip(e)&&(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"null_protocol_msg_id.migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)}),o("MAWDBMigrationUtils").mawDbMigrationVersion.version>=o("MAWDBMigrationUtils").MAWDB_DEDUPE_MSGS_MIGRATION_VERSION&&r("FBLogger")("maw_db_migration").warn("Message with null protocolMsgId after the msg dedupe migration. type: %s, rowId: %s, externalId: %s",t==null?void 0:t.type,t==null?void 0:t.rowId,t==null?void 0:t.externalId)),t!=null&&t.protocolMsgId!=null&&t.protocolMsgId!==o("MAWJidUtils").toProtocolMsgIdStringForMAWStorage(t)&&o("Random").coinflip(e)&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_PROTOCOL_MSG_ID_INDEX,key:"inconsistent_protocol_msg_id."+(t==null?void 0:t.type)+".migration_version_"+o("MAWDBMigrationUtils").mawDbMigrationVersion.version+".append_protocol_msg_id_for_put_operation_jk_"+String(!0)})}catch(e){var a=r("getErrorSafe")(e);r("FBLogger")("messenger_web").catching(a).mustfix("Error while checking protocol msg id")}}function m(){return{create:function(t){try{return babelHelpers.extends({},t,{table:function(n){return n!=="messages"?t.table(n):s(t.table(n))}})}catch(n){var e=r("getErrorSafe")(n);return r("FBLogger")("messenger_web").catching(e).mustfix("Error applying Protocol MsgId Middleware"),t}},name:"MAWDbProtocolMsgIdMiddleware",stack:"dbcore"}}l.appendProtocolMsgId=u,l.isCorruptedMsgRow=c,l.MAWDbProtocolMsgIdMiddleware=m}),98);
__d("MAWLSDataSyncMiddleware",["FBLogger","MAWBridge","MAWLSEditMsgHistoryAddedDataSyncHandler","MAWLSMsgsDataSync","MAWLSReactionsDataSyncHandler","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(){var t=new Set;t.add(o("MAWLSReactionsDataSyncHandler").mawLSReactionsDataSyncHandler),t.add(o("MAWLSEditMsgHistoryAddedDataSyncHandler").mawLSEditHistoryDataSyncHandler),t.add(o("MAWLSMsgsDataSync").mawLSMsgsDataSyncHandler),t.forEach(function(t){e.set(t.tableName,t)})}function u(t){return babelHelpers.extends({},t,{mutate:function(r){var n=e.get(t.name);return n!=null?n.performAndSyncMutation(r,t):t.mutate(r)}})}function c(){return s(),{create:function(n){try{return babelHelpers.extends({},n,{table:function(r){return e.has(r)?u(n.table(r)):n.table(r)}})}catch(e){var t=r("getErrorSafe")(e);return r("FBLogger")("maw_db").catching(t).mustfix("Error applying MAW to LS data sync middleware"),n}},name:"MAWLSDataSyncMiddleware",stack:"dbcore"}}function d(e){o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[e]})}l.getMAWLSDataSyncMiddleware=c,l.syncToLS=d}),98);
__d("MAWLSEditMsgHistoryAddedDataSyncHandler",["MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.map(function(e){return babelHelpers.extends({},e)});o("MAWLSDataSyncMiddleware").syncToLS({tag:"EditMsgHistoryAdded",value:t})}var s={performAndSyncMutation:function(n,r){switch(n.type){case"put":case"add":{var t=[].concat(n.values);o("MAWIndexedDb").afterTransactionEffect(function(){return e(t)})}break}return r.mutate(n)},tableName:"editMsgHistory"};l.mawLSEditHistoryDataSyncHandler=s}),98);
__d("MAWLSMsgsDataSync",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n=t.keys,r=t.trans;return e.getMany({keys:n,trans:r}).then(function(e){return e.filter(Boolean)})}function s(e){var t=e.reduce(function(e,t){var n,r=o("MAWBridgeTypesCreators").createBridgeDeletedMessage(t);return e.has(t.threadJid)||e.set(t.threadJid,[]),(n=e.get(t.threadJid))==null||n.push(r),e},new Map);t.entries().forEach(function(e){var t=e[0],n=e[1],r={messages:n,threadJid:t};o("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteMessages",value:r})})}var u={performAndSyncMutation:function(n,r){switch(n.type){case"delete":return e(r,n).then(function(e){return o("MAWIndexedDb").afterTransactionEffect(function(){return s(e)}),r.mutate(n)});default:return r.mutate(n)}},tableName:"messages"};l.mawLSMsgsDataSyncHandler=u}),98);
__d("MAWLSReactionsDataSyncHandler",["MAWBridgeTypesCreators","MAWIndexedDb","MAWLSDataSyncMiddleware"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.reaction,r=e.reactToMsgId,a=e.threadJid,i=e.ts;r!=null&&o("MAWLSDataSyncMiddleware").syncToLS({tag:"UpsertReaction",value:o("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:t,chatJid:a,reaction:n||"",reactToMsgId:r,ts:i})})}function s(e){var t=e.author,n=e.reactToMsgId,r=e.threadJid;n!=null&&o("MAWLSDataSyncMiddleware").syncToLS({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:r,reactToMsgId:n})})}function u(t){t.forEach(function(t){t.reaction==null?s(t):e(t)})}var c={performAndSyncMutation:function(t,n){switch(t.type){case"put":case"add":{var e=[].concat(t.values);o("MAWIndexedDb").afterTransactionEffect(function(){return u(e)})}break}return n.mutate(t)},tableName:"reactions"};l.mawLSReactionsDataSyncHandler=c}),98);
__d("MAWDbReaction",["FBLogger","I64","MAWAckLevel","MAWGetBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=e.author,n=e.reaction,r=e.reactToAuthor,a=o("MAWUserJidWrapper").getMyUserJid();return!(n==null||n===""||r!=="@me"&&r!==a||t==="@me"||t==="@system"||t===a)}function u(e){var t=o("MAWUserJidWrapper").getMyUserJid();if(e.reactToAuthor!=="@me"&&e.reactToAuthor!==t||e.reaction==null)return null;var n=e.author==="@me"||e.author==="@system"?null:e.author;return n==null?null:babelHelpers.extends({},e,{author:n,reaction:e.reaction,reactToAuthor:"@me"})}function c(e){var t=u(e);if(t==null)throw r("FBLogger")("messenger_web").mustfixThrow("Cannot cast reaction to incomingDbReaction");return t}function d(e,t,n){var r=o("MAWUserJidWrapper").getMyUserJid();return e.find(function(e){return e.threadJid===t&&o("WAJids").authorToUserId(e.author,r)===o("WAJids").authorToUserId(n,r)})}function m(e){return e}function p(e,t,n,r,a,i,l,s,u,c,d,m,p){m===void 0&&(m=o("MAWAckLevel").ACK.clock);var _={ack:m,author:c,externalId:t,groupingKey:i,reaction:a,reactionId:n,reactToAuthor:l,reactToExternalId:r,reactToMsgId:s,senderTimestampMs:p,threadJid:e,ts:u};return d!=null?babelHelpers.extends({},_,{rowId:d}):_}function _(t){var n=o("MAWGetBumpTimestampMs").getBumpTimestampMs(t);return o("WATimeUtils").castToMillisTime((e||(e=o("I64"))).to_float(n))}l.isIncomingReaction=s,l.maybeCastToIncomingDbReaction=u,l.castToIncomingDbReaction=c,l.findMatchingReaction=d,l.reactionIdToMsgId=m,l.formatReactionForDb=p,l.getReactionTimeMs=_}),98);
__d("MAWThreadNewestMsgOrReactionUtils",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","first","last"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return _(e,t,u)}function u(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+e)}}function c(e,t){return _(e,t,m)}function d(e){var t=e.db,n=e.jid,r=e.limit;return o("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(t,n,null,!0,r,function(e){var t;return p(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:(t=e.msgContent)==null?void 0:t.adminType,author:e.author,msgType:e.type,xmaMessageType:e.xmaMessageType}),e.ephemeralMsgDisappeared===!0)},"before")}function m(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : %s",e)}}function p(e,t){switch(e){case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return t!==!0;case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case o("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return!1;default:throw r("FBLogger")("messenger_web").mustfixThrow("[MAWCacheService] Unhandled threadUpdateType to create filter function : %s",e)}}function _(t,n,r){var a=function(a){return a==null?o("MAWDexieTable").dexieResolve(null):g(t,n,r,a)};return f(t,n,r).then(function(t){return a(t).then(function(r){if(t==null&&r==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"])),n),null;if(r==null)return t;if(t==null)return r;var a=o("WATimeUtils").castToMillisTime(o("MAWDbMsg").getSortOrderWithFallback(t)),i=o("MAWDbReaction").getReactionTimeMs(r);return a>=i?t:r})})}function f(e,t,n){return o("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(e,t,null,!0,1,function(e){var t;return n(o("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg({adminType:(t=e.msgContent)==null?void 0:t.adminType,author:e.author,msgType:e.type,xmaMessageType:e.xmaMessageType}),e.ephemeralMsgDisappeared===!0)},"before").then(r("first"))}function g(e,t,n,a){var i=o("MAWDbMsg").getSortOrderWithFallback(a),l=function(a,l){return o("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(e,t,o("WATimeUtils").castToMillisTime(i),l,l==null,a,function(e){return n(o("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(e),!1)&&o("MAWDbReaction").getReactionTimeMs(e)>i})},s=[1,10],u=100,c=new Set,d=function(n,a){var t;return l((t=s[n])!=null?t:u,a).then(function(t){var a=t.filter(function(e){return!c.has(C(e))});return a.length===0?(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+n}),null):h(e,a).then(function(e){var a=e.newestReaction,i=e.nullMsgIds;return a!=null?(o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+n}),a):(i.forEach(function(e){return c.add(e)}),d(n+1,r("last")(t)))})})};return d(0,null)}function h(e,t){return o("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(e,t.map(y)).then(function(e){var n=new Set(e.map(b)),r=new Set,o=null;return t.forEach(function(e){var t=C(e);n.has(t)?o=v(o,e):r.add(t)}),{newestReaction:o,nullMsgIds:r}})}function y(e){return{author:e.reactToAuthor,chat:e.threadJid,externalId:e.reactToExternalId}}function C(e){return o("WAMsg").craftWAMsgIdString(y(e))}function b(e){return o("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId})}function v(e,t){return e==null?t:t==null||o("MAWDbReaction").getReactionTimeMs(e)>o("MAWDbReaction").getReactionTimeMs(t)?e:t}l.getNewestMsgOrReactionForBump=s,l.filterForBump=u,l.getNewestMsgOrReactionForSnippet=c,l.getNewestIncomingMsgsForSnippet=d,l.filterForSnippet=m,l.filterForSnippetNewestIncomingMessages=p,l.getNewestReactionToNonNullMsg=h}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Set([(e=o("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,e.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,e.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,e.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,e.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,e.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,e.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function u(e,t,n,r,a,i){return{ack:o("MAWAckLevel").ACK.sent,altIndex:a!=null?a:void 0,author:o("WAJids").AUTHOR_SYSTEM,externalId:n,msgContent:e,sortOrderMs:i,threadJid:t,ts:r!=null?r:o("WATimeUtils").unixTime(),type:o("MAWMsgType").MSG_TYPE.ADMIN}}function c(e){if(s.has(e))return!0;switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case o("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_DISABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_LIMIT_SHARING_ENABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_OTHER_USER_NAME_UNKNOWN:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_SELF_THREAD:case o("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE_WITH_OTHER_USER_NAME:return!0}return!1}function d(e){switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function m(e){switch(e){case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}l.POLL_ADMIN_MSG_TYPES=s,l.buildUnstoredDbAdminMsg=u,l.isAdminMsgNormalized=c,l.isDeviceChangeAdminMsg=d,l.isParticipantChangeAdminMsg=m}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.adminMsgContent,n=e.adminType,a=e.snippetSenderContactId,i=n;if(i==null||t==null)return r("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null"),{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET};var l=o("MAWLocalizationUtils").isAdminMsgNormalized(i)?o("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(i,t):{contactIds:[],contents:t},s=l.contactIds,u=l.contents;return{snippetParams:{contactIDs:[].concat(s.map(function(e){return e==="Facebook User"?"0":e})),strings:[].concat(u)},snippetSenderContactId:a,snippetType:i}}l.default=e}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAGlobals","WAJids","WALogger","WAMsgType"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e,t,n){return{snippetParams:{contactIDs:n!=null?n:[],strings:[]},snippetSenderContactId:e,snippetType:t}}var m=function(t){return d(t,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function p(t){var n=t.author,r=t.replyAuthor,a=t.replyType,i=t.snippetSenderContactId;if(o("WAJids").isAuthorSystem(n))return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"]))),m(i);var l=a;if(l===o("WAMsgType").UNAVAILABLE)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"]))),m(i);var p=r;return p==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"]))),m(i)):o("WAJids").isAuthorMe(n)||n===o("WAGlobals").getMyUserJid()?o("WAJids").isAuthorMe(p)||p===o("WAGlobals").getMyUserJid()?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[o("WAJids").userIdFromJid(p)]):i==null?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"]))),m(i)):o("WAJids").isAuthorMe(p)||p===o("WAGlobals").getMyUserJid()?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[i]):p===n?d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[i]):d(i,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[i,o("WAJids").userIdFromJid(p)])}l.default=p}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:e,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}l.default=e}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return{snippetParams:{contactIDs:n!=null?n:[],strings:[]},snippetSenderContactId:e,snippetType:t}}function s(t){var n=t.author,r=t.snippetSenderContactId,a=t.unsupportedType;if(o("WAJids").isAuthorMe(n))switch(a){case"liveLocationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return e(r,o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}l.default=s}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.ravenMediaType,i=t.snippetSenderContactId,l=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,s={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?l=a===o("MAWMsg").MAWRavenMsgMediaType.IMAGE?o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:o("WAJids").isAuthorSystem(n)||i==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]))):(l=a===o("MAWMsg").MAWRavenMsgMediaType.IMAGE?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,s.contactIDs.push(i)),{snippetParams:s,snippetSenderContactId:i,snippetType:l}}l.default=s}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,r){var a=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,i={contactIDs:[],mentionJIDs:n!=null?n:[],strings:[]};return o("WAJids").isAuthorMe(t)?a=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:o("WAJids").isAuthorSystem(t)||r==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]))):(a=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,i.contactIDs.push(r)),{snippetParams:i,snippetSenderContactId:r,snippetType:a}}l.getMAWThreadSnippetForStickerMsg=s}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils","vulture"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.mentionedJids,a=e.snippetSenderContactId;return r("vulture")("OJJ5LVXkUf0pOmWS05uzvna5IPM="),o("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(t,n,a)}l.default=e}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.mentionedJids,a=t.snippetSenderContactId,i=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,l={contactIDs:[],mentionJIDs:r,strings:[]};return o("WAJids").isAuthorMe(n)?i=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:o("WAJids").isAuthorSystem(n)||a==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]))):(i=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,l.contactIDs.push(a)),{snippetParams:l,snippetSenderContactId:a,snippetType:i}}l.default=s}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.mentionedJids,r=e.snippetSenderContactId;return o("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(t,n,r)}l.default=e}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.content,a=t.isGroup,i=t.mentionedJids,l=t.snippetSenderContactId,s=t.specialTextSize,u=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,c={contactIDs:[],mentionJIDs:i,strings:[]};if(o("WAJids").isAuthorMe(n)?u=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:o("WAJids").isAuthorSystem(n)||l==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]))):(u=a?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,c.contactIDs.push(l)),r!=null)if(s===1||s===2||s===3){var d=o("MAWVault").unvault(r);c.strings.push(d==="\uD83D\uDC4D"?"(Y)":r)}else c.strings.push(r);return{snippetParams:c,snippetSenderContactId:l,snippetType:u}}l.default=s}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.author,r=t.gifPlayback,a=t.mentionedJids,i=t.snippetSenderContactId,l=r===!0,s=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,u={contactIDs:[],mentionJIDs:a,strings:[]};return o("WAJids").isAuthorMe(n)?s=l?o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:o("WAJids").isAuthorSystem(n)||i==null?o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]))):(s=l?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,u.contactIDs.push(i)),{snippetParams:u,snippetSenderContactId:i,snippetType:s}}l.default=s}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N;function M(t){var n=t.author,a=t.chatJid,i=t.content,l=t.mentionedJids,M=t.snippetSenderContactId,A=t.xmaMessageType,F=o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,O={contactIDs:[],mentionJIDs:l,strings:[]};switch(A==null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"]))),A){case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.GEN_AI_RICH_RESPONSE:if(!r("gkx")("12661")){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),A);break}case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_REACTION_REPLY:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:if(o("WAJids").isAuthorMe(n))if(i!=null){var B=i;F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT,B!=null&&O.strings.push(B)}else F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT;else if(o("WAJids").isAuthorSystem(n)||M==null)o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"])));else{F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,O.contactIDs.push(M);var W=i;W!=null&&O.strings.push(W)}break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(o("WAJids").isAuthorMe(n)){F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;var q;if(a!=null&&(q=o("WAJids").interpretAsUserJid(a)),q!=null){var U=o("WAJids").userIdFromJid(q);O.contactIDs.push(U)}else o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)?o("WALogger").ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:if(o("WAJids").isAuthorMe(n)){F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED;var V=w(a);V!=null?O.contactIDs.push(V):o("WALogger").ERROR(S||(S=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(R||(R=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:if(o("WAJids").isAuthorMe(n)&&M!=null){F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED;var H=w(a);H!=null?O.contactIDs.push(H):o("WALogger").ERROR(L||(L=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(E||(E=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:if(o("WAJids").isAuthorMe(n)){F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL;var G=w(a);G!=null?O.contactIDs.push(G):o("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(I||(I=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:if(o("WAJids").isAuthorMe(n)){F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL;var z=w(a);z!=null?O.contactIDs.push(z):o("WALogger").ERROR(T||(T=babelHelpers.taggedTemplateLiteralLoose(["RTC XMA must have a target Jid"])))}else o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(D||(D=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:o("WAJids").isAuthorMe(n)&&M!=null?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:o("WAJids").isAuthorMe(n)&&M!=null?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR($||($=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,O.contactIDs.push(M));break;case o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:o("WAJids").isAuthorMe(n)?F=o("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:o("WAJids").isAuthorSystem(n)||M==null?o("WALogger").ERROR(P||(P=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]))):(F=o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,O.contactIDs.push(M));break;default:o("WALogger").ERROR(N||(N=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""])),A)}return{snippetParams:O,snippetSenderContactId:M,snippetType:F}}function w(e){var t=e!=null?o("WAJids").interpretAsUserJid(e):null;return t!=null?o("WAJids").userIdFromJid(t):null}l.default=M}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return/^\d+$/.test(e)}function s(t){if(!o("WAJids").isAuthorSystem(t)){var n=o("WAJids").isAuthorMe(t)?o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid()):o("WAJids").userIdFromJid(t);if(!e(n)){r("FBLogger")("messenger_web").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return n}}function u(e){var t=e.adminMsgContent,n=e.adminType,a=e.author,i=e.chatJid,l=e.content,u=e.gifPlayback,c=e.mentionedJids,d=e.msgType,m=e.ravenMediaType,p=e.replyAuthor,_=e.replyType,f=e.specialTextSize,g=e.unsupportedType,h=e.xmaMessageType,y=o("WAJids").switchOnMsgrChatJidType(i,{group:function(t){return!0},user:function(t){return!1}}),C=s(a);switch(d){case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:return r("MAWThreadSnippetForCiphertextMsg")(C);case o("MAWMsgType").MSG_TYPE.TEXT:return r("MAWThreadSnippetForTextMsg")({author:a,content:l,isGroup:y,mentionedJids:c,snippetSenderContactId:C,specialTextSize:f});case o("MAWMsgType").MSG_TYPE.IMAGE:return r("MAWThreadSnippetForImageMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.VIDEO:return r("MAWThreadSnippetForVideoMsg")({author:a,gifPlayback:u,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.PTT:return r("MAWThreadSnippetForPttMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case o("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case o("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return r("MAWThreadSnippetForAdminOrEphemeralMsg")({adminMsgContent:t,adminType:n,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.GIF:return r("MAWThreadSnippetForGifMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.STICKER:return r("MAWThreadSnippetForStickerMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return r("MAWThreadSnippetForDocumentFileMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.REVOKED:return r("MAWThreadSnippetForRevokedMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.XMA:return r("MAWThreadSnippetForXMAMsg")({author:a,chatJid:i,content:l,mentionedJids:c,snippetSenderContactId:C,xmaMessageType:h});case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return r("MAWThreadSnippetForBumpExistingMessageMsg")({author:a,replyAuthor:p,replyType:_,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.FUTUREPROOF:return r("MAWThreadSnippetForFallbackMessageMsg")({author:a,snippetSenderContactId:C,unsupportedType:g});case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return r("MAWThreadSnippetForReceiverFetchMsg")({author:a,mentionedJids:c,snippetSenderContactId:C});case o("MAWMsgType").MSG_TYPE.RAVEN:return r("MAWThreadSnippetForRavenMsg")({author:a,mentionedJids:c,ravenMediaType:m,snippetSenderContactId:C});default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:C,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}l.getSnippetContactId=s,l.buildThreadSnippet=u}),98);
__d("WAProtocolMsgId",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.externalId===t.externalId&&e.author===t.author&&e.chat===t.chat}i.equals=e}),66);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDbMsgOrReaction","MAWDbReaction","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("WAJids").switchOnMsgrChatJidType(n,{group:function(r){return u(e,t,!0)},user:function(r){return u(e,t,!1)}})}function s(t,n){return o("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(n,{forMessage:function(n){var e,r,a,i,l,s,u;return o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(e=n.msgContent)==null?void 0:e.adminMsgContent,adminType:(r=n.msgContent)==null?void 0:r.adminType,author:n.author,chatJid:t,content:(a=n.msgContent)==null?void 0:a.content,mentionedJids:(i=n.msgContent)==null?void 0:i.mentionedJids,msgType:n.type,ravenMediaType:n.ravenMediaType,replyAuthor:(l=n.quote)==null?void 0:l.content.author,replyType:(s=n.quote)==null?void 0:s.content.type,specialTextSize:n.specialTextSize,unsupportedType:(u=n.msgContent)==null?void 0:u.subtype,xmaMessageType:n.xmaMessageType})},forReaction:function(n){var t=o("MAWDbReaction").castToIncomingDbReaction(n);return e(t.author,t.reaction,t.threadJid)}})}function u(e,t,n){var a;o("WAJids").isAuthorMe(e)?(r("FBLogger")("messenger_web").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),a=o("WAJids").userIdFromJid(o("MAWUserJidWrapper").getMyUserJid())):a=o("WAJids").userIdFromJid(e);var i={contactIDs:[],strings:[]},l=n?o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:o("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;return i.contactIDs.push(a),i.strings.push(t),{snippetParams:i,snippetSenderContactId:a,snippetType:l}}function c(e,t,n,r){var a,i=n.newestReaction,l=n.reactionsToClear;if(i!=null&&o("WATimeUtils").castUnixTimeToMillisTime(i.ts)>((a=t.snippetMsgTs)!=null?a:0))return o("MAWDexieTable").dexieResolve({newestReaction:i,thread:d(t,i,r)});var s=l!=null&&l.length>0;return s&&t.snippetMsg!=null?e.reactions.get({reactionId:t.snippetMsg}).then(function(n){var r=!1;if(n==null)r=!0;else{var a=o("MAWJidUtils").maybeToProtocolMsgId(n.author,n.threadJid,n.reactToExternalId);a!=null&&(r=l.some(function(e){var t=o("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.reactToExternalId);return t!=null&&o("WAProtocolMsgId").equals(t,a)}))}return r?m(e,t).then(function(e){return{newestReaction:null,thread:e}}):o("MAWDexieTable").dexieResolve({newestReaction:null,thread:t})}):o("MAWDexieTable").dexieResolve({newestReaction:null,thread:t})}function d(e,t,n){return babelHelpers.extends({},e,{snippetMsg:t.reactionId,snippetMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(t.ts)})}function m(e,t){return o("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(e,t).then(function(e){if(e==null)return r("FBLogger")("messenger_web").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled"),babelHelpers.extends({},t,{snippetMsg:void 0,snippetMsgTs:void 0});var n=o("WATimeUtils").castUnixTimeToMillisTime(o("MAWDbMsg").getCanonicalTsFromMsg(e));return babelHelpers.extends({},t,{snippetMsg:e.msgId,snippetMsgTs:n})})}function p(e,t){return m(e,t).then(function(t){return e.threads.put(t).then(r("emptyFunction"))})}l.buildReactionThreadSnippet=e,l.buildThreadSnippetForMsgOrIncomingReaction=s,l.getReactionSnippetParams=u,l.getThreadChangesetForReactionChanges=c,l.getThreadChangesetForNewReaction=d,l.refreshThreadSnippet=p}),98);
__d("MAWEphemeralMsgUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return function(t){return!e.has(t.msgId)&&t.ephemeralMsgDisappeared!==!0}}i.filterNonExpiredMsg=e}),66);
__d("MAWThreadSnippetUtils",["MAWDbReaction","MAWEphemeralMsgUtils","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MAWXMAUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;if(d(e.xmaMessageType))return!0;var n=((t=e.msgContent)==null?void 0:t.adminType)!=null?o("MAWLocalizationUtils").isDeviceChangeAdminMsg(e.msgContent.adminType):!1;if(e.type!==o("MAWMsgType").MSG_TYPE.ADMIN)return!1;var r=e.msgContent.adminType;return r===o("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:n}function s(t,n,r){return t.messages.where("[threadJid+sortOrderMs]").between([n.jid,Number.MIN_SAFE_INTEGER],[n.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(t){return(r==null||o("MAWEphemeralMsgUtils").filterNonExpiredMsg(r)(t))&&!e(t)}).reverse().first()}var u={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:o("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function c(e,t,n,r){return r==null||r.addPoint("fetching_from_db_from_scratch_"+(n!=null?n:0)+"_start"),o("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(e,t).then(function(e){return r==null||r.addPoint("fetching_from_db_from_scratch_"+(n!=null?n:0)+"_end"),e==null?{snippet:u}:m(t,e)})}function d(e){return o("MAWXMAUtils").isXMAStoryReply(e)||o("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(e)}function m(e,t){var n,r,a,i,l,s,c;if(t.reactionId!=null){var d=o("MAWDbReaction").maybeCastToIncomingDbReaction(t);return d==null?{snippet:u}:{snippet:o("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(d.author,d.reaction,e),snippetMsgOrReaction:t}}switch(t.type){case o("MAWMsgType").MSG_TYPE.XMA:{var m,p,_,f,g,h,y,C=o("MAWJidUtils").toProtocolMsgId(t);return C==null?{snippet:u}:{snippet:o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(m=t.msgContent)==null?void 0:m.adminMsgContent,adminType:(p=t.msgContent)==null?void 0:p.adminType,author:t.author,chatJid:t.threadJid,content:(_=t.msgContent)==null?void 0:_.content,mentionedJids:(f=t.msgContent)==null?void 0:f.mentionedJids,msgType:t.type,ravenMediaType:t.ravenMediaType,replyAuthor:(g=t.quote)==null?void 0:g.content.author,replyType:(h=t.quote)==null?void 0:h.content.type,specialTextSize:t.specialTextSize,unsupportedType:(y=t.msgContent)==null?void 0:y.subtype,xmaMessageType:t.xmaMessageType}),snippetMsgOrReaction:t}}default:return{snippet:o("MAWThreadSnippet").buildThreadSnippet({adminMsgContent:(n=t.msgContent)==null?void 0:n.adminMsgContent,adminType:(r=t.msgContent)==null?void 0:r.adminType,author:t.author,chatJid:t.threadJid,content:(a=t.msgContent)==null?void 0:a.content,mentionedJids:(i=t.msgContent)==null?void 0:i.mentionedJids,msgType:t.type,ravenMediaType:t.ravenMediaType,replyAuthor:(l=t.quote)==null?void 0:l.content.author,replyType:(s=t.quote)==null?void 0:s.content.type,specialTextSize:t.specialTextSize,unsupportedType:(c=t.msgContent)==null?void 0:c.subtype,xmaMessageType:t.xmaMessageType}),snippetMsgOrReaction:t}}}l.isDbMsgDisabledForThreadSnippet=e,l.recalculateSnippetFromScratch_EXPENSIVE=s,l.EMPTY_SNIPPET_DATA=u,l.getThreadSnippetFromScratch=c,l.shouldIgnoreXMAMsgForSnippet=d}),98);
__d("MAWDBMigrationUtils",["MAWDbAppMeta","MAWIndexedDb","MAWTransactionMode"],(function(t,n,r,o,a,i,l){"use strict";var e={batchSize:0,cursorValue:0,isRunning:!1},s={version:0},u=o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"getMigrationVersion",function(e){return function(){return e.appMeta.get(o("MAWDbAppMeta").AppMetaKeysEnum.dbMigrationVersion).then(function(e){var t,n=(t=e==null?void 0:e.value.dbMigrationVersion)!=null?t:0;return s.version=n,n})}}),c=6;l.mawDbDedupeMsgsMigrationStatus=e,l.mawDbMigrationVersion=s,l.getMigrationVersion=u,l.MAWDB_DEDUPE_MSGS_MIGRATION_VERSION=c}),98);
__d("MAWLoadReplyMediaTxns",["MAWBridgeReceiverFetchInfo","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;function f(e,t,n){if(r("gkx")("2419")&&n!=null){var a=o("MAWMediaUtils").genHMACPlaintextHash(n);return e.media.where("hashedPlaintextHash").equals(a).first()}else return e.media.get(t)}var g=new Set([(_=o("MAWDbMedia")).MEDIA_TYPE.IMAGE,_.MEDIA_TYPE.GIF,_.MEDIA_TYPE.PTT,_.MEDIA_TYPE.STICKER,_.MEDIA_TYPE.VIDEO,_.MEDIA_TYPE.DOCUMENT_FILE]);function h(e){var t;switch(e.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.STICKER:t=e.validatedImageInfo;break;case o("MAWDbMedia").MEDIA_TYPE.VIDEO:t=e.validatedVideoInfo;break}var n=t||{},r=n.height,a=n.jpegThumbnailHeight,i=n.jpegThumbnailWidth,l=n.width;return{replyMediaPreviewHeight:a!=null?a:r,replyMediaPreviewWidth:i!=null?i:l}}function y(e){switch(e.type){case o("MAWMsgType").MSG_TYPE.IMAGE:case o("MAWMsgType").MSG_TYPE.VIDEO:case o("MAWMsgType").MSG_TYPE.PTT:case o("MAWMsgType").MSG_TYPE.GIF:case o("MAWMsgType").MSG_TYPE.STICKER:case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case o("MAWMsgType").MSG_TYPE.XMA:return r("gkx")("9921")?!0:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(e.xmaMessageType)||o("MAWXMAUtils").isXMAStoryReply(e.xmaMessageType);case o("MAWMsgType").MSG_TYPE.TEXT:case o("MAWMsgType").MSG_TYPE.UNAVAILABLE:case o("MAWMsgType").MSG_TYPE.REVOKED:case o("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case o("MAWMsgType").MSG_TYPE.GROUP_INVITE:case o("MAWMsgType").MSG_TYPE.CIPHERTEXT:case o("WAMsgType").NOTE_REPLY:case o("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case o("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return r("WAAssertUnreachable")(e.type)}}function C(t,n,r){if(n==null)return o("MAWDexieTable").dexieResolve();var a=f(t,n,r).then(function(e){if(e==null)return o("WAResultOrError").makeError("reply_media_not_found");if(!g.has(e.mediaType))return o("WAResultOrError").makeError("reply_media_type_unknown");var t=h(e),r=t.replyMediaPreviewHeight,a=t.replyMediaPreviewWidth;return n!=null&&e.plaintextHash==null&&o("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_'unknown'}"),o("WAResultOrError").makeResult({replyMediaId:n,replyMediaPreviewHeight:r,replyMediaPreviewWidth:a,replyPlaintextHash:e.plaintextHash})});return a.then(function(t){if(t.success!==!0){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""])),n,t.error);return}return t.value})}function b(e,t){var n=t.defaultPreviewMediaId;if(n==null)return o("MAWDexieTable").dexieResolve({replyXMAId:t.xmaId});var r=f(e,n).then(function(e){if(e==null)return o("WAResultOrError").makeError("reply_xma_media_not_found - "+t.targetType);if(!g.has(e.mediaType))return o("WAResultOrError").makeError("reply_xma_media_type_unknown");var n=h(e),r=n.replyMediaPreviewHeight,a=n.replyMediaPreviewWidth;return o("WAResultOrError").makeResult({replyMediaPreviewHeight:r,replyMediaPreviewWidth:a,replyPlaintextHash:e.plaintextHash,replyXMAId:t.xmaId})});return r.then(function(e){if(e.success!==!0){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""])),t.xmaId,e.error);return}return e.value})}function v(e,t,n){var a,i,l;n===void 0&&(n=!1);var s=((a=t.quote)==null?void 0:a.content)||{},u=s.author,c=s.externalId,d=s.mediaId,m=s.msgId,p=s.plaintextHash,_=s.type,f=s.xmaMessageType;if(((i=t.quote)==null?void 0:i.content)==null||!y((l=t.quote)==null?void 0:l.content))return o("MAWDexieTable").dexieResolve();var g=t.threadJid,h=u===o("MAWUserJidWrapper").getMyUserJid(),b=h?o("WAJids").AUTHOR_ME:u;return(r("gkx")("9921")?_===o("MAWMsgType").MSG_TYPE.XMA:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))?S(e,o("MAWJidUtils").maybeToProtocolMsgId(b,g,c)):_===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?E(e,m):C(e,d,n?null:p)}function S(e,t){return t==null?o("MAWDexieTable").dexieResolve():o("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(e,t).then(function(t){if(!(t==null||o("MAWXMAUtils").isXMAExpired(t.isTombstoned,t.targetExpiringAtSec)))return b(e,t)})}function R(e,t){var n=t.author,a=t.externalId,i=t.mediaId,l=t.plaintextHash,s=t.threadJid,u=t.type,c=t.xmaMessageType,d=r("gkx")("9921")?u===o("MAWMsgType").MSG_TYPE.XMA:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(c),m=u===o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;return!o("MAWDbMsg").isMediaMsg(t)&&!d&&!m?o("MAWDexieTable").dexieResolve():d?S(e,o("MAWJidUtils").maybeToProtocolMsgId(n,s,a)):m?L(e,t.receiverFetchId):C(e,i,l)}function L(e,t,n){return t==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"]))),o("MAWDexieTable").dexieResolve()):e.receiverFetchInfo.get({receiverFetchId:t}).then(function(e){if(e==null){o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"])));return}try{var t=o("MAWDbMedia").convertNumberToMediaId(parseInt(e.receiverFetchId,10));return n!=null&&o("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:o("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(n.threadJid,n.msgId,n.sortOrderMs,n.ts,e)}),{replyMediaId:t,replyMediaPreviewHeight:e.previewHeight,replyMediaPreviewWidth:e.previewWidth}}catch(e){o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""])),e);return}})}function E(e,t){return t==null?(o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"]))),o("MAWDexieTable").dexieResolve()):e.messages.get({msgId:t}).then(function(t){if(t==null||t.type!==o("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||t.receiverFetchId==null){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""])),t==null?void 0:t.type);return}return L(e,t.receiverFetchId,t)})}l.getMedia=f,l.MSG_MEDIA_TYPE=g,l.getImageAttributes=h,l.isMediaReplyContent=y,l.getReplyMediaForMsgQuote=v,l.getReplyMediaForMsg=R}),98);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","MWFBLogger","WAErrorMessage","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("MWFBLogger").MWLogger().tags(["maw_db","txn","MAWDbChunkTxns"]),m=function(t,n,r,a,i,l){l===void 0&&(l=0);var e=o("MAWMediaUtils").genHMACPlaintextHash(n);return p(t,n,e,r,a,i,l)},p=function(n,r,a,i,l,m,_){return _===void 0&&(_=0),n.chunk.where("hashedPlaintextHash").equals(a).first().then(function(t){var f={blobData:i,hashedPlaintextHash:a,isProgressivePreview:m!=null?m:void 0,mimetype:l,plaintextHash:r};if(t){_>0&&d.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""])),a);var g=m!==!0&&t.isProgressivePreview===!0;if(g){var h=babelHelpers.extends({},f,{chunkId:t.chunkId});return n.chunk.put(h).then(function(){return h})}else return t}return n.chunk.add(f).then(function(e){return babelHelpers.extends({},f,{chunkId:e})}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);if(_>0)throw d.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""])),a,t),d.MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""])),t),e;return d.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""])),a,t),o("MAWODSProxy").odsBumpEntityKey({amount:1,entity:o("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"}),p(n,r,a,i,l,m,_+1)})})},_=function(t,n){return t.chunk.where("hashedPlaintextHash").equals(n)},f=function(t,n){return _(t,n).count().then(function(e){return e>0})},g=function(t,n){return o("MAWDexieTable").dexieAll(n.map(function(e){return f(t,e).then(function(t){return[e,t]})})).then(function(e){return new Map(e)})},h=function(t,n){return _(t,n).first()},y=function(t,n){return t.chunk.where("hashedPlaintextHash").anyOf(n).toArray().then(function(e){return new Map(e.map(function(e){return[e.hashedPlaintextHash,e]}))})},C=function(t,n){var e=n.map(o("MAWMediaUtils").genHMACPlaintextHash);return t.chunk.where("hashedPlaintextHash").anyOf(e).toArray().then(function(e){return new Map(e.map(function(e){return[e.plaintextHash,e]}))})};function b(e,t){return e.chunk.bulkGet(t)}var v=function(t,n){var e=o("MAWMediaUtils").genHMACPlaintextHash(n);return t.chunk.get({hashedPlaintextHash:e})};l.getOrCreateMediaChunkWithPlaintextHash=m,l.getOrCreateMediaChunkWithHashedPlaintextHash=p,l.hasMediaChunk=f,l.hasMediaChunks=g,l.maybeGetChunkFromHash=h,l.maybeBulkGetChunksFromHash=y,l.maybeBulkGetChunksFromPlaintextHash=C,l.bulkGetChunks=b,l.maybeGetChunkByPlaintextHash=v}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","MAWODSProxy","WAHashUtils","WALogger","WAOdsEnums","WAResultOrError","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c;function d(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.media.get({mediaId:t})}function m(e,t){return t.length===0?o("MAWDexieTable").dexieResolve(new Map):e.media.bulkGet(t).then(function(e){return new Map(e.filter(Boolean).map(function(e){return[e.mediaId,e]}))})}function p(e,t){return e.media.where("hashedPlaintextHash").equals(t).first()}function _(e,t){var n=o("MAWMediaUtils").genHMACPlaintextHash(t);return p(e,n)}function f(e,t){var n=t.map(function(e){return o("MAWMediaUtils").genHMACPlaintextHash(e)});return g(e,n)}function g(e,t){return e.media.where("hashedPlaintextHash").anyOf(t).toArray()}function h(e,t){return t==null?o("MAWDexieTable").dexieResolve():y(e,t).then(function(n){var r=n==null?void 0:n.mediaId;return r!=null?e.media.get({mediaId:r}):e.media.get({objectId:t})})}function y(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.mediaBackup.get({objectId:t})}function C(e,t){if(t==null)return o("MAWDexieTable").dexieResolve();var n=e.mediaBackup.where("msgId").equals(t).toArray();return n}function b(t,n){var a=n.filter(o("MAWDbMsg").isMediaMsg);if(a.length===0)return o("MAWDexieTable").dexieResolve([]);o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""])),a.map(function(e){return""+e.msgId}));var i=a.reduce(function(e,t){return t.mediaId==null?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""])),t.msgId,t.type),e):e.set(t.mediaId,t)},new Map),l=Array.from(i.keys());return R(t,l).then(function(e){var t=[];return e.forEach(function(e){if(e==null)throw r("err")("Error missing media");var n=i.get(e.mediaId);if(n==null)throw r("err")("Error missing media");var a=o("MAWMediaUtils").genHMACPlaintextHash(e.plaintextHash);a!==e.hashedPlaintextHash&&(o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] encountered mismatched hashedPlaintextHash for media. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(e.plaintextHash)),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MEDIA_MISMATCH_HASHED_PLAINTEXT_HASH,key:"mismatch."+n.type})),t.push([n,e])}),t})}function v(e,t){if(t.length===0)return o("MAWDexieTable").dexieResolve([]);var n=t.filter(o("MAWDbMsg").isMediaMsg).map(function(e){var t=e.mediaId;if(t==null)throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""])),e.msgId),r("err")("mediaId is missing");return t});return R(e,n).then(function(e){var t=[];return e.forEach(function(e){e!=null&&t.push(e)}),t})}function S(e,t){if(t.type===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||o("MAWDbMsg").isMediaMsg(t)){var n=t.mediaId;return n==null?t.type===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeResult()):o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeError("missing")):e.media.get(n).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}else return o("MAWDexieTable").dexieResolve(o("WAResultOrError").makeResult())}function R(e,t){return e.media.bulkGet(t)}function L(e,t){var n=t.previewMediaIds!=null?R(e,t.previewMediaIds):o("MAWDexieTable").dexieResolve(),r=t.headerMediaId!=null?e.media.get(t.headerMediaId):o("MAWDexieTable").dexieResolve(),a=t.faviconMediaId!=null?e.media.get(t.faviconMediaId):o("MAWDexieTable").dexieResolve(),i=t.defaultPreviewMediaId!=null?e.media.get(t.defaultPreviewMediaId):o("MAWDexieTable").dexieResolve();return o("MAWDexieTable").dexieAll([n,r,a,i]).then(function(e){var n=e[0],r=e[1],a=e[2],i=e[3];if(t.headerMediaId!=null&&r==null||t.faviconMediaId!=null&&a==null||n==null)return o("WAResultOrError").makeError("missing");var l=[];for(var s of n){if(s==null)return o("WAResultOrError").makeError("missing");l.push(s)}return o("WAResultOrError").makeResult({defaultPreview:i,favicon:a,header:r,previews:l})})}function E(e,t,n){var r=babelHelpers.extends({},t,n);return e.media.put(r)}l.maybeGetMediaFromMediaId=d,l.maybeBulkGetMediaFromMediaId=m,l.maybeGetMediaFromHashedPlaintextHash=p,l.maybeGetMediaFromPlaintextHash=_,l.maybeBulkGetMediaFromPlaintextHash=f,l.maybeBulkGetMediaFromHashedPlaintextHash=g,l.maybeGetMediaFromObjectId=h,l.maybeGetMediaBackupRowFromObjectId=y,l.maybeGetMediaBackupRowFromMsgId=C,l.getMsgMediaPairFromMsgs=b,l.getMediaFromMsgs=v,l.getAndCheckMediaFromMsg=S,l.bulkGetMedias=R,l.getMediaForXMA=L,l.updateMedia=E}),98);
__d("WAMsgMap",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e){var t=this;this.$1=new Map,e==null||e.forEach(function(e){var n=e[0],r=e[1];t.set(n,r)})}var t=e.prototype;return t.clear=function(){this.$1.clear()},t.delete=function(t){var e;(e=this.$1.get(t.externalId))==null||(e=e.get(t.author))==null||e.delete(t.chat)},t.get=function(t){var e;return(e=this.$1.get(t.externalId))==null||(e=e.get(t.author))==null?void 0:e.get(t.chat)},t.has=function(t){var e,n;return(e=(n=this.$1.get(t.externalId))==null||(n=n.get(t.author))==null?void 0:n.has(t.chat))!=null?e:!1},t.set=function(t,n){var e,r,o=(e=this.$1.get(t.externalId))!=null?e:new Map;this.$1.has(t.externalId)||this.$1.set(t.externalId,o);var a=(r=o.get(t.author))!=null?r:new Map;return o.has(t.author)||o.set(t.author,a),a.set(t.chat,n),this},t.keys=function(){var e=[],t=this.$1;for(var n of t.keys()){var r,o=(r=t.get(n))!=null?r:new Map;for(var a of o.keys()){var i,l=(i=o.get(a))!=null?i:new Map;for(var s of l.keys())e.push({externalId:n,author:a,chat:s})}}return e},t.entries=function(){var e=[],t=this.$1;for(var n of t.keys()){var r,o=(r=t.get(n))!=null?r:new Map;for(var a of o.keys()){var i,l=(i=o.get(a))!=null?i:new Map;for(var s of l.keys()){var u=l.get(s);u!=null&&e.push([{externalId:n,author:a,chat:s},u])}}}return e},t.values=function(){return this.entries().map(function(e){return e[1]})},e})();i.MsgMap=e}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return t.reduce(function(t,n){var r=n.threadJid;return r==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"]))),t):n.author==="@system"?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"]))),t):(t.set({author:n.author,chat:r,externalId:n.externalId},n),t)},new(o("WAMsgMap")).MsgMap)}function c(e){return o("WAJids").isAuthorSystem(e.author)||e.threadJid==null?null:{author:e.author,chat:e.threadJid,externalId:e.externalId}}l.convertMsgArrayToMap=u,l.getProtocolMsgIdFromDbMsg=c}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n=t.author,r=t.chat,a=t.externalId;return e.threads.get({jid:r}).then(function(t){return t==null?o("WAResultOrError").makeError("missing_thread_unrendered_msg"):m(e,a,r,n).then(function(e){return e==null?o("WAResultOrError").makeError("missing_unrendered_msg"):o("WAResultOrError").makeResult(e)})})}function d(e,t){var n=t.map(function(e){var t=e.externalId;return t});return e.unrenderedMessages.where("externalId").anyOf(n).toArray().then(function(e){var n=o("MAWDbMsgUtil").convertMsgArrayToMap(e),r=new(o("WAMsgMap")).MsgMap;return t.forEach(function(e){var t=n.get(e);t!=null&&r.set(e,t)}),r})}function m(e,t,n,r){return e.unrenderedMessages.where("externalId").equals(t).filter(function(e){return e.author===r&&e.threadJid===n}).first()}function p(e,t){return e+"_"+t}function _(e,t){var n=t.map(function(e){var t=e.externalId;return t}),r=Array.from(new Set(t.map(function(e){return e.chat})));return o("MAWDexieTable").dexieAll([e.threads.where("jid").anyOf(r).toArray(),e.unrenderedMessages.where("externalId").anyOf(n).toArray()]).then(function(e){var n=e[0],r=e[1];if(r.length===0||n.length===0)return[];var o=new Map;return t.forEach(function(e){var t=e.author,n=e.chat,r=e.externalId,a=o.get(r)||new Set;a.add(p(t,n)),o.set(r,a)}),r.filter(function(e){var t=e.author,n=e.externalId,r=e.threadJid,a=o.get(n);return a!=null&&r!=null&&a.has(p(t,r))})})}function f(t,n,r){return g(t,[{ack:r,msgId:n}]).then(function(t){var n=t[0];return n==null?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"]))),null):n})}function g(e,t){var n=t.map(function(e){return e.msgId}),r=new Map;return t.forEach(function(e){return r.set(e.msgId,{ack:e.ack})}),e.unrenderedMessages.where("msgId").anyOf(n).toArray().then(function(t){if(t.length===0)return t;var n=[],a=[];return t.forEach(function(e){var t;if(e.author!==o("WAJids").AUTHOR_ME){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]))),n.push(e);return}if(e.ack>o("MAWAckLevel").ACK.clock){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]))),n.push(e);return}var i=(t=r.get(e.msgId))==null?void 0:t.ack;if(i==null)return null;var l=babelHelpers.extends({},e,{ack:i});i===o("MAWAckLevel").ACK.sent&&delete l.resendCount,a.push(l)}),e.unrenderedMessages.bulkPut(a).then(function(){return[].concat(a,n)})})}function h(e,t){var n=t.map(function(t){return e.unrenderedMessages.get({msgId:t})});return o("MAWDexieTable").dexieAll(n)}function y(e,t){return e.unrenderedMessages.where("msgId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.msgId);return t+1})}l.maybeGetUnrenderedMsgByProtocolMsgId=c,l.getUnrenderedMsgMapByProtocolMsgId=d,l.maybeGetUnrenderedMsgByExternalId=m,l.getUnrenderedMsgsByProtocolMsgId=_,l.updateSystemAckForUnrenderedMsg=f,l.bulkUpdateSystemAckForUnrenderedMsgs=g,l.getUnrenderedMsgsByMsgIds=h,l.getNextUnrenderedMsgIdNumberForThread=y}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(t){var n=t.revokedExternalId!=null?t.revokedExternalId:t.externalId;n==null&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"])));var r=(d||(d=o("I64"))).of_string_opt(n);if(t.serverTs==null){var a;if(t.sortOrderMs!=null)return t.sortOrderMs;r==null&&o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"])));var i=r==null?null:o("MAWExtractMsFromExternalId").extractMsFromExternalId(r);return Math.floor((a=t.originalTs)!=null?a:o("MAWDbMsg").getCanonicalTsFromMsg(t))*1e3+(i!=null?i:0)}if(r!=null){var l=o("MAWExtractMsFromExternalId").extractMsFromExternalId(r);if(l!=null){var m=t.originalTs!=null?t.originalTs:t.serverTs;return Number(m)*1e3+l}else o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"])))}else o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"])));return o("MAWDbMsg").getSortOrderWithFallback(t)}l.generateAuthoritativeMessageSortOrder=m}),98);
__d("WAArrayGroupBy",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=new Map,r=0;r<e.length;r++){var o=t(e[r]),a=n.get(o);a==null?n.set(o,[e[r]]):a.push(e[r])}return Array.from(n.entries())}i.groupBy=e}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMsgType","MAWODSProxy","MAWTransactionMode","MAWTransactor","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","gkx","justknobx","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g;function h(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.messages.get({msgId:t})}function y(e,t){return e.messages.where("threadJid").equals(t).count().then(function(e){return e===0})}function C(e,t,n){return e.messages.where("threadJid").equals(t).filter(n).first().then(function(e){return e!=null})}function b(e,t,n,r){return e.messages.where(["threadJid","sortOrderMs"]).between([t,Number.MIN_SAFE_INTEGER],[t,Number.MAX_SAFE_INTEGER],n,r)}function v(e,t){return b(e,t,!1,!1).last()}function S(e,t){return v(e,t).then(function(e){return e==null?void 0:e.msgId})}function R(e,t){return v(e,t).then(function(e){return(e==null?void 0:e.sortOrderMs)==null?null:o("WATimeUtils").castToMillisTime(e.sortOrderMs)})}function L(e,t,n){return r("vulture")("ST6o7qk-BKGl46ZXS71LYr_2y6I="),b(e,t,!1,!1).reverse().limit(n).toArray()}function E(e,t){return b(e,t,!1,!1).first()}function k(e,t){return E(e,t).then(function(e){return e==null?void 0:e.msgId})}function I(e,t){return e.messages.where("externalId").equals(t.externalId).filter(function(e){return e.author===t.author&&e.threadJid===t.chat}).toArray().then(D)}function T(e,t){var n=new Set(t.map(function(e){var t=e.author,n=e.chat,r=e.externalId;return o("WAMsg").craftWAMsgIdString({author:t,chat:n,externalId:r})}));return e.messages.where("externalId").anyOf(t.map(function(e){var t=e.externalId;return t})).filter(function(e){var t=e.author,r=e.externalId,a=e.threadJid;return n.has(o("WAMsg").craftWAMsgIdString({author:t,chat:a,externalId:r}))}).toArray().then(function(e){return o("WAArrayGroupBy").groupBy(e,function(e){return o("WAMsg").craftWAMsgIdString({author:e.author,chat:e.threadJid,externalId:e.externalId})}).map(function(e){var t=e[0],n=e[1];return D(n)}).filter(Boolean)})}function D(t){if(t.length>1){var n=t.map(function(e){var t,n;return e.type+":"+((t=e.serverTs)!=null?t:0).toString()+":"+((n=e.ts)!=null?n:0).toString()}),a=new Set(n).size===1;a?o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"]))):o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"])),t.length),(r("gkx")("5039")||o("Random").coinflip(r("justknobx")._("3594")))&&x(t)}return t[0]}function x(e){var t=e.length;if(!(t<=1)){var n=t-1,a=e[n],i={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};e.slice(0,n).forEach(function(e){var t=[];if((e==null?void 0:e.editCount)!==(a==null?void 0:a.editCount)){var n,l;i.editCount++,t.push("editCount, reference: "+((n=a==null?void 0:a.editCount)!=null?n:"")+", duplicate: "+((l=e==null?void 0:e.editCount)!=null?l:"")+". ")}if((e==null?void 0:e.mediaId)!==(a==null?void 0:a.mediaId)&&(i.mediaId++,t.push("mediaId, reference: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+", duplicate: "+((e==null?void 0:e.mediaId)!=null?String(e.mediaId):"")+". ")),e.sortOrderMs!==a.sortOrderMs&&(i.sortOrderMs++,t.push("sortOrderMs, reference: "+String(a.sortOrderMs)+", duplicate: "+String(e.sortOrderMs)+". ")),e.serverTs!==a.serverTs&&(i.serverTs++,t.push("serverTs, reference: "+String(a.serverTs)+", duplicate: "+String(e.serverTs)+". ")),e.ts!==a.ts&&(i.ts++,t.push("ts, reference: "+String(a.ts)+", duplicate: "+String(e.ts)+". ")),e.type!==a.type){var s,u;(e.type===o("MAWMsgType").MSG_TYPE.REVOKED||a.type===o("MAWMsgType").MSG_TYPE.REVOKED)&&(i.revokedStatus++,r("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",e.msgId,e.type,e.externalId,e.revokedExternalId,e.sortOrderMs,e.serverTs,e.ts,e.rowId,a.msgId,a.type,a.externalId,a.revokedExternalId,e.sortOrderMs,e.serverTs,e.ts,e.rowId)),i.type++,t.push("type, reference: "+((s=a.type)!=null?s:"")+", duplicate: "+((u=e.type)!=null?u:"")+". ")}var c=t.join("");c.length>0?r("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",e.msgId,a.msgId,c):r("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",e.msgId,a.msgId)}),o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"}),Object.keys(i).forEach(function(e){var t=i[e];t>0&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+e+"_field_differences"})}),o("MAWODSProxy").odsBumpEntityKey({amount:t-1,entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"}),Object.keys(i).forEach(function(e){var t=i[e];t>0&&o("MAWODSProxy").odsBumpEntityKey({amount:t,entity:o("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+e+"_field_differences"})})}}function $(e,t,n,r){var o={author:r,chat:n,externalId:t};return I(e,o)}function P(e,t){return e.messages.where("msgId").equals(t).toArray()}function N(e,t){return A(e,t).then(function(e){return e.success,e})}function M(e,t){var n=t.map(function(e){var t=e.externalId;return t});return e.messages.where("externalId").anyOf(n).toArray().then(function(e){var n=o("MAWDbMsgUtil").convertMsgArrayToMap(e),r=new(o("WAMsgMap")).MsgMap;return t.forEach(function(e){var t=n.get(e);t!=null&&r.set(e,t)}),r})}function w(e,t){return e.messages.where("msgId").equals(t).first().then(function(e){return e==null?void 0:e.sortOrderMs})}function A(e,t){var n=t.author,r=t.chat,a=t.externalId;return e.threads.get({jid:r}).then(function(t){return t==null?o("WAResultOrError").makeError("missing_thread_msg"):$(e,a,t.jid,n).then(function(e){return e==null?o("WAResultOrError").makeError("missing_msg"):o("WAResultOrError").makeResult(e)})})}function F(e,t){var n=t.author,r=t.chat,o=t.externalId;return e.threads.get({jid:r}).then(function(t){if(t!=null)return e.messages.where("revokedExternalId").equals(o).filter(function(e){return e.author===n&&e.threadJid===t.jid&&e.type==="Revoked"}).first()})}function O(e,t,n,r){var a=e.messages.where("revokedExternalId").equals(t).filter(function(e){return e.author===r&&e.threadJid===n&&e.type===o("MAWMsgType").MSG_TYPE.REVOKED}).first(),i=o("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(e,t,n,r).then(function(e){if((e==null?void 0:e.type)===o("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return e});return o("MAWDexieTable").dexieAll([a,i]).then(function(e){var t=e[0],n=e[1];return t!=null||n!=null})}function B(e,t){var n=new Array(t.length),r=new Set;return t.forEach(function(e){n.push(e.externalId),r.add(o("EncryptedBackupsUtils").convertWAMsgIdToStringId(e))}),e.messages.where("externalId").anyOf(n).filter(function(e){return r.has(o("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:e.author,chat:e.threadJid,externalId:e.externalId}))}).toArray()}function W(e,t,n,r,a,i){return q(e,[{ack:n,applicationErrorCode:i,msgId:t,reportingMeta:a,serverTs:r}]).then(function(e){var n=e.find(function(e){return e.msgId===t});return n==null?(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"]))),null):n})}function q(e,t){var n=t.map(function(e){return e.msgId});return o("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(e,n).then(function(r){var a=new Map;t.forEach(function(e){a.set(e.msgId,{ack:e.ack,applicationErrorCode:e.applicationErrorCode,reportingMeta:e.reportingMeta,serverTs:e.serverTs});var t=r.get(e.msgId);t!=null&&a.set(t,{ack:e.ack,applicationErrorCode:e.applicationErrorCode,reportingMeta:e.reportingMeta,serverTs:e.serverTs})});var i=Array.from(new Set(n.concat(Array.from(r.values()))));return e.messages.where("msgId").anyOf(i).toArray().then(function(t){if(t.length===0)return t;var n=[],r=[];return t.forEach(function(e){var t,i,l;if(e.author!==o("WAJids").AUTHOR_ME||e.ack>o("MAWAckLevel").ACK.clock){n.push(e);return}var s=(t=a.get(e.msgId))==null?void 0:t.ack,u=(i=a.get(e.msgId))==null?void 0:i.serverTs;if(s==null)return null;var c=babelHelpers.extends({},e,{ack:s});U(c,u);var d=(l=a.get(e.msgId))==null?void 0:l.reportingMeta;d!=null&&(c.reportingMeta=d),s===o("MAWAckLevel").ACK.sent&&delete c.resendCount,r.push(c)}),n.length>0&&o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""])),n.map(function(e){return e.msgId}).toString()),e.messages.bulkPut(r).then(function(){return o("MAWDexieTable").dexieAll(r.map(function(t){return o("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,t)}))}).then(function(e){return r.forEach(function(t,n){o("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:o("MAWBridgeMsg").createBridgeMsg(t,e[n])})}),[].concat(r,n)})})})}function U(e,t){if(t!=null){e.serverTs=t;var n=e.sortOrderMs;e.type!==o("MAWMsgType").MSG_TYPE.REVOKED&&(e.sortOrderMs=o("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(e),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""])),t,n,e.sortOrderMs))}}function V(e,t,n,a){return o("MAWDbThreadTxns").getThread(e,t).then(function(t){if(!(!t.success||a==null)){var i=t.value,l=[e.messages.where(["threadJid","sortOrderMs"]).above([i.jid,a]).first(),e.messages.where(["threadJid","sortOrderMs"]).below([i.jid,a]).last()];return o("MAWDexieTable").dexieAll(l).then(function(t){var a=t[0],l=t[1];return o("MAWDbThreadTxns").updateThread(e,babelHelpers.extends({},i,{newestMsgTs:(l==null?void 0:l.ts)==null?i.newestMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(l.ts),oldestMsg:i.oldestMsg===n?a==null?void 0:a.msgId:i.oldestMsg})).then(r("emptyFunction"))})}})}function H(e){return e.messages.where("altIndex").equals(o("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(e){var t=[];return e.forEach(function(e){if(e.type!==o("MAWMsgType").MSG_TYPE.FUTUREPROOF){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""])),e.msgId,e.type);return}t.push(e)}),t})}function G(e){return e.toString()}function z(e,t,n,a){var i=t.mediaId;if(i===n)return o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),t.msgId,n),o("MAWDexieTable").dexieResolve();var l=i!=null?e.media.get(i):o("MAWDexieTable").dexieResolve();return l.then(function(i){i&&o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""])),t.type);var l=a!=null?a:void 0,s=babelHelpers.extends({},t,{mediaId:n,plaintextHash:l});return e.messages.put(s).then(r("emptyFunction"))})}function j(e,t){var n=Array.from(t.keys());return e.messages.where("msgId").anyOf(n).toArray().then(function(n){var a=[];return n.map(function(e){var n=t.get(e.msgId),i=e.mediaId;if(i!=null&&i!==n){if(n!=null)throw r("FBLogger")("messenger_web").mustfixThrow("mediaId "+G(i)+" in message "+e.msgId+" is different with the "+G(n)+" in bulkUpdateMediaId");o("WALogger").LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""])),e.msgId,n);return}var l=babelHelpers.extends({},e,{mediaId:n,plaintextHash:e.plaintextHash});a.push(l)}),e.messages.bulkPut(a).then(r("emptyFunction"))})}function K(e,t){return Q(e,[t]).then(r("emptyFunction"))}function Q(e,t){return e.messages.where("msgId").anyOf(t).toArray().then(function(t){var n=t.map(function(e){return babelHelpers.extends({},e,{isExpiredXmaMsg:!0})});return e.messages.bulkPut(n).then(function(){return n})})}function X(e,t,n,r){if(r!=null&&r<=0)return o("MAWDexieTable").dexieResolve([]);var a=e.messages.where("altIndex").equals(o("MAWDbMsg").craftToBeReadAltIndex(t)).filter(function(e){return o("MAWDbMsg").getSortOrderWithFallback(e)<=n});return r!=null&&(a=a.limit(r)),a.toArray()}function Y(e,t,n){return X(e,t,n).then(function(t){var n=t.map(function(e){return babelHelpers.extends({altIndex:null},e)});return e.messages.bulkPut(n).then(function(){return n})})}function J(e,t){return e.messages.delete(t)}function Z(e,t){return e.messages.bulkDelete(t)}function ee(e,t,n){var r=t.map(function(e){return e.rowId}),a=n!=null?t.map(function(e){var t=o("MAWJidUtils").toProtocolMsgId(e);if(t)return babelHelpers.extends({},t,{reason:n})}).filter(Boolean):[];return o("MAWDexieTable").dexieAll([e.deletedMessages.bulkAdd(a),e.messages.bulkDelete(r)]).then(function(e){var t=e[0],n=e[1];o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"])),n)})}function te(e,t){return e.messages.where("msgId").anyOf(t).toArray()}function ne(e){return e.messages.where("altIndex").anyOf([o("MAWDbMsg").SPAM_ALT_INDEX,o("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function re(e,t,n,r,a,i,l,s){l===void 0&&(l="before"),s===void 0&&(s=null);var u=n==null?null:o("MAWDbMsg").getSortOrderWithFallback(n);return l==="before"?e.messages.where(["threadJid","sortOrderMs"]).between([t,s!=null?s:Number.MIN_SAFE_INTEGER],[t,u!=null?u:Number.MAX_SAFE_INTEGER],!0,r).reverse().filter(i).limit(a).toArray():e.messages.where(["threadJid","sortOrderMs"]).between([t,u!=null?u:Number.MIN_SAFE_INTEGER],[t,s!=null?s:Number.MAX_SAFE_INTEGER],r,!0).filter(i).limit(a).toArray().then(function(e){return e.sort(function(e,t){return t.ts-e.ts})})}function oe(e,t,n,r){var o=n.msgId;if(r==null){var a;return{oldestMsg:(a=e==null?void 0:e.msgId)!=null?a:o}}var i=[e,t,n].filter(Boolean);return{oldestMsg:i.reduce(function(e,t){return ae(e,o,r)<ae(t,o,r)?e:t}).msgId}}function ae(e,t,n){return e.msgId===t?n:o("MAWDbMsg").getSortOrderWithFallback(e)}function ie(e,t){return e.messages.where("msgId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.msgId);return t+1})}function le(e){return o("MAWTransactor").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"checkMessagesExistenceByProtocolMsgIds",function(t){return function(){return o("MAWDexieTable").dexieAll(e.map(function(e){return t.messages.get({protocolMsgId:e.chat+"."+e.externalId})}))}})()}function se(e,t){return e.messages.where("externalId").anyOf(t).toArray()}l.maybeGetMsg=h,l.getIsThreadEmpty=y,l.doesThreadHaveMsgsMatchCriteria=C,l.getThreadMessagesBySortOrder=b,l.getThreadNewestMessageBySortOrder=v,l.getThreadNewestMessageId=S,l.getThreadNewestMessageMs=R,l.getThreadNewestNumMessagesBySortOrder=L,l.getThreadOldestMessageBySortOrder=E,l.getThreadOldestMessageId=k,l.maybeGetMsgByProtocolMsgId=I,l.getUniqueMsgsByProtocolMsgIds=T,l.maybeGetMsgByExternalId=$,l.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=P,l.maybeGetMsgResultByProtocolMsgId=N,l.getMsgMapByProtocolMsgId=M,l.getSortOrderFromMsgId=w,l.maybeGetRevokedMsgByProtocolMsgId=F,l.checkIfMsgIsDeletedForMeOrRevoked=O,l.getMsgsByProtocolMsgId=B,l.updateSystemAck=W,l.bulkUpdateSystemAck=q,l.maybeUpdateThreadMsgsForDeleteForMe=V,l.getFutureProofMsgs=H,l.updateMediaId=z,l.bulkUpdateMediaId=j,l.updateDbMsgXMAExpiration=K,l.bulkUpdateDbMsgXMAExpired=Q,l.getMsgsNeedingRetroactiveReadReceiptsUpTo=X,l.clearRetroactiveReadReceiptStatusFromMsgsUpTo=Y,l.deleteDbMsg=J,l.bulkDeleteDbMsg=Z,l.deleteMessages=ee,l.getMsgsByMsgIds=te,l.getSpamMsgs=ne,l.fetchMessagesFromDbWithSortOrderMs=re,l.calculateOldestMsg=oe,l.getNextMsgIdNumberForThread=ie,l.checkMessagesExistenceByProtocolMsgIds=le,l.UNSAFE_getMultipleMsgsByExternalId=se}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","MAWTransactionMode","MAWTransactor","MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return e.appMeta.get({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(e){return e==null?void 0:e.value.msgTypeVersion})}function u(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:t}})}function c(e,t){return e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:t}})}function d(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:t}})}function m(e){return e.appMeta.get({key:o("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(e){return e==null?void 0:e.value.hmacKey})}function p(e,t){return e.appMeta.get({key:t})}function _(e,t){return o("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor").setCachedShouldSaveSecurityAlert(t),e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:t}}).then(r("emptyFunction"))}function f(e,t){return e.appMeta.put({key:o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:t}}).then(r("emptyFunction"))}function g(){return o("MAWTransactor").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY},"handleInstructions",function(e){return function(){return h(e)}})()}function h(e){return p(e,o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(e){var t;return(t=e==null?void 0:e.value.allowSecurityAlert)!=null?t:!1})}function y(e){return p(e,o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(e){var t;return(t=e==null?void 0:e.value.allowSecurityAlertForSelf)!=null?t:!0})}function C(e,t){return e.appMeta.add({key:o("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:t}})}function b(e){return o("MAWDexieTable").dexieAll([y(e),h(e)]).then(function(e){var t=e[0],n=e[1];return{allowSecurityAlertForContact:n,allowSecurityAlertForSelf:t}})}l.MSG_TYPE_VERSION=(e=o("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion,l.ALLOW_SECURITY_ALERT_FOR_CONTACT=e.AppMetaKeysEnum.allowSecurityAlert,l.ALLOW_SECURITY_ALERT_FOR_SELF=e.AppMetaKeysEnum.allowSecurityAlertForSelf,l.HOT_LIKE=e.AppMetaKeysEnum.hotlikeSticker,l.getMsgTypeVersion=s,l.addMsgTypeVersion=u,l.updateMsgTypeVersion=c,l.addHMACKey=d,l.getHMACKey=m,l.getAppMetaValue=p,l.updateSecurityAlertValueForContact=_,l.updateSecurityAlertValueForSelf=f,l.getSecuritySettingForContactTxn=g,l.getSecuritySettingForContact=h,l.getSecuritySettingForSelf=y,l.addHotLike=C,l.maybeBulkGetSecuritySetting=b}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDexieTable","MAWIndexedDb","WALogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=function(t){return t};function d(e,t){return e.reactions.put(c(t))}function m(t,n){return t.reactions.delete(n.rowId).then(function(){var t=n.author,r=n.reactionId,a=n.reactToMsgId,i=n.threadJid;a!=null&&(o("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:i,reactToMsgId:a})}),o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."])),r))})}function p(e,t){var n=o("MAWAuthor").getAuthorUserJid(t.author);return e.reactions.where("reactToExternalId").equals(t.externalId).filter(function(e){return(e.reactToAuthor===n||e.reactToAuthor===t.author)&&e.threadJid===t.chat}).toArray()}function _(e,t){var n=t.reduce(function(e,t){return e.set(t.msgId,t),e},new Map);return e.reactions.where("reactToMsgId").anyOf(t.map(function(e){return e.msgId})).toArray().then(function(e){var t=e.filter(function(e){var t,r=e.reactToExternalId,o=e.reactToMsgId;return o!=null&&r===((t=n.get(o))==null?void 0:t.externalId)});return t.length<e.length&&r("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId"),t})}function f(e,t){return e.reactions.where("reactToMsgId").equals(t.msgId).toArray().then(function(e){var n=e.filter(function(e){var n=e.reactToExternalId;return n===t.externalId});return n.length<e.length&&r("FBLogger")("messenger_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId"),n})}function g(e,t){return _(e,[t])}function h(e,t){var n=t.author,r=t.chat,o=t.externalId;return e.reactions.where("externalId").equals(o).filter(function(e){return e.author===n&&e.threadJid===r}).first()}function y(e,t){return o("MAWDexieTable").dexieAll(t.map(function(t){var n=t.author,r=t.externalId,a=o("MAWAuthor").getAuthorUserJid(n);return e.reactions.where("reactToExternalId").equals(r).filter(function(e){return o("MAWAuthor").getAuthorUserJid(e.reactToAuthor)===a}).toArray()})).then(function(t){var n=t.flat();if(n.forEach(function(e){var t=e.author,n=e.reactToMsgId,r=e.threadJid;n!=null&&o("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:o("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:t,chatJid:r,reactToMsgId:n})})}),n.length!==0)return o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."])),n.length),e.reactions.bulkDelete(n.map(function(e){return e.rowId}))})}function C(e,t){return e.reactions.where("reactToMsgId").anyOf(t.map(function(e){return e.msgId})).delete().then(function(e){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"])),e)})}function b(e,t){return e.reactions.where("reactionId").between(o("MAWDbMsg").msgIdsInChatLowerBound(t.chatId),o("MAWDbMsg").msgIdsInChatUpperBound(t.chatId)).last().then(function(e){var t=e==null?0:o("MAWDbMsg").getInChatMsgIdFromMsgId(e.reactionId);return t+1})}function v(e,t,n,r,a,i,l){var s,u,c=(s=r==null?void 0:r.ts)!=null?s:o("WATimeUtils").unixTime();return e.reactions.where(["threadJid","ts"]).between([t,(u=o("WATimeUtils").castMillisTimeToUnixTime(n))!=null?u:o("WATimeUtils").castToUnixTime(0)],[t,c],!0,a).reverse().filter(l).limit(i).toArray()}l.coerceToReaction=c,l.putReaction=d,l.deleteReaction=m,l.getReactionForEcho=p,l.getReactionsFromMessages=_,l.getReactionsForMessage=f,l.getReactionsFromMessage=g,l.maybeGetReactionByProtocolMsgId=h,l.deleteReactionsByUniqueMsgIdentifiers=y,l.deleteAllReactionsForMessages=C,l.getNextReactionIdNumberForThread=b,l.fetchReactionsFromDbWithTimestamp=v}),98);
__d("MaybeCreateOrUpdateThreadResultCache",[],(function(t,n,r,o,a,i){"use strict";var e=new Map;function l(t){e.delete(t)}i.cache__I_KNOW_WHAT_I_AM_DOING=e,i.deleteCachedThreadResult=l}),66);
__d("MAWDbThreadTxns",["MAWAuthoritativeThreadsCache","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MaybeCreateOrUpdateThreadResultCache","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return e.threads.get({deduplicationKey:t}).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function d(e,t){return e.threads.get({jid:t}).then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function m(e,t){return e.threads.where("jid").anyOf(t).toArray()}function p(e,t){return e.threads.where("jid").startsWith(t+"@").first().then(function(e){return e==null?o("WAResultOrError").makeError("missing"):o("WAResultOrError").makeResult(e)})}function _(e){o("MaybeCreateOrUpdateThreadResultCache").deleteCachedThreadResult(e),o("MAWAuthoritativeThreadsCache").AuthoritativeThreadsCache.delete(e)}function f(e,t){return e.threads.where("jid").equals(t).delete().then(function(){return _(t)})}function g(e,t){return e.participants.where("userJid").equals(t).toArray().then(function(t){var n=t.map(function(e){return e.threadJid});return m(e,n)})}function h(e,t){return e.participants.where("userJid").anyOf(t).toArray().then(function(t){var n=new Map,r=new Set;return t.forEach(function(e){var t,o=e.userJid,a=(t=n.get(o))!=null?t:[];a.push(e.threadJid),n.set(o,a),r.add(e.threadJid)}),m(e,Array.from(r)).then(function(e){var t=e.reduce(function(e,t){return e.set(t.jid,t),e},new Map);return new Map(Array.from(n.entries()).map(function(e){var n=e[0],r=e[1];return[n,r.map(function(e){return t.get(e)}).filter(Boolean)]}))})})}function y(e,t,n){return(t==null?void 0:t.lastReadMsgReceiptSent)==null?o("MAWDexieTable").dexieResolve(!1):o("MAWDbMsgTxns").getSortOrderFromMsgId(e,t.lastReadMsgReceiptSent).then(function(e){return n.sortOrderMs==null||e==null?!1:n.sortOrderMs<=e})}function C(e,t){return e.threads.get({jid:t.threadJid}).then(function(n){return y(e,n,t)})}function b(e,t){return e.threads.where("jid").anyOf(t.map(function(e){return e.threadJid})).toArray().then(function(n){return o("MAWDexieTable").dexieAll(o("WAArrayZip").zip(t,n).map(function(t){var n=t[0],r=t[1];return y(e,r,n)}))})}function v(e,t,n){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var r=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{archived:!0,cannotReplyReason:n?"viewer_not_subscribed":e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return e.threads.bulkPut(r).then(function(){r.forEach(function(e){n&&o("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+e.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:e.jid})})})})})}function S(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{cannotReplyReason:null})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){var t={cannotReplyReason:null,threadJid:e.jid};o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread(t)})})})})}function R(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{archived:!1,cannotReplyReason:e.cannotReplyReason==="viewer_not_subscribed"?e.cannotReplyReason:null,folder:o("MAWFolderTypes").FOLDER_ID.INBOX})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:e.cannotReplyReason,folder:o("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:e.jid})})})})})}function L(e,t){return e.threads.where("jid").anyOf(t).toArray().then(function(t){var n=t.filter(Boolean).map(function(e){return babelHelpers.extends({},e,{cannotReplyReason:"viewer_not_subscribed"})});return e.threads.bulkPut(n).then(function(){n.forEach(function(e){var t={cannotReplyReason:"viewer_not_subscribed",threadJid:e.jid};o("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+e.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),o("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:o("MAWBridgeTypesCreators").createBridgeUpdatedThread(t)})})})})}function E(t,n){return d(t,n).then(function(n){if(!n.success){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"])));return}var a=n.value;if(a.isMigratedLocally===!0){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"])));return}var i=babelHelpers.extends({},a,{isMigratedLocally:!0});return t.threads.put(i).then(r("emptyFunction"))})}function k(e,t){if(t.isMigratedLocally===!1)return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"]))),o("MAWDexieTable").dexieResolve(t);var n=babelHelpers.extends({},t,{isMigratedLocally:!1});return e.threads.put(n).then(function(){return n})}function I(e,t){return e.threads.put(t).then(r("emptyFunction"))}function T(e,t,n,r,a){return I(e,babelHelpers.extends({},t,{newestMsgTs:(a==null?void 0:a.ts)==null?t.newestMsgTs:o("WATimeUtils").castUnixTimeToMillisTime(a.ts),oldestMsg:r==null?void 0:r.msgId}))}l.getThreadByDeduplicationKey=c,l.getThread=d,l.getThreads=m,l.getThreadPrimaryId=p,l.deleteThread=f,l.getAllThreadsForUser=g,l.getAllThreadsForUsers=h,l.needsRetroactiveReadReceiptInThread=C,l.bulkNeedsRetroactiveReadReceiptInThread=b,l.archiveThreads=v,l.subscribeToThreads=S,l.unarchiveThreads=R,l.unsubscribeFromThreads=L,l.markCutoverThreadAsMigratedLocally=E,l.markCutoverThreadAsNotMigratedLocally=k,l.updateThread=I,l.updateThreadMsgsForUndefinedOldestOrNewestMsgs=T}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return e.xma.bulkGet(t)}function s(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.get({xmaId:t})}function u(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.where("associatedMessageId").equals(t).first()}function c(e,t){return t==null?o("MAWDexieTable").dexieResolve():e.xma.where("externalId").equals(t.externalId).filter(function(e){return e.author===t.author&&e.threadJid===t.chat}).first()}function d(e,t){return c(e,t).then(function(t){return t==null?o("WAResultOrError").makeError("missing"):o("MAWDexieTable").dexieAll([o("MAWDbMediaTxns").getMediaForXMA(e,t),o("MAWDbMsgTxns").maybeGetMsg(e,t.associatedMessageId)]).then(function(e){var n=e[0],r=e[1];if(!n.success)return o("WAResultOrError").makeError("missing");var a=n.value,i=a.defaultPreview,l=a.favicon,s=a.header,u=a.previews;return o("WAResultOrError").makeResult({associatedMessage:r,defaultPreview:i,favicon:l,header:s,previews:u,xma:t})})})}function m(e,t){return u(e,t).then(function(t){if(t!=null)return o("MAWDbMsgTxns").maybeGetMsg(e,t.msgId)})}function p(e,t){if(t.length===0)return o("MAWDexieTable").dexieResolve([]);var n=t.filter(o("MAWDbMsg").isXMAMsg).map(function(e){return o("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.externalId)}).filter(Boolean),r=n.map(function(t){return c(e,t)});return o("MAWDexieTable").dexieAll(r).then(function(e){return e.filter(Boolean)})}function _(e,t){return e.xma.where("associatedMessageId").anyOf(t).toArray().then(function(e){var t=e.filter(function(e){return e.msgId!=null&&r("gkx")("9841")?e.targetType!=null:o("MAWXMAUtils").isXMAShare_DO_NOT_USE(e.targetType)});return t.reduce(function(e,t){return t.associatedMessageId!=null&&t.msgId!=null?e.set(t.associatedMessageId,t.msgId):e},new Map)})}function f(e,t){return e.xma.where("associatedMessageId").equals(t).first()}function g(e,t){return e.xma.where("associatedMessageId").equals(t).first().then(function(t){if(t!=null){var n=o("MAWJidUtils").maybeToProtocolMsgId(t.author,t.threadJid,t.externalId);if(n!=null)return o("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(e,n)}})}function h(e,t){return f(e,t).then(function(t){return t==null?o("WAResultOrError").makeResult():o("MAWDexieTable").dexieAll([o("MAWDbMediaTxns").getMediaForXMA(e,t),o("MAWDbMsgTxns").maybeGetMsg(e,t.associatedMessageId)]).then(function(e){var n=e[0],r=e[1];if(!n.success)return o("WAResultOrError").makeError("missing");var a=n.value,i=a.defaultPreview,l=a.favicon,s=a.header,u=a.previews;return o("WAResultOrError").makeResult({associatedMessage:r,defaultPreview:i,favicon:l,header:s,previews:u,xma:t})})})}function y(e,t,n){return o("MAWDbThreadTxns").getThread(e,n).then(function(n){if(n.success){var r=n.value;if(t==null)return o("MAWDexieTable").dexieResolve();var a={author:t.author,chat:r.jid,externalId:t.externalId};return o("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(e,a)}})}function C(e,t){return c(e,t).then(function(t){if(t==null)return o("MAWDexieTable").dexieResolve();if(!o("MAWXMAUtils").isXMAStoryReply(t.targetType))return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t.defaultPreviewMediaId).then(function(n){return n==null?{hasMedia:!1,xma:t}:o("MAWDexieTable").dexieAll([n,o("MAWDbChunkTxns").hasMediaChunk(e,n.hashedPlaintextHash)]).then(function(e){var n=e[0],r=e[1];return{hasMedia:r,previewMedia:n,xma:t}})})})}function b(e,t){return e.xma.where("externalId").anyOf(t).toArray()}l.bulkGetXMAs=e,l.maybeGetXMAFromXMAId=s,l.maybeGetXMAFromAssociatedMsgId=u,l.maybeGetXMAFromProtocolMsgId=c,l.maybeGetXMAPayloadFromProtocolMsgId=d,l.getDbXMAMsgFromAssociatedMsgId=m,l.getXMAFromMsgs=p,l.getXMAMsgIdsFromAssociatedMsgIds=_,l.maybeGetDbXMAMsgByAssociatedMsgId=g,l.maybeGetXMAPayloadFromAssociatedMsgId=h,l.maybeGetAssociatedXMAMsg=y,l.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=C,l.getMultipleXMAByExternalId=b}),98);
__d("MAWDbMutationMiddleware",["FBLogger","MAWDbMiddlewareMutations","getErrorSafe","vulture"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{create:function(n){return babelHelpers.extends({},n,{table:function(a){var t=n.table(a);try{return babelHelpers.extends({},t,{get:function(r){return t.get(r).then(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})},getMany:function(r){return t.getMany(r).then(function(t){return t.map(function(t){if(t!=null)return o("MAWDbMiddlewareMutations").getValue(t,a,e)})})},mutate:function(r){var n=null;switch(r.type){case"add":case"put":n=r.values.map(function(t){return o("MAWDbMiddlewareMutations").mutateValue(t,a,e)});break;case"delete":break;case"deleteRange":break}return r.type==="delete"||r.type==="deleteRange"||n==null?t.mutate(r):(r.values=n,t.mutate(r).then(function(e){return e}))},openCursor:function(r){return t.openCursor(r).then(function(t){return t==null||t.value==null?t:u(t,a,e)})},query:function(r){return t.query(r).then(function(t){if(t.result.length===0||typeof t.result[0]!="object")return t;var n=t.result.map(function(t){return o("MAWDbMiddlewareMutations").getValue(t,a,e)});return t.result=n,t})}})}catch(e){var i=r("getErrorSafe")(e);return r("FBLogger")("messenger_web").catching(i).mustfix("Error applying MAWDbMiddleware"),t}}})},name:"MAWDbMutationMiddleware",stack:"dbcore"}}function s(){return{create:function(t){return babelHelpers.extends({},t,{table:function(n){var e=t.table(n);try{return babelHelpers.extends({},e,{get:function(r){return e.get(r).then(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})},getMany:function(a){return e.getMany(a).then(function(e){return r("vulture")("SMxI1wxhqOhNsUbqaKEGeOiO21w="),e.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})},mutate:function(r){return r.type==="delete"||r.type==="deleteRange"||(r.values=r.values.map(function(e){return o("MAWDbMiddlewareMutations").mutateVaultedValue(e,n)})),e.mutate(r)},openCursor:function(r){return e.openCursor(r).then(function(e){return e==null||e.value==null?e:c(e,n)})},query:function(r){return e.query(r).then(function(e){return e.result.length===0||typeof e.result[0]!="object"?e:babelHelpers.extends({},e,{result:e.result.map(function(e){return o("MAWDbMiddlewareMutations").getVaultedValue(e,n)})})})}})}catch(t){var a=r("getErrorSafe")(t);return r("FBLogger")("messenger_web").catching(a).mustfix("Error applying MAWDbMiddleware"),e}}})},name:"getMAWVaultMiddleware",stack:"dbcore"}}function u(e,t,n){var r;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(i){return e.start(function(){r=o("MAWDbMiddlewareMutations").getValue(e.value,t,n);try{e.value=r}catch(e){}i()})}},value:{get:function(){return r}}})}function c(e,t){var n;return Object.create(e,{continue:{get:function(){return e.continue}},continuePrimaryKey:{get:function(){return e.continuePrimaryKey}},key:{get:function(){return e.key}},primaryKey:{get:function(){return e.primaryKey}},start:{value:function(a){return e.start(function(){n=o("MAWDbMiddlewareMutations").getVaultedValue(e.value,t);try{e.value=n}catch(e){}a()})}},value:{get:function(){return n}}})}l.getMAWDbMutationMiddleware=e,l.getMAWVaultMiddleware=s}),98);
__d("MAWDbEncryptObjContent",["MAWKeychainNaClCrypto"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return o("MAWKeychainNaClCrypto").encryptTweetNaClArrayBuffer(e,t,n)}l.encryptContent=e}),98);
__d("MAWXMACTAUtil",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}function l(e){var t=e.actionUrl,n=e.buttonType,r=e.ctaType,o=e.nativeUrl,a=e.title;return{actionUrl:t,buttonType:n,ctaType:r,nativeUrl:o,title:a}}i.toMAWCTAEncode=e,i.fromMAWCTAEncode=l}),66);
__d("WAServerSync.pb",["$InternalEnum","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s=n("$InternalEnum")({SET:0,REMOVE:1}),u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={};u.name="SyncdVersion",u.internalSpec={version:[1,(e=o("WAProtoConst")).TYPES.UINT64]},c.name="ExitCode",c.internalSpec={code:[1,e.TYPES.UINT64],text:[2,e.TYPES.STRING]},d.name="SyncdIndex",d.internalSpec={blob:[1,e.TYPES.BYTES]},m.name="SyncdValue",m.internalSpec={blob:[1,e.TYPES.BYTES]},p.name="KeyId",p.internalSpec={id:[1,e.TYPES.BYTES]},_.name="SyncdRecord",_.internalSpec={index:[1,e.TYPES.MESSAGE,d],value:[2,e.TYPES.MESSAGE,m],keyId:[3,e.TYPES.MESSAGE,p]},f.name="ExternalBlobReference",f.internalSpec={mediaKey:[1,e.TYPES.BYTES],directPath:[2,e.TYPES.STRING],handle:[3,e.TYPES.STRING],fileSizeBytes:[4,e.TYPES.UINT64],fileSha256:[5,e.TYPES.BYTES],fileEncSha256:[6,e.TYPES.BYTES]},g.name="SyncdSnapshot",g.internalSpec={version:[1,e.TYPES.MESSAGE,u],records:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_],mac:[3,e.TYPES.BYTES],keyId:[4,e.TYPES.MESSAGE,p]},h.name="SyncdMutations",h.internalSpec={mutations:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},y.name="SyncdMutation",y.internalSpec={operation:[1,e.TYPES.ENUM,s],record:[2,e.TYPES.MESSAGE,_]},C.name="SyncdPatch",C.internalSpec={version:[1,e.TYPES.MESSAGE,u],mutations:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y],externalMutations:[3,e.TYPES.MESSAGE,f],snapshotMac:[4,e.TYPES.BYTES],patchMac:[5,e.TYPES.BYTES],keyId:[6,e.TYPES.MESSAGE,p],exitCode:[7,e.TYPES.MESSAGE,c],deviceIndex:[8,e.TYPES.UINT32],clientDebugData:[9,e.TYPES.BYTES]},l.SyncdMutation$SyncdOperation=s,l.SyncdVersionSpec=u,l.ExitCodeSpec=c,l.SyncdIndexSpec=d,l.SyncdValueSpec=m,l.KeyIdSpec=p,l.SyncdRecordSpec=_,l.ExternalBlobReferenceSpec=f,l.SyncdSnapshotSpec=g,l.SyncdMutationsSpec=h,l.SyncdMutationSpec=y,l.SyncdPatchSpec=C}),98);
__d("MAWDbObjDecode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloCollectionVersionsTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloMissingKeysTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPendingMutationsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloSyncActionsTableSchema.pb","MAWArmadilloSyncKeysTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWODSProxy","MAWXMACTAUtil","WAOdsEnums","WAServerSync.pb","decodeProtobuf"],(function(t,n,r,o,a,i,l){var e={appData:function(t){return I(t)},appMeta:function(t){return T(t)},chunk:function(t){return D(t)},collectionVersions:function(t){return O(t)},deletedMessages:function(t){return _(t)},deviceChangeAlerts:function(t){return u(t)},dualSendMedia:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},dyiBatch:function(t){return N(t)},ebMessageRestoreTasks:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebMsgRanges:function(t){return M(t)},ebRestoreQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ebUploadQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},editMsgHistory:function(t){return q(t)},encryptionMetaV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ephemeralSettings:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},existingUsers:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsBackloggedMessages:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsEncryptionMeta:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsIndexV3:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},ftsPurgeThreadBacklog:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},groupInfo:function(t){return h(t)},groupInvites:function(t){return L(t)},historySyncQRCodeData:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},historySyncQRCodeSecretKey:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},igMessageAuxiliaryInfo:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},isDualSend:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},media:function(t){return $(t)},mediaBackup:function(t){return x(t)},mediaKeys:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},messages:function(t){return p(t)},missingKeys:function(t){return A(t)},participants:function(t){return R(t)},pendingMessageStanzaQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},pendingMutations:function(t){return F(t)},pendingReceipts:function(t){return v(t)},pendingStanzas:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},personalSenderKeyStatuses:function(t){return k(t)},poll:function(t){return V(t)},reactions:function(t){return P(t)},receipts:function(t){return b(t)},receiverFetchInfo:function(t){return U(t)},sentBytesCache:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},staleQueue:function(t){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for decryption")},syncActions:function(t){return w(t)},syncKeys:function(t){return B(t)},tasks:function(t){return E(t)},threads:function(t){return S(t)},unrenderedMessages:function(t){return f(t)},xma:function(t){return W(t)}};function s(t,n){var o=null;if(Object.prototype.hasOwnProperty.call(e,n))o=e[n](t);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return o}function u(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,e);return{action:t.action,deviceJid:t.deviceJid,identity:t.identity,isArchived:t.isArchived,latitude:t.latitude,location:t.location,loggedOut:t.loggedOut,longitude:t.longitude,model:t.model,platform:t.platform,ts:t.ts}}function c(e){var t=e.quote,n;if(t!=null){if(t.content==null)throw r("FBLogger")("messenger_web").mustfixThrow("QuotedMsgContent missing upon decoding");var o=t.content,a=o.author,i=o.expirationTs,l=o.externalId,s=o.mediaId,u=o.msgContent,c=o.msgId,d=o.plaintextHash,m=o.sourceId,p=o.specialTextSize,_=o.ts,f=o.type,g=o.xmaMessageType;n={content:babelHelpers.extends({},t.content,{author:a,expirationTs:i,externalId:l,mediaId:s,msgContent:u,msgId:c,plaintextHash:d,sourceId:m,specialTextSize:p,ts:_,type:f,xmaMessageType:g}),remoteJid:t.remoteJid}}return n}function d(e){return e==null?e:new Uint8Array(e)}function m(e){return e==null||e.length===0?new Set:new Set(e)}function p(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,e),n=t.msgContent;if(t.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF){if(n==null)throw r("FBLogger")("messenger_web").mustfixThrow("MsgContent missing upon decoding futureproof message");n.subtype=n.subtype}var a=c(t),i=g(t.reportingMeta);return babelHelpers.extends({},t,{msgContent:n,quote:a,reportingMeta:i})}function _(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,e);return babelHelpers.extends({},t)}function f(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,e),n=c(t),r=g(t.reportingMeta);return babelHelpers.extends({},t,{quote:n,reportingMeta:r})}function g(e){if(e!=null)return{frankingKey:e.frankingKey!=null?new Uint8Array(e.frankingKey):e.frankingKey,frankingTag:e.frankingTag!=null?new Uint8Array(e.frankingTag):e.frankingTag,frankingVersion:e.frankingVersion,reportingContent:e.reportingContent,reportingTag:e.reportingTag!=null?new Uint8Array(e.reportingTag):e.reportingTag}}function h(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,e);return{creationTs:t.creationTs,creator:t.creator,inviter:t.inviter,memberAddMode:t.memberAddMode,msgExpiration:t.msgExpiration,name:t.name,nameOwner:t.nameOwner,nameTs:t.nameTs,participantVersion:t.participantVersion}}function y(e){return e.length===0?null:new Map(e.map(function(e){var t=e.deviceJid;if(t==null||e.serializedPubKey==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJid or serializedPubKey are missing ");var n=new Uint8Array(e.serializedPubKey),o=d(e.baseKey),a={baseKey:o,pubKey:n};return[t,a]}))}function C(e){return e==null?null:new Map(e.map(function(e){var t;if(e.deviceJid==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceJID is missing ");return[e.deviceJid,(t=e.count)!=null?t:0]}))}function b(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,e),n=t.recipientDevices,r=m(n);return{permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:r,retryCountsPerDevice:C(t.retryCountsPerDevice)}}function v(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,e)}function S(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,e);return{archived:t.archived,cannotReplyReason:t.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:t.didInsertDualThreadCutoverAdminMsg,folder:t.folder,isMigratedLocally:t.isMigratedLocally,lastReadMsg:t.lastReadMsg,lastReadMsgReceiptSent:t.lastReadMsgReceiptSent,muteCallsExpireTimeMs:t.muteCallsExpireTimeMs,muteExpireTimeMs:t.muteExpireTimeMs,newestMsg:t.newestMsg,newestMsgTs:t.newestMsgTs,oldestMsg:t.oldestMsg,optimisticThreadKey:t.optimisticThreadKey,snippetMsg:t.snippetMsg,snippetMsgTs:t.snippetMsgTs}}function R(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,e)}function L(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,e)}function E(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,e)}function k(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,e),n=t.hasSenderKey,r=m(n);return{hasSenderKey:r,rotateSenderKey:t.rotateSenderKey,senderKeyId:t.senderKeyId,senderKeyTs:t.senderKeyTs}}function I(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,e);return{ack:t.ack,contents:t.contents,permittedIdentitiesPerDevice:y(t.permittedIdentitiesPerDevice),recipientDevices:new Set(t.recipientDevices),sendPartial:t.sendPartial,ts:t.ts}}function T(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,e)}function D(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,e)}function x(e){return o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,e)}function $(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,e),n,a=t.mediaEntries;return a==null?n=new Map:n=new Map(a.map(function(e){if(e.msgId==null||e.mediaEntryData==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected msgId or mediaEntryData are missing ");return[e.msgId,new Uint8Array(e.mediaEntryData)]})),{accessibilitySummaryText:t.accessibilitySummaryText,isVideoGif:t.isVideoGif,mediaEntries:n,mediaType:t.mediaType,plaintextHash:t.plaintextHash,size:t.size,ts:t.ts,validatedAudioInfo:t.validatedAudioInfo,validatedDocumentFileInfo:t.validatedDocumentFileInfo,validatedImageInfo:t.validatedImageInfo,validatedResult:t.validatedResult,validatedVideoInfo:t.validatedVideoInfo}}function P(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,e);return t.ts!=null&&o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.MAW_MIGRATE_REACTION_TS_AS_INDEX,key:"reaction_ts_encrypted"}),babelHelpers.extends({ack:t.ack,author:t.author,groupingKey:t.groupingKey,reaction:t.reaction,reactToAuthor:t.reactToAuthor,senderTimestampMs:t.senderTimestampMs},t.ts!=null?{ts:t.ts}:{})}function N(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,e);return{isThread:t.isThread,numMessages:t.numMessages,numMessagesRestored:t.numMessagesRestored,numThreadsRestored:t.numThreadsRestored,oldestTs:t.oldestTs,qplFlowDescriptor:t.qplFlowDescriptor,qplInstanceKeyE2E:t.qplInstanceKeyE2E,qplInstanceKeyForThread:t.qplInstanceKeyForThread,threadId:t.threadId}}function M(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,e);return{creationTime:t.creationTime,maxMsgExternalId:t.maxMsgExternalId,maxMsgSortOrderMs:t.maxMsgSortOrderMs,minMsgExternalId:t.minMsgExternalId,minMsgSortOrderMs:t.minMsgSortOrderMs}}function w(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncActionsTableSchema.pb").SyncActionsTableSchemaProtoSpec,e);return{binarySyncData:t.binarySyncData,keyId:t.keyId,timestamp:t.timestamp,valueMac:t.valueMac,version:t.version}}function A(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloMissingKeysTableSchema.pb").MissingKeysTableSchemaProtoSpec,e),n;return t.deviceResponses==null?n=new Map:n=new Map(t.deviceResponses.map(function(e){if(e.deviceId==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected deviceId is missing");return[e.deviceId,e.deviceResponse]})),{deviceResponses:n,keyId:t.keyId,timestamp:t.timestamp}}function F(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPendingMutationsTableSchema.pb").PendingMutationsTableSchemaProtoSpec,e),n;switch(t.operation){case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.SET:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.SET;break;case o("MAWArmadilloPendingMutationsTableSchema.pb").SYNCD_MUTATION_SYNCD_OPERATION.REMOVE:n=o("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE;break;default:throw r("FBLogger")("messenger_web").mustfixThrow("operation missing when decoding PendingMutation")}return{binarySyncAction:t.binarySyncAction,operation:n,timestamp:t.timestamp,version:t.version}}function O(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloCollectionVersionsTableSchema.pb").CollectionVersionsTableSchemaProtoSpec,e);return{finiteFailureStartTime:t.finiteFailureStartTime,isCollectionInMacMismatchFatal:t.isCollectionInMacMismatchFatal,isCollectionLthashInconsistent:t.isCollectionLthashInconsistent,ltHash:t.ltHash,state:t.state,version:t.version}}function B(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloSyncKeysTableSchema.pb").SyncKeysTableSchemaProtoSpec,e);return{fingerprint:t.fingerprint,keyData:t.keyData,timestamp:t.timestamp}}function W(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,e);return{author:t.author,ctas:t.ctas.map(function(e){return o("MAWXMACTAUtil").fromMAWCTAEncode(e)}),defaultCTA:t.defaultCTA==null?t.defaultCTA:o("MAWXMACTAUtil").fromMAWCTAEncode(t.defaultCTA),defaultPreviewMediaPlaintextHash:t.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:t.faviconPlaintextHash,headerMediaPlaintextHash:t.headerMediaPlaintextHash,headerTitle:t.headerTitle,isTombstoned:t.isTombstoned,maxSubtitleNumOfLines:t.maxSubtitleNumOfLines,maxTitleNumOfLines:t.maxTitleNumOfLines,msgId:t.msgId,overlayDescription:t.overlayDescription,overlayIconGlyph:t.overlayIconGlyph,overlayTitle:t.overlayTitle,previewMediaIds:t.previewMediaIds,subtitleText:t.subtitleText,targetId:t.targetId,targetType:t.targetType,targetUsername:t.targetUsername,threadJid:t.threadJid,titleText:t.titleText,xmaLayoutType:t.xmaLayoutType}}function q(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,e);return{author:t.author,editExternalId:t.editExternalId,editTs:t.editTs,msgContent:t.msgContent,sendStatus:t.sendStatus,specialTextSize:t.specialTextSize}}function U(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,e);return{accessibilitySummaryText:t.accessibilitySummaryText,mimetype:t.mimetype,previewHeight:t.previewHeight,previewUrl:t.previewUrl,previewUrlExpirationTimestampMs:t.previewUrlExpirationTimestampMs,previewWidth:t.previewWidth,type:t.type}}function V(e){var t=o("decodeProtobuf").decodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,e),n=new Map(t.pollOptions.map(function(e){var t=e.pollOptionHash;if(t==null||e.pollOption==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected pollOptionHash or pollOption is missing");return[t,{optionText:e.pollOption.optionText,voteAuthors:new Set(e.pollOption.voteAuthors)}]}).filter(Boolean)),a=new Map(t.latestSenderTimestampsMs.map(function(e){if(e.author==null||e.latestSenderTimestampMs==null)throw r("FBLogger")("messenger_web").mustfixThrow("Expected author or latestSenderTimestampMs are missing");return[e.author,e.latestSenderTimestampMs]}));return{encKey:t.encKey,latestSenderTimestampsMs:a,pollAuthor:t.pollAuthor,pollOptions:n,pollParticipantCount:t.pollParticipantCount,pollState:t.pollState,selectableOptionsCount:t.selectableOptionsCount,title:t.title}}l.decodeDbObj=s}),98);
__d("WASyncdKeyTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e){return e}function s(e){return e}function u(e){return e}i.toSyncKeyId=e,i.fromSyncKeyId=l,i.toSyncKeyData=s,i.fromSyncKeyData=u}),66);
__d("MAWDbObjEncode",["FBLogger","MAWArmadilloAppDataTableSchema.pb","MAWArmadilloAppMetaTableSchema.pb","MAWArmadilloDeletedMessagesTableSchema.pb","MAWArmadilloDeviceChangeAlertsTableSchema.pb","MAWArmadilloDyiBatchTableSchema.pb","MAWArmadilloEBMsgRangesTableSchema.pb","MAWArmadilloEditMsgHistoryTableSchema.pb","MAWArmadilloGroupInfoTableSchema.pb","MAWArmadilloGroupInvitesTableSchema.pb","MAWArmadilloMediaTablesSchema.pb","MAWArmadilloMessagesTableSchema.pb","MAWArmadilloParticipantsTableSchema.pb","MAWArmadilloPersonalSenderKeyStatusTableSchema.pb","MAWArmadilloPollTableSchema.pb","MAWArmadilloReactionsTableSchema.pb","MAWArmadilloReceiptTablesSchema.pb","MAWArmadilloReceiverFetchInfoTableSchema.pb","MAWArmadilloTasksTableSchema.pb","MAWArmadilloThreadsTableSchema.pb","MAWArmadilloUnrenderedMessagesTableSchema.pb","MAWArmadilloXMATableSchema.pb","MAWMsgType","MAWXMACTAUtil","WASyncdKeyTypes","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e=["ack","altIndex","collapsibleId","externalId","messageDeleteTs","messageExpirationTs","msgId","pollStanzaId","protocolMsgId","quoteExpirationTs","quoteExternalId","revokedExternalId","rowId","serverTs","sortOrderMs","threadJid","unsendMsgContentDeleteTs"],s=["author","chat","externalId","rowId"],u={appData:k,appMeta:I,chunk:T,deletedMessages:_,deviceChangeAlerts:c,dualSendMedia:d,dyiBatch:P,ebMessageRestoreTasks:d,ebMsgRanges:N,ebRestoreQueue:d,ebUploadQueue:d,editMsgHistory:w,encryptionMetaV3:d,ephemeralSettings:d,existingUsers:d,ftsBackloggedMessages:d,ftsEncryptionMeta:d,ftsIndexV3:d,ftsPurgeBacklog:d,ftsPurgeThreadBacklog:d,groupInfo:g,groupInvites:R,historySyncQRCodeData:d,historySyncQRCodeSecretKey:d,igMessageAuxiliaryInfo:d,isDualSend:d,media:x,mediaBackup:D,mediaKeys:d,messages:p,participants:S,pendingMessageStanzaQueue:d,pendingReceipts:b,pendingStanzas:d,personalSenderKeyStatuses:E,poll:F,reactions:$,receipts:C,receiverFetchInfo:A,sentBytesCache:d,staleQueue:d,tasks:L,threads:v,unrenderedMessages:f,xma:M};function c(e){var t={action:e.action,deviceJid:e.deviceJid,identity:e.identity,isArchived:e.isArchived,latitude:e.latitude,location:e.location,loggedOut:e.loggedOut,longitude:e.longitude,model:e.model,platform:e.platform,ts:e.ts};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeviceChangeAlertsTableSchema.pb").DeviceChangeAlertsTableSchemaProtoSpec,t).readByteArrayView()}}function d(e){throw r("FBLogger")("messenger_web").mustfixThrow("unexpected table for encryption")}function m(e,t){var n=null;if(Object.prototype.hasOwnProperty.call(u,t))n=u[t](e);else throw r("FBLogger")("messenger_web").mustfixThrow("not a valid table name");return n}function p(t){var n=t.ack,r=t.altIndex,a=t.collapsibleId,i=t.externalId,l=t.messageDeleteTs,s=t.messageExpirationTs,u=t.msgId,c=t.pollStanzaId,d=t.protocolMsgId,m=t.quoteExpirationTs,p=t.quoteExternalId,_=t.revokedExternalId,f=t.rowId,g=t.serverTs,h=t.sortOrderMs,y=t.threadJid,C=t.unsendMsgContentDeleteTs,b=babelHelpers.objectWithoutPropertiesLoose(t,e),v=b,S;if(v.quote==null)S=v.quote;else{var R,L={author:v.quote.content.author,expirationTs:v.quote.content.expirationTs,externalId:(R=v.quote)==null?void 0:R.content.externalId,mediaId:v.quote.content.mediaId,msgContent:v.quote.content.msgContent,msgId:v.quote.content.msgId,plaintextHash:v.quote.content.plaintextHash,sourceId:v.quote.content.sourceId,specialTextSize:v.quote.content.specialTextSize,ts:v.quote.content.ts,type:v.quote.content.type,xmaMessageType:v.quote.content.xmaMessageType},E={content:L,remoteJid:v.quote.remoteJid};S=E}var k=v.msgContent;v.type===o("MAWMsgType").MSG_TYPE.FUTUREPROOF&&(k={protobuf:v.msgContent.protobuf,subtype:v.msgContent.subtype});var I=v.ravenEphemeralType,T=v.ravenEphemeralMediaState,D=I!=null?I:null,x=T!=null?T:null,$={applicationErrorCode:v.applicationErrorCode,author:v.author,editCount:v.editCount,ephemeralCounterStarted:v.ephemeralCounterStarted,ephemeralMsgDisappeared:v.ephemeralMsgDisappeared,ephemeralSetting:v.ephemeralSetting,forwardingScore:v.forwardingScore,groupId:v.groupId,groupIndex:v.groupIndex,groupSize:v.groupSize,hdType:v.hdType,isCollapsed:v.isCollapsed,isExpiredXmaMsg:v.isExpiredXmaMsg,isForwarded:v.isForwarded,mediaId:v.mediaId,msgContent:k,originalTs:v.originalTs,quote:S,ravenEphemeralMediaState:x,ravenEphemeralType:D,receiverFetchId:v.receiverFetchId,reportingMeta:v.reportingMeta,resendCount:v.resendCount,source:v.source,specialTextSize:v.specialTextSize,ts:v.ts,type:v.type,xmaMessageType:v.xmaMessageType};return{encodedFields:$,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMessagesTableSchema.pb").MessagesTableSchemaProtoSpec,$).readByteArrayView()}}function _(e){var t=e.author,n=e.chat,r=e.externalId,a=e.rowId,i=babelHelpers.objectWithoutPropertiesLoose(e,s),l={reason:String(i.reason)};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDeletedMessagesTableSchema.pb").DeletedMessagesTableSchemaProtoSpec,l).readByteArrayView()}}function f(e){var t;if(e.quote==null)t=e.quote;else{var n,r={author:e.quote.content.author,expirationTs:e.quote.content.expirationTs,externalId:(n=e.quote)==null?void 0:n.content.externalId,mediaId:e.quote.content.mediaId,msgContent:e.quote.content.msgContent,msgId:e.quote.content.msgId,plaintextHash:e.quote.content.plaintextHash,sourceId:e.quote.content.sourceId,ts:e.quote.content.ts,type:e.quote.content.type,xmaMessageType:e.quote.content.xmaMessageType},a={content:r,remoteJid:e.quote.remoteJid};t=a}var i={ack:e.ack,author:e.author,ephemeralSetting:e.ephemeralSetting,groupName:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,mediaId:e.mediaId,msgContent:e.msgContent,quote:t,reportingMeta:e.reportingMeta,resendCount:e.resendCount,ts:e.ts,type:e.type,xmaMessageType:e.xmaMessageType};return{encodedFields:i,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloUnrenderedMessagesTableSchema.pb").UnrenderedMessagesTableSchemaProtoSpec,i).readByteArrayView()}}function g(e){var t={creationTs:e.creationTs,creator:e.creator,inviter:e.inviter,memberAddMode:e.memberAddMode,msgExpiration:e.msgExpiration,name:e.name,nameOwner:e.nameOwner,nameTs:e.nameTs,participantVersion:e.participantVersion};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInfoTableSchema.pb").GroupInfoSchemaProtoSpec,t).readByteArrayView()}}function h(e){return e==null?e:Array.from(e,function(e){var t=e[0],n=e[1];return{baseKey:n.baseKey,deviceJid:t,serializedPubKey:n.pubKey}})}function y(e){return e==null?null:Array.from(e,function(e){var t=e[0],n=e[1];return{count:n,deviceJid:t}})}function C(e){var t=Array.from(e.recipientDevices),n={permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:t,retryCountsPerDevice:y(e.retryCountsPerDevice)};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").ReceiptsTableSchemaProtoSpec,n).readByteArrayView()}}function b(e){var t={author:e.author,deliveryReceipts:e.deliveryReceipts,externalId:e.externalId,readReceipts:e.readReceipts,thread:e.thread};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiptTablesSchema.pb").PendingReceiptsTableSchemaProtoSpec,t).readByteArrayView()}}function v(e){var t={archived:e.archived,cannotReplyReason:e.cannotReplyReason,didInsertDualThreadCutoverAdminMsg:e.didInsertDualThreadCutoverAdminMsg,folder:e.folder,isMigratedLocally:e.isMigratedLocally,lastReadMsg:e.lastReadMsg,lastReadMsgReceiptSent:e.lastReadMsgReceiptSent,newestMsgTs:e.newestMsgTs,oldestMsg:e.oldestMsg,optimisticThreadKey:e.optimisticThreadKey,snippetMsg:e.snippetMsg,snippetMsgTs:e.snippetMsgTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloThreadsTableSchema.pb").ThreadsTableSchemaProtoSpec,t).readByteArrayView()}}function S(e){var t={addressable:e.addressable,deliveredWatermarkTs:e.deliveredWatermarkTs,lastReadActionTs:e.lastReadActionTs,lastReadWatermarkTs:e.lastReadWatermarkTs,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloParticipantsTableSchema.pb").ParticipantsTableSchemaProtoSpec,t).readByteArrayView()}}function R(e){var t={caption:e.caption,inviteCode:e.inviteCode,inviteExpirationTs:e.inviteExpirationTs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloGroupInvitesTableSchema.pb").GroupInvitesTableSchemaProtoSpec,t).readByteArrayView()}}function L(e){var t={scheduledTime:e.scheduledTime};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloTasksTableSchema.pb").TasksTableSchemaProtoSpec,t).readByteArrayView()}}function E(e){var t=Array.from(e.hasSenderKey),n={hasSenderKey:t,rotateSenderKey:e.rotateSenderKey,senderKeyId:e.senderKeyId,senderKeyTs:e.senderKeyTs};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPersonalSenderKeyStatusTableSchema.pb").PersonalSenderKeyStatusTableSchemaProtoSpec,n).readByteArrayView()}}function k(e){var t;switch(e.contents.type){case"meta_sync":{var n=[];for(var a of e.contents.actions)a.chatAction?n.push({chatAction:a.chatAction}):a.messageAction&&n.push({messageAction:a.messageAction});t={actions:n,type:"meta_sync"};break}case"backups_secrets":{t={encryptedBackupsSecrets:e.contents.encryptedBackupsSecrets,type:"backups_secrets"};break}case"sync_key_share":{var i;t={syncKeyShare:{keys:e.contents.syncKeyShare.keys,orphanKeys:(i=e.contents.syncKeyShare)==null||(i=i.orphanKeys)==null?void 0:i.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_share"};break}case"sync_key_request":{t={syncKeyRequest:{keyIds:e.contents.syncKeyRequest.keyIds.map(o("WASyncdKeyTypes").fromSyncKeyId)},type:"sync_key_request"};break}default:throw e.contents.type,r("FBLogger")("messenger_web").mustfixThrow("Unknown appdata type: "+e.contents.type)}var l={ack:e.ack,contents:t,permittedIdentitiesPerDevice:h(e.permittedIdentitiesPerDevice),recipientDevices:Array.from(e.recipientDevices),sendPartial:e.sendPartial,ts:e.ts};return{encodedFields:l,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppDataTableSchema.pb").AppDataTableSchemaProtoSpec,l).readByteArrayView()}}function I(e){var t={value:e.value};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloAppMetaTableSchema.pb").AppMetaTableSchemaProtoSpec,t).readByteArrayView()}}function T(e){var t={blobData:e.blobData,mimetype:e.mimetype,plaintextHash:e.plaintextHash};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").ChunkTableSchemaProtoSpec,t).readByteArrayView()}}function D(e){var t={fbid:e.fbid};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaBackupSchemaProtoSpec,t).readByteArrayView()}}function x(e){var t=Array.from(e.mediaEntries,function(e){var t=e[0],n=e[1];return{mediaEntryData:n,msgId:t}}),n={accessibilitySummaryText:e.accessibilitySummaryText,isVideoGif:e.isVideoGif,mediaEntries:t,mediaType:e.mediaType,plaintextHash:e.plaintextHash,size:e.size,ts:e.ts,validatedAudioInfo:e.validatedAudioInfo,validatedDocumentFileInfo:e.validatedDocumentFileInfo,validatedImageInfo:e.validatedImageInfo,validatedResult:e.validatedResult,validatedVideoInfo:e.validatedVideoInfo};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloMediaTablesSchema.pb").MediaTableSchemaProtoSpec,n).readByteArrayView()}}function $(e){var t={ack:e.ack,author:e.author,groupingKey:e.groupingKey,reaction:e.reaction,reactToAuthor:e.reactToAuthor,senderTimestampMs:e.senderTimestampMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReactionsTableSchema.pb").ReactionsTableSchemaProtoSpec,t).readByteArrayView()}}function P(e){var t={isThread:e.isThread,numMessages:e.numMessages,numMessagesRestored:e.numMessagesRestored,numThreadsRestored:e.numThreadsRestored,oldestTs:e.oldestTs,qplFlowDescriptor:e.qplFlowDescriptor,qplInstanceKeyE2E:e.qplInstanceKeyE2E,qplInstanceKeyForThread:e.qplInstanceKeyForThread,threadId:e.threadId};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloDyiBatchTableSchema.pb").DyiBatchTableSchemaProtoSpec,t).readByteArrayView()}}function N(e){var t={creationTime:e.creationTime,maxMsgExternalId:e.maxMsgExternalId,maxMsgSortOrderMs:e.maxMsgSortOrderMs,minMsgExternalId:e.minMsgExternalId,minMsgSortOrderMs:e.minMsgSortOrderMs};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEBMsgRangesTableSchema.pb").EBMsgRangesTableSchemaProtoSpec,t).readByteArrayView()}}function M(e){var t=e.ctas==null?[]:e.ctas.map(function(e){return o("MAWXMACTAUtil").toMAWCTAEncode(e)}),n={author:e.author,ctas:t,defaultCTA:e.defaultCTA==null?e.defaultCTA:o("MAWXMACTAUtil").toMAWCTAEncode(e.defaultCTA),defaultPreviewMediaPlaintextHash:e.defaultPreviewMediaPlaintextHash,faviconPlaintextHash:e.faviconPlaintextHash,headerMediaPlaintextHash:e.headerMediaPlaintextHash,headerTitle:e.headerTitle,isTombstoned:e.isTombstoned,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines,maxTitleNumOfLines:e.maxTitleNumOfLines,msgId:e.msgId,overlayDescription:e.overlayDescription,overlayIconGlyph:e.overlayIconGlyph,overlayTitle:e.overlayTitle,previewMediaIds:e.previewMediaIds,subtitleText:e.subtitleText,targetId:e.targetId,targetType:e.targetType,targetUsername:e.targetUsername,threadJid:e.threadJid,titleText:e.titleText,xmaLayoutType:e.xmaLayoutType};return{encodedFields:n,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloXMATableSchema.pb").XMATableSchemaProtoSpec,n).readByteArrayView()}}function w(e){var t={author:e.author,editExternalId:e.editExternalId,editTs:e.editTs,msgContent:e.msgContent,sendStatus:e.sendStatus,specialTextSize:e.specialTextSize};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloEditMsgHistoryTableSchema.pb").EditMsgHistoryTableSchemaProtoSpec,t).readByteArrayView()}}function A(e){var t={accessibilitySummaryText:e.accessibilitySummaryText,mimetype:e.mimetype,previewHeight:e.previewHeight,previewUrl:e.previewUrl,previewUrlExpirationTimestampMs:e.previewUrlExpirationTimestampMs,previewWidth:e.previewWidth,type:e.type};return{encodedFields:t,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloReceiverFetchInfoTableSchema.pb").ReceiverFetchInfoTableSchemaProtoSpec,t).readByteArrayView()}}function F(e){var t=Array.from(e.pollOptions,function(e){var t=e[0],n=e[1];return{pollOption:{optionText:n.optionText,voteAuthors:Array.from(n.voteAuthors)},pollOptionHash:t}}),n=Array.from(e.latestSenderTimestampsMs,function(e){var t=e[0],n=e[1];return{author:t,latestSenderTimestampMs:n}}),r={encKey:e.encKey,latestSenderTimestampsMs:n,pollAuthor:e.pollAuthor,pollOptions:t,pollParticipantCount:e.pollParticipantCount,pollState:e.pollState,selectableOptionsCount:e.selectableOptionsCount,title:e.title};return{encodedFields:r,proto:o("encodeProtobuf").encodeProtobuf(o("MAWArmadilloPollTableSchema.pb").PollTableSchemaProtoSpec,r).readByteArrayView()}}l.encodeDbObj=m,l.encodeDbPollForEncryption=F}),98);
__d("MAWMpsMigrationRunningState",[],(function(t,n,r,o,a,i){"use strict";var e=!1;function l(){return e}function s(t){e=t}i.isMawMpsMigrationRunning=l,i.setIsMawMpsMigrationRunning=s}),66);
__d("MAWDbObjEncryption",["ExecutionEnvironment","FBLogger","MAWBridge","MAWCryptoConsts","MAWDbEncryptObjContent","MAWDbObjDecode","MAWDbObjEncode","MAWDexieTable","MAWIndexedDb","MAWKeychainCrypto","MAWKeychainNaClCrypto","MAWKeychainUtil","MAWMpsMigrationRunningState","MAWQplProxy","MAWUnrecoverableDbErrors","MWEARKeychainV3","MWEARKeychainV3Errors","ODS","WABase64","WATimeUtils","getErrorSafe","gkx","isEncryptionAtRestEnabled","pageID","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u="_encryptedContent",c=new Set(["threads","messages","participants"]);function d(e,t,n){if(!(r("isEncryptionAtRestEnabled")()||r("gkx")("23910")===!0)||!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(t))return e;var a=o("MAWQplProxy").startQplUserFlow(r("qpl")._(25300256,"115"),{bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:t}});try{var i=babelHelpers.extends({},e),l=n(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear"),d=l.keys,m=d[0],p=l.version,_=l.randomisedVersion;o("MWEARKeychainV3").isKeychainSettled("maw_ear")===!1&&r("FBLogger")("messenger_web").mustfix("[EAR] Encrypting %s data with global ear. Transactor: %s",t,o("MAWDexieTable").getDexiePSDItem("transactorName")),a.addAnnotations({int:{keyVersion:p,randomisedVersion:_}});var f=o("MAWKeychainUtil").makeAAD(p,o("MAWCryptoConsts").CIPHER_ID),g=o("MAWDbObjEncode").encodeDbObj(e,t),h=g.encodedFields,y=g.proto;Object.keys(h).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&delete i[t]});var C=o("MAWDbEncryptObjContent").encryptContent(m,y,f);return i[u]=C,c.has(t)&&(i.updatedAt_S456130=Date.now(),i.randomisedVersion_S456130=_,i.encryptedWith_S456130=o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",i.keyVersion_S456130=p),a==null||a.endSuccess(),i}catch(e){var b=r("getErrorSafe")(e);throw a==null||a.endFail("ear_encrypt_fail"),r("FBLogger")("messenger_web").catching(b).mustfixThrow("[%s] %s - Encrypted dexie was unable to encrypt an entity for table %s",b.name,b.message,t)}}function m(t,n,a){if(!o("MAWIndexedDb").TABLES_TO_ENCRYPT.includes(n)||!Object.prototype.hasOwnProperty.call(t,u))return t;var i=(s||(s=r("ExecutionEnvironment"))).isInMainThread?null:o("MAWQplProxy").startQplUserFlow(r("qpl")._(25313004,"118"));i==null||i.addAnnotations({bool:{isWorker:(s||(s=r("ExecutionEnvironment"))).isInWorker,useMawEar:o("MWEARKeychainV3").isKeychainSettled("maw_ear")},string:{pageID:r("pageID"),tableName:n}});var l;try{var d=t[u],m=babelHelpers.extends({},t);(e||(e=o("ODS"))).bumpEntityKey(3185,"maw_db_ear_decryption","encrypted_content_type."+n+"."+(d instanceof ArrayBuffer?"ArrayBuffer":"string"));var f=d instanceof ArrayBuffer?d:o("WABase64").decodeB64(d),g=o("MAWKeychainCrypto").getKeyVersionFromCipherDataString(f),h=g.aadLengthInBytes,y=g.keyVersion,C=a(o("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear",y);l=C;var b=C.dbEntry,v=C.keys,S=C.randomisedVersion;i==null||i.addAnnotations({int:{contentVersion:t==null?void 0:t.keyVersion_S456130,keyVersion:y,randomisedVersion:S},string:{encryptedWith:t==null?void 0:t.encryptedWith_S456130,randomisedVersionEncryption:t==null?void 0:t.randomisedVersion_S456130}});var R={},L,E;for(var k of v)try{L=o("MAWKeychainNaClCrypto").decryptArrayBuffer(k,f,y,b.formatVersion,h);break}catch(e){E=e}if(L==null)throw r("getErrorSafe")(E);var I=o("MAWDbObjDecode").decodeDbObj(L,n);Object.keys(I).forEach(function(e){R[e]=I[e]}),delete m[u];var T=babelHelpers.extends({},m,R);return i==null||i.endSuccess(),T}catch(e){var D,x,$;if(c.has(n)){var P;i==null||i.addAnnotations({int:{updatedAt:(P=t==null?void 0:t.updatedAt_S456130)!=null?P:-1}})}if((e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&o("MAWMpsMigrationRunningState").isMawMpsMigrationRunning()){i==null||i.addAnnotations({bool:{earDecryptionErrorSuppressed:!0}}),r("FBLogger")("messenger_web").mustfix("[EAR] Ignoring EAR decryption error during MAW->MPS migration. Table: %s.",n);return}(s||(s=r("ExecutionEnvironment"))).isInWorker&&(e instanceof o("MAWKeychainNaClCrypto").EARDecryptionError||e instanceof o("MWEARKeychainV3Errors").EARKeychainNotFoundError)&&(r("FBLogger")("messenger_web").mustfix("[EAR] Encountered EAR Error - submitting unrecoverableDbError. Table: %s.",n),i==null||i.addAnnotations({bool:{unrecoverableDbError:!0}}),o("MAWBridge").getBridge().fireAndForget("event","unrecoverableDbError",{error:new(o("MAWUnrecoverableDbErrors")).EarRuntimeError}));var N=r("getErrorSafe")(e);throw i==null||i.markError("ear_decrypt_exception",null,N),i==null||i.endFail("ear_decrypt_fail"),r("FBLogger")("messenger_web").catching(N).mustfixThrow("[%s] %s - (v2) Encrypted dexie was unable to decrypt an entity for table %s. UpdatedAt: %s. KeyStatus: %s. Signature matches: %s. Key source: %s. Using MAW EAR: %s. Worker: %s. Encrypted With: %s. PageID: %s. Source: %s",N.name,N.message,n,p(t==null?void 0:t.updatedAt_S456130),_(t,l),(t==null?void 0:t.randomisedVersion_S456130)!=null&&((D=l)==null?void 0:D.randomisedVersion)!=null?t.randomisedVersion_S456130===l.randomisedVersion:null,(x=($=l)==null?void 0:$.dbEntry.source)!=null?x:"-1",o("MWEARKeychainV3").isKeychainSettled("maw_ear"),(s||(s=r("ExecutionEnvironment"))).isInWorker,t==null?void 0:t.encryptedWith_S456130,r("pageID"),o("MAWDexieTable").getDexiePSDItem("transactorName"))}}function p(e){if(e==null)return"unknown";var t=Date.now()-e,n=Math.floor(t/(1e3*60*60*24));return n<1?"0-1 days":n<7?"1-7 days":n<14?"7-14 days":n<30?"14-30 days":"30+ days"}function _(e,t){if((e==null?void 0:e.updatedAt_S456130)==null||t==null)return null;var n=o("WATimeUtils").castToUnixTime(e.updatedAt_S456130/1e3),r=t.dbEntry.expiration-o("MAWCryptoConsts").ENC_KEY_TTL;return n===r?"same":n>r?"key_older":"key_newer"}l.ENCRYPTED_COLUMN_NAME=u,l.encryptDbObj=d,l.decryptDbObj=m}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=o("MAWKeychainUtil").getBufferWithRandomValuesFromLength(o("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return c(e).then(function(e){return o("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",e)})}function s(e,t){var n=new TextEncoder().encode(e),a=new Uint8Array(t),i=r("tweetnacl-auth")(n,a);return o("WABase64").encodeB64UrlSafe(i)}function u(){return e().then(function(e){return o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(t){return function(){return o("MAWDbMsgTypeVersionTxns").getHMACKey(t).then(function(n){return n!=null?n:o("MAWDbMsgTypeVersionTxns").addHMACKey(t,e).then(function(){return e})})}})()})}function c(e){return o("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",e,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}l.genHMACKey=e,l.hmacTweetNaCl=s,l.generateAndInsertHMACKey=u}),98);
__d("WAMsgIdToMessageKey",["WAGlobals","WAJids"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.author,n=e.chat,r=e.externalId,a=o("WAJids").isAuthorMe(t),i=o("WAJids").interpretAsGroupJid(n),l=a?o("WAGlobals").getMyUserJid():t,s=n,u=i!=null?l:void 0;return{fromMe:a,id:r,remoteJid:s,participant:u}}l.msgIdToMessageKey=e}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAMsgIdToMessageKey","WAMsgType","err"],(function(t,n,r,o,a,i,l){"use strict";var e="image/jpeg",s="video/mp4",u="audio/wav",c="image/gif",d="image/webp";function m(e){switch(e.type){case o("WAMsgType").MSG_TYPE.TEXT:return p(e);case o("WAMsgType").MSG_TYPE.REACTION:return _(e);case o("WAMsgType").MSG_TYPE.REVOKED:return f(e);default:return r("WAAssertUnreachable")(e.type)}}function p(e){var t={payload:{content:{messageText:{mentionedJid:[],text:e.msgContent.content}}}};if(e.specialTextSize!=null){var n=e.specialTextSize===1?o("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:e.specialTextSize===2?o("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:o("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;t.metadata={specialTextSize:n}}return t}function _(e){if(e.reactToMsgId==null)throw r("err")("cannot send reaction that reacts to no message");var t=o("WAMsgIdToMessageKey").msgIdToMessageKey(e.reactToMsgId),n={groupingKey:e.groupingKey==null?void 0:e.groupingKey,key:t,senderTimestampMs:e.ts,text:e.reaction==null?void 0:e.reaction};return{payload:{content:{reactionMessage:n}}}}function f(e){var t={remoteJid:e.id.chat,fromMe:!0,id:e.revokedExternalId};return{payload:{applicationData:{revoke:{key:t}}}}}l.IMAGE_MIME_TYPE=e,l.VIDEO_MIME_TYPE=s,l.AUDIO_MIME_TYPE=u,l.GIF_MIME_TYPE=c,l.STICKER_MIME_TYPE=d,l.asConsumerApplication=m,l.encodeTextMessage=p,l.encodeReactionMessage=_}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMsgType","WAAsConsumerApplication","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){switch(t===void 0&&(t="media"),e){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return t==="xma-media"?"xma-image":"image";case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case o("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case o("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case o("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw r("FBLogger")("messenger_web").mustfixThrow("get a wrong media file with type %s",e)}}function s(e){try{return o("WABlobToArrayBuffer").blobToArrayBuffer(e).then(u)}catch(e){var t=r("getErrorSafe")(e);throw r("FBLogger")("messenger_web").mustfixThrow("Got %s when convert the blob to Uint8Array",t.message)}}function u(e){return self.crypto.subtle.digest("SHA-256",e).then(function(e){return new Uint8Array(e)})}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield s(e),n=o("WAHashUtils").toPlaintextHash(t),r=_(n);return[n,r]}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield u(e),n=o("WAHashUtils").toPlaintextHash(t);return n}),p.apply(this,arguments)}function _(e){var t=o("WAGlobals").getHMACKey();return o("WAHashUtils").toHashedPlaintextHash(o("MAWHMACKey").hmacTweetNaCl(e,t))}function f(e){if(e==null)return null;var t="preview-"+o("WATimeUtils").unixTime().toString()+".jpeg";return g(e,t,"image/jpeg")}function g(e,t,n){return new File([new Blob([new Uint8Array(e)],{type:n})],t,{type:n})}function h(e,t,n){var r=function(){return n!=null?o("MAWDexieTable").dexieResolve(n.filter(function(e){return e.type!==o("WAMsgType").REVOKED&&t.msgIds.includes(e.msgId)})):e.messages.where("msgId").anyOf(t.msgIds).filter(function(e){return e.type!==o("WAMsgType").REVOKED}).toArray()};return r().then(function(e){return C(t,e)})}function y(e){return e.reduce(function(e,t){var n=t.hdType;return n!=null&&(e[t.msgId]=n),e},{})}function C(e,t){var n=t.filter(function(t){return t.type!==o("WAMsgType").REVOKED&&e.msgIds.includes(t.msgId)}),a=n.map(function(e){return e.msgId}),i=babelHelpers.extends({},e,{msgIds:a}),l=n.reduce(function(e,t){return e[t.msgId]=o("WATimeUtils").castToMillisTime(t.sortOrderMs!=null?t.sortOrderMs:t.ts*1e3),e},{});if(i=babelHelpers.extends({},i,{messagesSortOrderMs:l}),n.every(function(e){return e.type===o("WAMsgType").STICKER})){var s=o("MAWImageUtils").boundHeightWidth(i.previewHeight,i.previewWidth,o("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE),u=s.height,c=s.width;i=babelHelpers.extends({},i,{mediaType:o("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:u,previewHeightLarge:u,previewWidth:c,previewWidthLarge:c})}var d=new Set(n.map(function(e){return e.type}));return d.forEach(function(t){t!==o("MAWMsgType").MSG_TYPE.RAVEN&&e.mediaType!==b(t)&&r("FBLogger")("messenger_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",t,e.mediaType)}),i}function b(e){switch(e){case o("MAWMsgType").MSG_TYPE.IMAGE:return o("MAWDbMedia").MEDIA_TYPE.IMAGE;case o("MAWMsgType").MSG_TYPE.VIDEO:return o("MAWDbMedia").MEDIA_TYPE.VIDEO;case o("MAWMsgType").MSG_TYPE.PTT:return o("MAWDbMedia").MEDIA_TYPE.PTT;case o("MAWMsgType").MSG_TYPE.GIF:return o("MAWDbMedia").MEDIA_TYPE.GIF;case o("MAWMsgType").MSG_TYPE.STICKER:return o("MAWDbMedia").MEDIA_TYPE.STICKER;case o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}function v(e){var t,n,r=((t=e.ancillary)==null?void 0:t.gifPlayback)===!0,a=((n=e.integral)==null||(n=n.transport)==null||(n=n.ancillary)==null?void 0:n.mimetype)===o("WAAsConsumerApplication").GIF_MIME_TYPE;return r&&a}l.getServerMediaTypeFromMediaType=e,l.hashBlob=s,l.hashArrayBuffer=u,l.genBlobHashes=c,l.genHashFromArrayBuffer=m,l.genHMACPlaintextHash=_,l.convertJpegThumbnailArrayBufferToFile=f,l.getBridgeMediaAnnotatedForDisplay=h,l.createHdTypesForBridgeMedia=y,l.annotateBridgeMediaForDisplay=C,l.getMediaTypeFromMsgType=b,l.isTransportLegacyGif=v}),98);
__d("mergeMaps",[],(function(t,n,r,o,a,i){"use strict";function e(){for(var e=new Map,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++)for(var a=n[o].keys(),i=void 0;!(i=a.next()).done;)e.set(i.value,n[o].get(i.value));return e}i.default=e}),66);
__d("MpsPreprocessor",["Promise","getSafeQplErrorMessage","mergeMaps"],(function(t,n,r,o,a,i,l){"use strict";var e=["errors"],s;function u(t,a){return function(r){var o=r.payloadList.map(function(e){return e.message.messageId});r.ctx.messageToQpl.all(o).addPoint(a+"_start");var l=r.errors,u=babelHelpers.objectWithoutPropertiesLoose(r,e),c=t(u);return c instanceof(s||(s=n("Promise")))?c.then(function(e){return i(e,l!=null?l:new Map)}):i(c,l!=null?l:new Map)};function i(e,t){var n=e.payloadList.map(function(e){return e.message.messageId});return e.ctx.messageToQpl.all(n).addPoint(a+"_end"),e.errors.entries().forEach(function(t){var n=t[0],r=t[1];e.ctx.messageToQpl.endFail(n,a.toLowerCase()+"-error",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r))}),babelHelpers.extends({},e,{errors:r("mergeMaps")(t,e.errors)})}}l.preprocessor=u}),98);
__d("MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor",["MAWDbMsgTypeVersionTxns","MAWProtobufDeserializers","MpsPreprocessor","WAGlobals","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){e=t}var u=o("MpsPreprocessor").preprocessor((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.ctx,r=t.payloadList,a=new Map,i=[];for(var l of r){var s,u,c=l.directive,d=l.insertionSource,m=l.message,p=o("MAWProtobufDeserializers").DeserializedBackupMessage.create(m.payload),_=(s=p.payload().proto)==null||(s=s.event)==null?void 0:s.deviceChange;if(_==null){i.push({directive:c,insertionSource:d,message:m});continue}if(((u=p.proto.metadata)==null?void 0:u.senderId)===o("WAGlobals").getMyUserJid()){n.messageToQpl.addPoint(m.messageId,"drop_security_alert_my_device"),n.messageToQpl.endSuccess(m.messageId);continue}e===null&&(e=yield o("MAWDbMsgTypeVersionTxns").getSecuritySettingForContactTxn()),e===!0?i.push({directive:c,insertionSource:d,message:m}):(n.messageToQpl.addPoint(m.messageId,"drop_security_alert_disabled"),n.messageToQpl.endSuccess(m.messageId))}return{ctx:n,errors:a,payloadList:i}});return function(e){return t.apply(this,arguments)}})(),"maybe_drop_security_alerts");l.setCachedShouldSaveSecurityAlert=s,l.MawMpsDropDeviceNotificationsForTurnedOffSecurityAlertsPreprocessor=u}),98);
__d("MAWEBCombinedSwitch",["MAWEBEnabledStateManager","MAWEBLSInWorkerSwitch","MAWEBSwitch","MAWODSProxy","WAOdsEnums"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(t,n){var r;return r=e.call(this)||this,r.$MAWCombinedStateManager$p_1=t,r.$MAWCombinedStateManager$p_2=n,r.$MAWCombinedStateManager$p_3=null,r.$MAWCombinedStateManager$p_4=!1,r.$MAWCombinedStateManager$p_1.onSet(function(){r.$MAWCombinedStateManager$p_5()}),r.$MAWCombinedStateManager$p_2.onSet(function(){r.$MAWCombinedStateManager$p_5()}),r.$MAWCombinedStateManager$p_5(),r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.isEnabled=function(){var t=e.prototype.isEnabled.call(this);return this.$MAWCombinedStateManager$p_6(),t},n.$MAWCombinedStateManager$p_6=function(){var e=this.$MAWCombinedStateManager$p_1.isEnabled(),t=this.$MAWCombinedStateManager$p_2.isEnabled(),n=e!==t,r=e?"enabled":"disabled",a=t?"enabled":"disabled",i=n?"mismatch":"match";if(n&&!this.$MAWCombinedStateManager$p_4)this.$MAWCombinedStateManager$p_3=Date.now(),this.$MAWCombinedStateManager$p_4=!0;else if(this.$MAWCombinedStateManager$p_4&&this.$MAWCombinedStateManager$p_3!=null){var l=this.$MAWCombinedStateManager$p_3,s=Date.now()-l;this.$MAWCombinedStateManager$p_4=n,this.$MAWCombinedStateManager$p_3=n?Date.now():null;var u=this.$MAWCombinedStateManager$p_7(s);o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch.sync.duration_bucket."+u});var c=n?"failed":"success";o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch.sync.result."+c})}o("MAWODSProxy").odsBumpEntityKey({entity:o("WAOdsEnums").Entity.EB_SWITCH_STATE,key:"eb_switch."+i+"."+r+"."+a})},n.$MAWCombinedStateManager$p_7=function(t){return t<100?"under_100ms":t<500?"100_to_500ms":t<1e3?"500ms_to_1s":t<5e3?"1s_to_5s":t<1e4?"5s_to_10s":"over_10s"},n.$MAWCombinedStateManager$p_5=function(){this.set(this.$MAWCombinedStateManager$p_1.isEnabled()&&this.$MAWCombinedStateManager$p_2.isEnabled()),this.$MAWCombinedStateManager$p_6()},t})(o("MAWEBEnabledStateManager").MAWEBEnabledStateManager),s=new e(r("MAWEBSwitch"),r("MAWEBLSInWorkerSwitch"));l.MAWCombinedStateManager=e,l.MAWEBCombinedSwitch=s}),98);
__d("WAAppData",[],(function(t,n,r,o,a,i){"use strict";var e=1,l=2;i.EPOCH_STATUS_OPEN=e,i.EPOCH_STATUS_CLOSE=l}),66);
__d("WAArmadilloICDC.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={};s.name="ICDCIdentityList",s.internalSpec={seq:[1,(e=o("WAProtoConst")).TYPES.INT32],timestamp:[2,e.TYPES.INT64],devices:[3,e.FLAGS.REPEATED|e.TYPES.BYTES],signingDeviceIndex:[4,e.TYPES.INT32]},u.name="SignedICDCIdentityList",u.internalSpec={details:[1,e.TYPES.BYTES],signature:[2,e.TYPES.BYTES]},l.ICDCIdentityListSpec=s,l.SignedICDCIdentityListSpec=u}),98);
__d("WAArrayChunk",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n,r){n===void 0&&(n=!1);for(var o=0,a=[];o<e.length;){for(var i=[],l=0;o<e.length;){var s=e[o],u=r?r(s):1;if(!n&&l===0||l+u<=t)l+=u,i.push(s),o++;else{n&&u>t&&o++;break}}i.length>0&&a.push(i)}return a}i.chunk=e}),66);
__d("WACryptoPkcs7",["WACryptoDependencies","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=new Uint8Array(1);do o("WACryptoDependencies").getCrypto().getRandomValues(t);while(t[0]===0);u(e,t[0])}function s(e){var t=new Uint8Array(1);o("WACryptoDependencies").getCrypto().getRandomValues(t),u(e,(t[0]&15)+1)}function u(e,t){for(var n=0;n<t;n++)e.writeUint8(t)}function c(e){if(e.length===0)throw r("err")("unpadPkcs7 given empty bytes");var t=e[e.length-1];if(t>e.length)throw r("err")("unpadPkcs7 given "+e.length+" bytes, but pad is "+t);return new Uint8Array(e.buffer,e.byteOffset,e.length-t)}l.writeRandomPad=e,l.writeRandomPadMax16=s,l.writePad=u,l.unpadPkcs7=c}),98);
__d("WAMsgTransport.pb",["WACommon.pb","WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={NOOP:0,UPSERT:1,DELETE:2,UPSERT_AND_DELETE:3},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={};u.name="MessageTransport",u.internalSpec={payload:[1,(e=o("WAProtoConst")).TYPES.MESSAGE,c],protocol:[2,e.TYPES.MESSAGE,d]},c.name="MessageTransport$Payload",c.internalSpec={applicationPayload:[1,e.TYPES.MESSAGE,o("WACommon.pb").SubProtocolSpec],futureProof:[3,e.TYPES.ENUM,o("WACommon.pb").FUTURE_PROOF_BEHAVIOR]},d.name="MessageTransport$Protocol",d.internalSpec={integral:[1,e.TYPES.MESSAGE,h],ancillary:[2,e.TYPES.MESSAGE,m]},m.name="MessageTransport$Protocol$Ancillary",m.internalSpec={skdm:[2,e.TYPES.MESSAGE,g],deviceListMetadata:[3,e.TYPES.MESSAGE,C],icdc:[4,e.TYPES.MESSAGE,_],backupDirective:[5,e.TYPES.MESSAGE,p]},p.name="MessageTransport$Protocol$Ancillary$BackupDirective",p.internalSpec={messageId:[1,e.TYPES.STRING],actionType:[2,e.TYPES.ENUM,s],supplementalKey:[3,e.TYPES.STRING]},_.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices",_.internalSpec={senderIdentity:[1,e.TYPES.MESSAGE,f],recipientIdentities:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,f],recipientUserJids:[3,e.FLAGS.REPEATED|e.TYPES.STRING]},f.name="MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescription",f.internalSpec={seq:[1,e.TYPES.INT32],signingDevice:[2,e.TYPES.BYTES],unknownDevices:[3,e.FLAGS.REPEATED|e.TYPES.BYTES],unknownDeviceIds:[4,e.FLAGS.REPEATED|e.TYPES.INT32]},g.name="MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessage",g.internalSpec={groupId:[1,e.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,e.TYPES.BYTES]},h.name="MessageTransport$Protocol$Integral",h.internalSpec={padding:[1,e.TYPES.BYTES],dsm:[2,e.TYPES.MESSAGE,y]},y.name="MessageTransport$Protocol$Integral$DeviceSentMessage",y.internalSpec={destinationJid:[1,e.TYPES.STRING],phash:[2,e.TYPES.STRING]},C.name="DeviceListMetadata",C.internalSpec={senderKeyHash:[1,e.TYPES.BYTES],senderTimestamp:[2,e.TYPES.UINT64],recipientKeyHash:[8,e.TYPES.BYTES],recipientTimestamp:[9,e.TYPES.UINT64]},l.MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE=s,l.MessageTransportSpec=u,l.MessageTransport$PayloadSpec=c,l.MessageTransport$ProtocolSpec=d,l.MessageTransport$Protocol$AncillarySpec=m,l.MessageTransport$Protocol$Ancillary$BackupDirectiveSpec=p,l.MessageTransport$Protocol$Ancillary$ICDCParticipantDevicesSpec=_,l.MessageTransport$Protocol$Ancillary$ICDCParticipantDevices$ICDCIdentityListDescriptionSpec=f,l.MessageTransport$Protocol$Ancillary$SenderKeyDistributionMessageSpec=g,l.MessageTransport$Protocol$IntegralSpec=h,l.MessageTransport$Protocol$Integral$DeviceSentMessageSpec=y,l.DeviceListMetadataSpec=C}),98);
__d("WAAsMessageTransport",["WABinary","WACryptoPkcs7","WAJids","WAMsgTransport.pb"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e.type){case"text":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.externalId,supplementalKey:null};case"media":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.externalId,supplementalKey:null};case"reaction":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.originalMsgExternalId,supplementalKey:"reaction:"+o("WAJids").extractChatId__DANGEROUS(e.chatJid)};case"edit":return{actionType:o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE.UPSERT,messageId:e.originalMsgExternalId,supplementalKey:"edit:"+o("WAJids").extractChatId__DANGEROUS(e.chatJid)+":"+(e.timestamp*1e3).toString()}}}function s(e,t,n,r,a,i){i===void 0&&(i=2);var l;t!=null&&(l={destinationJid:t});var s;e!=null&&(s={applicationPayload:{payload:e,version:i}});var u=new(o("WABinary")).Binary;return o("WACryptoPkcs7").writeRandomPadMax16(u),{payload:s,protocol:{integral:{padding:u.readBuffer(),dsm:l},ancillary:{skdm:n==null?void 0:n,icdc:r==null?void 0:r,backupDirective:a==null?void 0:{actionType:a.actionType,messageId:a.messageId,supplementalKey:a.supplementalKey}}}}}l.backupDirectiveActionType=o("WAMsgTransport.pb").MESSAGE_TRANSPORT_PROTOCOL_ANCILLARY_BACKUP_DIRECTIVE_ACTION_TYPE,l.constructBackupDirective=e,l.asMessageTransport=s}),98);
__d("WAConvertRegistrationIdMixin",["WAParsableXmlNode"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WAParsableXmlNode").convertBytesToUint(e.registrationElementValue,4)}l.registrationIdMixin=e}),98);
__d("WAConvertSignedPreKeyMixin",["WAParsableXmlNode"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return{id:o("WAParsableXmlNode").convertBytesToUint(e.skeyIdKeyIDMixin.elementValue,3),pubkey:e.skeyValueKeyDataMixin.elementValue,signature:e.skeySignatureElementValue}}l.convertSignedPreKeyMixin=e}),98);
__d("WASmaxInPreKeysIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInPreKeysIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInPreKeysIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"code",400,499);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFallbackClientMixin=e}),98);
__d("WASmaxInPreKeysIQErrorNoValidJIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","not-acceptable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",406);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorNoValidJIDMixin=e}),98);
__d("WASmaxInPreKeysRequestErrorsFetch",["WAResultOrError","WASmaxInPreKeysIQErrorBadRequestMixin","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNoValidJIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInPreKeysIQErrorNoValidJIDMixin").parseIQErrorNoValidJIDMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"IQErrorNoValidJID",value:n.value});var r=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return r.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorNoValidJID","IQErrorFallbackClient"],[t,n,r])}l.parseRequestErrorsFetch=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetch","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrorsFetch").parseRequestErrorsFetch(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrorsFetch:i.value})):i}l.parseFetchKeyBundlesResponseRequestError=e}),98);
__d("WASmaxInPreKeysIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"code",500,599);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFallbackServerMixin=e}),98);
__d("WASmaxInPreKeysIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","service-unavailable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",503);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorServiceUnavailableMixin=e}),98);
__d("WASmaxInPreKeysServerErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackServerMixin","WASmaxInPreKeysIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:t.value});var n=o("WASmaxInPreKeysIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorServiceUnavailable","IQErrorFallbackServer"],[t,n])}l.parseServerErrors=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseFetchKeyBundlesResponseServerError=e}),98);
__d("WASmaxInPreKeysEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e,s={validators:[(e=o("WAJids")).validateDeviceJid,e.validateDeviceJid],typeName:"DeviceJid|DeviceJid"},u={validators:[e.validateDeviceJid,e.validateDeviceJid,e.validateInteropDeviceJid,e.validateInteropDeviceJid],typeName:"DeviceJid|DeviceJid|InteropDeviceJid|InteropDeviceJid"},c={validators:[e.validateDeviceJid,e.validateDomainJid],typeName:"DeviceJid|DomainJid"},d={validators:[e.validateUserJid,e.validateUserJid],typeName:"UserJid|UserJid"};l.DEVICEJID_DEVICEJID=s,l.DEVICEJID_DEVICEJID_INTEROPDEVICEJID_INTEROPDEVICEJID=u,l.DEVICEJID_DOMAINJID=c,l.USERJID_USERJID=d}),98);
__d("WASmaxInPreKeysIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInPreKeysResponsePaddingMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"iq");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"padding");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(n.value,0,524288);return r.success?o("WAResultOrError").makeResult({paddingElementValue:r.value}):r}l.parseResponsePaddingMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(n.value,"text");if(!r.success)return r;var a=o("WASmaxParseUtils").attrIntRange(n.value,"code",500,599);return a.success?o("WAResultOrError").makeResult({errorText:r.value,errorCode:a.value}):a}l.parseFetchKeyBundlesUserErrorFallbackMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(n.value,"text");if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,n.value,"code",500);return a.success?o("WAResultOrError").makeResult({errorText:r.value,errorCode:a.value}):a}l.parseFetchKeyBundlesUserErrorMixin=e}),98);
__d("WASmaxInPreKeysDeviceIdentityMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"device-identity");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytes(t.value);return n.success?o("WAResultOrError").makeResult({deviceIdentityElementValue:n.value}):n}l.parseDeviceIdentityMixin=e}),98);
__d("WASmaxInPreKeysKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").contentBytesRange(e,32,32);return t.success?o("WAResultOrError").makeResult({elementValue:t.value}):t}l.parseKeyDataMixin=e}),98);
__d("WASmaxInPreKeysIdentityKeyMixin",["WASmaxInPreKeysKeyDataMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"identity");if(!t.success)return t;var n=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(t.value);return n.success,n}l.parseIdentityKeyMixin=e}),98);
__d("WASmaxInPreKeysKeyTypeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"type");if(!t.success)return t;var n=o("WASmaxParseUtils").contentLiteralBytes(t.value,new Uint8Array([5]));return n.success?o("WAResultOrError").makeResult({typeElementValue:n.value}):n}l.parseKeyTypeMixin=e}),98);
__d("WASmaxInPreKeysKeyIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"id");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(e,3,3);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}l.parseKeyIDMixin=e}),98);
__d("WASmaxInPreKeysPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"key");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"id");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"value");if(!r.success)return r;var a=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(n.value);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(r.value);return i.success?o("WAResultOrError").makeResult({keyIdKeyIDMixin:a.value,keyValueKeyDataMixin:i.value}):i}l.parsePreKeyMixin=e}),98);
__d("WASmaxInPreKeysRegistrationIDMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"registration");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(t.value,4,4);return n.success?o("WAResultOrError").makeResult({registrationElementValue:n.value}):n}l.parseRegistrationIDMixin=e}),98);
__d("WASmaxInPreKeysSignedPreKeyMixin",["WAResultOrError","WASmaxInPreKeysKeyDataMixin","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"skey");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"id");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"value");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"signature");if(!a.success)return a;var i=o("WASmaxParseUtils").contentBytesRange(a.value,64,64);if(!i.success)return i;var l=o("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(n.value);if(!l.success)return l;var s=o("WASmaxInPreKeysKeyDataMixin").parseKeyDataMixin(r.value);return s.success?o("WAResultOrError").makeResult({skeySignatureElementValue:i.value,skeyIdKeyIDMixin:l.value,skeyValueKeyDataMixin:s.value}):s}l.parseSignedPreKeyMixin=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin",["WAResultOrError","WASmaxInPreKeysDeviceIdentityMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysPreKeyMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"t",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").optionalLiteral(o("WASmaxParseUtils").attrString,e,"is_cloud_api","true");if(!r.success)return r;var a=o("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(e);if(!a.success)return a;var i=o("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(e),l=o("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(e);if(!l.success)return l;var s=o("WASmaxInPreKeysPreKeyMixin").parsePreKeyMixin(e),u=o("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(e);if(!u.success)return u;var c=o("WASmaxInPreKeysDeviceIdentityMixin").parseDeviceIdentityMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({t:n.value,isCloudApi:r.value},a.value,{keyTypeMixin:i.success?i.value:null},l.value,{preKeyMixin:s.success?s.value:null},u.value,{deviceIdentityMixin:c.success?c.value:null}))}l.parseFetchKeyBundlesUserSuccessMixin=e}),98);
__d("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup",["WAResultOrError","WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin","WASmaxInPreKeysFetchKeyBundlesUserErrorMixin","WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysFetchKeyBundlesUserSuccessMixin").parseFetchKeyBundlesUserSuccessMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserSuccess",value:t.value});var n=o("WASmaxInPreKeysFetchKeyBundlesUserErrorMixin").parseFetchKeyBundlesUserErrorMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserError",value:n.value});var r=o("WASmaxInPreKeysFetchKeyBundlesUserErrorFallbackMixin").parseFetchKeyBundlesUserErrorFallbackMixin(e);return r.success?o("WAResultOrError").makeResult({name:"FetchKeyBundlesUserErrorFallback",value:r.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["UserSuccess","UserError","UserErrorFallback"],[t,n,r])}l.parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup=e}),98);
__d("WASmaxInPreKeysFetchKeyBundlesResponseSuccess",["WAResultOrError","WASmaxInPreKeysEnums","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysResponsePaddingMixin","WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseJid").attrJidEnum(e,"jid",o("WASmaxInPreKeysEnums").DEVICEJID_DEVICEJID);if(!n.success)return n;var r=o("WASmaxInPreKeysUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup").parseUserFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup(e);return r.success?o("WAResultOrError").makeResult({jid:n.value,userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup:r.value}):r}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"list");if(!a.success)return a;var i=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxInPreKeysResponsePaddingMixin").parseResponsePaddingMixin(t),s=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"user",0,1e5,e);return s.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{responsePaddingMixin:l.success?l.value:null,listUser:s.value})):s}l.parseFetchKeyBundlesResponseSuccessListUser=e,l.parseFetchKeyBundlesResponseSuccess=s}),98);
__d("WASmaxAttrs",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return t==null?o("WAWap").DROP_ATTR:e(t)}function s(e,t){return t?e:o("WAWap").DROP_ATTR}l.OPTIONAL=e,l.OPTIONAL_LITERAL=s}),98);
__d("WASmaxChildren",["WADeepEquals"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return t==null?null:e(t)}function s(e,t){if(t==null)return null;if(t)return e()}function u(e,t){if(t){for(var n=1;n<t.length;n++)if(!o("WADeepEquals").deepEqual(t[n],t[0]))throw new Error("expected all homogeneous children to be equal, but they were not")}var r=d(e,t,0,1/0);return r}function c(e,t){return m(e,t,0,1/0)}function d(e,t,n,r){if(t==null){if(n>0)throw new Error("expected at least "+n+" children, but none provided");return[]}var o=t.length;if(o<n)throw new Error("expected at least "+n+" children, but found "+o);if(o>r)throw new Error("expected at most "+r+" children, but found "+o);return t.map(function(t){return e(t)})}function m(e,t,n,r){if(t===0){if(n>0)throw new Error("expected at least "+n+" children, but none provided");return[]}if(t<n)throw new Error("expected at least "+n+" children, but found "+t);if(t>r)throw new Error("expected at most "+r+" children, but found "+t);for(var o=[],a=0;a<t;a++)o.push(e());return o}l.OPTIONAL_CHILD=e,l.HAS_OPTIONAL_CHILD=s,l.HOMOGENEOUS_CHILD=u,l.HOMOGENEOUS_CHILD_COUNT=c,l.REPEATED_CHILD=d,l.REPEATED_CHILD_COUNT=m}),98);
__d("WASmaxOutPreKeysClientRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),xmlns:"encrypt",to:o("WAWap").S_WHATSAPP_NET});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeClientRequestMixin=s}),98);
__d("WASmaxOutPreKeysFetchKeyBundlesRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=e.hasUserReasonIdentity,r=o("WASmaxJsx").smax("user",{jid:o("WAWap").JID(t),reason:o("WASmaxAttrs").OPTIONAL_LITERAL("identity",n)});return r}function s(t){var n=t.userArgs,r=o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"get"},o("WASmaxJsx").smax("key",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,1e5))));return r}l.makeFetchKeyBundlesRequestKeyUser=e,l.makeFetchKeyBundlesRequest=s}),98);
__d("WASmaxParsingFailure",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(t){var n;return n=e.call(this,"SmaxParsingFailure: "+t)||this,n.name="SmaxParsingFailure",n.reason=t,n}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"SmaxParsingFailure: "+this.reason},t})(babelHelpers.wrapNativeSuper(Error));i.SmaxParsingFailure=e}),66);
__d("WASmaxRpcUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){var n=Object.keys(t).map(function(e){var n=e==="Request"?"<request>":'<response name="'+e+'">';return"Tried "+n+", but failed with "+t[e].error+"."}).join(" ");return'Failed to parse incoming stanza of <rpc name="'+e+'">. '+n}i.errorMessageRpcParsing=e}),66);
__d("WASmaxPreKeysFetchKeyBundlesRPC",["WAComms","WASmaxInPreKeysFetchKeyBundlesResponseRequestError","WASmaxInPreKeysFetchKeyBundlesResponseServerError","WASmaxInPreKeysFetchKeyBundlesResponseSuccess","WASmaxOutPreKeysFetchKeyBundlesRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutPreKeysFetchKeyBundlesRequest").makeFetchKeyBundlesRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInPreKeysFetchKeyBundlesResponseSuccess").parseFetchKeyBundlesResponseSuccess(r,n);if(a.success)return{name:"FetchKeyBundlesResponseSuccess",value:a.value};var i=o("WASmaxInPreKeysFetchKeyBundlesResponseRequestError").parseFetchKeyBundlesResponseRequestError(r,n);if(i.success)return{name:"FetchKeyBundlesResponseRequestError",value:i.value};var l=o("WASmaxInPreKeysFetchKeyBundlesResponseServerError").parseFetchKeyBundlesResponseServerError(r,n);if(l.success)return{name:"FetchKeyBundlesResponseServerError",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchKeyBundles",{Success:a,RequestError:i,ServerError:l}))}),s.apply(this,arguments)}l.sendFetchKeyBundlesRPC=e}),98);
__d("WAFetchPreKeyBundlesProtocol",["WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchKeyBundlesRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["fetchPreKeyBundlesProtocol"]);function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){d.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start fetching prekey of ","..."])),t.join(", "));var n=yield o("WASmaxPreKeysFetchKeyBundlesRPC").sendFetchKeyBundlesRPC({userArgs:t.map(function(e){return{userJid:e,hasUserReasonIdentity:!1}})});switch(n.name){case"FetchKeyBundlesResponseSuccess":{d.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["fetched prekey successfully"])));var r=new Map;return n.value.listUser.map(function(e){var t=e.userFetchKeyBundlesSuccessOrFetchKeyBundlesErrorOrFetchKeyBundlesErrorFallbackMixinGroup;t.name==="FetchKeyBundlesUserSuccess"&&r.set(e.jid,_(t.value))}),o("WAResultOrError").makeResult(r)}case"FetchKeyBundlesResponseServerError":{var a=n.value.errorServerErrors.name;return d.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ServerError: ",""])),a),o("WAResultOrError").makeError({type:"server-error",payload:a})}case"FetchKeyBundlesResponseRequestError":{var i=n.value.errorRequestErrorsFetch.name;return d.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["RequestError: ",""])),i),o("WAResultOrError").makeError({type:"request-error",payload:i})}}}),p.apply(this,arguments)}function _(e){var t=o("WAConvertRegistrationIdMixin").registrationIdMixin(e),n=o("WASignalKeys").serializeIdentity(e.elementValue),r=o("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(e),a=e.preKeyMixin?f(e.preKeyMixin):null,i=o("WATimeUtils").castToUnixTime(e.t||0);return{keys:{regId:t,identity:n,oneTimeKey:a,signedKey:{id:r.id,signature:r.signature,publicKey:o("WASignalKeys").serializeIdentity(r.pubkey)}},timestamp:i}}function f(e){return{id:o("WAParsableXmlNode").convertBytesToUint(e.keyIdKeyIDMixin.elementValue,3),publicKey:o("WASignalKeys").serializeIdentity(e.keyValueKeyDataMixin.elementValue)}}l.fetchPreKeyBundlesProtocol=m}),98);
__d("WABulkRequestKeys",["WAFetchPreKeyBundlesProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAFetchPreKeyBundlesProtocol").fetchPreKeyBundlesProtocol(e);return t.success?o("WAResultOrError").makeResult(t.value):o("WAResultOrError").makeError("errRequestKeysParsingFailed")}),s.apply(this,arguments)}l.bulkRequestKeys=e}),98);
__d("WALock",["Promise","WAResolvable","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return{lock:function(a,i){var r=new(o("WAResolvable")).Resolvable,l=a.map(function(e){return[e,new(o("WAResolvable")).Resolvable]});return(s||(s=n("Promise"))).all(l.map(function(e){var n=e[0],o=e[1];return t.enqueue(n,function(){return o.resolve(),r.promise})})).catch(function(){o("WATagsLogger").TAGS(["WALock"]).ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Lock failed for ",""])),a)}),s.all(l.map(function(e){var t=e[0],n=e[1];return n.promise})).then(function(){return i()}).finally(function(){r.resolve()})},wait:function(n){return t.wait(n)}}}l.makeLock=u}),98);
__d("WALockMap",["WALock","WAPromiseQueue"],(function(t,n,r,o,a,i,l){"use strict";function e(e){e===void 0&&(e=-1);var t=new(o("WAPromiseQueue")).PromiseQueueMap(e);return o("WALock").makeLock(t)}l.makeLockMap=e}),98);
__d("WACryptoCurveConstants",[],(function(t,n,r,o,a,i){"use strict";var e=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),l=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),s=BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),u=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),c=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989");i.P=e,i.I=l,i.D=s,i.A=u,i.L=c}),66);
__d("WACryptoCurveEncoding",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){for(var t=BigInt(0),n=0;n<e.length;n++)t|=BigInt(e[n])<<BigInt(8)*BigInt(n);return t}function s(e){for(var t=new Uint8Array(32),n=e,r=0;r<32;r++)t[r]=Number(n&BigInt(255)),n>>=BigInt(8);return t}function u(e){if(e.length%2)throw r("err")("hexToU8: odd string length");for(var t=new Uint8Array(e.length/2),n=0;n<t.length;n++)t[n]=parseInt(e.slice(2*n,2*n+2),16);return t}l.bytesToBigIntLE=e,l.bigIntTo32LE=s,l.hexToU8=u}),98);
__d("WACryptoCurveTransformations",["WACryptoCurveConstants","WACryptoCurveEncoding","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return(e%o("WACryptoCurveConstants").P+o("WACryptoCurveConstants").P)%o("WACryptoCurveConstants").P}function s(e){return u(e,o("WACryptoCurveConstants").P-BigInt(2))}function u(t,n){for(var r=e(t),o=n,a=BigInt(1);o>BigInt(0);)o&BigInt(1)&&(a=e(a*r)),r=e(r*r),o>>=BigInt(1);return a}function c(t,n){var a=e(t*s(n)),i=u(a,o("WACryptoCurveConstants").P+BigInt(3)>>BigInt(3)),l=e(i*i);if(l!==a&&(i=e(i*o("WACryptoCurveConstants").I),l=e(i*i),l!==a))throw r("err")("Montgomery u is on the twist (no sqrt for v)");return i}function d(t){var n=e(o("WACryptoCurveEncoding").bytesToBigIntLE(t));if(n===o("WACryptoCurveConstants").P-BigInt(1))throw r("err")("u == -1 (mod p): cannot convert");var a=e(e(n-BigInt(1))*s(e(n+BigInt(1))));return o("WACryptoCurveEncoding").bigIntTo32LE(a)}function m(t,n){return{X:t,Y:n,Z:BigInt(1),T:e(t*n)}}function p(t){var n=e(t.x),o=e(t.y),a=e(BigInt(1)-o);if(a===BigInt(0))throw r("err")("y == 1: map undefined");var i=e((BigInt(1)+o)*s(a)),l=n===BigInt(0)?void 0:e(i*s(n));return{u:i,v:l}}function _(e){var t=e.x,n=e.y,r=o("WACryptoCurveEncoding").bigIntTo32LE(n),a=(t&BigInt(1))===BigInt(1)?128:0;return r[31]|=a,r}function f(t){if(!(t instanceof Uint8Array)||t.length!==32)throw r("err")("Compressed Ed25519 key is not 32 bytes");var n=t[31],a=(n&128)!==0,i=t.slice();i[31]&=127;var l=e(o("WACryptoCurveEncoding").bytesToBigIntLE(i)),s=e(l*l),u=e(s-BigInt(1)),d=e(o("WACryptoCurveConstants").D*s+BigInt(1)),m=c(u,d);if((m&BigInt(1))!==(a?BigInt(1):BigInt(0))&&(m=e(-m)),m===BigInt(0)&&a)throw r("err")("Error during decompression of Ed25519: x coord is 0 but sign bit set");return{x:m,y:l}}l.mod=e,l.toEdwardsCompressed=d,l.affineToExtended=m,l.fromAffineToMontgomeryUV=p,l.compressEd25519=_,l.decompressEd25519=f}),98);
__d("WACryptoCurveEd25519PointOps",["WACryptoCurveConstants","WACryptoCurveTransformations","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){var n,r=e.T,a=e.X,i=e.Y,l=e.Z,s=t.T,u=t.X,c=t.Y,d=t.Z,m=(n=o("WACryptoCurveTransformations")).mod(a*u),p=n.mod(i*c),_=n.mod(r*o("WACryptoCurveConstants").D*s),f=n.mod(l*d),g=n.mod((a+i)*(u+c)-m-p),h=n.mod(f-_),y=n.mod(f+_),C=n.mod(p-o("WACryptoCurveConstants").A*m),b=n.mod(g*h),v=n.mod(y*C),S=n.mod(h*y),R=n.mod(g*C);return{X:b,Y:v,Z:S,T:R}}function s(e){var t,n=e.X,r=e.Y,a=e.Z,i=(t=o("WACryptoCurveTransformations")).mod(n*n),l=t.mod(r*r),s=t.mod(BigInt(2)*t.mod(a*a)),u=t.mod(o("WACryptoCurveConstants").A*i),c=n+r,d=t.mod(t.mod(c*c)-i-l),m=t.mod(u+l),p=t.mod(m-s),_=t.mod(u-l);return{X:t.mod(d*p),Y:t.mod(m*_),Z:t.mod(p*m),T:t.mod(d*_)}}function u(e,t){var n,r=e.X,a=e.Y,i=e.Z,l=t.X,s=t.Y,u=t.Z,c=(n=o("WACryptoCurveTransformations")).mod(r*u),d=n.mod(l*i),m=n.mod(a*u),p=n.mod(s*i);return c===d&&m===p}function c(t,n){for(var r={X:BigInt(0),Y:BigInt(1),Z:BigInt(1),T:BigInt(0)},o=t,a=n;a>BigInt(0);)a&BigInt(1)&&(r=e(r,o)),o=s(o),a>>=BigInt(1);return r}function d(e){var t,n=e.T,a=e.X,i=e.Y,l=e.Z,s=(t=o("WACryptoCurveTransformations")).mod(a*a),u=t.mod(i*i),c=t.mod(l*l),d=t.mod(c*c),m=t.mod(s*o("WACryptoCurveConstants").A),p=t.mod(c*t.mod(m+u)),_=t.mod(d+t.mod(o("WACryptoCurveConstants").D*t.mod(s*u)));if(p!==_)throw r("err")("bad point: equation left != right (1)");var f=o("WACryptoCurveTransformations").mod(a*i),g=o("WACryptoCurveTransformations").mod(l*n);if(f!==g)throw r("err")("bad point: equation left != right (2)");return!0}l.addPoints=e,l.doublePoint=s,l.equalPoints=u,l.scalarMult=c,l.isPointValid=d}),98);
__d("WACryptoCurveKeyCanonicalCheck",["WACryptoCurveConstants","WACryptoCurveEd25519PointOps","WACryptoCurveEncoding","WACryptoCurveTransformations"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("WACryptoCurveEd25519PointOps").equalPoints(e,{X:BigInt(0),Y:BigInt(1),Z:BigInt(1),T:BigInt(0)})}function s(e){var t=o("WACryptoCurveEncoding").bytesToBigIntLE(e);return t<o("WACryptoCurveConstants").P}function u(t){try{var n=o("WACryptoCurveTransformations").toEdwardsCompressed(t),r=o("WACryptoCurveTransformations").decompressEd25519(n),a=r.x,i=r.y,l=o("WACryptoCurveTransformations").affineToExtended(a,i),s=o("WACryptoCurveEd25519PointOps").scalarMult(l,o("WACryptoCurveConstants").L);return e(s)}catch(e){return!1}}function c(e){return u(e)&&s(e)}l.isIdentity=e,l.isInRange=s,l.isTorsionFree=u,l.isCanonical=c}),98);
__d("WACryptoLibraryConfig",[],(function(t,n,r,o,a,i){"use strict";var e={signalFutureMessagesMax:2e3,S508658AutoAcknowledgeStaleSessions:!1,baseKeyCanonicalCheck:!1};function l(){return e}function s(t){e=t}i.getCryptoLibraryConfig=l,i.setCryptoLibraryConfig=s}),66);
__d("WASignalSessions",["WABinary","WACryptoLibraryConfig","WASignalKeys","WASignalOther","err"],(function(t,n,r,o,a,i,l){"use strict";var e=3;function s(e){return!o("WACryptoLibraryConfig").getCryptoLibraryConfig().S508658AutoAcknowledgeStaleSessions||e.initialExchangeInfo==null?e:y(e.local,e.remote,e.rootKey,e.recvChains,e.sendChain,null,e.prevSendChainHighestIndex,e.prevSessions,e.aliceBaseKey)}function u(e,t){return c(e,0,t,[])}function c(e,t,n,r){return{ratchetPubKey:e,nextMsgIndex:t,chainKey:n,unusedMsgKeys:r}}function d(e,t){return m(e,0,t)}function m(e,t,n){return{ratchetKey:e,nextMsgIndex:t,chainKey:n}}function p(e,t,n){return{remoteOneTimeId:e,remoteSignedId:t,localOneTimePubKey:n}}function _(e,t){return y(e.local,e.remote,e.rootKey,e.recvChains,e.sendChain,e.initialExchangeInfo,e.prevSendChainHighestIndex,t,e.aliceBaseKey)}function f(e,t,n){return y(e.local,e.remote,e.rootKey,t,n,e.initialExchangeInfo,e.prevSendChainHighestIndex,e.prevSessions,e.aliceBaseKey)}function g(e,t,n,r){return n===void 0&&(n=e.sendChain),y(e.local,e.remote,r,t,n,null,Math.max(e.sendChain.nextMsgIndex-1,0),e.prevSessions,e.aliceBaseKey)}function h(e,t,n,r,o,a,i){return y(e,t,n,r,o,a,0,[],i)}function y(e,t,n,r,o,a,i,l,s){return{local:e,remote:t,rootKey:n,sendChain:o,recvChains:r,initialExchangeInfo:a,prevSendChainHighestIndex:i,prevSessions:l,aliceBaseKey:s}}function C(e,t){var n=new(o("WABinary")).Binary(t),r=o("WASignalOther").readBytes(n,32),a=o("WASignalOther").readBytes(n,32),i=o("WASignalOther").readBytes(n,16);return b(e,r,a,i)}function b(e,t,n,r){return{index:e,cipherKey:t,macKey:n,iv:r}}function v(e){return{senderRatchetKey:e.ratchetPubKey,chainKey:{index:e.nextMsgIndex,key:e.chainKey},messageKeys:e.unusedMsgKeys}}function S(e){var t=e.ratchetKey;return{senderRatchetKey:t.serializedPubKey,senderRatchetKeyPrivate:t.privateKey,chainKey:{index:e.nextMsgIndex,key:e.chainKey}}}function R(t){var n=t.initialExchangeInfo,r=t.local,o=t.remote,a=void 0;if(n){var i=n.remoteOneTimeId;a={preKeyId:i!=null?i:void 0,signedPreKeyId:n.remoteSignedId,baseKey:n.localOneTimePubKey}}return{currentSession:{sessionVersion:e,localIdentityPublic:r.pubKey,remoteIdentityPublic:o.pubKey,rootKey:t.rootKey,previousCounter:t.prevSendChainHighestIndex,senderChain:S(t.sendChain),receiverChains:t.recvChains.map(v),pendingPreKey:a,remoteRegistrationId:o.regId,localRegistrationId:r.regId,aliceBaseKey:t.aliceBaseKey},previousSessions:t.prevSessions}}function L(t){var n=t.initialExchangeInfo,r=t.local,a=t.remote,i=t.sendChain,l=void 0;if(n){var s=n.remoteOneTimeId;l={preKeyId:s!=null?s:void 0,signedPreKeyId:n.remoteSignedId,baseKey:o("WASignalOther").toBuffer(n.localOneTimePubKey)}}return{sessionVersion:e,localIdentityPublic:o("WASignalOther").toBuffer(r.pubKey),remoteIdentityPublic:o("WASignalOther").toBuffer(a.pubKey),rootKey:o("WASignalOther").toBuffer(t.rootKey),previousCounter:t.prevSendChainHighestIndex,senderChain:{senderRatchetKey:o("WASignalOther").toBuffer(i.ratchetKey.serializedPubKey),senderRatchetKeyPrivate:o("WASignalOther").toBuffer(i.ratchetKey.privateKey),chainKey:{index:i.nextMsgIndex,key:o("WASignalOther").toBuffer(i.chainKey)},messageKeys:[]},receiverChains:t.recvChains.map(function(e){return{senderRatchetKey:o("WASignalOther").toBuffer(e.ratchetPubKey),chainKey:{index:e.nextMsgIndex,key:o("WASignalOther").toBuffer(e.chainKey)},messageKeys:e.unusedMsgKeys.map(function(e){return{index:e.index,cipherKey:o("WASignalOther").toBuffer(e.cipherKey),macKey:o("WASignalOther").toBuffer(e.macKey),iv:o("WASignalOther").toBuffer(e.iv)}})}}),pendingPreKey:l,remoteRegistrationId:a.regId,localRegistrationId:r.regId,aliceBaseKey:t.aliceBaseKey==null?void 0:o("WASignalOther").toBuffer(t.aliceBaseKey)}}function E(e){var t=$(e.currentSession,"currentSession");return I(t,e.previousSessions)}function k(e){return I(e,[])}function I(t,n){var a=$(t.sessionVersion,"sessionVersion");if(a!==e)throw r("err")("Signal: bad session version "+a);var i=$(t.senderChain,"senderChain"),l=$(i.chainKey,"senderChain.chainKey"),s=m(o("WASignalKeys").makeSerializedKeyPairFrom(x(i.senderRatchetKeyPrivate,32,"senderRatchetKeyPrivate"),D(i.senderRatchetKey,"senderRatchetKey")),$(l.index,"senderChain.chainKey.index"),x(l.key,32,"senderChain.chainKey.key")),u=$(t.receiverChains,"receiverChains").map(function(e){var t=$(e.chainKey,"receiverChains[].chainKey");return c(D(e.senderRatchetKey,"receiverChains[].senderRatchetKey"),$(t.index,"receiverChains[].chainKey.index"),x(t.key,32,"receiverChains[].chainKey.key"),T(e.messageKeys))}),d={regId:o("WASignalOther").castRegistrationId($(t.localRegistrationId,"localRegistrationId")),pubKey:D(t.localIdentityPublic,"localIdentityPublic")},_={regId:o("WASignalOther").castRegistrationId($(t.remoteRegistrationId,"remoteRegistrationId")),pubKey:D(t.remoteIdentityPublic,"remoteIdentityPublic")},f=t.pendingPreKey,g=null;if(f){var h=f.preKeyId;g=p(h!=null?o("WASignalKeys").castToPreKeyId(h):null,o("WASignalKeys").castToSignedPreKeyId($(f.signedPreKeyId,"pendingPreKey.signedPreKeyId")),D(f.baseKey,"pendingPreKey.baseKey"))}var C=t.aliceBaseKey==null?null:D(t.aliceBaseKey,"aliceBaseKey");return y(d,_,x(t.rootKey,32,"rootKey"),u,s,g,t.previousCounter||0,n,C)}function T(e){return e.map(function(e){return{index:$(e.index,"messageKeys[].index"),cipherKey:x(e.cipherKey,32,"messageKeys[].cipherKey"),macKey:x(e.macKey,32,"messageKeys[].macKey"),iv:x(e.iv,16,"messageKeys[].iv")}})}function D(e,t){return o("WASignalKeys").castToSerializedPubKey(new Uint8Array($(e,t)))}function x(e,t,n){return o("WASignalOther").toBytes($(e,n),t)}function $(e,t){if(e==null)throw r("err")("Signal: protobuf is missing "+t);return e}l.FORMAT_VERSION=e,l.maybeClearPendingPreKey=s,l.makeFreshRecvChain=u,l.makeRecvChain=c,l.makeFreshSendChain=d,l.makeSendChain=m,l.makeInitialExchangeInfo=p,l.setPrevSessions=_,l.updateChains=f,l.ratchetSession=g,l.makeFreshSession=h,l.makeSession=y,l.splitMsgKey=C,l.serializeSession=R,l.detachSession=L,l.parseSessionFromRecord=E,l.parseSession=k,l._parseSession=I,l.bytesOrThrow=x,l.definedOrThrow=$}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){var n=e;e=[];try{return t()}finally{(e!=null?e:[]).forEach(function(e){return void e.fill(0)}),e=n}}function u(t,n){if(e==null)throw r("err")("allocate called outside of active scope");return new t(n)}function c(e,t,n){o("WACryptoPrimitives").lowlevel.crypto_hash(e,t,n)}function d(e,t){for(var n=0;n<64;++n)t[n]=e[n],e[n]=0;_(e,t),t.fill(0)}function m(e,t){var n=[p(),p(),p(),p()];o("WACryptoPrimitives").lowlevel.scalarbase(n,t),j(e,n)}function p(e){var t=u(Float64Array,16);if(e){if(e.length>16)throw r("err")("Incorrect initialiser array provided to the fieldElement");for(var n=0;n<e.length;n++)t[n]=e[n]}return t}function _(e,t){o("WACryptoPrimitives").lowlevel.modL(e,t)}var f=function(){return p([0])},g=function(){return p([1])},h=function(){return p([2])},y=function(){return p([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function C(){return[p(),p(),p(),p()]}function b(){return[p(),p(),p(),p()]}function v(){return[p(),p(),p()]}function S(e,t){for(var n=0,r=t;r>0;){var o=r%65536;e[n]=o,r=(r-o)/65536,n++}}function R(e,t){return Q(e,t)?0:1}function L(e){var t=o("WACryptoPrimitives").lowlevel.pack25519,n=u(Uint8Array,32);return t(n,e),n[0]&1}function E(e,t){var n=o("WACryptoPrimitives").lowlevel.M,r=o("WACryptoPrimitives").lowlevel.S,a=h(),i=p();r(i,t),n(e,a,i)}function k(e,t){var n=o("WACryptoPrimitives").lowlevel.A,r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.S,i=f(),l=g(),s=p(),u=p(),c=p(),d=p();S(i,486662),a(s,t),r(u,i,t),n(c,s,u),n(d,c,l),r(e,t,d)}function I(e,t,n){n===1&&e.set(t)}var T=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function D(e,t){var n,r=(n=o("WACryptoPrimitives")).lowlevel.M,a=n.lowlevel.S,i=n.lowlevel.pow2523,l=n.lowlevel.unpack25519,s=p();l(s,T);var u=p();i(u,t);var c=p();r(c,t,u);var d=p();a(d,c);var m=p();r(m,c,s),I(c,m,1^R(d,t)),e.set(c)}function x(e,t){var n=o("WACryptoPrimitives").lowlevel.A,r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.Z,i=g(),l=p(),s=p(),u=p();a(l,t,i),n(s,t,i),K(u,s),r(e,l,u)}function $(e,t){var n=o("WACryptoPrimitives").lowlevel.Z,r=f();n(e,r,t)}function P(e,t){var n=o("WACryptoPrimitives").lowlevel.M;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3])}function N(e,t){var n=o("WACryptoPrimitives").lowlevel.M;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3]),n(e[3],t[0],t[1])}function M(e,t){var n=o("WACryptoPrimitives").lowlevel.A,r=o("WACryptoPrimitives").lowlevel.S,a=o("WACryptoPrimitives").lowlevel.Z;r(e[0],t[0]),r(e[2],t[1]),E(e[3],t[2]),n(e[1],t[0],t[1]);var i=p();r(i,e[1]),n(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],i,e[1]),a(e[3],e[3],e[2])}var w=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function A(e,t,n){var r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.unpack25519,i=p();a(i,w);var l=p();x(l,t);var s=p();k(s,t);var u=p();D(u,s);var c=p();r(c,t,i);var d=p();K(d,u);var m=p();r(m,c,d);var _=p();$(_,m),I(m,_,L(m)^n),e[0].set(m),e[1].set(l),e[2].set(g()),r(e[3],e[0],e[1])}function F(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])}function O(e,t){var n=v();F(n,t),M(e,n)}function B(e,t){var n=b(),r=v();O(n,t),P(r,n),M(n,r),P(r,n),M(n,r),N(e,n)}function W(e){var t,n=(t=o("WACryptoPrimitives")).lowlevel.M,r=t.lowlevel.S,a=t.lowlevel.pack25519,i=t.lowlevel.pow2523,l=p(),s=p(),u=p(),c=p(),d=p();i(l,e),r(s,l),r(u,s),n(c,u,e),n(d,c,e);var m=new Uint8Array(32);return a(m,d),1&m[31]}function q(e,t){$(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),$(e[3],t[3])}function U(e,t){var n=C(),r=X(n,t);return r!==0?-1:(q(e,n),0)}function V(e,t){var n=o("WACryptoPrimitives").lowlevel.A,r=o("WACryptoPrimitives").lowlevel.M,a=t,i=g(),l=f();S(l,486662);var s=p();E(s,a);var u=p();n(u,s,i);var c=p();K(c,u);var d=p();r(d,c,l);var m=p();$(m,d);var _=p();k(_,m);var h=W(_),y=p([0]);I(y,l,h);var C=p();n(C,m,y);var b=p();$(b,C),I(C,b,h),e.set(C)}function H(e){var t=o("WACryptoPrimitives").lowlevel.unpack25519,n=o("WACryptoPrimitives").hash(e),r=(n[31]&128)>>7;n[31]&=127;var a=p();t(a,n);var i=p();G(i,a);var l=C();A(l,i,r);var s=C();return B(s,l),s}function G(e,t){return s(function(){return V(e,t)})}function z(e){return s(function(){return H(e)})}function j(e,t){var n=p(),r=p(),a=p(),i=o("WACryptoPrimitives").lowlevel.M,l=o("WACryptoPrimitives").lowlevel.pack25519;K(a,t[2]),i(n,t[0],a),i(r,t[1],a),l(e,r);var s=new Uint8Array(32);l(s,n),e[31]^=(s[0]&1)<<7}function K(e,t){var n=p();n.set(t);for(var r=o("WACryptoPrimitives").lowlevel.M,a=o("WACryptoPrimitives").lowlevel.S,i=253;i>=0;--i)a(n,n),i!==2&&i!==4&&r(n,n,t);e.set(n)}function Q(e,t){var n=o("WACryptoPrimitives").lowlevel.crypto_verify_32,r=o("WACryptoPrimitives").lowlevel.pack25519,a=new Uint8Array(32),i=new Uint8Array(32);return r(a,e),r(i,t),n(a,0,i,0)}function X(e,t){var n,r=(n=o("WACryptoPrimitives")).lowlevel.A,a=n.lowlevel.D,i=n.lowlevel.M,l=n.lowlevel.S,s=n.lowlevel.Z,u=n.lowlevel.pow2523,c=n.lowlevel.set25519,d=n.lowlevel.unpack25519,m=p(),_=p(),h=p(),C=p(),b=p(),v=p(),S=p();return c(e[2],g()),d(e[1],t),l(h,e[1]),i(C,h,a),s(h,h,e[2]),r(C,e[2],C),l(b,C),l(v,b),i(S,v,b),i(m,S,h),i(m,m,C),u(m,m),i(m,m,h),i(m,m,C),i(m,m,C),i(e[0],m,C),l(_,e[0]),i(_,_,C),Q(_,h)&&i(e[0],e[0],y()),l(_,e[0]),i(_,_,C),Q(_,h)?-1:(Y(e[0])===t[31]>>7&&s(e[0],f(),e[0]),i(e[3],e[0],e[1]),0)}function Y(e){var t=o("WACryptoPrimitives").lowlevel.pack25519,n=new Uint8Array(32);return t(n,e),n[0]&1}l.runInAllocationScope=s,l.allocate=u,l.hashSha512=c,l.reduce=d,l.scalarmultBase=m,l.fieldElement=p,l.modL=_,l.p3Element=C,l.unpack=U,l.elligator=G,l.hashToPoint=z,l.pack=j,l.inv25519=K,l.unpackneg=X}),98);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAHex","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t,n){return o("WACryptoEd25519").runInAllocationScope(function(){var r,a=t.length,i=e.privateKey,l=new Uint8Array(32);(r=o("WACryptoEd25519")).scalarmultBase(l,i);var s=l[31]&128,u=new Uint8Array(a+128);u[0]=254,u.fill(255,1,32),u.set(i,32),u.set(t,64),u.set(n,a+64);var c=r.allocate(Uint8Array,64);r.hashSha512(c,u,a+128),u.set(l,32);var d=r.allocate(Float64Array,64);r.reduce(c,d),r.scalarmultBase(u,c);var m=r.allocate(Uint8Array,64);r.hashSha512(m,u,a+64),r.reduce(m,d);var p,_;for(p=0;p<32;++p)d[p]=c[p];for(p=0;p<32;++p)for(_=0;_<32;++_)d[p+_]+=m[p]*i[_];return r.modL(u.subarray(32,64),d),{pubKeyNegative:s!==0,signedMsg:u}})}function u(t,r){return(e||(e=n("Promise"))).resolve().then(function(){var e=o("WASignalOther").makeBytes(64);return o("WACryptoDependencies").getCrypto().getRandomValues(e),d(t,r,e)})}function c(e,t,n){var r=n[63];return r&96?!1:o("WACryptoEd25519").runInAllocationScope(function(){var a,i,l=(a=o("WACryptoPrimitives")).lowlevel.A,s=a.lowlevel.M,u=a.lowlevel.Z,c=a.lowlevel.pack25519,d=a.lowlevel.unpack25519,m=(i=o("WACryptoEd25519")).allocate(Uint8Array,64);m.set(n),m[63]=r&127;var p=i.fieldElement(),_=i.fieldElement(),f=i.fieldElement(),g=i.fieldElement(),h=i.fieldElement(),y=i.allocate(Uint8Array,32),C=i.fieldElement();return C[0]=1,d(p,e.subarray(1)),u(_,p,C),l(f,p,C),i.inv25519(g,f),s(h,_,g),c(y,h),y[31]=y[31]&127|r&128,a.signDetachedVerify(t,m,y)})}function d(e,t,n){var r=s(e,t,n),a=o("WASignalOther").sliceBytes(r.signedMsg,0,64);return a[63]=a[63]&127|(r.pubKeyNegative?128:0),a}function m(e,t,n){var a=o("WASignalKeys").makeKeyPair(),i=o("WASignalOther").makeBytes(64);o("WACryptoDependencies").getCrypto().getRandomValues(i);var l=d(n,o("WASignalKeys").serializePubKey(a),i);if(!Number.isSafeInteger(t))throw r("err")("Expected timestamp to be a safe integer, given "+String(t));return{id:o("WASignalKeys").castToPreKeyId(e),ts:t,keyPair:a,signature:l}}function p(e,t){var n=o("WASignalOther").makeBytes(64);return o("WACryptoDependencies").getCrypto().getRandomValues(n),d(e,t,n)}function _(e){var t=e.id,n=e.keyPair;return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:t,publicKey:o("WASignalKeys").serializePubKey(n),privateKey:n.privateKey,signature:e.signature,timestamp:e.ts})}function f(e){try{var t=o("decodeProtobuf").decodeProtobuf(o("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,e),n=t.id,r=t.privateKey,a=t.publicKey,i=t.signature,l=t.timestamp;return n==null||a==null||r==null||i==null||l==null?null:{id:o("WASignalKeys").castToSignedPreKeyId(n),ts:o("WALongInt").numberOrThrowIfTooLarge(l),keyPair:o("WASignalKeys").makeKeyPairFromSerialized(o("WASignalOther").toBytes(r,32),o("WASignalKeys").castToSerializedPubKey(new Uint8Array(a))),signature:o("WASignalOther").toBytes(i,64)}}catch(e){return null}}function g(e){return new Uint8Array(o("WAHex").parseHex(e))}function h(e){if(e.length===33)return o("WASignalKeys").castToSerializedPubKey(e);if(e.length===32)return o("WASignalKeys").serializeIdentity(e);throw r("err")("verifyCertificate publicKey incorrect length")}function y(t,r,o){return(e||(e=n("Promise"))).resolve().then(function(){var e=m(t,r,o),n=_(e);return{plainObject:e,record:n}})}l.signMsg=u,l.verifyMsgSignalVariant=c,l.makeSignature=d,l.makeSignedPreKey=m,l.signSenderKeyMessage=p,l.serializeSignedPreKeyForPrivateStorage=_,l.deserializeSignedPreKey=f,l.convertPublicKeyHexToUint8Array=g,l.convertPublicKeyToSerializedPubKey=h,l.generateSignedPreKey=y}),98);
__d("WASignalWhisperTextProtocol.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={};s.internalSpec={ratchetKey:[1,(e=o("WAProtoConst")).TYPES.BYTES],counter:[2,e.TYPES.UINT32],previousCounter:[3,e.TYPES.UINT32],ciphertext:[4,e.TYPES.BYTES]},u.internalSpec={registrationId:[5,e.TYPES.UINT32],preKeyId:[1,e.TYPES.UINT32],signedPreKeyId:[6,e.TYPES.UINT32],baseKey:[2,e.TYPES.BYTES],identityKey:[3,e.TYPES.BYTES],message:[4,e.TYPES.BYTES]},c.internalSpec={id:[1,e.TYPES.UINT32],baseKey:[2,e.TYPES.BYTES],ratchetKey:[3,e.TYPES.BYTES],identityKey:[4,e.TYPES.BYTES],baseKeySignature:[5,e.TYPES.BYTES]},d.internalSpec={id:[1,e.TYPES.UINT32],iteration:[2,e.TYPES.UINT32],ciphertext:[3,e.TYPES.BYTES]},m.internalSpec={id:[1,e.TYPES.UINT32],iteration:[2,e.TYPES.UINT32],chainKey:[3,e.TYPES.BYTES],signingKey:[4,e.TYPES.BYTES]},p.internalSpec={generation:[1,e.TYPES.UINT32],signature:[2,e.TYPES.BYTES]},l.SignalMessageSpec=s,l.PreKeySignalMessageSpec=u,l.KeyExchangeMessageSpec=c,l.SenderKeyMessageSpec=d,l.SenderKeyDistributionMessageSpec=m,l.DeviceConsistencyCodeMessageSpec=p}),98);
__d("WASignalGroupSession",["WASignalKeys","WASignalSessions"],(function(t,n,r,o,a,i,l){"use strict";var e=5,s=3;function u(e){var t=o("WASignalSessions").definedOrThrow(e.senderSigningKey,"senderSigningKey"),n=o("WASignalSessions").definedOrThrow(e.senderMessageKeys,"senderMessageKeys"),r=o("WASignalSessions").definedOrThrow(e.senderChainKey,"senderChainKey");return{senderSigningKeyPublic:S(t.public,"public"),senderSigningKeyPrivate:t.private?o("WASignalSessions").bytesOrThrow(t.private,32,"private"):void 0,senderKeyId:o("WASignalSessions").definedOrThrow(e.senderKeyId,"senderKeyId"),unusedMsgKeys:n.map(function(e){return _(o("WASignalSessions").definedOrThrow(e.iteration,"iteration"),o("WASignalSessions").bytesOrThrow(e.seed,50,"seed"))}),senderKeyChainKey:f(o("WASignalSessions").definedOrThrow(r.iteration,"iteration"),o("WASignalSessions").bytesOrThrow(r.seed,32,"seed"))}}function c(e,t,n,r,o){return{senderSigningKeyPublic:e,senderSigningKeyPrivate:t,senderKeyChainKey:n,senderKeyId:r,unusedMsgKeys:o==null?[]:o}}function d(e,t){var n=e.senderKeyStates.findIndex(function(e){return e.senderKeyId===t.senderKeyId});return{senderKeyStates:e.senderKeyStates.map(function(e,r){return r===n?t:e})}}function m(t,n){var r=t.senderKeyStates.slice(t.senderKeyStates.length>e-1?1:0);return r.push(n),{senderKeyStates:r}}function p(e){return{senderKeyStates:[e]}}function _(e,t){return{iteration:e,seed:t}}function f(e,t){return{nextMsgIndex:e,chainKey:t}}function g(e){var t=o("WASignalSessions").definedOrThrow(e.senderKeyStates,"senderKeyStates");return h(t)}function h(e){return y(e)}function y(e){var t=e.map(function(e){return u(e)});return{senderKeyStates:t}}function C(e,t){var n=e.senderKeyStates.findIndex(function(e){return e.senderKeyId===t});if(n!==-1)return e.senderKeyStates[n]}function b(e){return{senderKeyStates:e.senderKeyStates.map(function(e){return v(e)})}}function v(e){return{senderKeyId:e.senderKeyId,senderChainKey:{iteration:e.senderKeyChainKey.nextMsgIndex,seed:e.senderKeyChainKey.chainKey},senderSigningKey:{public:e.senderSigningKeyPublic,private:e.senderSigningKeyPrivate},senderMessageKeys:e.unusedMsgKeys.map(function(e){var t=e.iteration,n=e.seed;return{iteration:t,seed:n}})}}function S(e,t){return o("WASignalKeys").castToSerializedPubKey(new Uint8Array(o("WASignalSessions").definedOrThrow(e,t)))}function R(e){return e}l.FORMAT_VERSION=s,l.makeSenderKeyState=c,l.updateSessionWithUpdatedSenderKeyState=d,l.updateSessionWithNewSenderKeyState=m,l.makeNewSenderKeySession=p,l.makeSenderKeyMsgKey=_,l.makeSenderKeyChainKey=f,l.parseSessionFromRecord=g,l._parseSession=h,l.makeSenderKeySessionFromRecord=y,l.findSenderKeyState=C,l.serializeSession=b,l.serializeSenderKeyState=v,l.convertFromRawToSenderKeyState=R}),98);
__d("WASignalWhitepaper",["Promise","WABinary","WACryptoDependencies","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Uint8Array(32);s.fill(255);var u=new Uint8Array([1]),c=new Uint8Array([2]);function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r,a=e.regId,i=e.staticKeyPair,l=t.identity,u=t.signedKey.publicKey,c=n.privateKey,d=i.privateKey,m=(r=t.oneTimeKey)==null?void 0:r.publicKey,p=o("WABinary").Binary.build(s,E(d,u),E(c,l),E(c,u),m&&E(c,m)).readByteArrayView(),_=yield R(p,"WhisperText"),f=_[0],g=_[1],h=t.ratchetKey,y=o("WASignalSessions").makeFreshRecvChain(h,g),C=o("WASignalKeys").makeSerializedKeyPair(),b=yield v(f,C,h),S=o("WASignalSessions").makeInitialExchangeInfo(t.oneTimeKey==null?null:t.oneTimeKey.id,t.signedKey.id,o("WASignalKeys").serializePubKey(n));return o("WASignalSessions").makeFreshSession({regId:a,pubKey:o("WASignalKeys").serializePubKey(i)},{regId:t.regId,pubKey:l},b.rootKey,[y],o("WASignalSessions").makeFreshSendChain(C,b.chainKey),S,o("WASignalKeys").serializePubKey(n))}),m.apply(this,arguments)}function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a,i=e.regId,l=e.staticKeyPair,u=l.privateKey,c=r.signed.privateKey,d=n,m=t.pubKey,p=(a=r.oneTime)==null?void 0:a.privateKey,_=o("WABinary").Binary.build(s,k(m,c),k(d,u),k(d,c),p&&k(d,p)).readByteArrayView(),f=yield R(_,"WhisperText"),g=f[0],h=f[1],y=r.ratchet,C=o("WASignalSessions").makeFreshSendChain(y,h);return o("WASignalSessions").makeSession({regId:i,pubKey:o("WASignalKeys").serializePubKey(l)},t,g,[],C,null,0,[],n)}),_.apply(this,arguments)}function f(t){var r=o("WASignalGroupSession").makeSenderKeyState(o("WASignalKeys").serializePubKey(t),t.privateKey,o("WASignalGroupSession").makeSenderKeyChainKey(0,o("WASignalKeys").makeRawSenderKey()),o("WASignalOther").makeSenderKeyId(),[]);return(e||(e=n("Promise"))).resolve(o("WASignalGroupSession").makeNewSenderKeySession(r))}function g(t,r,a,i,l){var s=o("WASignalGroupSession").makeSenderKeyState(a,void 0,o("WASignalGroupSession").makeSenderKeyChainKey(r,i),t,[]),u=null;return l?u=o("WASignalGroupSession").updateSessionWithNewSenderKeyState(l,s):u=o("WASignalGroupSession").makeNewSenderKeySession(s),(e||(e=n("Promise"))).resolve(u)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield o("WASignalOther").makeCryptoKey(r,"hmac-sha256"),i=function(t){return o("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},a,t)},l=i(u).then(function(e){return o("WASignalOther").hkdf(new Uint8Array(e),null,"WhisperMessageKeys",80)}).then(function(e){return o("WASignalSessions").splitMsgKey(t,e)}),s=i(c).then(function(e){return o("WASignalOther").toBytes(e,32)});return(e||(e=n("Promise"))).all([s,l])}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=yield o("WASignalOther").makeCryptoKey(r,"hmac-sha256"),i=function(t){return o("WACryptoDependencies").getCrypto().subtle.sign({name:"HMAC",hash:"SHA-256"},a,t)},l=i(u).then(function(e){return o("WASignalOther").hkdf(new Uint8Array(e),null,"WhisperGroup",50)}).then(function(e){return o("WASignalGroupSession").makeSenderKeyMsgKey(t,e)}),s=i(c).then(function(e){return o("WASignalOther").toBytes(e,32)});return(e||(e=n("Promise"))).all([s,l])}),b.apply(this,arguments)}function v(e,t,n){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=t.privateKey,a=n,i=o("WASignalKeys").ecdh(r,a),l=yield R(new Uint8Array(i),"WhisperRatchet",e),s=l[0],u=l[1];return{rootKey:s,chainKey:u}}),S.apply(this,arguments)}function R(e,t,n){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){n===void 0&&(n=null);var r=yield o("WASignalOther").hkdf(e,n,t,64);return[o("WASignalOther").sliceBytes(r,0,32),o("WASignalOther").sliceBytes(r,32,32)]}),L.apply(this,arguments)}function E(e,t){return new Uint8Array(o("WASignalKeys").ecdh(e,t))}function k(e,t){return E(t,e)}l.initiateSessionOutgoing=d,l.initiateSessionIncoming=p,l.initiateSenderKeySessionOutgoing=f,l.initiateSenderKeySessionIncoming=g,l.deriveMsgKey=h,l.deriveSenderKeyMsgKey=C,l.calculateRatchet=v}),98);
__d("WASignalCipher",["Promise","WABinary","WACryptoCurveKeyCanonicalCheck","WACryptoDependencies","WACryptoLibraryConfig","WACryptoUtils","WAResultOrError","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s=40,u=8,c=2e3;function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e.sendChain,r=yield o("WASignalWhitepaper").deriveMsgKey(n.nextMsgIndex,n.chainKey),a=r[0],i=r[1],l=yield T(i),s=l.cipherKey,c=l.macKey,d=yield o("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:i.iv},s,t),m=new(o("WABinary")).Binary;m.writeByteArray(e.local.pubKey),m.writeByteArray(e.remote.pubKey);var p=m.size();m.writeUint8(E(o("WASignalSessions").FORMAT_VERSION,o("WASignalSessions").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SignalMessageSpec,{ratchetKey:n.ratchetKey.serializedPubKey,counter:i.index,previousCounter:e.prevSendChainHighestIndex,ciphertext:d},m);var _=m.readByteArrayView(),f=yield I(c,_),g=_.subarray(p),h=o("WABinary").Binary.build(g,new Uint8Array(f,0,u)).readByteArrayView(),y,C,b=e.initialExchangeInfo;if(b!=null){var v,S=new(o("WABinary")).Binary;S.writeUint8(E(o("WASignalSessions").FORMAT_VERSION,o("WASignalSessions").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,{registrationId:e.local.regId,preKeyId:(v=b.remoteOneTimeId)!=null?v:void 0,signedPreKeyId:b.remoteSignedId,baseKey:b.localOneTimePubKey,identityKey:e.local.pubKey,message:h},S),y="pkmsg",C=S.readByteArrayView()}else y="msg",C=h;var R=o("WASignalSessions").makeSendChain(n.ratchetKey,i.index+1,a),L=o("WASignalSessions").updateChains(e,e.recvChains,R);return[L,{type:y,ciphertext:C}]}),m.apply(this,arguments)}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e==null)return o("WAResultOrError").makeError("errSignalNoSession");var n=yield b(e,t);if(n.success){var r=n.value,a=r[0],i=r[1];return o("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:a,plaintext:i})}else{for(var l=e.prevSessions,s=n,u=0;!s.success&&u<l.length;u++){var c=o("WASignalSessions").maybeClearPendingPreKey(o("WASignalSessions").parseSession(l[u])),d=yield b(c,t);if(d.success){var m=d.value,p=m[0],_=m[1],f=o("WASignalSessions").setPrevSessions(p,[o("WASignalSessions").detachSession(e)].concat(l.slice(0,u),l.slice(u+1))),g=!e||!o("WACryptoUtils").serializedPubKeysEqual(f.remote.pubKey,e.remote.pubKey)?f.remote.pubKey:null;s=o("WAResultOrError").makeResult({newSessionInfo:{newIdentity:g,baseSession:c,usedPreKey:null},updatedSession:f,plaintext:_})}}return s}}),_.apply(this,arguments)}function f(e,t){if(e==null)return o("WAResultOrError").makeResult(null);var n=e;if(D(n,t))return o("WAResultOrError").makeResult(n);for(var r=n.prevSessions,a=0;a<r.length;a++){var i=o("WASignalSessions").parseSession(r[a]);if(D(i,t))return o("WAResultOrError").makeError("errSignalInvalidMsg")}return o("WAResultOrError").makeResult(null)}function g(e,t,n,r){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a,i=r.localSignedPreKey;if(i==null)return o("WAResultOrError").makeError("errSignalInvalidSignedPreKey");var l=o("WASignalSignatures").deserializeSignedPreKey(i);if(l==null)return o("WAResultOrError").makeError("errSignalSignedPreKeyDeserialization");if(l.id!==n.localSignedPreKeyId)return o("WAResultOrError").makeError("errSignalSignedPreKeyIdMismatch");var u=null;if(n.localOneTimeKeyId!=null){var c=r.localOneTimeKey;if(c==null)return o("WAResultOrError").makeError("errSignalInvalidOneTimeKey");if(u=o("WASignalKeys").deserializePreKey(c),u==null)return o("WAResultOrError").makeError("errSignalOneTimeKeyDeserialization");if(u.id!==n.localOneTimeKeyId)return o("WAResultOrError").makeError("errSignalOneTimeKeyMismatch")}if(o("WACryptoLibraryConfig").getCryptoLibraryConfig().baseKeyCanonicalCheck&&!o("WACryptoCurveKeyCanonicalCheck").isCanonical(n.sessionBaseKey.subarray(1)))return o("WAResultOrError").makeError("errSignalBaseKeyIsNotCanonical");var d=yield o("WASignalWhitepaper").initiateSessionIncoming(e,n.remote,n.sessionBaseKey,{signed:l.keyPair,oneTime:(a=u)==null?void 0:a.keyPair,ratchet:o("WASignalKeys").toSerializedKeyPair(l.keyPair)}),m=d.remote.pubKey,p=!t||!o("WACryptoUtils").serializedPubKeysEqual(m,t.remote.pubKey)?m:null;t&&!p&&(d=o("WASignalSessions").setPrevSessions(d,[o("WASignalSessions").detachSession(t)].concat(t.prevSessions.slice(0,s-1))));var _=yield b(d,n);if(!_.success)return _;var f=_.value,g=f[0],h=f[1];return o("WAResultOrError").makeResult({newIdentity:p,baseSession:d,updatedSession:g,plaintext:h})}),h.apply(this,arguments)}function y(e){var t,n,r=null;try{var a=L(e,o("WASignalSessions").FORMAT_VERSION,u);if(!a.success)return a;var i=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SignalMessageSpec,a.value),l=i.ratchetKey;if(r=i.counter,n=i.ciphertext,l==null||r==null||n==null)return o("WAResultOrError").makeError("errSignalDeserializeInvalidProtoFormat");t=o("WASignalKeys").castToSerializedPubKey(new Uint8Array(l))}catch(e){return o("WAResultOrError").makeError("errSignalDeserializeRatchetKeyBadFormat")}var s={ratchetPubKey:t,counter:r,ciphertext:new Uint8Array(n),versionContentMac:e};return o("WAResultOrError").makeResult(s)}function C(e){var t=L(e,o("WASignalSessions").FORMAT_VERSION,0);if(!t.success)return t;var n,r,a,i,l;try{var s=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,t.value),u=s.baseKey,c=s.identityKey,d=s.message,m=s.preKeyId,p=s.registrationId,_=s.signedPreKeyId;if(p==null||_==null||u==null||c==null||d==null)return o("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");i=o("WASignalKeys").castToSerializedPubKey(new Uint8Array(u)),n={regId:o("WASignalOther").castRegistrationId(p),pubKey:o("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))},a=m!=null?o("WASignalKeys").castToPreKeyId(m):null,r=o("WASignalKeys").castToSignedPreKeyId(_),l=new Uint8Array(d)}catch(e){return o("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}var f=y(l);return f.success?o("WAResultOrError").makeResult(babelHelpers.extends({},f.value,{remote:n,sessionBaseKey:i,localSignedPreKeyId:r,localOneTimeKeyId:a})):f}function b(e,t){return v.apply(this,arguments)}function v(){return v=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.ciphertext,r=t.counter,a=t.ratchetPubKey,i=t.versionContentMac,l=e.recvChains,s=e.recvChains.findIndex(function(e){return o("WACryptoUtils").serializedPubKeysEqual(e.ratchetPubKey,a)}),c,d;if(s===-1){var m=yield o("WASignalWhitepaper").calculateRatchet(e.rootKey,e.sendChain.ratchetKey,a),p=o("WASignalSessions").makeFreshRecvChain(a,m.chainKey),_=yield S(p,r);if(!_.success)return _;var f=_.value,g=o("WASignalKeys").makeSerializedKeyPair(),h=yield o("WASignalWhitepaper").calculateRatchet(m.rootKey,g,a),y=l.slice(-4);y.push(f.updatedChain),d=f.msgKey,c=o("WASignalSessions").ratchetSession(e,y,o("WASignalSessions").makeFreshSendChain(g,h.chainKey),h.rootKey)}else{var C=yield S(l[s],r);if(!C.success)return C;var b=C.value,v=l.slice();v[s]=b.updatedChain,d=b.msgKey,c=o("WASignalSessions").updateChains(e,v,e.sendChain)}var R=yield T(d),L=R.cipherKey,E=R.macKey,k=o("WABinary").Binary.build(e.remote.pubKey,e.local.pubKey,i.subarray(0,-u)).readByteArrayView(),D=yield I(E,k),x=i.subarray(-u),$=!o("WACryptoUtils").uint8ArraysEqual(new Uint8Array(D,0,u),x),P=null;try{P=yield o("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:d.iv},L,n)}catch(e){}return $&&P==null?s===-1?o("WAResultOrError").makeError("errInvalidMacInvalidCipherKeyNewChain"):o("WAResultOrError").makeError("errInvalidMacInvalidCipherKey"):$?o("WAResultOrError").makeError("errInvalidMacWithDecryptedPlaintext"):P==null?o("WAResultOrError").makeError("errUnknownInvalidCipherKey"):o("WAResultOrError").makeResult([c,P])}),v.apply(this,arguments)}function S(e,t){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t-e.nextMsgIndex,r=o("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(n>r)return o("WAResultOrError").makeError("errSignalTooManyMessagesInFuture");var a=e.unusedMsgKeys;if(n<0){var i=a.findIndex(function(e){return e.index===t});return i===-1?o("WAResultOrError").makeError("errDuplicateMsg"):o("WAResultOrError").makeResult({msgKey:a[i],updatedChain:o("WASignalSessions").makeRecvChain(e.ratchetPubKey,e.nextMsgIndex,e.chainKey,k(a,i))})}var l=e.nextMsgIndex,s=yield o("WASignalWhitepaper").deriveMsgKey(l,e.chainKey),u=s[0],d=s[1],m=null;if(n>0){var p=n+a.length-c;p>0?(m=a.slice(p),p-=a.length):m=a.slice();for(var _=l+1;_<=t;_++){p>0?p--:m.push(d);var f=yield o("WASignalWhitepaper").deriveMsgKey(_,u);u=f[0],d=f[1]}}return o("WAResultOrError").makeResult({msgKey:d,updatedChain:o("WASignalSessions").makeRecvChain(e.ratchetPubKey,t+1,u,m||a)})}),R.apply(this,arguments)}function L(e,t,n){if(e.length<1)return o("WAResultOrError").makeError("errSignalEmptyVersionContentSuffix");var r=e[0]>>>4;if(r!==t)return r<t?o("WAResultOrError").makeError("errSignalLegacyMsg"):o("WAResultOrError").makeError("errSignalInvalidVersion");var a=e.length-n;return a<1?o("WAResultOrError").makeError("errSignalContentExceededExpectedLength"):o("WAResultOrError").makeResult(e.subarray(1,a))}function E(e,t){return(e<<4|t)&255}function k(e,t){for(var n=[],r=0;r<e.length;r++)r!==t&&n.push(e[r]);return n}function I(e,t){return o("WACryptoDependencies").getCrypto().subtle.sign(o("WASignalOther").HMAC_SHA256,e,t)}function T(t){return(e||(e=n("Promise"))).all([o("WASignalOther").makeCryptoKey(t.cipherKey,"aes-cbc"),o("WASignalOther").makeCryptoKey(t.macKey,"hmac-sha256")]).then(function(e){var t=e[0],n=e[1];return{cipherKey:t,macKey:n}})}function D(e,t){var n=e.aliceBaseKey;return n?o("WACryptoUtils").serializedPubKeysEqual(n,t):!1}l.MAX_UNUSED_KEYS=c,l.encryptMsg=d,l.decryptMsg=p,l.findMatchingSession=f,l.decryptPkMsgWithNewSession=g,l.deserializeMsg=y,l.deserializePkMsg=C,l.decryptMsgFromSession=b,l.readContent=L,l.versionByte=E}),98);
__d("WASignalGroupCipher",["WABinary","WACryptoDependencies","WACryptoLibraryConfig","WALogger","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WASignalWhitepaper","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s=64;function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=g(e);if(!n.success)return n;var r=n.value,a=r.chainKey,i=r.iteration,l=r.senderKeyId,s=r.signingKeyPublic,u=yield o("WASignalWhitepaper").initiateSenderKeySessionIncoming(l,i,s,a,t);return o("WAResultOrError").makeResult(u)}),c.apply(this,arguments)}function d(e){var t=o("WASignalGroupSession").serializeSenderKeyState(e),n=new(o("WABinary")).Binary;return n.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,{id:t.senderKeyId,iteration:o("WASignalSessions").definedOrThrow(t.senderChainKey,"senderChainKey").iteration,chainKey:o("WASignalSessions").definedOrThrow(t.senderChainKey,"senderChainKey").seed,signingKey:o("WASignalSessions").definedOrThrow(t.senderSigningKey,"senderSigningKey").public},n),n.readByteArrayView()}function m(e,t){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(!e.senderKeyStates||e.senderKeyStates.length===0)return o("WAResultOrError").makeError("errSignalNoSession");var n=e.senderKeyStates[e.senderKeyStates.length-1],r=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(n.senderKeyChainKey.nextMsgIndex,n.senderKeyChainKey.chainKey),a=r[0],i=r[1],l=yield y(i.seed),s=l[0],u=l[1],c=yield o("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-CBC",iv:u},s,t),d=new(o("WABinary")).Binary;o("encodeProtobuf").encodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,{id:n.senderKeyId,iteration:i.iteration,ciphertext:c},d);var m=new(o("WABinary")).Binary;m.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),m.writeBinary(d);var p=o("WASignalKeys").makeKeyPairFromSerialized(o("WASignalSessions").definedOrThrow(n.senderSigningKeyPrivate,"senderSigningKeyPrivate"),n.senderSigningKeyPublic),_=o("WASignalSignatures").signSenderKeyMessage(p,m.readByteArrayView()),f=new(o("WABinary")).Binary;f.writeUint8(o("WASignalCipher").versionByte(o("WASignalGroupSession").FORMAT_VERSION,o("WASignalGroupSession").FORMAT_VERSION)),f.writeBinary(d),f.writeByteArray(_);var g=o("WASignalGroupSession").makeSenderKeyChainKey(i.iteration+1,a),h=o("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(e,o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,g,n.senderKeyId,n.unusedMsgKeys));return o("WAResultOrError").makeResult([h,f.readByteArrayView()])}),p.apply(this,arguments)}function _(e,t){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=t.ciphertext,r=t.iteration,a=t.senderKeyMessageId,i=t.versionContentMac,l=o("WASignalGroupSession").findSenderKeyState(e,a);if(l==null)return o("WAResultOrError").makeError("errSignalNoSession");var s=l.senderSigningKeyPublic,u=b(i,s);if(!u)return o("WAResultOrError").makeError("errSignalInvalidKey");var c=yield v(l,r);if(!c.success)return c;var d=c.value,m=d.msgKey,p=o("WASignalGroupSession").updateSessionWithUpdatedSenderKeyState(e,d.updatedSenderKeyState),_=yield y(m.seed),f=_[0],g=_[1],h=yield o("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-CBC",iv:g},f,n);return o("WAResultOrError").makeResult([p,h])}),f.apply(this,arguments)}function g(e){var t,n,r,a,i;try{if(i=o("WASignalCipher").readContent(e,o("WASignalGroupSession").FORMAT_VERSION,0),!i.success)return i;var l=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyDistributionMessageSpec,i.value);t=l.id,n=l.iteration;var s=o("WASignalSessions").bytesOrThrow(l.signingKey,33,"signingKey");if(r=o("WASignalKeys").castToSerializedPubKey(s),a=o("WASignalSessions").bytesOrThrow(l.chainKey,32,"chainKey"),t==null||n==null)return o("WAResultOrError").makeError("errSignalGrpInvalidProtoFormat")}catch(e){return o("WAResultOrError").makeError("errSignalGrpInvalidKeyFormat")}return o("WAResultOrError").makeResult({senderKeyId:t,iteration:n,signingKeyPublic:r,chainKey:a})}function h(t){if(t.length<1)return o("WAResultOrError").makeError("errSignalGrpVersionContentEmpty");var n=t[0]>>>4;if(n!==o("WASignalGroupSession").FORMAT_VERSION)return n<o("WASignalGroupSession").FORMAT_VERSION?o("WAResultOrError").makeError("errSignalLegacyMsg"):o("WAResultOrError").makeError("errSignalInvalidVersion");if(t.length<1+s)return o("WAResultOrError").makeError("errSignalGrpInvalidVersionContentLength");var r,a,i;try{var l=t.subarray(1,-s),u=o("decodeProtobuf").decodeProtobuf(o("WASignalWhisperTextProtocol.pb").SenderKeyMessageSpec,l);if(r=u.id,a=u.iteration,i=u.ciphertext,r==null||a==null||i==null)return o("WAResultOrError").makeError("errSignalGrpSenderKeyInvalidProtoFormat")}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception caught during SenderKeyMessageSpec Proto: ",""])),t),o("WAResultOrError").makeError("errSignalGrpSenderKeyProtoError")}return o("WAResultOrError").makeResult({senderKeyMessageId:r,iteration:a,ciphertext:new Uint8Array(i),versionContentMac:t})}function y(e){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=new(o("WABinary")).Binary(e),n=o("WASignalOther").readBytes(t,16),r=o("WASignalOther").readBytes(t,32);return[yield o("WASignalOther").makeCryptoKey(r,"aes-cbc"),n]}),C.apply(this,arguments)}function b(e,t){var n=e.subarray(e.length-s),r=e.subarray(0,e.length-s);return o("WASignalSignatures").verifyMsgSignalVariant(t,r,o("WASignalOther").toBytes(o("WASignalOther").toBuffer(n),64))}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=e,r=t-n.senderKeyChainKey.nextMsgIndex,a=o("WACryptoLibraryConfig").getCryptoLibraryConfig().signalFutureMessagesMax;if(r>a)return o("WAResultOrError").makeError("errSignalGrpTooManyMessagesInFuture");var i=e.unusedMsgKeys||[];if(r<0){var l=i.findIndex(function(e){return e.iteration===t});return l===-1?o("WAResultOrError").makeError("errDuplicateMsg"):o("WAResultOrError").makeResult({msgKey:i[l],updatedSenderKeyState:o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,n.senderKeyChainKey,n.senderKeyId,R(i,l))})}var s=n.senderKeyChainKey.nextMsgIndex,u=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(s,n.senderKeyChainKey.chainKey),c=u[0],d=u[1],m=null;if(r>0){var p=r+i.length-o("WASignalCipher").MAX_UNUSED_KEYS;p>0?(m=i.slice(p),p-=i.length):m=i.slice();for(var _=s+1;_<=t;_++){p>0?p--:m.push(d);var f=yield o("WASignalWhitepaper").deriveSenderKeyMsgKey(_,c);c=f[0],d=f[1]}}return o("WAResultOrError").makeResult({msgKey:d,updatedSenderKeyState:o("WASignalGroupSession").makeSenderKeyState(n.senderSigningKeyPublic,n.senderSigningKeyPrivate,o("WASignalGroupSession").makeSenderKeyChainKey(t+1,c),e.senderKeyId,m||i)})}),S.apply(this,arguments)}function R(e,t){for(var n=[],r=0;r<e.length;r++)r!==t&&n.push(e[r]);return n}l.processSenderKeyDistributionMsg=u,l.createSenderKeyDistributionProto=d,l.encryptSenderKeyMsgWithSession=m,l.decryptSenderKeyMsgFromSession=_,l.deserializeSenderKeyMsg=h}),98);
__d("WACryptoLibrary",["WACryptoUtils","WAJids","WALockMap","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSignatures","WASignalWhitepaper","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WALockMap").makeLockMap(6e4),u=[],c=300;function d(e){u.push(e),u.length>=c&&u.shift()}function m(e){e(u),u=[]}function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){d("createOutgoingSession");var n=I(t),r=n.signedKey,a=yield o("WASignalSignatures").verifyMsgSignalVariant(n.identity,r.publicKey,r.signature);if(!a)return d("createOutgoingSession: errSignalInvalidKey"),o("WAResultOrError").makeError("errSignalInvalidKey");var i=yield o("WASignalWhitepaper").initiateSessionOutgoing(e,n,o("WASignalKeys").makeKeyPair());return o("WAResultOrError").makeResult(i)}),_.apply(this,arguments)}function f(e,t,n,r,o){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,o){var a=e.handleNewSession;d("establishOutgoingSession");var i=yield p(t,r);if(!i.success)return i;var l=i.value;return a(n,l,l.remote.pubKey,null,o)}),g.apply(this,arguments)}function h(e,t,r,a){var i=e.handleNewSession,l=e.loadSession;return d("encryptContent"),s.lock([o("WAJids").extractUserJid(t)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;do{var n=yield l(t,"cryptoLibraryEncryptContent");if(n==null)return d("encryptContent: errSignalInvalidKey"),o("WAResultOrError").makeError("errSignalInvalidKey");if(a!=null&&!o("WACryptoUtils").uint8ArraysEqual(a,n.remote.pubKey))return d("encryptContent: identity-mismatch"),o("WAResultOrError").makeError("identity-mismatch");var s=yield o("WASignalCipher").encryptMsg(n,r),u=s[0],c=s[1],m=yield i(t,u,u.remote.pubKey);m.success?e=o("WAResultOrError").makeResult(babelHelpers.extends({},c,{baseKey:u.aliceBaseKey})):m.error}while(e==null);return e}))}function y(e,t,r,a,i){var l=e.handleNewSession,u=e.loadOneTimePreKey,c=e.loadSession,m=e.loadSignedPreKey;return d("decryptContent"),s.lock([o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=!1,n=yield c(r,"decryptContent"),s;if(a.type==="pkmsg"){var p=o("WASignalCipher").deserializePkMsg(a.ciphertext);if(!p.success)return d("decryptContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var _=p.value,f=yield C({loadSignedPreKey:m,loadOneTimePreKey:u},t,_,n);if(!f.success)return f;s=f.value}else{a.type;var g=o("WASignalCipher").deserializeMsg(a.ciphertext);if(!g.success)return d("decryptContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var h=g.value,y=yield o("WASignalCipher").decryptMsg(n,h);if(!y.success)return y;s=y.value}var b=s,v=b.newSessionInfo;if(v&&(v.newIdentity!=null||v.usedPreKey!=null)&&(yield l(r,v.baseSession,v.newIdentity,v.usedPreKey)),!e){var S=v==null?void 0:v.baseSession.remote.pubKey;yield i(new Uint8Array(s.plaintext),S),e=!0}return yield l(r,s.updatedSession,s.updatedSession.remote.pubKey),o("WAResultOrError").makeResult()}))}function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){var a=e.loadOneTimePreKey,i=e.loadSignedPreKey;d("decryptPkMsg");var l=o("WASignalCipher").findMatchingSession(r,n.sessionBaseKey);if(!l.success)return l;var s=l.value;if(s){var u=yield o("WASignalCipher").decryptMsgFromSession(s,n);if(!u.success)return u;var c=u.value,m=c[0],p=c[1];return o("WAResultOrError").makeResult({newSessionInfo:null,updatedSession:m,plaintext:p})}else{var _=n.localOneTimeKeyId,f=yield i(n.localSignedPreKeyId),g=_==null?null:yield a(_),h=yield o("WASignalCipher").decryptPkMsgWithNewSession(t,r,n,{localSignedPreKey:f,localOneTimeKey:g});if(!h.success)return h;var y=h.value,C=y.baseSession,b=y.newIdentity,v=y.plaintext,S=y.updatedSession;return o("WAResultOrError").makeResult({newSessionInfo:{newIdentity:b,baseSession:C,usedPreKey:_},updatedSession:S,plaintext:v})}}),b.apply(this,arguments)}function v(e,t,r,a){var i=e.loadSenderKeySession,l=e.saveSenderKeySession;return d("encryptGroupContent"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;do{var n=yield i(t,r);if(!n.success)return o("WAResultOrError").makeError(n.error);var s=n.value,u=yield o("WASignalGroupCipher").encryptSenderKeyMsgWithSession(s,a);if(u.success){var c=u.value,m=c[0],p=c[1];yield l(t,r,m);var _=s.senderKeyStates[s.senderKeyStates.length-1];e=o("WAResultOrError").makeResult({ciphertext:{ciphertext:p,type:"skmsg"},senderKeyId:_.senderKeyId,senderKeyDistributionProto:o("WASignalGroupCipher").createSenderKeyDistributionProto(o("WASignalGroupSession").convertFromRawToSenderKeyState(_))})}else return d("encryptGroupContent: sender-key-no-session"),o("WAResultOrError").makeError("sender-key-no-session")}while(e==null);return e}))}function S(t,r,a,i,l){var u=t.loadSenderKeySession,c=t.saveSenderKeySession;return d("decryptGroupContent"),s.lock([r,o("WAJids").extractUserJid(a)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=!1,n=yield u(r,a);if(!n.success)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[WACryptoLibrary] Unable to load sender key session for group during decryptGroupContent: ",", author: ",""])),r,a),o("WAResultOrError").makeError(n.error);var s=o("WASignalGroupCipher").deserializeSenderKeyMsg(i);if(!s.success)return d("decryptGroupContent: errCryptoDeserialization"),o("WAResultOrError").makeError("errCryptoDeserialization");var m=n.value,p=yield o("WASignalGroupCipher").decryptSenderKeyMsgFromSession(m,s.value);if(!p.success)return p;var _=p.value,f=_[0],g=_[1];return t||(yield l(new Uint8Array(g)),t=!0),yield c(r,a,f),o("WAResultOrError").makeResult()}))}function R(e,t,r,a){var i=e.loadSenderKeySession,l=e.saveSenderKeySession;return d("saveSenderKeySession"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=null;if(i){var n=yield i(t,r);e=n.success?n.value:null}var s=yield o("WASignalGroupCipher").processSenderKeyDistributionMsg(a,e);if(!s.success)return s;var u=s.value;return yield l(t,r,u),o("WAResultOrError").makeResult()}))}function L(e,t,r,a){var i=e.saveSenderKeySession;return d("rotateGroupSenderKey"),s.lock([t,o("WAJids").extractUserJid(r)],n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WASignalWhitepaper").initiateSenderKeySessionOutgoing(a),n=e.senderKeyStates[0].senderKeyId;return yield i(t,r,e),{senderKeyId:n}}))}function E(e,t,n){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.loadSenderKeySession,a=e.saveSenderKeySession;d("createSenderKeyDistributionMsg");var i=yield r(t,n),l=i.error;if(!i.success&&l==="errLoadSenderKeySession"){var s=yield o("WASignalKeys").makeKeyPair();yield L({saveSenderKeySession:a},t,n,s),i=yield r(t,n)}if(i.success){var u=i.value.senderKeyStates.slice(-1);if(u.length>0)return o("WAResultOrError").makeResult(o("WASignalGroupCipher").createSenderKeyDistributionProto(o("WASignalGroupSession").convertFromRawToSenderKeyState(u[0])))}return d("createSenderKeyDistributionMsg: errGetSenderKeyProto"),o("WAResultOrError").makeError("errGetSenderKeyProto")}),k.apply(this,arguments)}function I(e){var t=e.identity,n=e.oneTimeKey,r=e.regId,a=e.signedKey;d("sanitizeInitialSessionInfo");var i=o("WASignalKeys").castToSerializedPubKey(a.publicKey);return{regId:o("WASignalOther").castRegistrationId(r),identity:o("WASignalKeys").castToSerializedPubKey(t),signedKey:{id:o("WASignalKeys").castToSignedPreKeyId(a.id),publicKey:i,signature:o("WASignalOther").ensureSize(a.signature,64)},oneTimeKey:n&&{id:o("WASignalKeys").castToPreKeyId(n.id),publicKey:o("WASignalKeys").castToSerializedPubKey(n.publicKey)},ratchetKey:i}}l.publishLogs=m,l.createOutgoingSession=p,l.establishOutgoingSession=f,l.encryptContent=h,l.decryptContent=y,l.encryptGroupContent=v,l.decryptGroupContent=S,l.saveSenderKeySession=R,l.rotateGroupSenderKey=L,l.createSenderKeyDistributionMsg=E}),98);
__d("WACryptoManager",["Promise","WABridge","WACryptoLibrary","WACryptoUtils","WAGlobals","WAJids","WALogger","WALoggerTag","WANullthrows","WAOdsEnums","WAPromiseQueue","WAResultOrError","WASignalCipher","WASignalGroupSession","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WASignalSessions","WASignalSignatures","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS([r("WALoggerTag").CryptoManager]),f={type:"default"};function g(e){return{flush:function(){return e.storage.savePendingToDatabase().then(function(){})}}}function h(e){return{regInfo:e.regInfo,network:e.network,storage:e.storage}}function y(e,t,n,r,o){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){var i=yield r(t,a);if(i!=null&&n.type!=="requestNewSession"){var l=i;if(n.type==="default")return o("WAResultOrError").makeResult(l);if(l.aliceBaseKey!=null&&n.session.baseKey!=null&&(n.type,!o("WACryptoUtils").uint8ArraysEqual(n.session.baseKey,l.aliceBaseKey)))return o("WAResultOrError").makeResult(l)}var s;if(n.type==="useSession")s=n.session.keys;else{n.type;var u=yield e.network.requestKeys(t);if(!u.success)return u;s=u.value.keys,n.type==="compareTSAndUseSession"&&n.session.timestamp>=u.value.timestamp&&(s=n.session.keys)}var c=yield o("WACryptoLibrary").createOutgoingSession(e.regInfo,s);return c.success?o("WAResultOrError").makeResult(c.value):c}),C.apply(this,arguments)}function b(e,t,n,r){return o("WACryptoLibrary").establishOutgoingSession({handleNewSession:e.storage.handleNewSession},e.regInfo,t,n,r)}function v(e,t){return S.apply(this,arguments)}function S(){return S=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.storage.loadSessions(t),r=t.filter(function(e){return!n.has(e)});if(r.length===0)return n;var a=yield e.network.bulkRequestKeys(r);if(!a.success)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[sessions] fail during key requesting"]))),n;for(var i of n.entries()){var l=i[0],s=i[1];s.sendChain.nextMsgIndex>=o("WAGlobals").getConfig().sessionDropIfTooOld()&&(n.delete(l),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.WA_LONG_SESSION_DROP,key:"decryption"}))}var u=a.value,m=new(o("WAPromiseQueue")).PromiseQueue;return u.forEach(function(t,r){m.enqueue(function(){return o("WACryptoLibrary").createOutgoingSession(e.regInfo,t.keys).then(function(e){e.success===!1?o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[sessions] Failed to create a session"]))):n.set(r,e.value)})})}),yield m.wait(),n}),S.apply(this,arguments)}function R(e,t){return L.apply(this,arguments)}function L(){return L=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=Array.from(t.keys());o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] sendWrittenMsg bulkEncryptContent"])));var i=yield v(e,a),l=new Map;return(p||(p=n("Promise"))).all(Array.from(i.entries()).map((function(){var a=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){var a,i=n[0],s=n[1],u=yield o("WASignalCipher").encryptMsg(s,r("WANullthrows")((a=t.get(i))==null?void 0:a.plaintext)),c=u[0],d=u[1];return l.set(i,babelHelpers.extends({},d,{baseKey:null})),e.storage.handleNewSession(i,c,c.remote.pubKey)});return function(e){return a.apply(this,arguments)}})())).then(function(){return o("WAResultOrError").makeResult(l)})}),L.apply(this,arguments)}function E(e,t,n,r,a){return o("WACryptoLibrary").encryptContent({loadSession:function(n){return y(e,n,r,e.storage.loadSession,"cryptoManagerEncryptContent").then(function(e){return e.success===!0?e.value:null})},handleNewSession:e.storage.handleNewSession},t,n,a)}function k(e,t,n,r){return o("WACryptoLibrary").decryptContent({loadSession:e.storage.loadSession,handleNewSession:e.storage.handleNewSession,loadSignedPreKey:e.storage.loadSignedPreKey,loadOneTimePreKey:e.storage.loadOneTimePreKey},e.regInfo,t,n,r)}function I(e,t){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.storage.loadSession(t,"getParticipantInfo");return n==null?void 0:n.remote}),T.apply(this,arguments)}function D(e){return x.apply(this,arguments)}function x(){return x=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t,n,a=yield e.storage.getLastPreKeyGenerationId(),i=((t=a==null?void 0:a.lastPreKeyId)!=null?t:0)+1,l=o("WASignalKeys").makePreKeys(i,1)[0],s=yield e.storage.saveOneTimePreKey({keyId:l.plainObject.id,encoded:l.record});if(s.success)return l.plainObject;throw r("err")("Cannot save one time prekey: "+s.error+", LastPreKeyId: "+((n=a==null?void 0:a.lastPreKeyId)!=null?n:0))}),x.apply(this,arguments)}function $(e,t){return P.apply(this,arguments)}function P(){return P=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n;t===void 0&&(t=o("WAGlobals").getConfig().maxPrekeysToUpload());var r=yield e.storage.getLastPreKeyGenerationId(),a=o("WASignalKeys").makePreKeys(((n=r==null?void 0:r.lastPreKeyId)!=null?n:0)+1,t);return e.storage.savePreKeysGeneration(a.map(function(e){var t=e.plainObject,n=e.record;return{keyId:t.id,encoded:n}}))}),P.apply(this,arguments)}function N(t){return t.storage.loadLatestSignedPreKey().then(function(n){if(n.success===!1){var a,i,l;throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey ",""])),n==null||(a=n.payload)==null?void 0:a.toString()),r("err")("Failed to generate signed prekey: "+((i=n==null||(l=n.payload)==null?void 0:l.message)!=null?i:""))}var u=n.value,c=o("WASignalSignatures").deserializeSignedPreKey(u);if(c==null)throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey: ",""])),n),r("err")("failed to deserialize signed prekey");var d=c.id+1>=o("WASignalKeys").PRE_KEY_NON_INCLUSIVE_UPPER_BORDER?1:c.id+1;return M(t,d)})}function M(e,t){var n=o("WASignalSignatures").makeSignedPreKey(t,o("WATimeUtils").unixTimeMs(),e.regInfo.staticKeyPair),a=o("WASignalSignatures").serializeSignedPreKeyForPrivateStorage(n);return e.storage.saveSignedPreKeyIfNew(n.id,a).then(function(e){return e.type==="success"?o("WAResultOrError").makeResult(n):(e.type,o("WAResultOrError").makeResult(e.key))}).then(function(e){if(!e.success){var t,n;throw _.TAGS([r("WALoggerTag").SignedPrekey]).ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate signed prekey with id: ",""])),e),r("err")("Unexpected error when generateSignedPreKeyWithId: "+((t=e==null||(n=e.payload)==null?void 0:n.message)!=null?t:e.error))}return e.value})}function w(e,t,n,r){return o("WACryptoLibrary").encryptGroupContent({loadSenderKeySession:e.storage.loadSenderKeySession,saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r)}function A(e,t,n,r,a){return o("WACryptoLibrary").decryptGroupContent({loadSenderKeySession:e.storage.loadSenderKeySession,saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r,a)}function F(e,t,n,r){return o("WACryptoLibrary").saveSenderKeySession({saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r)}function O(e,t,n){return B.apply(this,arguments)}function B(){return B=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield D(e);return o("WACryptoLibrary").rotateGroupSenderKey({saveSenderKeySession:e.storage.saveSenderKeySession},t,n,r.keyPair)}),B.apply(this,arguments)}function W(e){return(p||(p=n("Promise"))).resolve().then(function(){return{regId:o("WASignalOther").makeRegistrationId(e),staticKeyPair:o("WASignalKeys").makeKeyPair(),authKeyPair:o("WASignalKeys").makeKeyPair()}})}function q(e){return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").RecordStructureSpec,o("WASignalSessions").serializeSession(e))}function U(e){return o("WASignalOther").decodeSignalProto(o("WASignalLocalStorageProtocol.pb").RecordStructureSpec,e,o("WASignalSessions").parseSessionFromRecord)}function V(e){return o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,o("WASignalGroupSession").serializeSession(e))}function H(e){return o("WASignalOther").decodeSignalProto(o("WASignalLocalStorageProtocol.pb").SenderKeyRecordStructureSpec,e,o("WASignalGroupSession").parseSessionFromRecord)}function G(e){return e}function z(e,t){return e+"|"+t}function j(e){var t=e.split("|");if(t.length!==2)throw r("err")("Incorrect ComplexSenderKey");return{groupId:o("WAJids").unsafeCoerceToGroupJid(t[0]),deviceId:o("WAJids").unsafeCoerceToDeviceJid(t[1])}}l.DEFAULT_SESSION_REQUEST=f,l.cryptoManagerFlushable=g,l.initCryptoManager=h,l.getSessionForRecipient=y,l.establishOutgoingSession=b,l.ensureSessionsExists=v,l.bulkEncryptContent=R,l.encryptContent=E,l.decryptContent=k,l.getParticipantInfo=I,l.generateOneTimePreKey=D,l.generatePreKeys=$,l.generateSignedPreKey=N,l.generateSignedPreKeyWithId=M,l.encryptGroupContent=w,l.decryptGroupContent=A,l.saveSenderKeySession=F,l.rotateGroupSenderKey=O,l.generateRegistrationInfo=W,l.encodeSession=q,l.decodeSession=U,l.encodeSenderKeySession=V,l.decodeSenderKeySession=H,l.castToPreKeyGenerationId=G,l.encodeSenderKey=z,l.decodeSenderKey=j}),98);
__d("WADbSignal",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e,t,n){return e+"_"+t+"_"+n}var s={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"},u={msgrDeviceId:"msgrDeviceId"},c={registrationHistory:"registrationHistory"};i.unsafeCoerceToSenderKeySessionId=e,i.buildSenderKeySessionId=l,i.MetaKeysEnum=s,i.PlainTextMetaKeysEnum=c}),66);
__d("WABulkSaveSignalDataApi",["Promise","WACryptoManager","WADbSignal","WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=t.dhashUpdate,a=t.icdcUpdate,i=t.identityRemove,l=t.identityUpdate,s=t.lastSyncTsUpdate,c=t.preKeyRemove,m=t.senderKeySessionUpdate,p=t.sessionRemove,_=t.sessionUpdate,f=_.map(function(e){var t=e.id,n=e.updated;return{id:t,session:o("WACryptoManager").encodeSession(n)}}),g=[];m.forEach(function(e){var t=e.author,n=e.groupId,r=e.updated,a=o("WAJids").extractUserJid(t),i=o("WAJids").extractDeviceId(t),l=o("WADbSignal").buildSenderKeySessionId(n,a,i);g.push({deviceId:i,groupJid:n,id:l,record:o("WACryptoManager").encodeSenderKeySession(r),userJid:a})}),yield o("WASignalDB").getDb().runInTransaction(["contacts","identity","prekey","senderKeySessions","session"],"readwrite",function(t){var o=t.stores,m=o.identity,_=o.prekey,h=o.senderKeySessions,y=o.session;return(e||(e=n("Promise"))).all([y.bulkDelete(p),m.bulkDelete(i),y.bulkPut(f),h.bulkPut(g),d(t.stores,l),u(t.stores,a,l,r,s),_.bulkDelete(c.map(function(e){var t=e.id;return t}))])},o("WASignalDB").signalOp("bulkSaveSignalData"))});return function(n){return t.apply(this,arguments)}})();function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){var i=new Set;for(var l of n)i.add(o("WAJids").extractUserJid(l.id));var s=Array.from(i);for(var u of t)i.add(u.id);var c=yield e.contacts.bulkGet(Array.from(i)),d=new Map;for(var m of c)m!=null&&d.set(m.contactJid,m);for(var p of s){var _=d.get(p);_==null?(_={contactJid:p,dhash:null},d.set(p,_)):_.dhash=null}for(var f of t){var g=d.get(f.id);g==null?(g={contactJid:f.id,dhash:null,icdcInfo:f.icdc},d.set(f.id,g)):g.icdcInfo=f.icdc}for(var h of r){var y=d.get(h.id);y==null?(y={contactJid:h.id,dhash:h.dhash},d.set(h.id,y)):y.dhash=h.dhash}for(var C of a){var b=d.get(C.id);b==null?(b={contactJid:C.id,dhash:null,lastSyncTs:C.lastSyncTs},d.set(C.id,b)):b.lastSyncTs=C.lastSyncTs}yield e.contacts.bulkPut(Array.from(d.values()))}),c.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t.length!==0){var n=t.map(function(e){var t=e.id,n=e.identity;return{deviceJid:t,identity:n,userJid:o("WAJids").extractUserJid(t)}});yield e.identity.bulkPut(n)}}),m.apply(this,arguments)}l.bulkSaveSignalData=s}),98);
__d("WAIdentityUtils",["WABinary","WACryptoDependencies","WASignalOther"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.length===33&&e[0]===5;return t?e.slice(1):e}function s(e,t){for(var n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length}function u(t){var n=t.map(function(t){return e(t)}),r=new(o("WABinary")).Binary;n.sort(s).forEach(function(e){return r.writeByteArray(e)});var a=o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",r.readByteArrayView());return a.then(function(e){var t=new Uint8Array(e);return o("WASignalOther").sliceBytes(t,0,10)})}l.removeKeyTypeIfNeeded=e,l.computeIdentitiesHash=u}),98);
__d("WAICDCUtils",["WAArmadilloICDC.pb","WABase64","WABinary","WACryptoDependencies","WACryptoEd25519","WACryptoUtils","WAIdentityUtils","WALogger","WASignalKeys","WASignalOther","WASignalSignatures","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d;function m(t,n,r,a){if(t!==a.details.seq)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched sequence between XML node and byte structure"]))),null;if(r!==a.details.timestamp)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched timestamp between XML node and byte structure"]))),null;if(a.details.signingDeviceIndex==null)return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Received ICDC has mismatched missed signingDeviceIndex"]))),null;var i=a.details.signingDeviceIndex;return{dirty:n,sequence:t,timestamp:r,signingDeviceIndex:i,devices:a.details.devices.map(function(e){return new Uint8Array(e)})}}function p(e){return e.signingDeviceIndex<0||e.signingDeviceIndex>=e.devices.length}function _(e){var t=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,e),n=t.signature,r=o("decodeProtobuf").decodeProtobuf(o("WAArmadilloICDC.pb").ICDCIdentityListSpec,t.details);return{signature:n,details:r}}function f(e){return e.map(function(e){return o("WASignalKeys").serializeIdentity(new Uint8Array(o("WABase64").decodeB64UrlSafe(e)))})}function g(e,t,n,a,i){var l=o("WAIdentityUtils").removeKeyTypeIfNeeded(e.publicKey),s=n.map(function(e){return o("WAIdentityUtils").removeKeyTypeIfNeeded(e)}),u=s.findIndex(function(e){return o("WACryptoUtils").uint8ArraysEqual(e,l)});if(u===-1)throw o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["signingDeviceIndex not found. This should never happen. ",". caller: ",""])),a,i),r("err")("signingDeviceIndex not found");var m=t==null?1:t+1,p=o("WATimeUtils").unixTime();p<0&&o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["ICDC timestamp is negative. time: ",", closkSkew: ",""])),Date.now(),o("WATimeUtils").getClockSkew());var _={seq:m,timestamp:p,devices:s,signingDeviceIndex:u},f=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloICDC.pb").ICDCIdentityListSpec,_).readBuffer(),g=h(e,o("WABinary").Binary.build(f).readByteArrayView()),y={details:f,signature:g},C=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloICDC.pb").SignedICDCIdentityListSpec,y).readBuffer();return{icdcInfo:_,encodedSignedICDC:C}}function h(e,t){var n=o("WASignalOther").makeBytes(64);o("WACryptoDependencies").getCrypto().getRandomValues(n);var r=new Uint8Array(64);o("WACryptoEd25519").hashSha512(r,t,t.length);var a=o("WASignalSignatures").makeSignature(e,t,n);return o("WABinary").Binary.build(a).readBuffer()}var y=4*o("WATimeUtils").HOUR_SECONDS;function C(e){return e==null?!0:!o("WATimeUtils").happenedWithin(e,y)}l.validateAndPrepareICDCFromNotification=m,l.isICDCIndexInvalid=p,l.decodeICDCInfo=_,l.base64DeviceIdentitiesToSerializedPubKeys=f,l.computeICDCInfoForUpload=g,l.isLastSyncTsExpired=C}),98);
__d("WAComputeAndUploadICDCInfo",["WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WAGetDevices","WAGlobals","WAICDCUtils","WAIdentityUtils","WALogger","WAPromiseBackoffs","WAWap","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=new(r("WADeprecatedWapParser"))("parseUploadICDCInfoResponse",function(e){e.assertTag("iq"),e.assertFromServer(),e.assertAttr("type","result")}),m=0,p=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=t.caller,i=t.reason,l=t.sequence;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["computeAndUploadICDCInfo called ",""])),l);var p;try{p=yield o("WAGlobals").getWaOneQueue().enqueue((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.cryptoManager,n=yield t.storage.loadIdentities(o("WAGlobals").getMyUserJid()),r=t.regInfo;return{regInfo:r,identities:Array.from(n.values())}});return function(t){return e.apply(this,arguments)}})(),{operationType:"icdc_load_identities",flush:!1,afterInit:!0})}catch(e){var _=r("getErrorSafe")(e);o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Loading identities fails with error: ",""])),_.toString())}if(p!=null){var f=p,g=f.identities,h=f.regInfo,y=o("WAICDCUtils").computeICDCInfoForUpload(h.staticKeyPair,l,g,i,a),C=y.encodedSignedICDC,b=y.icdcInfo,v=yield o("WAIdentityUtils").computeIdentitiesHash(g),S=o("WAWap").wap("iq",{id:o("WAWap").generateId(),to:o("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"fbid:devices"},o("WAWap").wap("icdc",{ihash:o("WAWap").CUSTOM_STRING(o("WABase64").encodeB64(v)),seq:o("WAWap").INT(b.seq),ts:o("WAWap").INT(b.timestamp)},C)),R=yield o("WADeprecatedSendIq").deprecatedSendIq(S,d);R.success?(m=0,yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.saveICDC(o("WAGlobals").getMyUserJid(),{sequence:b.seq,timestamp:b.timestamp,devices:b.devices,signingDeviceIndex:b.signingDeviceIndex,dirty:!1})},{operationType:"save_icdc",flush:!0,afterInit:!0})):(m+=1,R.errorCode===406||R.errorCode===500?setTimeout(function(){o("WAGetDevices").getDevices({ignoreDhash:!0,reason:"compute-Upload-icdc",users:new Set().add(o("WAGlobals").getMyUserJid())}).catch(function(e){o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed getting devices ",""])),e.toString())})},o("WAPromiseBackoffs").getDelay(m,{jitter:.1,max:3e4,algo:{type:"fibonacci",first:1e3,second:1e3}})):o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Cannot update ICDC for user, because of "," server response"])),R.errorCode))}});return function(n){return t.apply(this,arguments)}})();l.computeAndUploadICDCInfo=p}),98);
__d("WAFetchAndSaveDevices",["Promise","WAComputeAndUploadICDCInfo","WAGlobals","WAICDCUtils","WALogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length!==0){var r=[];yield o("WAGlobals").getWaOneQueue().enqueue(function(a){var i=a.cryptoManager;return o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Update user devices signal and DB"]))),(s||(s=n("Promise"))).all(t.map(function(e){var t;return r.push({contactJid:e.jid,dhash:e.dhash,lastSyncTs:e.lastSyncTs,icdcInfo:(t=e.icdcInfo)!=null?t:void 0}),i.storage.updateUserDevicesInfo([e])}))},{operationType:"get_devices",flush:!0,afterInit:!0});var a=o("WAGlobals").getMyUserJid(),i=t.find(function(e){return e.jid===a});if(i!=null){var l=i.icdcInfo;if(l==null||o("WAICDCUtils").isICDCIndexInvalid(l)||l!=null&&l.dirty){var u;l==null?u="empty":l.dirty?u="dirty":u="invalidIndex",o("WAComputeAndUploadICDCInfo").computeAndUploadICDCInfo({reason:u,caller:"get_devices",sequence:l==null?void 0:l.sequence}).catch(function(e){})}}}}),c.apply(this,arguments)}l.updateUsersDevicesSignalAndDB=u}),98);
__d("WAPushSafeTypes",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}i.unsafeNotNullable=e}),66);
__d("WAGetDevices",["WADevicesState","WALogger","WAPushSafeTypes","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return u.apply(this,arguments)}function u(){return u=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=o("WAPushSafeTypes").unsafeNotNullable(t),r=n.ignoreDhash,a=r===void 0?!1:r,i=n.reason,l=n.users;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["fetchAndSaveDevices: ",""])),i),a&&o("WADevicesState").getDevicesState().reset(Array.from(l)),yield o("WADevicesState").getDevicesState().waitForUserDevices(Array.from(l),"getDevices job: "+i,a)}),u.apply(this,arguments)}l.getDevices=s}),98);
__d("WAHandleFbDeviceChangeNotificationProtocol",["WAICDCUtils","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.dhash}function s(e){var t,n=((t=e.iCDCDirtyMixin)==null?void 0:t.dirty)==="true",r=o("WATimeUtils").castToUnixTime(e.ts),a=e.seq,i=o("WAICDCUtils").decodeICDCInfo(e.elementValue),l=o("WAICDCUtils").validateAndPrepareICDCFromNotification(a,n,r,i);return l==null?o("WAResultOrError").makeError("icdc-validation-failure"):o("WAResultOrError").makeResult(l)}l.parseDhash=e,l.parseICDCFromServer=s}),98);
__d("WALoadContactsApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet(t).then(function(e){return new Map(e.filter(Boolean).map(function(e){return[e.contactJid,{contactJid:e.contactJid,dhash:e.dhash,icdcFails:e.icdcFails,icdcInfo:e.icdcInfo,lastSyncTs:e.lastSyncTs}]}))})},o("WASignalDB").signalOp("loadContacts"))};l.loadContacts=e}),98);
__d("WARPCAbortController",["Promise"],(function(t,n,r,o,a,i){"use strict";var e,l="rpc-timeout";function s(t,r){var o,a=new(e||(e=n("Promise")))(function(e,t){o=setTimeout(function(){t(l)},r)});return e.race([t,a]).finally(function(){clearTimeout(o)})}i.RPC_TIMEOUT=l,i.rpcAbortController=s}),66);
__d("WASmaxInDevicesIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInDevicesIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInDevicesNonRetryableIQErrorMixin",["WASmaxInDevicesIQErrorBadRequestMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);return n.success,n}l.parseNonRetryableIQErrorMixin=e}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInDevicesIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","service-unavailable");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",503);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorServiceUnavailableMixin=e}),98);
__d("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorMixin","WASmaxInDevicesIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:t.value});var n=o("WASmaxInDevicesIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorInternalServerError","IQErrorServiceUnavailable"],[t,n])}l.parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup=e}),98);
__d("WASmaxInDevicesRetryableIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"backoff",0,86400);if(!n.success)return n;var r=o("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(e);return r.success?o("WAResultOrError").makeResult({backoff:n.value,iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:r.value}):r}l.parseRetryableIQErrorMixin=e}),98);
__d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"RetryableIQError",value:t.value});var n=o("WASmaxInDevicesNonRetryableIQErrorMixin").parseNonRetryableIQErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"NonRetryableIQError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableIQError","NonRetryableIQError"],[t,n])}l.parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup=e}),98);
__d("WASmaxInDevicesFetchResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseFetchResponseError=e}),98);
__d("WASmaxInDevicesIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","item-not-found");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",404);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorItemNotFoundMixin=e}),98);
__d("WASmaxInDevicesFetchNonRetryableUserErrorMixin",["WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);return n.success,n}l.parseFetchNonRetryableUserErrorMixin=e}),98);
__d("WASmaxInDevicesFetchRetryableUserErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrServiceUnavailableMixinGroup(e);return n.success?o("WAResultOrError").makeResult({iQErrorInternalServerErrorOrServiceUnavailableMixinGroup:n.value}):n}l.parseFetchRetryableUserErrorMixin=e}),98);
__d("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup",["WAResultOrError","WASmaxInDevicesFetchNonRetryableUserErrorMixin","WASmaxInDevicesFetchRetryableUserErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesFetchRetryableUserErrorMixin").parseFetchRetryableUserErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchRetryableUserError",value:t.value});var n=o("WASmaxInDevicesFetchNonRetryableUserErrorMixin").parseFetchNonRetryableUserErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"FetchNonRetryableUserError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableUserError","NonRetryableUserError"],[t,n])}l.parseFetchOrFetchNonRetryableUserErrorMixinGroup=e}),98);
__d("WASmaxInDevicesFetchUserResponseFailureMixin",["WAResultOrError","WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!n.success)return n;var r=o("WASmaxParseJid").attrUserJid(e,"jid");if(!r.success)return r;var a=o("WASmaxInDevicesFetchOrFetchNonRetryableUserErrorMixinGroup").parseFetchOrFetchNonRetryableUserErrorMixinGroup(n.value);return a.success?o("WAResultOrError").makeResult({jid:r.value,errorFetchOrFetchNonRetryableUserErrorMixinGroup:a.value}):a}l.parseFetchUserResponseFailureMixin=e}),98);
__d("WASmaxInDevicesDeviceModelInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"platform");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"model");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(t){var n=o("WASmaxParseUtils").optionalChildWithTag(t,"platform",e);if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"model",s);return r.success?o("WAResultOrError").makeResult({platform:n.value,model:r.value}):r}l.parseDeviceModelInfoPlatform=e,l.parseDeviceModelInfoModel=s,l.parseDeviceModelInfoMixin=u}),98);
__d("WASmaxInDevicesDhashMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").attrString(e,"dhash");return t.success?o("WAResultOrError").makeResult({dhash:t.value}):t}l.parseDhashMixin=e}),98);
__d("WASmaxInDevicesKeyDataMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").contentBytesRange(e,32,32);return t.success?o("WAResultOrError").makeResult({elementValue:t.value}):t}l.parseKeyDataMixin=e}),98);
__d("WASmaxInDevicesIdentityKeyMixin",["WASmaxInDevicesKeyDataMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"identity");if(!t.success)return t;var n=o("WASmaxInDevicesKeyDataMixin").parseKeyDataMixin(t.value);return n.success,n}l.parseIdentityKeyMixin=e}),98);
__d("WASmaxInDevicesDeviceListMixin",["WAResultOrError","WASmaxInDevicesDeviceModelInfoMixin","WASmaxInDevicesDhashMixin","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"device");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"id",1,999);if(!n.success)return n;var r=o("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(e);if(!r.success)return r;var a=o("WASmaxInDevicesDeviceModelInfoMixin").parseDeviceModelInfoMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({id:n.value},r.value,{deviceModelInfoMixin:a.success?a.value:null}))}function s(t){var n=o("WASmaxParseUtils").assertTag(t,"devices");if(!n.success)return n;var r=o("WASmaxInDevicesDhashMixin").parseDhashMixin(t),a=o("WASmaxParseUtils").mapChildrenWithTag(t,"device",0,25,e);return a.success?o("WAResultOrError").makeResult({dhashMixin:r.success?r.value:null,device:a.value}):a}l.parseDeviceListDevice=e,l.parseDeviceListMixin=s}),98);
__d("WASmaxInDevicesICDCDirtyMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"dirty","true");return n.success?o("WAResultOrError").makeResult({dirty:n.value}):n}l.parseICDCDirtyMixin=e}),98);
__d("WASmaxInDevicesICDCSeqMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").attrIntRange(e,"seq",0,2147483647);return t.success?o("WAResultOrError").makeResult({seq:t.value}):t}l.parseICDCSeqMixin=e}),98);
__d("WASmaxInDevicesICDCSignedListMixin",["WAResultOrError","WASmaxInDevicesICDCSeqMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"ts",0,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(e,1,40072);if(!r.success)return r;var a=o("WASmaxInDevicesICDCSeqMixin").parseICDCSeqMixin(e);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({ts:n.value,elementValue:r.value},a.value)):a}l.parseICDCSignedListMixin=e}),98);
__d("WASmaxInDevicesICDCFromServerMixin",["WAResultOrError","WASmaxInDevicesICDCDirtyMixin","WASmaxInDevicesICDCSignedListMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxInDevicesICDCSignedListMixin").parseICDCSignedListMixin(e);if(!n.success)return n;var r=o("WASmaxInDevicesICDCDirtyMixin").parseICDCDirtyMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({},n.value,{iCDCDirtyMixin:r.success?r.value:null}))}l.parseICDCFromServerMixin=e}),98);
__d("WASmaxInDevicesFetchUserResponseSuccessMixin",["WAResultOrError","WASmaxInDevicesDeviceListMixin","WASmaxInDevicesICDCFromServerMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"devices");if(!t.success)return t;var n=o("WASmaxInDevicesDeviceListMixin").parseDeviceListMixin(e);return n.success,n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"icdc");if(!t.success)return t;var n=o("WASmaxInDevicesICDCFromServerMixin").parseICDCFromServerMixin(e);return n.success,n}function u(t){var n=o("WASmaxParseUtils").assertTag(t,"user");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"devices",e);if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"icdc",s);if(!a.success)return a;var i=o("WASmaxParseJid").attrUserJid(t,"jid");return i.success?o("WAResultOrError").makeResult({jid:i.value,devices:r.value,icdc:a.value}):i}l.parseFetchUserResponseSuccessDevices=e,l.parseFetchUserResponseSuccessIcdc=s,l.parseFetchUserResponseSuccessMixin=u}),98);
__d("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup",["WAResultOrError","WASmaxInDevicesFetchUserResponseFailureMixin","WASmaxInDevicesFetchUserResponseSuccessMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesFetchUserResponseFailureMixin").parseFetchUserResponseFailureMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"FetchUserResponseFailure",value:t.value});var n=o("WASmaxInDevicesFetchUserResponseSuccessMixin").parseFetchUserResponseSuccessMixin(e);return n.success?o("WAResultOrError").makeResult({name:"FetchUserResponseSuccess",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["UserResponseFailure","UserResponseSuccess"],[t,n])}l.parseUserResponseFetchFailureOrFetchSuccessMixinGroup=e}),98);
__d("WASmaxInDevicesFetchUserResponseMixin",["WAResultOrError","WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxInDevicesUserResponseFetchFailureOrFetchSuccessMixinGroup").parseUserResponseFetchFailureOrFetchSuccessMixinGroup(e);return n.success?o("WAResultOrError").makeResult({userResponseFetchFailureOrFetchSuccessMixinGroup:n.value}):n}l.parseFetchUserResponseMixin=e}),98);
__d("WASmaxInDevicesIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInDevicesFetchResponseSuccess",["WAResultOrError","WASmaxInDevicesFetchUserResponseMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"user");if(!t.success)return t;var n=o("WASmaxInDevicesFetchUserResponseMixin").parseFetchUserResponseMixin(e);return n.success,n}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"users");if(!a.success)return a;var i=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"user",0,25,e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{usersUser:l.value})):l}l.parseFetchResponseSuccessUsersUser=e,l.parseFetchResponseSuccess=s}),98);
__d("WASmaxOutDevicesBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutDevicesDhashMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyDhash,n=o("WASmaxJsx").smax("smax$any",{dhash:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDhashMixin=s}),98);
__d("WASmaxOutDevicesICDCSeqMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anySeq,n=o("WASmaxJsx").smax("smax$any",{seq:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeICDCSeqMixin=s}),98);
__d("WASmaxOutDevicesFetchRequest",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutDevicesBaseIQGetRequestMixin","WASmaxOutDevicesDhashMixin","WASmaxOutDevicesICDCSeqMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=e.dhashMixinArgs,r=e.iCDCSeqMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutDevicesICDCSeqMixin").mergeICDCSeqMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutDevicesDhashMixin").mergeDhashMixin,o("WASmaxJsx").smax("user",{jid:o("WAWap").USER_JID(t)}),n),r);return a}function s(t){var n=t.userArgs,r=o("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("users",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,25))));return r}l.makeFetchRequestUsersUser=e,l.makeFetchRequest=s}),98);
__d("WASmaxDevicesFetchRPC",["WAComms","WASmaxInDevicesFetchResponseError","WASmaxInDevicesFetchResponseSuccess","WASmaxOutDevicesFetchRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutDevicesFetchRequest").makeFetchRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesFetchResponseSuccess").parseFetchResponseSuccess(r,n);if(a.success)return{name:"FetchResponseSuccess",value:a.value};var i=o("WASmaxInDevicesFetchResponseError").parseFetchResponseError(r,n);if(i.success)return{name:"FetchResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Fetch",{Success:a,Error:i}))}),s.apply(this,arguments)}l.sendFetchRPC=e}),98);
__d("WAFetchFbDevicesProtocolV2",["Promise","WAArrayChunk","WAHandleFbDeviceChangeNotificationProtocol","WAJids","WALoadContactsApi","WARPCAbortController","WASignalKeys","WASmaxDevicesFetchRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=25,d=1e4,m=o("WATagsLogger").TAGS(["wa-devices-protocol"]);function p(e,t){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(e.length===0)return new Map;var r=yield f(e,t),a=o("WAArrayChunk").chunk(e.map(function(e){var t=r.get(e),n=t!=null?{anyDhash:t}:null;return{userJid:e,dhashMixinArgs:n}}),c),i=new Map;return yield(u||(u=n("Promise"))).allSettled(a.map(function(e){return h(i,e)})),i}),_.apply(this,arguments)}function f(e,t){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){if(t)return new Map;var n=yield o("WALoadContactsApi").loadContacts(e),r=new Map;return n.forEach(function(e){e&&e.dhash!=null&&r.set(e.contactJid,e.dhash)}),r}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){try{var a=new Set(n.map(function(e){return e.userJid})),i=yield o("WARPCAbortController").rpcAbortController(o("WASmaxDevicesFetchRPC").sendFetchRPC({userArgs:n}),d);if(i.name==="FetchResponseError")throw r("err")("Failed to fetch user devices");i.value.usersUser.map(function(e){var n=e.userResponseFetchFailureOrFetchSuccessMixinGroup;if(n.name!=="FetchUserResponseFailure"){var r=n.value,i=r.devices,l=r.icdc,s=r.jid;a.delete(s),t.set(s,{newState:C(s,i,l,o("WATimeUtils").unixTime()),stateIsUpToDate:!1})}}),a.forEach(function(e){t.set(e,{stateIsUpToDate:!0})})}catch(t){if(t===o("WARPCAbortController").RPC_TIMEOUT){m.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Timeout for fetchAndSaveDevices"])));return}m.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)}}),y.apply(this,arguments)}function C(e,t,n,r){r===void 0&&(r=null);var a=[],i=null;if(t){var l;a=t.device.map(function(e){var t,n;return{id:o("WAJids").interpretAsDeviceId(e.id),identity:o("WASignalKeys").serializeIdentity(e.elementValue),platform:(t=e.deviceModelInfoMixin)==null||(t=t.platform)==null?void 0:t.elementValue,model:(n=e.deviceModelInfoMixin)==null||(n=n.model)==null?void 0:n.elementValue}}),i=(l=t.dhashMixin)==null?void 0:l.dhash}var s=null;if(n){var u=o("WAHandleFbDeviceChangeNotificationProtocol").parseICDCFromServer(n);s=u.success?u.value:null}return{jid:e,devices:a,lastSyncTs:o("WATimeUtils").unixTime(),dhash:i,icdcInfo:s,notificationTs:r}}l.fetchFbDevicesProtocol=p}),98);
__d("WADevicesState",["Promise","WAFetchAndSaveDevices","WAFetchFbDevicesProtocolV2","WAResolvable","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=3e4,p=1e3*60*60,_=o("WATagsLogger").TAGS(["WADevicesState"]),f=(function(){function t(){this.$1=new Map}var r=t.prototype;return r.$2=function(t){var e=this;setTimeout(function(){t.forEach(function(t){var n=t[0],r=t[1];r.resolveWasCalled()||(r.resolve(o("WAResultOrError").makeError()),e.$1.get(n)===r&&e.$1.delete(n))})},m),setTimeout(function(){t.forEach(function(t){var n=t[0],r=t[1];e.$1.get(n)===r&&e.$1.delete(n)})},p)},r.waitForUserDevices=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a){var i=this;a===void 0&&(a=!1);var l=[],m=[];a===!0&&t.forEach(function(e){i.$1.delete(e)}),t.forEach(function(e){var t=i.$1.get(e);if(t==null){var n=new(o("WAResolvable")).Resolvable;l.push([e,n]),i.$1.set(e,n)}else m.push([e,t.promise])}),this.$2(l),_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getDevices called for users ",", reason: ",""])),Array.from(t),r);var p=yield o("WAFetchFbDevicesProtocolV2").fetchFbDevicesProtocol(l.map(function(e){var t=e[0];return t}),a).catch(function(e){return _.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["fetchFBDevicesProtocol failed: ",""])),e),new Map}),f=!0;_.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["getDevices -> update devices signal"]))),yield o("WAFetchAndSaveDevices").updateUsersDevicesSignalAndDB(Array.from(p.values()).map(function(e){return e.newState}).filter(Boolean)).catch(function(e){f=!1,_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["updateDevicesSignalAndDB failed: ",""])),e)}),l.forEach(function(e){var t=e[0],n=e[1];if(!f){n.resolve(o("WAResultOrError").makeError()),i.$1.delete(t);return}p.has(t)?n.resolve(o("WAResultOrError").makeResult()):(n.resolve(o("WAResultOrError").makeError()),i.$1.delete(t))}),yield(d||(d=n("Promise"))).allSettled(m.map(function(e){var t=e[0],n=e[1];return n}))});function r(e,n,r){return t.apply(this,arguments)}return r})(),r.reset=function(t){var e=this;t.forEach(function(t){return e.$1.delete(t)})},t})(),g=new f;function h(){return g}l.DeviceStateClassV2=f,l.getDevicesState=h}),98);
__d("WAComputeICDC",["Promise","WAGetDevices","WAICDCUtils","WAIdentityUtils","WAJids","WATagsLogger","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("WATagsLogger").TAGS(["WAComputeICDC"]);function p(e,t,n,r){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r,a,i){var l=new Set,p=[].concat(t),_=t.find(function(e){return e.user===r});if(_==null){var f=yield i.cryptoManager.storage.loadIdentities(r),g=f.get(a);if(g==null){m.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Sender does not have identity"])));return}p.push({user:r,devicesInfo:[{identity:g,jid:a}]})}var h=void 0,y=[],C=[];return yield(d||(d=n("Promise"))).all(p.map((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield(d||(d=n("Promise"))).all([i.cryptoManager.storage.loadICDC(e.user),i.cryptoManager.storage.loadLastSyncTs(e.user)]),a=t[0],u=t[1];o("WAICDCUtils").isLastSyncTsExpired(u)&&l.add(e.user);var c=new Set;if(a==null)l.add(e.user);else if(o("WAICDCUtils").isICDCIndexInvalid(a))l.add(e.user),m.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ICDC has invalid index"]))),a=null;else for(var p of a.devices)c.add(p.toString());var _=[],f=[];for(var g of e.devicesInfo){var b=o("WAJids").extractDeviceId(g.jid),v=o("WAIdentityUtils").removeKeyTypeIfNeeded(g.identity);c.has(v.toString())||(_.push(b),f.push(v.buffer))}var S={unknownDevices:f,unknownDeviceIds:_};a!=null&&(S.seq=a.sequence,S.signingDevice=a.devices[a.signingDeviceIndex].buffer),e.user===r?h=S:(y.push(S),C.push(e.user))});return function(t){return e.apply(this,arguments)}})())),l.size>0&&(m.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Triggering getDevices for users with missing or incorrect icdc info."]))),o("WAGetDevices").getDevices({ignoreDhash:!0,reason:"missing-icdc-info",users:l}).catch(function(e){m.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices for users with missing icdc info: ",""])),e)})),{senderIdentity:h,recipientIdentities:y,recipientUserJids:C}}),_.apply(this,arguments)}l.computeICDC=p}),98);
__d("WAMultiDevice.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={};s.name="MultiDevice",s.internalSpec={payload:[1,(e=o("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,e.TYPES.MESSAGE,u]},u.name="MultiDevice$Metadata",u.internalSpec={},c.name="MultiDevice$Payload",c.internalSpec={applicationData:[1,e.TYPES.MESSAGE,d],signal:[2,e.TYPES.MESSAGE,y],__oneofs__:{payload:["applicationData","signal"]}},d.name="MultiDevice$ApplicationData",d.internalSpec={appStateSyncKeyShare:[1,e.TYPES.MESSAGE,p],appStateSyncKeyRequest:[2,e.TYPES.MESSAGE,m],__oneofs__:{applicationData:["appStateSyncKeyShare","appStateSyncKeyRequest"]}},m.name="MultiDevice$ApplicationData$AppStateSyncKeyRequestMessage",m.internalSpec={keyIds:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,h]},p.name="MultiDevice$ApplicationData$AppStateSyncKeyShareMessage",p.internalSpec={keys:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,_]},_.name="MultiDevice$ApplicationData$AppStateSyncKey",_.internalSpec={keyId:[1,e.TYPES.MESSAGE,h],keyData:[2,e.TYPES.MESSAGE,f]},f.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData",f.internalSpec={keyData:[1,e.TYPES.BYTES],fingerprint:[2,e.TYPES.MESSAGE,g],timestamp:[3,e.TYPES.INT64]},g.name="MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprint",g.internalSpec={rawId:[1,e.TYPES.UINT32],currentIndex:[2,e.TYPES.UINT32],deviceIndexes:[3,e.FLAGS.REPEATED|e.FLAGS.PACKED|e.TYPES.UINT32]},h.name="MultiDevice$ApplicationData$AppStateSyncKeyId",h.internalSpec={keyId:[1,e.TYPES.BYTES]},y.name="MultiDevice$Signal",y.internalSpec={},l.MultiDeviceSpec=s,l.MultiDevice$MetadataSpec=u,l.MultiDevice$PayloadSpec=c,l.MultiDevice$ApplicationDataSpec=d,l.MultiDevice$ApplicationData$AppStateSyncKeyRequestMessageSpec=m,l.MultiDevice$ApplicationData$AppStateSyncKeyShareMessageSpec=p,l.MultiDevice$ApplicationData$AppStateSyncKeySpec=_,l.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyDataSpec=f,l.MultiDevice$ApplicationData$AppStateSyncKey$AppStateSyncKeyData$AppStateSyncKeyFingerprintSpec=g,l.MultiDevice$ApplicationData$AppStateSyncKeyIdSpec=h,l.MultiDevice$SignalSpec=y}),98);
__d("WAParseAppStateSyncKeyRequest",["WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=[];for(var n of e.keyIds)n.keyId!=null&&t.push(o("WASyncdKeyTypes").toSyncKeyId(n.keyId));return{keyIds:t}}l.parseAppStateSyncKeyRequest=e}),98);
__d("WASyncdKeyManagementUtils",["WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return new DataView(o("WASyncdKeyTypes").fromSyncKeyId(e)).getUint16(0)}function s(e){return new DataView(o("WASyncdKeyTypes").fromSyncKeyId(e)).getUint32(2)}function u(e){return s(e)+1}l.getKeyDeviceId=e,l.getKeyEpoch=s,l.generateNewKeyEpoch=u}),98);
__d("WAParseAppStateSyncKeyShare",["WALogger","WALongInt","WASyncdKeyManagementUtils","WASyncdKeyTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=[],n=[];for(var r of e.keys){var o=u(r);o!=null&&(o.type==="orphan"?n.push(o.keyId):(o.type,t.push(o.keyData)))}return{keys:t,orphanKeys:n}}function u(t){var n,r,a,i,l,s;if(((n=t.keyId)==null?void 0:n.keyId)==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Key missing keyId"]))),null;var u=o("WASyncdKeyTypes").toSyncKeyId(t.keyId.keyId),c=(r=t.keyData)==null?void 0:r.keyData,d=o("WALongInt").maybeNumberOrThrowIfTooLarge((a=t.keyData)==null?void 0:a.timestamp),m=(i=t.keyData)==null||(i=i.fingerprint)==null?void 0:i.currentIndex,p=(l=t.keyData)==null||(l=l.fingerprint)==null?void 0:l.deviceIndexes,_=(s=t.keyData)==null||(s=s.fingerprint)==null?void 0:s.rawId;return t.keyData==null||c==null||d==null||m==null||p==null||_==null?{keyId:u,type:"orphan"}:{keyData:{fingerprint:{currentIndex:m,deviceIndexes:p,rawId:_},keyData:o("WASyncdKeyTypes").toSyncKeyData(c),keyEpoch:o("WASyncdKeyManagementUtils").getKeyEpoch(u),keyId:u,timestamp:d},type:"key"}}l.parseAppStateSyncKeyShare=s}),98);
__d("WAConvertAppData",["WAAppData","WAArmadilloApplication.pb","WAJids","WALogger","WAMultiDevice.pb","WAParseAppStateSyncKeyRequest","WAParseAppStateSyncKeyShare","WAStanzaUtils","WASyncdKeyTypes","WATimeUtils","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b;function v(e){var t=o("WAJids").interpretAndValidateJid(e);if(t.jidType==="msgrUser")return t.userJid;if(t.jidType==="group")return t.groupJid;throw t.jidType,r("err")("Incorrect jid type: "+t.jidType)}function S(e){var t=o("WAJids").interpretAndValidateJid(e);if(t.jidType==="msgrUser")return t.userJid;if(t.jidType==="msgrDevice")return o("WAJids").extractUserJid(t.deviceJid);throw t.jidType,r("err")("Incorrect jid type: "+t.jidType)}function R(e){return e!=null?typeof e=="number"&&e>o("WATimeUtils").MAX_INT?o("WATimeUtils").castMilliSecondsToUnixTime(e):o("WATimeUtils").castLongIntToUnixTime(e):void 0}function L(e){return e==null?void 0:{lastMessageTimestamp:R(e.lastMessageTimestamp),lastSystemMessageTimestamp:R(e.lastSystemMessageTimestamp),messages:e.messages==null?[]:e.messages.map(function(e){return{key:e.key==null?void 0:{fromMe:e.key.fromMe,id:e.key.id},ts:R(e.timestamp)}})}}function E(t,n){var r=t.chatId;if(r==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Missing chatId in chat action: ",""])),t),null;if(t.chatArchive!=null){var a=t.chatArchive,i=L(a.messageRange);return{chatJid:v(r),messageRange:i,ts:n,type:"chat_archive"}}else if(t.chatDelete!=null){var l=t.chatDelete,u=L(l.messageRange);return{chatJid:v(r),messageRange:u,ts:n,type:"chat_delete"}}else if(t.chatRead!=null){var c=t.chatRead,d=L(c.messageRange);return{chatJid:v(r),messageRange:d,read:c.read,ts:n,type:"chat_read"}}else return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),t),null}function k(e){var t=e.key,n=t==null?void 0:t.remoteJid,r=t==null?void 0:t.id,a=t==null?void 0:t.fromMe;if(t==null||n==null||a==null||r==null)return o("WALogger").WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Missing messageKey in message action: ",""])),e),null;var i=v(n),l=o("WAJids").interpretAsGroupJid(i)!=null,s;if(l&&!a){if((t==null?void 0:t.participant)==null)return o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["No participant in messageKey in message action when it is group chat and message is not fromMe: ",""])),e),null;s=S(t.participant)}else a?s=o("WAJids").AUTHOR_ME:s=S(n);var m={author:s,chat:i,externalId:o("WAStanzaUtils").toStanzaId(r)};return e.messageDelete!=null?{protocolMsgId:m,type:"delete_for_me"}:(o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),e),null)}function I(e){var t=[];for(var n of e){var r=R(n.actionTimestamp);if(n.chatAction!=null){var a=E(n.chatAction,r);a!=null&&t.push({chatAction:a})}else if(n.messageAction!=null){var i=k(n.messageAction);i!=null&&t.push({messageAction:i})}else o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata sync action type: ",""])),n)}return t}function T(e){var t=e.anonId,n=e.id,r=e.rootKey,a=e.status;if(a==null||n==null||t==null||r==null)return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecretsEpoch"]))),null;var i;if(a===o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN)i=o("WAAppData").EPOCH_STATUS_OPEN;else if(a===o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE)i=o("WAAppData").EPOCH_STATUS_CLOSE;else return o("WALogger").WARN(_||(_=babelHelpers.taggedTemplateLiteralLoose(["status in EncryptedBackupsSecretsEpoch has invalid value"]))),null;return{anonId:t,id:n,rootKey:r,status:i}}function D(e){var t=e.backupId,n=e.epoch,r=e.mailboxRootKey,a=e.obliviousValidationToken,i=e.serverDataId,l=e.tempOcmfClientState;return t==null||i==null||l==null||r==null||a==null?(o("WALogger").WARN(f||(f=babelHelpers.taggedTemplateLiteralLoose(["missing keys in EncryptedBackupsSecrets"]))),null):{backupId:t,epoch:n.map(T).reduce(function(e,t){return t!=null?e.concat([t]):e},[]),mailboxRootKey:r,obliviousValidationToken:a,serverDataId:i,tempOcmfClientState:l}}function x(e){var t,n;if(((t=e.applicationData)==null||(t=t.metadataSync)==null?void 0:t.actions)!=null){var r;return{actions:I((r=e.applicationData)==null||(r=r.metadataSync)==null?void 0:r.actions),type:"meta_sync"}}else if(((n=e.signal)==null?void 0:n.encryptedBackupsSecrets)!=null){var a=D(e.signal.encryptedBackupsSecrets);return a==null?null:{encryptedBackupsSecrets:a,type:"backups_secrets"}}else return o("WALogger").WARN(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e),null}function $(e){var t,n;if(((t=e.applicationData)==null?void 0:t.appStateSyncKeyShare)!=null){var r;return{syncKeyShare:o("WAParseAppStateSyncKeyShare").parseAppStateSyncKeyShare((r=e.applicationData)==null?void 0:r.appStateSyncKeyShare),type:"sync_key_share"}}else if(((n=e.applicationData)==null?void 0:n.appStateSyncKeyRequest)!=null){var a;return{syncKeyRequest:o("WAParseAppStateSyncKeyRequest").parseAppStateSyncKeyRequest((a=e.applicationData)==null?void 0:a.appStateSyncKeyRequest),type:"sync_key_request"}}else return o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e),null}function P(e){if(e.subprotocolType==="armadillo"){var t=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAArmadilloApplication.pb").ArmadilloSpec,e.payload);if(t.payload==null)throw r("err")("Appdata contains unparseable armadillo data.");return x(t.payload)}else if(e.subprotocolType==="multiDevice"){var n=o("decodeProtobuf").decodeProtobufWithUnknowns(o("WAMultiDevice.pb").MultiDeviceSpec,e.payload);if(n.payload==null)throw r("err")("Appdata contains unparseable armadillo data.");return $(n.payload)}else throw r("err")("Appdata contains unexpected message application: "+e.subprotocolType)}function N(e){return e==null?void 0:{lastMessageTimestamp:e.lastMessageTimestamp,lastSystemMessageTimestamp:e.lastSystemMessageTimestamp,messages:e.messages.map(function(e){return{key:e.key==null?void 0:{fromMe:e.key.fromMe,id:e.key.id},timestamp:e.ts}})}}function M(e){switch(e.type){case"meta_sync":return{payload:{applicationData:V(e)}};case"backups_secrets":return{payload:{signal:{encryptedBackupsSecrets:q(e.encryptedBackupsSecrets)}}};default:return e.type,o("WALogger").WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),{}}}function w(e){return{keyId:o("WASyncdKeyTypes").fromSyncKeyId(e)}}function A(e){return{keyData:{fingerprint:{currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes,rawId:e.fingerprint.rawId},keyData:o("WASyncdKeyTypes").fromSyncKeyData(e.keyData),timestamp:e.timestamp},keyId:w(e.keyId)}}function F(e){var t=e.keys.map(A),n=e.orphanKeys==null?[]:e.orphanKeys.map(function(e){return{keyId:w(e)}});return t.push.apply(t,n),{keys:t}}function O(e){return{keyIds:e.keyIds.map(w)}}function B(e){switch(e.type){case"sync_key_share":return{payload:{applicationData:{appStateSyncKeyShare:F(e.syncKeyShare)}}};case"sync_key_request":return{payload:{applicationData:{appStateSyncKeyRequest:O(e.syncKeyRequest)}}};default:return e.type,o("WALogger").WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),{}}}function W(e){var t;switch(e.type){case"meta_sync":case"backups_secrets":{var n=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloApplication.pb").ArmadilloSpec,M(e));t={armadillo:{payload:n.readByteArrayView(),version:1}};break}case"sync_key_share":case"sync_key_request":{var r=o("encodeProtobuf").encodeProtobuf(o("WAMultiDevice.pb").MultiDeviceSpec,B(e));t={multiDevice:{payload:r.readByteArrayView(),version:1}};break}default:e.type,o("WALogger").WARN(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""])),e.type),t={}}return{payload:{subProtocol:t}}}function q(e){return{backupId:e.backupId,epoch:e.epoch.map(U),mailboxRootKey:e.mailboxRootKey,obliviousValidationToken:e.obliviousValidationToken,serverDataId:e.serverDataId,tempOcmfClientState:e.tempOcmfClientState}}function U(e){var t;return e.status===o("WAAppData").EPOCH_STATUS_OPEN?t=o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_OPEN:e.status===o("WAAppData").EPOCH_STATUS_CLOSE&&(t=o("WAArmadilloApplication.pb").ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS.ES_CLOSE),{anonId:e.anonId,id:e.id,rootKey:e.rootKey,status:t}}function V(e){return{metadataSync:{actions:e.actions.map(function(e){return e.chatAction?{actionTimestamp:e.chatAction.ts,chatAction:H(e.chatAction)}:{messageAction:G(e.messageAction)}})}}}function H(e){var t=N(e.messageRange),n=e.chatJid;switch(e.type){case"chat_archive":return{chatArchive:{archived:e.archived,messageRange:t},chatId:n};case"chat_delete":return{chatDelete:{messageRange:t},chatId:n};default:return e.type,{chatId:n,chatRead:{messageRange:t,read:e.read}}}}function G(e){if(e.type==="delete_for_me"){var t=e.protocolMsgId.chat,n=o("WAJids").interpretAsGroupJid(t)!=null;return{key:{fromMe:o("WAJids").isAuthorMe(e.protocolMsgId.author),id:e.protocolMsgId.externalId,participant:!o("WAJids").isAuthorMe(e.protocolMsgId.author)&&n?e.protocolMsgId.author:void 0,remoteJid:t},messageDelete:{}}}else throw r("err")("No other available type")}function z(e){if(e.type!=="meta_sync")return[];var t=e.actions.map(function(e){var t,n=e.chatAction,r=e.messageAction;return(t=r==null?void 0:r.protocolMsgId.chat)!=null?t:n==null?void 0:n.chatJid}).filter(Boolean);return Array.from(new Set(t))}l.parseArmadilloAppData=x,l.parseMultiDeviceAppData=$,l.parseAppData=P,l.convertArmadilloAppData=M,l.convertMultiDeviceAppData=B,l.convertAppData=W,l.getChatJidForAppData=z}),98);
__d("WADbPersonalSenderKeyStatusTxns",["WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=["groupJid","senderKeyTs"],s=["groupJid","senderKeyTs"],u={hasSenderKey:new Set,rotateSenderKey:!0,senderKeyId:null,senderKeyTs:o("WATimeUtils").castToUnixTime(0)},c=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(e){return e.stores.personalSenderKeyStatuses.bulkPut(t.map(function(e){return babelHelpers.extends({},u,{groupJid:e})}))},o("WASignalDB").signalOp("bulkPutNewPersonalSenderKeyStatus")).then(function(){})},d=function(t,r,a){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.get(t);yield e.stores.personalSenderKeyStatuses.bulkPut([babelHelpers.extends({},n||u,{groupJid:t,rotateSenderKey:!1,senderKeyId:r,senderKeyTs:a})])});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("markSenderKeyAsRotated"))},m=function(r){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield t.stores.personalSenderKeyStatuses.get(r);if(n!=null){var o=n.groupJid,a=n.senderKeyTs,i=babelHelpers.objectWithoutPropertiesLoose(n,e);return babelHelpers.extends({},i,{ts:a})}var l=babelHelpers.extends({},u,{groupJid:r});yield t.stores.personalSenderKeyStatuses.bulkPut([l]);var c=l.groupJid,d=l.senderKeyTs,m=babelHelpers.objectWithoutPropertiesLoose(l,s);return babelHelpers.extends({},m,{ts:d})});return function(e){return t.apply(this,arguments)}})(),"Signal - getSenderKeyStatus")},p=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.bulkGet(t);yield e.stores.personalSenderKeyStatuses.bulkPut(n.filter(function(e){return e!=null}).map(function(e){return babelHelpers.extends({},e,{rotateSenderKey:!0})}))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("bulkSetRotateSenderKeyToTrue"))},_=function(t){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(e){return e.stores.personalSenderKeyStatuses.bulkDelete(t)},o("WASignalDB").signalOp("deletePersonalSenderKeyStatus"))};l.bulkPutNewPersonalSenderKeyStatus=c,l.markSenderKeyAsRotated=d,l.getSenderKeyStatus=m,l.bulkSetRotateSenderKeyToTrue=p,l.deletePersonalSenderKeyStatus=_}),98);
__d("WACreateGroup",["WADbPersonalSenderKeyStatusTxns","WAGlobals","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){yield o("WAGlobals").getDependencies().createGroups(e),yield o("WADbPersonalSenderKeyStatusTxns").bulkPutNewPersonalSenderKeyStatus(e.map(function(e){return e.groupToCreate.jid}))});return function(n){return e.apply(this,arguments)}})();l.createGroups=e}),98);
__d("WAGetPrekeyIdsInRange",["WASignalKeys"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e}function s(t,n){var r=[],a=t,i=n;if(a<=i)for(var l=a;l<=n;l++)r.push(o("WASignalKeys").castToPreKeyId(l));else{for(var s=a;s<o("WASignalKeys").PRE_KEY_NON_INCLUSIVE_UPPER_BORDER;s++)r.push(o("WASignalKeys").castToPreKeyId(s));for(var u=1;u<=i;u++)r.push(o("WASignalKeys").castToPreKeyId(u))}return r}l.getPrekeyIdsInRange=s}),98);
__d("WADeletePreKeyGenerationsApi",["Promise","WAGetPrekeyIdsInRange","WALogger","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(r){return o("WASignalDB").getDb().runInTransaction(["prekey","prekeyGeneration"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield t.stores.prekeyGeneration.bulkGet(r),i=[];for(var l of a){if(l==null){o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Attempting to delete non-existent prekey generation"])));continue}for(var u of o("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(l.startingId,l.endingId))i.push(u)}yield(s||(s=n("Promise"))).all([t.stores.prekeyGeneration.bulkDelete(r),t.stores.prekey.bulkDelete(i)])});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("deletePreKeyGenerations"))};l.deletePreKeyGenerations=u}),98);
__d("WAGetLastPreKeyGenerationIdApi",["Promise","WADbSignal","WASignalDB","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(t){return(e||(e=n("Promise"))).all([t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyId).then(function(e){return e==null?void 0:e.value.lastPrekeyId}),t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(e){return e==null?void 0:e.value.lastPrekeyGenerationId})])},o("WASignalDB").signalOp("getLastPreKeyGenerationId")),a=t[0],i=t[1];if(a==null&&i!=null||a!=null&&i==null)throw r("err")("Last prekey id and Last prekey generation id should both be non-null");return a!=null&&i!=null?{lastGenerationId:i,lastPreKeyId:a}:null});return function(){return t.apply(this,arguments)}})();l.getLastPreKeyGenerationId=s}),98);
__d("WAGetPreKeyGenerationsTimestampsApi",["WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WASignalDB").getDb().runInTransaction(["prekeyGeneration"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.prekeyGeneration.readAll();return t.map(function(e){return{id:e.generationId,timestamp:e.createdTs}})});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("getPreKeyGenerationsTimestamps"))};l.getPreKeyGenerationsTimestamps=e}),98);
__d("WALoadICDCApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet([t]).then(function(e){var t,n=e.filter(Boolean).length>0?e[0]:null;return(t=n==null?void 0:n.icdcInfo)!=null?t:null})},o("WASignalDB").signalOp("loadICDC"))};l.loadICDC=e}),98);
__d("WALoadIdentitiesApi",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(t){return o("WASignalDB").getDb().runInTransaction(["identity"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.identity.readIndex("userJid",[t]);return new Map(n.filter(Boolean).map(function(e){return[e.deviceJid,e.identity]}))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadIdentities"))},u=function(r){return o("WASignalDB").getDb().runInTransaction(["identity"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var o=yield(e||(e=n("Promise"))).all(r.map(function(e){return t.stores.identity.readIndex("userJid",[e])})),a=new Map;for(var i of o)for(var l of i)if(l!=null){var s=a.get(l.userJid);s==null&&(s=new Map),s.set(l.deviceJid,l.identity),a.set(l.userJid,s)}return a});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("bulkLoadIdentities"))};l.loadIdentities=s,l.bulkLoadIdentities=u}),98);
__d("WALoadLastSyncTsApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readonly",function(e){return e.stores.contacts.bulkGet([t]).then(function(e){var t,n=e.filter(Boolean).length>0?e[0]:null;return(t=n==null?void 0:n.lastSyncTs)!=null?t:null})},o("WASignalDB").signalOp("loadLastSyncTs"))};l.loadLastSyncTs=e}),98);
__d("WADbMetaTxns",["WADbSignal","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.meta.bulkGet([o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,o("WADbSignal").MetaKeysEnum.identityKeyPair]).then(function(e){var t=e[0],n=e[1],r=t==null?void 0:t.value.lastSignedPrekeyId,o=n==null?void 0:n.value.identityKeyPair;return{identityPair:o,keyId:r}})}var s=function(t){return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){return yield e.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.cat,value:{cat:t}}]),t});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveCAT"))};l.maybeGetLastSignedPrekeyIdAndIdentity=e,l.saveCAT=s}),98);
__d("WADbSignedPrekeyTxns",["WADbMetaTxns","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WADbMetaTxns").maybeGetLastSignedPrekeyIdAndIdentity(e),n=t.identityPair,r=t.keyId;if(r==null)return n==null?o("WAResultOrError").makeError("missing-last-signed-prekey-id-and-registration"):o("WAResultOrError").makeError("missing-last-signed-prekey-id");var a=yield e.signedPrekey.get(r);return a==null?o("WAResultOrError").makeError("missing-last-signed-prekey"):o("WAResultOrError").makeResult(a.encoded)}),s.apply(this,arguments)}l.getLatestSignedPreKey=e}),98);
__d("WALoadLatestSignedPreKeyApi",["WADbSignedPrekeyTxns","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readonly",function(e){return o("WADbSignedPrekeyTxns").getLatestSignedPreKey(e.stores)},o("WASignalDB").signalOp("loadLatestSignedPreKey"))};l.loadLatestSignedPreKey=e}),98);
__d("WALoadOneTimePreKeyApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["prekey"],"readonly",function(e){return e.stores.prekey.get(t).then(function(e){return e==null?void 0:e.encoded})},o("WASignalDB").signalOp("loadOneTimePreKey"))};l.loadOneTimePreKey=e}),98);
__d("WADbPrekeyTxns",["WAGetPrekeyIdsInRange","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield e.prekeyGeneration.get(t);if(n==null)throw r("err")("Expected a prekey generation row");var a=o("WAGetPrekeyIdsInRange").getPrekeyIdsInRange(n.startingId,n.endingId),i=yield e.prekey.bulkGet(a);return i.filter(Boolean).map(function(e){return e.encoded})}),s.apply(this,arguments)}l.getPrekeysForGeneration=e}),98);
__d("WALoadPreKeysApi",["WADbPrekeyTxns","WADbSignal","WADbSignedPrekeyTxns","WALoggerTag","WASignalDB","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS([r("WALoggerTag").SignedPrekey]),d=function(a){return o("WASignalDB").getDb().runInTransaction(["identity","meta","prekey","prekeyGeneration","signedPrekey"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=yield o("WADbSignedPrekeyTxns").getLatestSignedPreKey(t.stores);if(!n.success){var i;throw c.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to get latest signed prekey"]))),(i=n.error)!=null?i:r("err")("Failed to get latest signed prekey")}var l=o("WASignalSignatures").deserializeSignedPreKey(n.value);if(l==null)throw c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize signed prekey"]))),r("err")("Failed to deserialize signed prekey");var d=a!=null?a:yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId).then(function(e){return e==null?void 0:e.value.lastPrekeyGenerationId});if(d==null)throw c.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["No last prekey generation id"]))),r("err")("No last prekey generation id");return o("WADbPrekeyTxns").getPrekeysForGeneration(t.stores,d).then(function(e){return{preKeys:e,signedPreKey:l}})});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadPreKeys"))};l.loadPreKeys=d}),98);
__d("WALoadSenderKeySessionApi",["WACryptoManager","WADbSignal","WAJids","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,r){var e=o("WAJids").extractUserJid(r),a=o("WAJids").extractDeviceId(r),i=o("WADbSignal").buildSenderKeySessionId(t,e,a);return o("WASignalDB").getDb().runInTransaction(["senderKeySessions"],"readonly",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.stores.senderKeySessions.get(i);if(t==null)return o("WAResultOrError").makeError("errLoadSenderKeySession");var n=o("WACryptoManager").decodeSenderKeySession(t.record);return o("WAResultOrError").makeResult(n)});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadSenderKeySession"))};l.loadSenderKeySession=e}),98);
__d("WALoadSignedPreKeyApi",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(e){return e.stores.signedPrekey.get(t).then(function(e){return e==null?void 0:e.encoded})},o("WASignalDB").signalOp("loadSignedPreKey"))};l.loadSignedPreKey=e}),98);
__d("WASaveOneTimePreKeyApi",["Promise","WADbSignal","WAResultOrError","WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r){return o("WASignalDB").getDb().runInTransaction(["meta","prekey"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var a=yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyId),i=a==null?void 0:a.value.lastPrekeyId;return i==null?o("WAResultOrError").makeError("missing_last_prekey"):(yield(e||(e=n("Promise"))).all([t.stores.prekey.bulkPut([babelHelpers.extends({},r,{isDeleted:!1})]),t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:r.keyId}}])]),o("WAResultOrError").makeResult())});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveOneTimePreKey"))};l.saveOneTimePreKey=s}),98);
__d("WASavePreKeysGenerationApi",["Promise","WACryptoManager","WADbSignal","WAResultOrError","WASignalDB","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){if(t.length===0)throw r("err")("Keys provided to savePreKeysGeneration cannot be empty");var a=yield o("WASignalDB").getDb().runInTransaction(["meta","prekey","prekeyGeneration"],"readwrite",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a,i=yield r.stores.meta.get(o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId),l=o("WACryptoManager").castToPreKeyGenerationId(((a=i==null?void 0:i.value.lastPrekeyGenerationId)!=null?a:0)+1),s=t[0].keyId,u=t[t.length-1].keyId,c=t.map(function(e){return babelHelpers.extends({},e,{isDeleted:!1})});return yield(e||(e=n("Promise"))).all([r.stores.prekey.bulkPut(c),r.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastPrekeyId,value:{lastPrekeyId:u}},{key:o("WADbSignal").MetaKeysEnum.lastPrekeyGenerationId,value:{lastPrekeyGenerationId:l}}]),r.stores.prekeyGeneration.bulkPut([{createdTs:o("WATimeUtils").unixTime(),endingId:u,generationId:l,startingId:s}])]),o("WAResultOrError").makeResult(l)});return function(e){return r.apply(this,arguments)}})(),o("WASignalDB").signalOp("savePreKeysGeneration"));return a});return function(n){return t.apply(this,arguments)}})();l.savePreKeysGeneration=s}),98);
__d("WASaveSignedPreKeyIfNewApi",["Promise","WADbSignal","WASignalDB","WASignalSignatures","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(r,a){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var i=yield t.stores.signedPrekey.get(r);if(i!=null){var l=o("WASignalSignatures").deserializeSignedPreKey(i.encoded);if(l!=null)return{key:l,type:"duplicate"}}return yield(e||(e=n("Promise"))).all([t.stores.signedPrekey.bulkPut([{encoded:a,keyId:r}]),t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:r}}])]),{type:"success"}});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveSignedPreKeyIfNew"))};l.saveSignedPreKeyIfNew=s}),98);
__d("WASessionApi",["WACryptoManager","WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return o("WASignalDB").getDb().store("session").get(t).then(function(e){return e==null?null:o("WACryptoManager").decodeSession(e.session)})},s=function(t){return o("WASignalDB").getDb().store("session").bulkGet(t).then(u)};function u(e){var t=new Map;for(var n of e)if(n!=null){var r=o("WACryptoManager").decodeSession(n.session);t.set(n.id,r)}return t}l.loadSession=e,l.bulkLoadSession=s}),98);
__d("WACryptoDbCallbacks",["WABulkSaveSignalDataApi","WADeletePreKeyGenerationsApi","WAGetLastPreKeyGenerationIdApi","WAGetPreKeyGenerationsTimestampsApi","WALoadICDCApi","WALoadIdentitiesApi","WALoadLastSyncTsApi","WALoadLatestSignedPreKeyApi","WALoadOneTimePreKeyApi","WALoadPreKeysApi","WALoadSenderKeySessionApi","WALoadSignedPreKeyApi","WASaveOneTimePreKeyApi","WASavePreKeysGenerationApi","WASaveSignedPreKeyIfNewApi","WASessionApi"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return{bulkLoadIdentities:o("WALoadIdentitiesApi").bulkLoadIdentities,bulkSaveSignalData:o("WABulkSaveSignalDataApi").bulkSaveSignalData,deletePreKeyGenerations:o("WADeletePreKeyGenerationsApi").deletePreKeyGenerations,getLastPreKeyGenerationId:o("WAGetLastPreKeyGenerationIdApi").getLastPreKeyGenerationId,getPreKeyGenerationsTimestamps:o("WAGetPreKeyGenerationsTimestampsApi").getPreKeyGenerationsTimestamps,loadICDC:o("WALoadICDCApi").loadICDC,loadIdentities:o("WALoadIdentitiesApi").loadIdentities,loadLastSyncTs:o("WALoadLastSyncTsApi").loadLastSyncTs,loadLatestSignedPreKey:o("WALoadLatestSignedPreKeyApi").loadLatestSignedPreKey,loadOneTimePreKey:o("WALoadOneTimePreKeyApi").loadOneTimePreKey,loadPreKeys:o("WALoadPreKeysApi").loadPreKeys,loadSenderKeySession:o("WALoadSenderKeySessionApi").loadSenderKeySession,loadSession:o("WASessionApi").loadSession,loadSessions:o("WASessionApi").bulkLoadSession,loadSignedPreKey:o("WALoadSignedPreKeyApi").loadSignedPreKey,saveOneTimePreKey:o("WASaveOneTimePreKeyApi").saveOneTimePreKey,savePreKeysGeneration:o("WASavePreKeysGenerationApi").savePreKeysGeneration,saveSignedPreKeyIfNew:o("WASaveSignedPreKeyIfNewApi").saveSignedPreKeyIfNew}};l.getCryptoDbCallbacks=e}),98);
__d("memoizeWithArgsLFUCache",["LFUCache"],(function(t,n,r,o,a,i,l){function e(e,t,n,o){var a;function i(){return a||(a=new(r("LFUCache"))(n)),a}function l(e){if(e===void 0)a=null;else{var t;(t=a)==null||t.delete(e)}}o&&o(l);var s=function(){var n=i(),r=t.apply(void 0,arguments);n.has(r)||n.set(r,e.apply(void 0,arguments));var o=n.get(r);return o};return s}l.default=e}),98);
__d("WAMPSFlushable",["MpsTypes","WebMps","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=[],this.$2=new Map,this.$3=new Set}var t=e.prototype;return t.enqueue=function(t,n,r){t!=null&&(this.$1.push(t),this.$2.set(t.messageId,n),this.$3.add(r))},t.flush=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a){if(this.$1.length!==0){var i=this.$1,l=Array.from(this.$3).join(", "),s=this.$2;this.$1=[],this.$2=new Map,this.$3=new Set;try{var u=yield o("WebMps").mps().saveNewMessages(i.map(function(e){return{directive:null,message:e,insertionSource:o("MpsTypes").InsertionSource.Receive}}),{source:l});s.forEach(function(e,t){e(u.get(t))})}catch(e){var c=r("getErrorSafe")(e);s.forEach(function(e){e(c)})}}});function t(t,n,r,o){return e.apply(this,arguments)}return t})(),e})(),s=new e;l.MPSFlushable=e,l.mpsFlushable=s}),98);
__d("WASignalEntityStoreV2",["$InternalEnum","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["NOT_PERSISTED","PERSIST_IN_PROGRESS","PERSISTED"]),l=(function(){function t(){this.$1=new Map}var r=t.prototype;return r.TEST_ONLY_LOAD_FROM_MEMORY=function(t){return this.$2(t)},r.$2=function(t){var e=this.$1.get(t);return e!=null?{entity:e.entity,deleted:e.deleted}:null},r.load=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=this.$2(e);if(n!=null&&n.deleted)return null;if(n!=null&&n.entity!=null)return n.entity;var r=yield t(e);return this.$3(e,r),r});function t(t,n){return e.apply(this,arguments)}return t})(),r.bulkLoad=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=[],r=new Map;for(var o of e){var a=this.$2(o);if(a==null){n.push(o);continue}a.deleted||(a.entity!=null?r.set(o,a.entity):n.push(o))}var i=yield t(n);for(var l of i.entries()){var s=l[0],u=l[1];r.set(s,u),this.$3(s,u)}return r});function t(t,n){return e.apply(this,arguments)}return t})(),r.$3=function(n,r){this.$1.set(n,{entity:r,status:e.PERSISTED,deleted:!1})},r.store=function(n,r){this.$1.set(n,{entity:r,status:e.NOT_PERSISTED,deleted:!1})},r.remove=function(n){this.$1.set(n,{entity:null,status:e.NOT_PERSISTED,deleted:!0})},r.pureSnapshot=function(){var t=[],n=Array.from(this.$1.entries()).filter(function(t){var n=t[0],r=t[1];return r.status===e.NOT_PERSISTED}).filter(function(e){var n=e[0],r=e[1];return r.deleted&&t.push({id:n}),!r.deleted}).filter(function(e){var t=e[0],n=e[1];return n.entity!=null}).map(function(e){var t=e[0],n=e[1];return{id:t,cachedEntity:n.entity}});return{update:n,remove:t}},r.snapshot=function(){var t=this,n=this.pureSnapshot();return n.remove.forEach(function(n){var r=n.id,o=t.$1.get(r);o&&(o.status=e.PERSIST_IN_PROGRESS)}),n.update.forEach(function(n){var r=n.id,o=t.$1.get(r);o&&(o.status=e.PERSIST_IN_PROGRESS)}),n},r.markSnapshotAsCommitted=function(){this.$1.forEach(function(t){t.status===e.PERSIST_IN_PROGRESS&&(t.status=e.PERSISTED)})},r.markSnapshotAsFailed=function(){this.$1.forEach(function(t){t.status===e.PERSIST_IN_PROGRESS&&(t.status=e.NOT_PERSISTED)})},r.clear=function(){this.$1=new Map},t})();i.PersistStatus=e,i.SignalEntityStore=l}),66);
__d("WASignalIdentityStore",["Promise","WAJids","WALogger","WASignalEntityStoreV2","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(){function t(){this.$1=new Map,this.$2=new(o("WASignalEntityStoreV2")).SignalEntityStore}var r=t.prototype;return r.bulkLoadIdentities=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,r=function*(){var e=o[0],r=o[1];yield t.loadIdentitiesByUser(e,function(){return(s||(s=n("Promise"))).resolve(r)})};for(var o of e)yield*r();return e});function t(t){return e.apply(this,arguments)}return t})(),r.loadIdentitiesByUser=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,r){var a=this.$1.get(t);if(a==null){var i=this.$3(t,yield r(t)),l=Array.from(i.keys());return this.$1.set(t,new Set(l)),this.$2.bulkLoad(l,function(){return(s||(s=n("Promise"))).resolve(i)})}else return this.$2.bulkLoad(Array.from(a),function(t){return t.length>0&&o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[WASignalIdentityStore] This should never happen."]))),(s||(s=n("Promise"))).resolve(new Map)})});function r(e,n){return t.apply(this,arguments)}return r})(),r.$3=function(t,n){var e=new Map(n),r=this.$2.pureSnapshot(),a=r.remove,i=r.update;for(var l of a){var s=l.id;e.delete(s)}for(var u of i){var c=u.cachedEntity,d=u.id;c!=null&&o("WAJids").extractUserJid(d)===t&&e.set(d,c)}return e},r.store=function(t,n){this.$2.store(t,n);var e=o("WAJids").extractUserJid(t),r=this.$1.get(e);r!=null&&r.add(t)},r.remove=function(t){this.$2.remove(t);var e=o("WAJids").extractUserJid(t),n=this.$1.get(e);n!=null&&n.delete(t)},r.clear=function(){this.$2.clear(),this.$1=new Map},r.load=function(t,n){return this.$2.load(t,n)},r.bulkLoad=function(t,n){return this.$2.bulkLoad(t,n)},r.snapshot=function(){return this.$2.snapshot()},r.pureSnapshot=function(){return this.pureSnapshot()},r.markSnapshotAsCommitted=function(){this.$2.markSnapshotAsCommitted()},r.markSnapshotAsFailed=function(){this.$2.markSnapshotAsFailed()},t})();l.SignalIdentityStore=u}),98);
__d("WAInMemorySignalStore",["MAWMpsGating","Promise","WAArmadilloTransportEvent.pb","WABuildMpsPayload","WACryptoManager","WACryptoUtils","WAGlobals","WAIdentityUtils","WAJids","WAMPSFlushable","WAProtocolQueue","WAResultOrError","WASignalEntityStoreV2","WASignalIdentityStore","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b=o("WATagsLogger").TAGS(["CryptoManager","InMemorySignalStore"]),v=(function(){function t(e,t){var r=this,a;this.loadSession=function(e,t){return r.$1.load(e,function(e){return r.$9.loadSession(e,t)})},this.loadSessions=function(e){return r.$1.bulkLoad(e,function(e){return r.$9.loadSessions(e).then(function(e){return new Map(Array.from(e.entries()).map(function(e){return[e[0],e[1]]}))})}).then(function(e){return new Map(Array.from(e.entries()).map(function(e){return[e[0],e[1]]}))})},this.loadSignedPreKey=function(e){return r.$7.load(e,function(){return r.$9.loadSignedPreKey(e)})},this.bulkLoadIdentities=function(e){var t=new Map;return(C||(C=n("Promise"))).all(e.map(function(e){return r.loadIdentities(e).then(function(n){t.set(e,n)})})).then(function(){return t})},this.loadIdentities=function(e){return r.$5.loadIdentitiesByUser(e,function(){return r.$9.loadIdentities(e)})},this.saveIdentity=function(e,t){return(C||(C=n("Promise"))).resolve(r.storeIdentity(e,t))},this.loadOneTimePreKey=function(e){return r.$6.load(e,function(){return r.$9.loadOneTimePreKey(e)})},this.saveSenderKeySession=function(e,t,o){return r.storeSenderKeySession(e,t,o),(C||(C=n("Promise"))).resolve()},this.saveSignedPreKeyIfNew=function(e,t){return r.$9.saveSignedPreKeyIfNew(e,t)},this.loadSenderKeySession=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=yield r.$8.load(o("WACryptoManager").encodeSenderKey(e,t),n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield r.$9.loadSenderKeySession(e,t);return n.success?n.value:null}));return a==null?o("WAResultOrError").makeError("errLoadSenderKeySession"):o("WAResultOrError").makeResult(a)});return function(t,n){return e.apply(this,arguments)}})(),this.handleNewSession=function(e,t,a,i,l){return r.storeSession(e,t),a!=null&&r.storeIdentity(e,a),i!=null&&r.removeOneTimePreKey(i),(C||(C=n("Promise"))).resolve(o("WAResultOrError").makeResult())},this.saveICDC=function(e,t){return r.$3.store(e,t),(C||(C=n("Promise"))).resolve()},this.loadICDC=function(e){return r.$3.load(e,function(){return r.$9.loadICDC(e)})},this.saveLastSyncTs=function(e,t){return r.$4.store(e,t),(C||(C=n("Promise"))).resolve()},this.loadLastSyncTs=function(e){return r.$4.load(e,function(){return r.$9.loadLastSyncTs(e)})},this.saveDhash=function(e,t){return r.$2.store(e,t),(C||(C=n("Promise"))).resolve()},this.getLastPreKeyGenerationId=function(){return r.$9.getLastPreKeyGenerationId()},this.savePreKeysGeneration=function(e){return r.$9.savePreKeysGeneration(e)},this.getPreKeyGenerationsTimestamps=function(){return r.$9.getPreKeyGenerationsTimestamps()},this.deletePreKeyGenerations=function(e){return r.$9.deletePreKeyGenerations(e)},this.saveOneTimePreKey=function(e){return r.$9.saveOneTimePreKey(e)},this.loadPreKeys=function(e){return r.$9.loadPreKeys(e)},this.loadLatestSignedPreKey=function(){return r.$9.loadLatestSignedPreKey()},this.$9=e,this.$10=t,this.$5=new(o("WASignalIdentityStore")).SignalIdentityStore,this.$1=new(a=o("WASignalEntityStoreV2")).SignalEntityStore,this.$2=new a.SignalEntityStore,this.$3=new a.SignalEntityStore,this.$4=new a.SignalEntityStore,this.$6=new a.SignalEntityStore,this.$7=new a.SignalEntityStore,this.$8=new a.SignalEntityStore}var r=t.prototype;return r.storeSession=function(t,n){this.$1.store(t,n)},r.storeIdentity=function(t,n){n&&this.$5.store(t,n)},r.removeOneTimePreKey=function(t){this.$6.remove(t)},r.storeSenderKeySession=function(t,n,r){this.$8.store(o("WACryptoManager").encodeSenderKey(t,n),r)},r.updateUserDevicesInfo=function(r){var t=this;return(C||(C=n("Promise"))).all(r.map((function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){var a=yield t.loadIdentities(r.jid),i=r.devices,l=r.dhash,_=r.icdcInfo,f=r.jid,g=r.lastSyncTs,h=r.notificationTs;b.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Update user devices: userJid: ","; new identities: ","; previous identities: ","}"])),f,i.map(function(e){var t=e.id;return o("WAJids").toDeviceJid(r.jid,t)}).join(","),Array.from(a.keys()).join(","));var y=new Set(a.keys()),v=[],S=[];for(var R of i){var L=R.id,E=R.identity,k=R.model,I=R.platform,T=o("WAJids").toDeviceJid(r.jid,L),D=a.get(T);if(o("WAGlobals").getMyDeviceJid()===T){var x=o("WACryptoUtils").uint8ArraysEqual(o("WAIdentityUtils").removeKeyTypeIfNeeded(t.$10.staticKeyPair.publicKey),o("WAIdentityUtils").removeKeyTypeIfNeeded(E));x||b.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Receiving an identity for my device but it is different from original one"])))}if(y.delete(T),D==null)S.push({instruction:"identityAdded",jid:o("WAJids").extractUserJid(T),type:"instruction",device:T,identity:E,model:k,platform:I,notificationTs:h,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow});else if(!o("WACryptoUtils").uint8ArraysEqual(D,E)){if(o("WAJids").extractUserJid(T)!==f){b.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove session the other one"])));continue}v.push(T),b.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Removing session dur to identity mismatch: ",""])),T),S.push({instruction:"identityChanged",jid:o("WAJids").extractUserJid(T),type:"instruction",device:T,identity:E,model:k,platform:I,notificationTs:h,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow})}}var $=[];for(var P of y){if(o("WAJids").extractUserJid(P)!==f){b.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Device notification of one user cannot remove identity the other one "])));continue}$.push(P),o("WAGlobals").getMyDeviceJid()===P&&b.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Removing my device identity. This should not happen"]))),b.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Removing old identity: ",""])),P),S.push({instruction:"identityRemoved",jid:o("WAJids").extractUserJid(P),type:"instruction",device:P,notificationTs:h,priority:o("WAProtocolQueue").WAProtocolQueuePriorityLow})}return(C||(C=n("Promise"))).all([l!=null?t.saveDhash(f,l):(C||(C=n("Promise"))).resolve(),g!=null?t.saveLastSyncTs(f,g):(C||(C=n("Promise"))).resolve(),_!=null?t.saveICDC(f,_):(C||(C=n("Promise"))).resolve()].concat(Array.from($).map(function(e){return t.deleteIdentity(e)}),[$.concat(v).map(function(e){return t.$11(e)})],i.map(function(e){var n=e.id,r=e.identity;return t.saveIdentity(o("WAJids").toDeviceJid(f,n),r)}))).then(function(){return S})});return function(e){return r.apply(this,arguments)}})())).then(function(e){var t=e.flat();t.forEach(function(e){var t,n;switch(e.instruction){case"identityAdded":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED;break;case"identityChanged":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED;break;case"identityRemoved":n=o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED;break;default:return}var r=o("WAGlobals").getDependencies().generateExternalId();o("WAMPSFlushable").mpsFlushable.enqueue(o("WABuildMpsPayload").buildMpsDeviceChangeAdminMessage(e.jid,(t=e.notificationTs)!=null?t:o("WATimeUtils").unixTime(),r,n,e.platform,e.model),function(e){if(e!=null){b.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to save device change admin message: ",""])),e);return}},"handle_device_change"),o("MAWMpsGating").isFullMpsEnabled()||o("WAProtocolQueue").pqFlushable.enqueue(e)}),o("MAWMpsGating").isFullMpsEnabled()&&o("WAGlobals").getDependencies().recordDeviceChangeHistory(t.map(function(e){var t,n,r;if(e.device==null)return null;var a=e.device;switch(e.instruction){case"identityAdded":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.ADDED,platform:e.platform,model:e.model,device:a,identity:e.identity,ts:(t=e.notificationTs)!=null?t:o("WATimeUtils").unixTime()};case"identityChanged":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED,platform:e.platform,model:e.model,device:a,identity:e.identity,ts:(n=e.notificationTs)!=null?n:o("WATimeUtils").unixTime()};case"identityRemoved":return{jid:e.jid,deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REMOVED,device:a,ts:(r=e.notificationTs)!=null?r:o("WATimeUtils").unixTime()};default:return null}}).filter(Boolean)).catch(function(e){b.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failed to record device change history: ",""])),e)})}).then(function(){})},r.savePendingToDatabase=function(){var e=this,t=this.$12();return t==null?(C||(C=n("Promise"))).resolve():(b.DEV(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Snapshot: ",""])),t),b.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: start"]))),this.$9.bulkSaveSignalData(t).then(function(){b.LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Snapshot save: end"]))),e.$13()},function(t){return e.$14(),(C||(C=n("Promise"))).reject(t)}))},r.clear=function(){this.$1.clear(),this.$5.clear(),this.$6.clear(),this.$7.clear(),this.$8.clear(),this.$2.clear(),this.$3.clear()},r.deleteIdentity=function(t){return this.$5.remove(t),(C||(C=n("Promise"))).resolve()},r.$11=function(t){return this.$1.remove(t),(C||(C=n("Promise"))).resolve()},r.$13=function(){this.$1.markSnapshotAsCommitted(),this.$2.markSnapshotAsCommitted(),this.$3.markSnapshotAsCommitted(),this.$4.markSnapshotAsCommitted(),this.$5.markSnapshotAsCommitted(),this.$6.markSnapshotAsCommitted(),this.$7.markSnapshotAsCommitted(),this.$8.markSnapshotAsCommitted()},r.$14=function(){this.$1.markSnapshotAsFailed(),this.$2.markSnapshotAsFailed(),this.$3.markSnapshotAsFailed(),this.$4.markSnapshotAsFailed(),this.$5.markSnapshotAsFailed(),this.$6.markSnapshotAsFailed(),this.$7.markSnapshotAsFailed(),this.$8.markSnapshotAsFailed()},r.$12=function(){var e=this.$1.snapshot(),t=[],n=e.remove.map(function(e){return e.id});e.update.forEach(function(e){var n=e.cachedEntity,r=e.id;n!=null&&t.push({id:r,updated:n})});var r=[];this.$8.snapshot().update.forEach(function(e){var t=o("WACryptoManager").decodeSenderKey(e.id),n=t.deviceId,a=t.groupId;e.cachedEntity!=null&&a&&n&&r.push({groupId:a,author:n,updated:e.cachedEntity})});var a=this.$5.snapshot(),i=a.remove.map(function(e){return e.id}),l=[];a.update.forEach(function(e){var t=e.cachedEntity,n=e.id;t!=null&&l.push({id:n,identity:t})});var s=this.$6.snapshot().remove,u=this.$2.snapshot(),c=[];for(var d of u.update){var m=d.cachedEntity,p=d.id;m!=null&&c.push({id:p,dhash:m})}var _=this.$4.snapshot(),f=[];for(var g of _.update){var h=g.cachedEntity,y=g.id;h!=null&&f.push({id:y,lastSyncTs:h})}var C=this.$3.snapshot(),b=[];for(var v of C.update){var S=v.cachedEntity,R=v.id;S!=null&&b.push({id:R,icdc:S})}return t.length===0&&n.length===0&&l.length===0&&r.length===0&&s.length===0&&b.length===0&&c.length===0&&f.length===0&&i.length===0?null:{dhashUpdate:c,icdcUpdate:b,identityRemove:i,identityUpdate:l,preKeyRemove:s,senderKeySessionUpdate:r,sessionRemove:n,sessionUpdate:t,lastSyncTsUpdate:f}},r.warmCache=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=this,n=e.map(o("WAJids").interpretAsUserJid).filter(Boolean),r=yield this.$9.bulkLoadIdentities(n).then(function(e){return t.$5.bulkLoadIdentities(e)}),a=Array.from(r.values()).reduce(function(e,t){return e.concat(Array.from(t.keys()))},[]);yield this.loadSessions(a)});function t(t){return e.apply(this,arguments)}return t})(),t})();l.InMemorySignalStoreImpl=v}),98);
__d("WARequestKeysBatcher",["WAResolvable"],(function(t,n,r,o,a,i,l){"use strict";var e={delayMs:50,maxSize:100};function s(t,n){var r=n===void 0?e:n,a=r.delayMs,i=r.maxSize,l=null;function s(e){return l&&l.args===e&&(l=null),t(e)}return function(e){if(l!=null)l.args.push(e);else{var t=[e],n=new(o("WAResolvable")).Resolvable,r=n.promise.then(s),u=function(){return void n.resolve(t)},c=setTimeout(u,a);l={args:t,batchPromise:r,run:u,timer:c}}var d=l,m=d.args,p=d.batchPromise,_=m.length-1;if(m.length>=i){var f;clearTimeout((f=l)==null?void 0:f.timer),l.run(),l=null}return p.then(function(e){return e[_]})}}l.makeSimpleBatcher=s}),98);
__d("WARequestKeys",["WABulkRequestKeys","WAPromiseManagement","WARequestKeysBatcher","WAResultOrError","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WARequestKeysBatcher").makeSimpleBatcher((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WABulkRequestKeys").bulkRequestKeys(e);return t.success===!1?e.map(function(){return t}):e.map(function(e){var n=t.value.get(e);return n?o("WAResultOrError").makeResult(n):o("WAResultOrError").makeError("errRequestKeysNoKeys")})});return function(t){return e.apply(this,arguments)}})()),s=o("WAPromiseManagement").cacheWhilePending(function(e){return e},e);l.requestKeys=s}),98);
__d("WACryptoManagerUtils",["Promise","WABulkRequestKeys","WACryptoDbCallbacks","WACryptoManager","WAGlobals","WAHandleFailureUtils","WAInMemorySignalStore","WALogger","WALoggerTag","WARequestKeys","WAResultOrError","WASignalKeys","WASignalSignatures","WATagsLogger","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f=o("WATagsLogger").TAGS([r("WALoggerTag").SignedPrekey]);function g(e){var t=new(o("WAInMemorySignalStore")).InMemorySignalStoreImpl(o("WACryptoDbCallbacks").getCryptoDbCallbacks(),e),n=h();return{manager:o("WACryptoManager").initCryptoManager({regInfo:e,storage:t,network:n}),storage:t}}function h(){return{requestKeys:o("WARequestKeys").requestKeys,bulkRequestKeys:o("WABulkRequestKeys").bulkRequestKeys}}function y(t,r,a,i){var l=null;return o("WACryptoManager").decryptContent(i.cryptoManager,r,{ciphertext:a,type:t},function(e,t){return l={plaintext:e,remoteIdentity:t},(_||(_=n("Promise"))).resolve()}).then(function(e){return e.success?o("WAResultOrError").makeResult(l):e}).catch(function(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),t),t})}function C(e,t,r,a){var i=null;return o("WACryptoManager").decryptGroupContent(a.cryptoManager,e,t,r,function(e){return i={plaintext:e},(_||(_=n("Promise"))).resolve()}).then(function(e){return e.success?o("WAResultOrError").makeResult(i):e}).catch(function(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["DecryptMsg runtime error: ",""])),e),e})}function b(e,t){return o("WACryptoManager").getParticipantInfo(t,e)}function v(e){return e.storage.getPreKeyGenerationsTimestamps()}function S(e,t){return t.storage.deletePreKeyGenerations(e)}function R(e,t,n,r){return o("WACryptoManager").saveSenderKeySession(r.cryptoManager,e,t,n)}function L(e){return E.apply(this,arguments)}function E(){return E=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield e.storage.loadLatestSignedPreKey();if(t.success===!1)throw f.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Missing signed prekey: ",", triggering reregistration"])),t.error),yield o("WAHandleFailureUtils").reregisterPhone(),r("err")("No signed prekey: "+t.error);var a=o("WASignalSignatures").deserializeSignedPreKey(t.value);if(a==null)throw f.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Cannot deserialize signed prekey"]))),r("err")("Cannot deserialize signed prekey");var i=yield o("WACryptoManager").generateOneTimePreKey(e);if(i==null)throw o("WATagsLogger").TAGS([r("WALoggerTag").OneTimePrekey]).ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate one time prekey"]))),r("err")("Cannot generate one time prekey");var l=e.regInfo,s=l.regId,u=l.staticKeyPair;return(_||(_=n("Promise"))).resolve({regId:s,keyType:o("WASignalKeys").KEY_TYPE,publicKey:u.publicKey,signedPreKey:a,preKey:i})}),E.apply(this,arguments)}function k(e,t,n){return o("WACryptoManager").encryptGroupContent(n.cryptoManager,e,o("WAGlobals").getMyDeviceJid(),t).catch(function(e){return o("WATagsLogger").TAGS(["EncryptGroupContent"]).ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Runtime excpetion when encrypting group content: ",""])),e),o("WAResultOrError").makeError("runtime-exception")})}function I(e,t){return o("WACryptoManager").bulkEncryptContent(t.cryptoManager,e)}function T(e,t,n,r,a){return o("WACryptoManager").encryptContent(n.cryptoManager,e,t,r||o("WACryptoManager").DEFAULT_SESSION_REQUEST,a)}function D(e,t){return o("WACryptoManager").bulkEncryptContent(t.cryptoManager,e).then(function(e){return e.success===!1?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[SendMessage] Fail encrypt messages"]))),new Map):e.value})}function x(e,t){return $.apply(this,arguments)}function $(){return $=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var r=yield o("WACryptoManager").ensureSessionsExists(t.cryptoManager,e);yield(_||(_=n("Promise"))).all(Array.from(r.entries()).map(function(e){var n=e[0],r=e[1];return t.cryptoManager.storage.handleNewSession(n,r,r.remote.pubKey)}))}),$.apply(this,arguments)}l.createCryptoManager=g,l.decryptMsg=y,l.decryptGroupMsg=C,l.getParticipantInfo=b,l.getPreKeyGenerationsTimestamps=v,l.deletePreKeyGenerations=S,l.saveSenderKeySession=R,l.getSignalInfoForRetry=L,l.encryptGroupContentWithMetrics=k,l.bulkEncryptMsgWithMetrics=I,l.encryptMsgWithMetrics=T,l.bulkEncrypt=D,l.bulkPreEstablishOutgoingSession=x}),98);
__d("WADbRegistrationApi",["Promise","WADbSignal","WAJids","WALogger","WASignalDB","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(t,r){return o("WASignalDB").getDb().runInTransaction(["contacts"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.contacts.get(t);return n!=null?e.stores.contacts.bulkPut([babelHelpers.extends({},n,{icdcInfo:r})]):e.stores.contacts.bulkPut([{contactJid:t,dhash:null,icdcInfo:r}])});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveICDC")).then(function(){})};function c(e){return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(t){return t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:e}}])},o("WASignalDB").signalOp("saveDeviceId")).then(function(){})}function d(e,t){return o("WASignalDB").getDb().runInTransaction(["meta","signedPrekey"],"readwrite",(function(){var r=n("asyncToGeneratorRuntime").asyncToGenerator(function*(r){yield(s||(s=n("Promise"))).all([r.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.deviceUUID,value:{deviceUUID:t.deviceUUID}},{key:o("WADbSignal").MetaKeysEnum.fbid,value:{fbid:e}},{key:o("WADbSignal").MetaKeysEnum.regId,value:{regId:t.signalRegInfo.regId}},{key:o("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:t.signalRegInfo.identityKeyPair}},{key:o("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:t.signalRegInfo.signedPreKey.keyId}},{key:o("WADbSignal").MetaKeysEnum.registrationVersion,value:{registrationVersion:t.registrationVersion}},{key:o("WADbSignal").MetaKeysEnum.authKeyPair,value:{authKeyPair:t.signalRegInfo.authKeyPair}},{key:o("WADbSignal").MetaKeysEnum.deviceRegUnixTime,value:{deviceRegUnixTime:t.registrationUnixTime}}]),r.stores.signedPrekey.bulkPut([t.signalRegInfo.signedPreKey])])});return function(e){return r.apply(this,arguments)}})(),o("WASignalDB").signalOp("saveRegistrationMeta"))}var m=function(t){var e=t.sessionId;return o("WASignalDB").getDb().runInTransaction(["meta"],"readwrite",function(t){return t.stores.meta.bulkPut([{key:o("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,value:{lastSessionDeviceWasLinkedTo:e}}])},o("WASignalDB").signalOp("saveLastSessionDeviceWasLinkedTo")).then(function(){})};function p(){return o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,a=yield t.stores.meta.bulkGet([(n=o("WADbSignal")).MetaKeysEnum.fbid,n.MetaKeysEnum.deviceId,n.MetaKeysEnum.cat,n.MetaKeysEnum.regId,n.MetaKeysEnum.identityKeyPair,n.MetaKeysEnum.authKeyPair]),i=a[0],l=a[1],s=a[2],u=a[3],c=a[4],d=a[5];o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["worker: got db data"])));var m=i==null?void 0:i.value.fbid,p=l==null?void 0:l.value.deviceId,_=s==null?void 0:s.value.cat,f=u==null?void 0:u.value.regId,g=c==null?void 0:c.value.identityKeyPair,h=d==null?void 0:d.value.authKeyPair;if(m==null)throw r("err")("fbid not set");if(p==null)throw r("err")("deviceId not set");if(_==null)throw r("err")("fbCat not set");if(f==null||g==null)throw r("err")("regInfo not set");return{deviceJid:o("WAJids").toDeviceJid(o("WAJids").toMsgrUserJid(m),p),fbCat:_.encrypted_serialized_cat,regInfo:{authKeyPair:h,regId:f,staticKeyPair:g},userJid:o("WAJids").toMsgrUserJid(m)}});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("loadAllRegistrationMeta"))}l.saveICDC=u,l.saveDeviceId=c,l.saveRegistrationMeta=d,l.saveLastSessionDeviceWasLinkedTo=m,l.loadAllRegistrationMetaInTransaction=p}),98);
__d("WAMapUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return new Map(Array.from(e.entries()).map(function(e){return[e[0],t(e[1],e[0])]}))}i.mapValues=e}),66);
__d("WAProtocolMediaType",[],(function(t,n,r,o,a,i){"use strict";function e(e){switch(e){case"image":case"sticker":case"gif":case"video":case"ptt":case"audio":case"document":return e;case"xma-image":return"document";default:return null}}i.castToProtocolMediaType=e}),66);
__d("WAEncNode",["WAAsMessageTransport","WACryptoManagerUtils","WAGlobals","WALogger","WAMapUtils","WAMsgTransport.pb","WANullthrows","WAProtocolMediaType","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n,a,i){var l=new Set,s=new Set,u=new Set,c=o("WAMapUtils").mapValues(t,function(e,t){var n=e.icdc,r=e.params,o;switch(l.add(r.type),r.type){case"message":{o=d({messageBytes:r.messageBytes,to:t,icdc:n,chat:r.chat,backupDirective:r.backupDirective,applicationPayloadVersion:r.applicationPayloadVersion}),s.add(r.messageType.type),r.messageType.mediaType!=null&&u.add(r.messageType.mediaType);break}case"appdata":{o=m({messageBytes:r.messageBytes});break}default:r.type,o=p({skdm:r.skdm,icdc:n})}return{plaintext:o}});return o("WACryptoManagerUtils").bulkEncryptMsgWithMetrics(c,n).then(function(n){return n.success?o("WAMapUtils").mapValues(n.value,function(e,n){var a,l,s=e.baseKey,u=e.ciphertext,c=e.type,d=r("WANullthrows")((a=t.get(n))==null?void 0:a.params),m=d.type==="message"&&d.messageType.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(d.messageType.mediaType):null;return{encType:"device",to:n,v:((l=d.messageBytes)==null?void 0:l.version)==="v2"?"2":"3",type:c,mediaType:m,count:i,ciphertext:u,baseKey:s}}):(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),n.error),null)})}function c(e,t,n,r,a,i,l,u){var c;switch(t.type){case"message":{c=d({messageBytes:t.messageBytes,to:e,icdc:l,chat:t.chat,backupDirective:u,applicationPayloadVersion:t.applicationPayloadVersion});break}case"appdata":{c=m({messageBytes:t.messageBytes});break}default:t.type,c=p({skdm:t.skdm,icdc:l})}var _=o("WACryptoManagerUtils").encryptMsgWithMetrics(e,c,n,a,i);return _.then(function(n){var a;if(!n.success)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to encrypt message: ",""])),n.error),null;var i=t.type==="message"&&t.messageType.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(t.messageType.mediaType):null,l=n.value,u=l.ciphertext,c=l.type;return{encType:"device",to:e,v:((a=t.messageBytes)==null?void 0:a.version)==="v2"?"2":"3",type:c,mediaType:i,count:r,ciphertext:u,baseKey:n.value.baseKey}})}function d(e){var t=e.applicationPayloadVersion,n=e.backupDirective,r=e.chat,a=e.icdc,i=e.messageBytes,l=e.to;if(i.version==="v3"){var s=null;o("WAGlobals").isPeerDevice(l)&&(s=r);var u=o("WAAsMessageTransport").asMessageTransport(i.bytes,s,null,a,n,t);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,u).readByteArrayView()}else return o("WAGlobals").isPeerDevice(l)?i.bytesForPeer:i.bytes}function m(e){var t=e.messageBytes;if(t.version==="v3"){var n=o("WAAsMessageTransport").asMessageTransport(t.bytes);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,n).readByteArrayView()}else throw r("err")("Plaintext v2 not supported yet")}function p(e){var t=e.icdc,n=e.skdm,r=o("WAAsMessageTransport").asMessageTransport(null,null,n,t);return o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,r).readByteArrayView()}l.getEncNodes=u,l.getEncNode=c}),98);
__d("WAPhash",["Promise","WABase64","WABinary","WACryptoDependencies","WALogger","WASortedLists"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- Start"])));for(var r=o("WASortedLists").sortAndDedupe(t),a=new(o("WABinary")).Binary,i=0;i<r.length;i++)a.writeString(r[i]);return(u||(u=n("Promise"))).resolve(o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",a.readByteArrayView()).then(function(e){o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Calculate pHash -- end"])));var t=new Uint8Array(e,0,6);return"2:"+o("WABase64").encodeB64(t)}))}l.calculatePHash=c}),98);
__d("WAEncUserMsg",["Promise","WAComputeICDC","WAEncNode","WAGlobals","WAJids","WAPhash","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y=o("WATagsLogger").TAGS(["WAEncUserMsg"]);function C(e,t,n,r){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,a,i){y.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- START"]))),e.length===0&&y.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- no recipient"]))),y.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- ICDC"])));var l=e.flatMap(function(e){return e.devicesInfo}).map(function(e){return e.jid});E(e)&&y.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- OTHER_RECIPENT_DEVICE_EMPTY"])));var s;return t.type==="message"&&!r("gkx")("3176")&&(s=yield k(e,a,i)),(h||(h=n("Promise"))).all([S(l,t,a,s,i),o("WAPhash").calculatePHash(l.concat(o("WAGlobals").getMyDeviceJid()))]).then(function(e){var t=e[0],n=e[1];return y.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptUserMsg -- user message -- DONE"]))),{participants:t,phash:n}})}),b.apply(this,arguments)}function v(e,t,n){return S(e,t,n)}function S(t,n,r,o,a){return L(t,n,r,o,a).then(function(t){if(t.length===0){y.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- EMPTY NODE"]))),a==null||a.addPoint("getParticipantNodes_empty_node");return}return t})}function R(e,t,n,r,a,i){return o("WAEncNode").getEncNode(e,t,n,r,a,i)}function L(e,t,n,r,a){var i=!1;y.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt -- getParticipantNodes -- START"]))),(t.type!=="message"||o("WAJids").interpretAsGroupJid(t.chat)!=null)&&(i=!0);var l=o("WAEncNode").getEncNodes(new Map(e.map(function(e){return[e,{params:t,icdc:r}]})),n).then(function(e){return e==null?(y.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- encrypt - getParticipantNodes -- EMPTY DEVICE JIDS"]))),a==null||a.addPoint("getParticipantNodes_empty_device_jids"),[]):(t.type==="message"&&(i=i||Array.from(e.keys()).some(function(e){return o("WAJids").extractUserJid(e)===t.chat})),Array.from(e==null?void 0:e.values()))});return l.then(function(e){return i?e:(y.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- getParticipantNodes -- receiverEncypted -- FALSE"]))),a==null||a.addPoint("getParticipantNodes_receiverEncypted_false"),[])}).then(function(e){return e.filter(Boolean)})}function E(e){return e.filter(function(e){return e.user!==o("WAGlobals").getMyUserJid()}).flatMap(function(e){return e.devicesInfo}).length===0}function k(e,t,n){return I.apply(this,arguments)}function I(){return I=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r;try{n==null||n.addPoint("icdc_start"),r=yield o("WAComputeICDC").computeICDC(e,o("WAGlobals").getMyUserJid(),o("WAGlobals").getMyDeviceJid(),t),n==null||n.addPoint("icdc_end",{bool:{isICDCEmpty:r==null}})}catch(e){n==null||n.addPoint("icdc-error"),y.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["WAEncUserMsg -- ICDC calc error: ",""])),e)}return r}),I.apply(this,arguments)}l.encryptUserMsg=C,l.encryptGroupFanoutMsg=v,l.encryptDeviceJidMessage=R}),98);
__d("WAGetUserDevices",["asyncToGeneratorRuntime"],(function(t,n,r,o,a,i){"use strict";function e(e,t){return l.apply(this,arguments)}function l(){return l=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield t.storage.bulkLoadIdentities(e);return Array.from(n).flatMap(function(e){var t=e[1];return Array.from(t.keys())})}),l.apply(this,arguments)}i.getUserDevices=e}),66);
__d("WAEncGroupMsg",["WAAsMessageTransport","WABridge","WACryptoManager","WACryptoManagerUtils","WADbPersonalSenderKeyStatusTxns","WAEncUserMsg","WAGetUserDevices","WAGlobals","WAHex","WAMsgTransport.pb","WAOdsEnums","WAPhash","WAPromiseQueue","WAProtocolMediaType","WAResultOrError","WASortedLists","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WAEncGroupMsg"]),f=30*o("WATimeUtils").DAY_SECONDS,g=new(o("WAPromiseQueue")).PromiseQueue;function h(e,t,n){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.senderKeyId;if(r==null||e.rotateSenderKey||!o("WATimeUtils").happenedWithin(e.ts,f))return o("WAResultOrError").makeError("sender-key-invalid");var a=yield n.cryptoManager.storage.loadSenderKeySession(t,o("WAGlobals").getMyDeviceJid());if(a.success===!1||a.value.senderKeyStates.length===0)return o("WAResultOrError").makeError("sender-key-missing");var i=a.value.senderKeyStates.at(-1);return i==null?o("WAResultOrError").makeError("sender-key-missing"):i.senderKeyId!==e.senderKeyId?o("WAResultOrError").makeError("sender-key-id-mismatch"):o("WAResultOrError").makeResult({senderKeyId:r})}),y.apply(this,arguments)}function C(e,t){return b.apply(this,arguments)}function b(){return b=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=yield o("WACryptoManager").rotateGroupSenderKey(t.cryptoManager,e,o("WAGlobals").getMyDeviceJid());return yield o("WADbPersonalSenderKeyStatusTxns").markSenderKeyAsRotated(e,n.senderKeyId,o("WATimeUtils").unixTime()),{senderKeyId:n.senderKeyId}}),b.apply(this,arguments)}function v(t,r,a,i){return g.enqueue(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield o("WADbPersonalSenderKeyStatusTxns").getSenderKeyStatus(t),l=yield h(n,t,a),s=yield o("WAGetUserDevices").getUserDevices(r,a.cryptoManager),u=new Set(s);if(l.success===!1){_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Rotating sender key for group "," because ",""])),t,l.error),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.GROUP_SKS_INVALID,key:l.error}),i.addPoint("sender_key_rotation_start");var c=yield C(t,a);return i.addPoint("sender_key_rotation_end"),{senderKeyId:c.senderKeyId,needsSenderKey:u,groupParticipants:new Set(s)}}else{var d;return((d=n.hasSenderKey)!=null?d:[]).forEach(function(e){return u.delete(e)}),i.addPoint("no_sk_rotation",{int:{noRotationNeedsSK:u.size}}),{senderKeyId:l.value.senderKeyId,needsSenderKey:u,groupParticipants:new Set(s)}}}))}function S(e,t,n,r,o,a,i){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a,i,l){l.addPoint("enc_group_start");var f=yield v(e,t.map(function(e){return e.user}),a,l),g=f.groupParticipants,h=f.needsSenderKey,y=f.senderKeyId;_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finish rotate participant info"]))),l.addPoint("rotated_participant_info");var C=null,b,S,R=t.flatMap(function(e){return e.devicesInfo}).map(function(e){return e.jid});g.delete(o("WAGlobals").getMyDeviceJid());var E=!o("WASortedLists").areEqual(o("WASortedLists").asSortedSet(g),o("WASortedLists").sortAndDedupe(R)),k=r.type==="text"&&r.isRevoked,I=r.type==="media"?o("WAProtocolMediaType").castToProtocolMediaType(r.mediaType):null;if(E||k){var T=yield o("WAEncUserMsg").encryptGroupFanoutMsg(R,{type:"message",messageBytes:n,messageType:r,chat:e,backupDirective:i},a);T&&!(r.type==="text"&&r.isInvisible===!0)&&(b=T,S={encType:"group",to:e,v:n.version==="v3"?"3":"2",type:"skmsg",mediaType:I,ciphertext:null}),_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Finish group fanout msg"]))),l.addPoint("finish_group_fanout_msg")}else{var D;if(n.version==="v3"){var x=o("WAAsMessageTransport").asMessageTransport(n.bytes);D=o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,x).readByteArrayView()}else D=n.bytes;var $=yield o("WACryptoManagerUtils").encryptGroupContentWithMetrics(e,D,a);if(_.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Finish encrypt group content"]))),l.addPoint("finish_encrypt_group_content"),$.success){_.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Encrypt success"])));var P=$.value;if(y!==P.senderKeyId&&g.forEach(function(e){return h.add(e)}),h.size>0){var N={groupId:e,axolotlSenderKeyDistributionMessage:o("WAHex").bytesToBuffer(P.senderKeyDistributionProto)};_.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start key distribution"])));var M=R.filter(function(e){return h.has(e)}),w=yield L(M,N,a);_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["end key distribution"]))),l.addPoint("finish_skdm_enc_node"),w.length>0&&(b=w,C={group:e,senderKeyId:P.senderKeyId,knowsSenderKey:new Set(M)})}S={encType:"group",to:e,v:n.version==="v2"?"2":"3",type:P.ciphertext.type,mediaType:I,ciphertext:P.ciphertext.ciphertext},r.type==="text"&&r.isInvisible===!0&&(S={encType:"group",to:e,v:n.version==="v2"?"2":"3",type:"skmsg",mediaType:null,ciphertext:null})}}var A=yield o("WAPhash").calculatePHash(R.concat(o("WAGlobals").getMyDeviceJid()));return l.addPoint("phash_finish"),{phash:A,participants:b,encNode:S,senderKeyDistributionInfo:C}}),R.apply(this,arguments)}function L(e,t,n){var r=o("WAAsMessageTransport").asMessageTransport(null,null,t,null),a=o("encodeProtobuf").encodeProtobuf(o("WAMsgTransport.pb").MessageTransportSpec,r).readByteArrayView();return o("WACryptoManagerUtils").bulkEncrypt(new Map(e.map(function(e){return[e,{plaintext:a}]})),n).then(function(e){var t=[];return e.forEach(function(e,n){t.push({encType:"device",to:n,v:"3",type:e.type,ciphertext:e.ciphertext,mediaType:null,count:null,baseKey:null})}),t})}l.encryptGroupMsg=S}),98);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(t,r,a){return r==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]))),(u||(u=n("Promise"))).resolve(null)):a!=null&&a!==0?(o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""])),a),(u||(u=n("Promise"))).resolve(null)):o("WAFranking").genFrankingTag(r,t)}l.genFrankingTagFromMessageApplicationEncode=c}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=yield o("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(e,t,n);return{frankingKey:t,frankingTag:r,frankingVersion:o("WAFranking").getFrankingVersion(n),reportingContent:o("WAByteArray").uint8ArrayToBuffer(e),reportingTag:null}}),s.apply(this,arguments)}l.genReportingMeta=e}),98);
__d("WAGetKeysForUpload",["WALoggerTag","WAResultOrError","WASignalKeys","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS([r("WALoggerTag").PrekeyGenerateAndUpload,r("WALoggerTag").SignedPrekey]);function u(t,n){return t.storage.loadPreKeys(n).then(function(n){var r=n.preKeys,a=n.signedPreKey,i=[];return r.forEach(function(t){var n=o("WASignalKeys").deserializePreKey(t);n==null?s.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to deserialize prekey received from the db"]))):i.push(n)}),o("WAResultOrError").makeResult({regInfo:t.regInfo,keyType:o("WASignalKeys").KEY_TYPE,preKeys:i,signedPreKey:a})})}l.getKeysForUpload=u}),98);
__d("WAMakeSignedPreKeyMixin",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={idElementValue:o("WAWap").BIG_ENDIAN_CONTENT(e.id,3)},n={anyElementValue:e.keyPair.publicKey},r=e.signature;return{keyIDMixinArgs:t,keyDataMixinArgs:n,signatureElementValue:r}}l.makeSignedPreKeyMixin=e}),98);
__d("WARandomJitter",[],(function(t,n,r,o,a,i){"use strict";function e(){return Math.round(Math.random()*500-250)}i.getRandomJitter=e}),66);
__d("WARetryUtils",["WARandomJitter"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e?{algo:{backoff:{first:1,second:1,type:"fibonacci"},toMs:function(t){return(1+t)*1e3+o("WARandomJitter").getRandomJitter()},type:"adjust"},relativeDelay:!0,max:6e5}:{algo:{type:"adjust",backoff:{type:"fibonacci",first:1,second:1},toMs:function(t){return(9+t)*1e3}},max:62e4}}l.fibonacciBackoff=e}),98);
__d("WASmaxInPreKeysSetVnameFailureBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureBadRequestMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"text");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureFallbackMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");return n.success?o("WAResultOrError").makeResult({text:n.value}):n}l.parseSetVnameFailureInternalServerErrorMixin=e}),98);
__d("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"violation");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","not-acceptable");if(!r.success)return r;var a=o("WASmaxParseUtils").attrString(n.value,"reason");if(!a.success)return a;var i=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrInt,n.value,"max");if(!i.success)return i;var l=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrInt,n.value,"length");return l.success?o("WAResultOrError").makeResult({text:r.value,violationReason:a.value,violationMax:i.value,violationLength:l.value}):l}l.parseSetVnameFailureNotAcceptableMixin=e}),98);
__d("WASmaxInPreKeysVnameFailures",["WAResultOrError","WASmaxInPreKeysSetVnameFailureBadRequestMixin","WASmaxInPreKeysSetVnameFailureFallbackMixin","WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin","WASmaxInPreKeysSetVnameFailureNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysSetVnameFailureNotAcceptableMixin").parseSetVnameFailureNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysSetVnameFailureBadRequestMixin").parseSetVnameFailureBadRequestMixin(e);if(n.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureBadRequest",value:n.value});var r=o("WASmaxInPreKeysSetVnameFailureInternalServerErrorMixin").parseSetVnameFailureInternalServerErrorMixin(e);if(r.success)return o("WAResultOrError").makeResult({name:"SetVnameFailureInternalServerError",value:r.value});var a=o("WASmaxInPreKeysSetVnameFailureFallbackMixin").parseSetVnameFailureFallbackMixin(e);return a.success?o("WAResultOrError").makeResult({name:"SetVnameFailureFallback",value:a.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["VnameFailureNotAcceptable","VnameFailureBadRequest","VnameFailureInternalServerError","VnameFailureFallback"],[t,n,r,a])}l.parseVnameFailures=e}),98);
__d("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysVnameFailures","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(r.value,"error");if(!a.success)return a;var i=o("WASmaxParseUtils").attrString(r.value,"text");if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,r.value,"code",207);if(!l.success)return l;var s=o("WASmaxParseUtils").attrIntRange(a.value,"code",400,599);if(!s.success)return s;var u=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!u.success)return u;var c=o("WASmaxInPreKeysVnameFailures").parseVnameFailures(a.value);return c.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorText:i.value,errorCode:l.value,errorErrorCode:s.value},u.value,{errorErrorVnameFailures:c.value})):c}l.parseSetResponsePreKeySuccessVnameFailure=e}),98);
__d("WASmaxInPreKeysIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"field");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"name");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"reason");return r.success?o("WAResultOrError").makeResult({name:n.value,reason:r.value}):r}function s(t){var n=o("WASmaxParseUtils").assertTag(t,"error");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"field",e);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,t,"text","not-acceptable");if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,t,"code",406);return i.success?o("WAResultOrError").makeResult({text:a.value,code:i.value,field:r.value}):i}l.parseIQErrorNotAcceptableField=e,l.parseIQErrorNotAcceptableMixin=s}),98);
__d("WASmaxInPreKeysRequestErrors",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:t.value});var n=o("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorNotAcceptable","IQErrorFallbackClient"],[t,n])}l.parseRequestErrors=e}),98);
__d("WASmaxInPreKeysSetResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysRequestErrors").parseRequestErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRequestErrors:i.value})):i}l.parseSetResponseRequestError=e}),98);
__d("WASmaxInPreKeysSetResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInPreKeysServerErrors").parseServerErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorServerErrors:i.value})):i}l.parseSetResponseServerError=e}),98);
__d("WASmaxInPreKeysSetResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseSetResponseSuccess=e}),98);
__d("WASmaxOutPreKeysKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyDataMixin=s}),98);
__d("WASmaxOutPreKeysIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("identity",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyMixin=s}),98);
__d("WASmaxOutPreKeysKeyTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("type",null,new Uint8Array([5])));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeKeyTypeMixin=s}),98);
__d("WASmaxOutPreKeysKeyIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.idElementValue,n=o("WASmaxJsx").smax("id",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyIDMixin=s}),98);
__d("WASmaxOutPreKeysPreKeyListMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.keyIDMixinArgs,n=e.keyDataMixinArgs,r=o("WASmaxJsx").smax("key",null,o("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(o("WASmaxJsx").smax("id",null),t),o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("value",null),n));return r}function s(t){var n=t.keyArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("list",null,o("WASmaxChildren").REPEATED_CHILD(e,n,0,2e4)));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makePreKeyListListKey=e,l.mergePreKeyListMixin=u}),98);
__d("WASmaxOutPreKeysRegistrationIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.registrationElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("registration",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRegistrationIDMixin=s}),98);
__d("WASmaxOutPreKeysRequestPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paddingElementValue,n=o("WASmaxJsx").smax("iq",null,o("WASmaxJsx").smax("padding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestPaddingMixin=s}),98);
__d("WASmaxOutPreKeysSignedPreKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysKeyDataMixin","WASmaxOutPreKeysKeyIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.keyIDMixinArgs,r=e.keyDataMixinArgs,a=e.signatureElementValue,i=(t=o("WASmaxJsx")).smax("smax$any",null,t.smax("skey",null,o("WASmaxOutPreKeysKeyIDMixin").mergeKeyIDMixin(t.smax("id",null),n),o("WASmaxOutPreKeysKeyDataMixin").mergeKeyDataMixin(t.smax("value",null),r),t.smax("signature",null,a)));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSignedPreKeyMixin=s}),98);
__d("WASmaxOutPreKeysVerifiedNameMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.verifiedNameElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("verified_name",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeVerifiedNameMixin=s}),98);
__d("WASmaxOutPreKeysIdentityKeyBundleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutPreKeysIdentityKeyMixin","WASmaxOutPreKeysKeyTypeMixin","WASmaxOutPreKeysPreKeyListMixin","WASmaxOutPreKeysRegistrationIDMixin","WASmaxOutPreKeysRequestPaddingMixin","WASmaxOutPreKeysSignedPreKeyMixin","WASmaxOutPreKeysVerifiedNameMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.verifiedNameMixinArgs,n=e.requestPaddingMixinArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutPreKeysRequestPaddingMixin").mergeRequestPaddingMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutPreKeysVerifiedNameMixin").mergeVerifiedNameMixin,o("WASmaxOutPreKeysKeyTypeMixin").mergeKeyTypeMixin(o("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(o("WASmaxOutPreKeysPreKeyListMixin").mergePreKeyListMixin(o("WASmaxOutPreKeysIdentityKeyMixin").mergeIdentityKeyMixin(o("WASmaxOutPreKeysRegistrationIDMixin").mergeRegistrationIDMixin(o("WASmaxJsx").smax("iq",null),e),e),e),e)),t),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyBundleMixin=s}),98);
__d("WASmaxOutPreKeysSetRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysIdentityKeyBundleMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutPreKeysIdentityKeyBundleMixin").mergeIdentityKeyBundleMixin(o("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(o("WASmaxJsx").smax("iq",{type:"set"})),e);return t}l.makeSetRequest=e}),98);
__d("WASmaxPreKeysSetRPC",["WAComms","WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure","WASmaxInPreKeysSetResponseRequestError","WASmaxInPreKeysSetResponseServerError","WASmaxInPreKeysSetResponseSuccess","WASmaxOutPreKeysSetRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutPreKeysSetRequest").makeSetRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInPreKeysSetResponseSuccess").parseSetResponseSuccess(r,n);if(a.success)return{name:"SetResponseSuccess",value:a.value};var i=o("WASmaxInPreKeysSetResponsePreKeySuccessVnameFailure").parseSetResponsePreKeySuccessVnameFailure(r,n);if(i.success)return{name:"SetResponsePreKeySuccessVnameFailure",value:i.value};var l=o("WASmaxInPreKeysSetResponseRequestError").parseSetResponseRequestError(r,n);if(l.success)return{name:"SetResponseRequestError",value:l.value};var s=o("WASmaxInPreKeysSetResponseServerError").parseSetResponseServerError(r,n);if(s.success)return{name:"SetResponseServerError",value:s.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Set",{Success:a,PreKeySuccessVnameFailure:i,RequestError:l,ServerError:s}))}),s.apply(this,arguments)}l.sendSetRPC=e}),98);
__d("WAGenerateAndUploadPreKeysProtocol",["WACryptoManager","WAGetKeysForUpload","WAGlobals","WAMakeSignedPreKeyMixin","WAPromiseRetryLoop","WAResultOrError","WARetryUtils","WASmaxPreKeysSetRPC","WATagsLogger","WAWap","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=o("WATagsLogger").TAGS(["generateAndUploadPreKeysProtocol"]);function p(){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var t=yield o("WAGlobals").getWaOneQueue().enqueue((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n=t.cryptoManager,r=yield o("WACryptoManager").generatePreKeys(n);return r.success?(m.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["About to upload pre keys"]))).devConsole("generation "+r.value),o("WAGetKeysForUpload").getKeysForUpload(n,r.value)):r});return function(e){return t.apply(this,arguments)}})(),{operationType:"generate_prekeys",flush:!0,afterInit:!0}),r=t.value,a=r.preKeys,i=r.regInfo,l=r.signedPreKey,p=babelHelpers.extends({registrationElementValue:o("WAWap").BIG_ENDIAN_CONTENT(i.regId),anyElementValue:i.staticKeyPair.publicKey,keyArgs:a.map(f)},o("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(l)),_=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"uploadKeys",timer:o("WARetryUtils").fibonacciBackoff(!1),code:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){m.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Attempt to upload keys"])));var t=yield o("WASmaxPreKeysSetRPC").sendSetRPC(p);switch(t.name){case"SetResponseSuccess":{m.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Keys are successfully uploaded"]))),e(o("WAResultOrError").makeResult({preKeys:a}));return}case"SetResponseRequestError":{m.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Got Malformed upload keys IQ on upload pre keys attempt"]))),e(o("WAResultOrError").makeError("request-error"));return}default:t.name,m.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Got unexpected error: ",", will retry after backoff"])),t.name)}});function t(t){return e.apply(this,arguments)}return t})()});return _.start(),_.promise()}),_.apply(this,arguments)}function f(e){var t={idElementValue:o("WAWap").BIG_ENDIAN_CONTENT(e.id,3)},n={anyElementValue:e.keyPair.publicKey};return{keyIDMixinArgs:t,keyDataMixinArgs:n}}l.generateAndUploadPreKeysProtocol=p}),98);
__d("WAGenerateAndUploadPreKeys",["WABridge","WAGenerateAndUploadPreKeysProtocol","WALoggerTag","WAOdsEnums","WATagsLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS([r("WALoggerTag").PrekeyGenerateAndUpload,r("WALoggerTag").SignedPrekey]);function c(t){var n=t.reason;return u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["About to generate and upload pre keys with reason: ",""])),n),o("WAGenerateAndUploadPreKeysProtocol").generateAndUploadPreKeysProtocol().then(function(e){var t;if(e.success){o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"success",amount:e.value.preKeys.length},!0);return}var n=e.error;if(n==="request-error")throw o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PREKEY_UPLOAD,key:"malformed"},!0),r("err")("Malformed upload keys IQ");u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate and upload prekeys with error ",": ","}"])),n,(t=e.payload)==null?void 0:t.message)})}l.generateAndUploadPreKeys=c}),98);
__d("WAGetCurrentUserDeviceInfoApi",["WAGetMetaApi","WASignalKeys"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WAGetMetaApi").getMeta().then(function(e){var t=e==null?void 0:e.deviceId,n=e==null?void 0:e.identityKeyPair;if(t==null||n==null)return null;var r=o("WASignalKeys").serializePubKey(n);return{deviceId:t,identityKey:r}})},s=function(){return o("WAGetMetaApi").getMeta().then(function(e){return(e==null?void 0:e.deviceId)==null?null:{deviceId:e==null?void 0:e.deviceId}})};l.getCurrentUserDeviceInfo=e,l.getCurrentUserDeviceId=s}),98);
__d("WAGetDeviceIdentityMixin",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e!=null?{deviceIdentityElementValue:e}:null}i.getDeviceIdentityMixin=e}),66);
__d("WAGetLocalPublicPrivateIdentityKeyApi",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(){return o("WASignalDB").getDb().runInTransaction(["meta"],"readonly",(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var n,a=yield t.stores.meta.get(o("WADbSignal").MetaKeysEnum.identityKeyPair);if((a==null||(n=a.value)==null?void 0:n.identityKeyPair)==null){var i="[Remote Presence Error] Identity key pair was null";throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),i),r("err")(i)}return o("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(e){return t.apply(this,arguments)}})(),o("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};l.getLocalPublicPrivateIdentityKey=s}),98);
__d("WAGetIdentityKeys",["WAGetLocalPublicPrivateIdentityKeyApi","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";function e(){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=yield o("WAGetLocalPublicPrivateIdentityKeyApi").getLocalPublicPrivateIdentityKey(),t=e.privateKey,n=e.serializedPubKey;return{identityPrivateKey:t,identityPublicKey:n}}),s.apply(this,arguments)}l.getIdentityKeysInWorker=e}),98);
__d("WALoadReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({receipts:o("MAWTransactionMode").READONLY},"loadReceipt",function(e){return(function(t){var n=o("WAMsg").craftWAMsgIdString(t);return e.receipts.get({waMsgId:n}).then(function(e){var n;return e==null?o("WAResultOrError").makeError("missing-receipt"):o("WAResultOrError").makeResult({id:t,permittedIdentitiesPerDevice:(n=e.permittedIdentitiesPerDevice)!=null?n:new Map,recipientDevices:e.recipientDevices})})})});l.loadReceipt=e}),98);
__d("WAMarkSenderKeyAsSentApi",["WASignalDB","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t,r,a){return o("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var n=yield e.stores.personalSenderKeyStatuses.get(t);n!=null&&n.senderKeyId===r&&(a.forEach(function(e){n.hasSenderKey.add(e)}),yield e.stores.personalSenderKeyStatuses.bulkPut([n]))});return function(t){return e.apply(this,arguments)}})(),o("WASignalDB").signalOp("markSenderKeyAsSent"))};l.markSenderKeyAsSent=e}),98);
__d("WASmaxInDevicesNotifyResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseNotifyResponseError=e}),98);
__d("WASmaxInDevicesNotifyResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseNotifyResponseSuccess=e}),98);
__d("WASmaxOutDevicesBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"set"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQSetRequestMixin=s}),98);
__d("WASmaxOutDevicesNotifyRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.userJid,n=o("WASmaxJsx").smax("user",{jid:o("WAWap").USER_JID(t)});return n}function s(t){var n=t.userArgs,r=o("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("users",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,25))));return r}l.makeNotifyRequestUsersUser=e,l.makeNotifyRequest=s}),98);
__d("WASmaxDevicesNotifyRPC",["WAComms","WASmaxInDevicesNotifyResponseError","WASmaxInDevicesNotifyResponseSuccess","WASmaxOutDevicesNotifyRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutDevicesNotifyRequest").makeNotifyRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesNotifyResponseSuccess").parseNotifyResponseSuccess(r,n);if(a.success)return{name:"NotifyResponseSuccess",value:a.value};var i=o("WASmaxInDevicesNotifyResponseError").parseNotifyResponseError(r,n);if(i.success)return{name:"NotifyResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Notify",{Success:a,Error:i}))}),s.apply(this,arguments)}l.sendNotifyRPC=e}),98);
__d("WANotifyDeviceChange",["Promise","WAGlobals","WALogger","WAPersistedJobManager","WASmaxDevicesNotifyRPC","WATimeUtils","asyncToGeneratorRuntime","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var r=t.users;if(r.size===0)return(s||(s=n("Promise"))).resolve();var a=o("WAGlobals").getConfig().maxUsersForNotifyDeviceChange(),i=Array.from(r);return r.size>a&&(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["The maximum number of users that can be notified is ",""])),a),i=i.slice(0,a)),c(i)}function c(e){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WASmaxDevicesNotifyRPC").sendNotifyRPC({userArgs:e.map(function(e){return{userJid:e}})});if(t.name!=="NotifyResponseSuccess"){t.name;var n=t.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;if(n.name==="RetryableIQError"){var a=n.value.backoff;throw a!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"constant",delay:a},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"exponential",first:o("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}throw r("err")("Failed with an unexpected error code "+n.value.code)}}),d.apply(this,arguments)}l.notifyDeviceChange=u}),98);
__d("WAParseFranking",["WAFranking","WAFrankingTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t,n;if(e==null)return null;var r=(t=e.maybeChild("franking_tag"))==null?void 0:t.contentBytes(),a=(n=e.maybeChild("reporting_tag"))==null?void 0:n.contentBytes();return{frankingKey:null,frankingTag:r!=null?o("WAFrankingTypes").castToFrankingTag(r):null,reportingTag:a!=null?o("WAFrankingTypes").castToReportingTag(a):null,frankingVersion:o("WAFranking").getFrankingVersion(),reportingContent:null}}l.parseFrankingNode=e}),98);
__d("WAQueryGroupsAndSync",["FBLogger","Promise","WACreateGroup","WAGetDevices","WAGlobals","WATimeUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){return d.apply(this,arguments)}function d(){return d=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n){if(n===void 0&&(n=!1),t!=null){if(t.type==="all"){r("FBLogger")("wmi").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsAndSync: unsupported input type: all"])));return}var o=t.groups;if(o==null||o.length===0){r("FBLogger")("wmi").MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsAndSync: empty groups list"])));return}yield m({groupJids:o,ignoreDhash:n})}}),d.apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return p=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupJids,n=e.ignoreDhash,r=n===void 0?!1:n,a=yield _({groupJids:t});if(a.length!==0){yield o("WACreateGroup").createGroups(a.map(function(e){return{groupStatus:"queried",groupToCreate:e,serverTs:o("WATimeUtils").unixTime(),extras:void 0,folder:void 0,key:void 0}}));var i=g(a);i.size!==0&&(yield o("WAGetDevices").getDevices({users:i,reason:"query-groups",ignoreDhash:r}))}}),p.apply(this,arguments)}function _(e){return f.apply(this,arguments)}function f(){return f=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e.groupJids,r=yield(u||(u=n("Promise"))).all(t.map(function(e){return o("WAGlobals").getDependencies().queryGroup({groupJid:e})})),a=[];for(var i of r)i.success&&a.push(i.value);return a}),f.apply(this,arguments)}function g(e){var t=new Set;for(var n of e)for(var r of n.participants)r.success?t.add(r.value.user):t.add(r.error.user);return t}l.queryGroupsLegacyWAAPI=c,l.queryGroupsAndSync=m}),98);
__d("WASmaxInMessagePublishAckAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","3");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckAdminEditMixin=e}),98);
__d("WASmaxInMessagePublishAckAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","8");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckAdminRevokeMixin=e}),98);
__d("WASmaxInMessagePublishAckMessageEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","1");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckMessageEditMixin=e}),98);
__d("WASmaxInMessagePublishAckMessagePinMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","2");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckMessagePinMixin=e}),98);
__d("WASmaxInMessagePublishEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e,s={CBP:"CBP",NBP:"NBP",PMP:"PMP"},u={delivery:"delivery",no_optimization:"no_optimization"},c={false:"false",true:"true"},d={free_customer_service:"free_customer_service",free_entry_point:"free_entry_point",regular:"regular"},m={lid:"lid",pn:"pn"},p={validators:[(e=o("WAJids")).validateDeviceJid,e.validateDeviceJid,e.validateUserJid,e.validateUserJid],typeName:"DeviceJid|DeviceJid|UserJid|UserJid"},_={validators:[e.validateUserJid,e.validateUserJid],typeName:"UserJid|UserJid"};l.ENUM_CBP_NBP_PMP=s,l.ENUM_DELIVERY_NOOPTIMIZATION=u,l.ENUM_FALSE_TRUE=c,l.ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR=d,l.ENUM_LID_PN=m,l.DEVICEJID_DEVICEJID_USERJID_USERJID=p,l.USERJID_USERJID=_}),98);
__d("WASmaxInMessagePublishAckPaidConversationMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"delivery_context");if(!t.success)return t;var n=o("WASmaxParseUtils").attrStringEnum(e,"optimization_goal",o("WASmaxInMessagePublishEnums").ENUM_DELIVERY_NOOPTIMIZATION);return n.success?o("WAResultOrError").makeResult({optimizationGoal:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"source_url");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(e){var t=o("WASmaxParseUtils").assertTag(e,"referral");if(!t.success)return t;var n=o("WASmaxParseUtils").optionalChildWithTag(e,"source_url",s);if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"source_type");return r.success?o("WAResultOrError").makeResult({sourceType:r.value,sourceUrl:n.value}):r}function c(e){var t=o("WASmaxParseUtils").assertTag(e,"origin");if(!t.success)return t;var n=o("WASmaxParseUtils").optionalChildWithTag(e,"referral",u);if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"type");return r.success?o("WAResultOrError").makeResult({type:r.value,referral:n.value}):r}function d(e){var t=o("WASmaxParseUtils").assertTag(e,"pricing");if(!t.success)return t;var n=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"consumer_country_code");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"business_country_code");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"conversation_status",0,void 0);if(!a.success)return a;var i=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"latest_c2b_timestamp",0,void 0);if(!i.success)return i;var l=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,e,"analytics_conversation_id");if(!l.success)return l;var s=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"b2c_timestamp",0,void 0);return s.success?o("WAResultOrError").makeResult({consumerCountryCode:n.value,businessCountryCode:r.value,conversationStatus:a.value,latestC2bTimestamp:i.value,analyticsConversationId:l.value,b2cTimestamp:s.value}):s}function m(t){var n=o("WASmaxParseUtils").assertTag(t,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(t,"biz");if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(r.value,"delivery_context",e);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(r.value,"origin",c);if(!i.success)return i;var l=o("WASmaxParseUtils").optionalChildWithTag(r.value,"pricing",d);if(!l.success)return l;var s=o("WASmaxParseUtils").attrString(r.value,"paid_convo_id");if(!s.success)return s;var u=o("WASmaxParseUtils").attrStringEnum(r.value,"pricing_model",o("WASmaxInMessagePublishEnums").ENUM_CBP_NBP_PMP);if(!u.success)return u;var m=o("WASmaxParseUtils").attrStringEnum(r.value,"billable",o("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);if(!m.success)return m;var p=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,r.value,"expiration_timestamp",0,void 0);if(!p.success)return p;var _=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,r.value,"pricing_category");if(!_.success)return _;var f=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrStringEnum,r.value,"pricing_type",o("WASmaxInMessagePublishEnums").ENUM_FREECUSTOMERSERVICE_FREEENTRYPOINT_REGULAR);return f.success?o("WAResultOrError").makeResult({bizPaidConvoId:s.value,bizPricingModel:u.value,bizBillable:m.value,bizExpirationTimestamp:p.value,bizPricingCategory:_.value,bizPricingType:f.value,bizDeliveryContext:a.value,bizOrigin:i.value,bizPricing:l.value}):f}l.parseAckPaidConversationBizDeliveryContext=e,l.parseAckPaidConversationBizOriginReferralSourceUrl=s,l.parseAckPaidConversationBizOriginReferral=u,l.parseAckPaidConversationBizOrigin=c,l.parseAckPaidConversationBizPricing=d,l.parseAckPaidConversationMixin=m}),98);
__d("WASmaxInMessagePublishAckPaidGroupConversationMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"biz");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(n.value,"pricing");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,r.value,"business_country_code");return a.success?o("WAResultOrError").makeResult({bizPricingBusinessCountryCode:a.value}):a}l.parseAckPaidGroupConversationMixin=e}),98);
__d("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup",["WAResultOrError","WASmaxInMessagePublishAckPaidConversationMixin","WASmaxInMessagePublishAckPaidGroupConversationMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInMessagePublishAckPaidConversationMixin").parseAckPaidConversationMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"AckPaidConversation",value:t.value});var n=o("WASmaxInMessagePublishAckPaidGroupConversationMixin").parseAckPaidGroupConversationMixin(e);return n.success?o("WAResultOrError").makeResult({name:"AckPaidGroupConversation",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["AckPaidConversation","AckPaidGroupConversation"],[t,n])}l.parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup=e}),98);
__d("WASmaxInMessagePublishAckRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"edit","7");return n.success?o("WAResultOrError").makeResult({edit:n.value}):n}l.parseAckRevokeMixin=e}),98);
__d("WASmaxInMessagePublishServerFrankingTagMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").flattenedChildWithTag(e,"franking");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(t.value,"reporting_tag");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytesRange(n.value,9,128);return r.success?o("WAResultOrError").makeResult({frankingReportingTagElementValue:r.value}):r}l.parseServerFrankingTagMixin=e}),98);
__d("WASmaxInMessagePublishAckMixin",["WAResultOrError","WASmaxInMessagePublishAckAdminEditMixin","WASmaxInMessagePublishAckAdminRevokeMixin","WASmaxInMessagePublishAckMessageEditMixin","WASmaxInMessagePublishAckMessagePinMixin","WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup","WASmaxInMessagePublishAckRevokeMixin","WASmaxInMessagePublishServerFrankingTagMixin","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",r.value);if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"class","message");if(!i.success)return i;var l=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",l.value);if(!s.success)return s;var u=o("WASmaxParseUtils").attrIntRange(e,"t",0,void 0);if(!u.success)return u;var c=o("WASmaxInMessagePublishAckMessageEditMixin").parseAckMessageEditMixin(e),d=o("WASmaxInMessagePublishAckAdminEditMixin").parseAckAdminEditMixin(e),m=o("WASmaxInMessagePublishAckMessagePinMixin").parseAckMessagePinMixin(e),p=o("WASmaxInMessagePublishAckAdminRevokeMixin").parseAckAdminRevokeMixin(e),_=o("WASmaxInMessagePublishAckRevokeMixin").parseAckRevokeMixin(e),f=o("WASmaxInMessagePublishServerFrankingTagMixin").parseServerFrankingTagMixin(e),g=o("WASmaxInMessagePublishAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup").parseAckPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup(e);return o("WAResultOrError").makeResult({class:i.value,t:u.value,ackMessageEditMixin:c.success?c.value:null,ackAdminEditMixin:d.success?d.value:null,ackMessagePinMixin:m.success?m.value:null,ackAdminRevokeMixin:p.success?p.value:null,ackRevokeMixin:_.success?_.value:null,serverFrankingTagMixin:f.success?f.value:null,ackPaidAckPaidConversationOrAckPaidGroupConversationConversationMixinGroup:g.success?g.value:null})}l.parseAckMixin=e}),98);
__d("WASmaxInMessagePublishApplicationNegativeAckMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"application_error",0,void 0);return n.success?o("WAResultOrError").makeResult({applicationError:n.value}):n}l.parseApplicationNegativeAckMixin=e}),98);
__d("WASmaxInMessagePublishMessageNackRetryAttributesMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"backoff",0,86400);return n.success?o("WAResultOrError").makeResult({backoff:n.value}):n}l.parseMessageNackRetryAttributesMixin=e}),98);
__d("WASmaxInMessagePublishNegativeAckMixin",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishApplicationNegativeAckMixin","WASmaxInMessagePublishMessageNackRetryAttributesMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"error");if(!r.success)return r;var a=o("WASmaxInMessagePublishAckMixin").parseAckMixin(e,t);if(!a.success)return a;var i=o("WASmaxInMessagePublishApplicationNegativeAckMixin").parseApplicationNegativeAckMixin(e),l=o("WASmaxInMessagePublishMessageNackRetryAttributesMixin").parseMessageNackRetryAttributesMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({error:r.value},a.value,{applicationNegativeAckMixin:i.success?i.value:null,messageNackRetryAttributesMixin:l.success?l.value:null}))}l.parseNegativeAckMixin=e}),98);
__d("WASmaxInMessagePublishIndividualResponseNegative",["WAResultOrError","WASmaxInMessagePublishNegativeAckMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrUserJid,e,"recipient");if(!r.success)return r;var a=o("WASmaxInMessagePublishNegativeAckMixin").parseNegativeAckMixin(e,t);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({recipient:r.value},a.value)):a}l.parseIndividualResponseNegative=e}),98);
__d("WASmaxInMessagePublishAckRcatMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").flattenedChildWithTag(e,"rcat");if(!n.success)return n;var r=o("WASmaxParseUtils").contentBytes(n.value);return r.success?o("WAResultOrError").makeResult({rcatElementValue:r.value}):r}l.parseAckRcatMixin=e}),98);
__d("WASmaxInMessagePublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"phash");return n.success?o("WAResultOrError").makeResult({phash:n.value}):n}l.parseDeviceListStaleMixin=e}),98);
__d("WASmaxInMessagePublishRefreshLIDMixin",["WAResultOrError","WASmaxInMessagePublishEnums","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrStringEnum(e,"refresh_lid",o("WASmaxInMessagePublishEnums").ENUM_FALSE_TRUE);return n.success?o("WAResultOrError").makeResult({refreshLid:n.value}):n}l.parseRefreshLIDMixin=e}),98);
__d("WASmaxInMessagePublishIndividualResponseSuccess",["WAResultOrError","WASmaxInMessagePublishAckMixin","WASmaxInMessagePublishAckRcatMixin","WASmaxInMessagePublishDeviceListStaleMixin","WASmaxInMessagePublishEnums","WASmaxInMessagePublishRefreshLIDMixin","WASmaxParseJid","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrUserJid,e,"recipient");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseJid").attrJidEnum,e,"participant",o("WASmaxInMessagePublishEnums").USERJID_USERJID);if(!a.success)return a;var i=o("WASmaxInMessagePublishAckMixin").parseAckMixin(e,t);if(!i.success)return i;var l=o("WASmaxInMessagePublishDeviceListStaleMixin").parseDeviceListStaleMixin(e),s=o("WASmaxInMessagePublishRefreshLIDMixin").parseRefreshLIDMixin(e),u=o("WASmaxInMessagePublishAckRcatMixin").parseAckRcatMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({recipient:r.value,participant:a.value},i.value,{deviceListStaleMixin:l.success?l.value:null,refreshLIDMixin:s.success?s.value:null,ackRcatMixin:u.success?u.value:null}))}l.parseIndividualResponseSuccess=e}),98);
__d("WASmaxOutMessagePublishAppdataMetaAttributeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaAppdata,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{appdata:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAppdataMetaAttributeMixin=s}),98);
__d("WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOriginalMsgT,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{original_msg_t:o("WAWap").INT(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeArmadilloOriginalMessageTimestampMixin=s}),98);
__d("WASmaxOutMessagePublishAutomatedMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("automated",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeAutomatedMixin=s}),98);
__d("WASmaxOutMessagePublishAuthMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.authVerificationTimestamp,n=e.authDisableIosAutofill,r=e.authEnableRiskCheck,a=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("auth",{verification_timestamp:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t),disable_ios_autofill:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n),enable_risk_check:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)})));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAuthMixin=s}),98);
__d("WASmaxOutMessagePublishBizAcceptTsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizAcceptTs,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{accept_ts:o("WAWap").INT(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizAcceptTsMixin=s}),98);
__d("WASmaxOutMessagePublishBizAutoResponseMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizAutoResponse,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{auto_response:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizAutoResponseMixin=s}),98);
__d("WASmaxOutMessagePublishBizCampaignMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizCampaignId,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{campaign_id:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizCampaignMixin=s}),98);
__d("WASmaxOutMessagePublishBizEngagementDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.engagementConversationState,n=e.engagementCustomerServiceState,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("engagement",{conversation_state:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),customer_service_state:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)})));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizEngagementDataMixin=s}),98);
__d("WASmaxOutMessagePublishBizMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.metadataAppOwner,a=e.metadataCsidBm,i=e.metadataPaymentBm,l=e.metadataCustomerCategory,s=e.metadataDidBepRun,u=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("metadata",{app_owner:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).CUSTOM_STRING,r),csid_bm:t.OPTIONAL(n.CUSTOM_STRING,a),payment_bm:t.OPTIONAL(n.CUSTOM_STRING,i),customer_category:t.OPTIONAL(n.CUSTOM_STRING,l),did_bep_run:t.OPTIONAL(n.CUSTOM_STRING,s)})));return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishBizPricingDataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.pricingConsumerCountryCode,n=e.pricingBusinessCountryCode,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("pricing",{consumer_country_code:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),business_country_code:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)})));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizPricingDataMixin=s}),98);
__d("WASmaxOutMessagePublishBizRolesMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizHostStorage,n=e.bizActualActors,r=e.bizPrivacyModeTs,a=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{host_storage:o("WAWap").INT(t),actual_actors:o("WAWap").INT(n),privacy_mode_ts:o("WAWap").INT(r)}));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizRolesMixin=s}),98);
__d("WASmaxMixinGroupExhaustiveError",[],(function(t,n,r,o,a,i){"use strict";var e=(function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,t.name="SmaxMixinGroupExhaustiveError",babelHelpers.assertThisInitialized(t)||babelHelpers.assertThisInitialized(t)}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));i.SmaxMixinGroupExhaustiveError=e}),66);
__d("WASmaxOutMessagePublishButtonsMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("buttons",null)));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeButtonsMixin=s}),98);
__d("WASmaxOutMessagePublishExtensionsMetadataMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.capabilityArgs,n=o("WASmaxJsx").smax("capabilities",null,o("WASmaxChildren").REPEATED_CHILD(s,t,1,50));return n}function s(e){var t=e.capabilityName,n=o("WASmaxJsx").smax("capability",{name:o("WAWap").CUSTOM_STRING(t)});return n}function u(t){var n=t.capabilitiesArgs,r=t.extensionsMetadataWellVersion,a=t.extensionsMetadataDataApiVersion,i=t.extensionsMetadataFlowMessageVersion,l=o("WASmaxJsx").smax("native_flow",null,o("WASmaxJsx").smax("extensions_metadata",{well_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,r),data_api_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,a),flow_message_version:o("WAWap").INT(i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return l}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeExtensionsMetadataExtensionsMetadataCapabilities=e,l.makeExtensionsMetadataExtensionsMetadataCapabilitiesCapability=s,l.mergeExtensionsMetadataMixin=c}),98);
__d("WASmaxOutMessagePublishMixedMetadataMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paymentsMetadataVersion,n=o("WASmaxJsx").smax("native_flow",null,o("WASmaxJsx").smax("mixed_metadata",null,o("WASmaxJsx").smax("payments_metadata",{version:o("WAWap").INT(t)})));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMixedMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishNativeFlowMessageTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishExtensionsMetadataMixin","WASmaxOutMessagePublishMixedMetadataMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.nativeFlowName,n=e.nativeFlowV,r=e.extensionsMetadataMixinArgs,a=e.mixedMetadataMixinArgs,i=o("WASmaxJsx").smax("interactive",{type:"native_flow"},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishMixedMetadataMixin").mergeMixedMetadataMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishExtensionsMetadataMixin").mergeExtensionsMetadataMixin,o("WASmaxJsx").smax("native_flow",{name:o("WAWap").CUSTOM_STRING(t),v:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)}),r),a));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeNativeFlowMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishInteractiveMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishNativeFlowMessageTypeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasInteractiveV1,n=e.nativeFlowMessageTypeMixinArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxOutMessagePublishNativeFlowMessageTypeMixin").mergeNativeFlowMessageTypeMixin(o("WASmaxJsx").smax("interactive",{v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)}),n)));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInteractiveMixin=s}),98);
__d("WASmaxOutMessagePublishNativeFlowMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bizNativeFlowName,n=e.bizNativeFlowVersion,r=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",{native_flow_name:o("WAWap").CUSTOM_STRING(t),native_flow_version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)}));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeNativeFlowMixin=s}),98);
__d("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishButtonsMixin","WASmaxOutMessagePublishInteractiveMixin","WASmaxOutMessagePublishNativeFlowMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isButtons)return o("WASmaxOutMessagePublishButtonsMixin").mergeButtonsMixin(e);if(t.nativeFlow)return o("WASmaxOutMessagePublishNativeFlowMixin").mergeNativeFlowMixin(e,t.nativeFlow);if(t.interactive)return o("WASmaxOutMessagePublishInteractiveMixin").mergeInteractiveMixin(e,t.interactive);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeButtonsOrNativeFlowOrInteractiveMixinGroup=e}),98);
__d("WASmaxOutMessagePublishConversionRecipientStatusMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.conversionRecipientStatus,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("conversion",{recipient_status:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeConversionRecipientStatusMixin=s}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.ctwaAttributionElementValue,n=o("WASmaxJsx").smax("ctwa_attribution",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClickToWhatsAppAttributionMixin=s}),98);
__d("WASmaxOutMessagePublishCtwaAttributionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppAttributionMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishClickToWhatsAppAttributionMixin").mergeClickToWhatsAppAttributionMixin(o("WASmaxJsx").smax("ctwa_attribution",null),e);return t}function s(t){var n=t.ctwaAttributionArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCtwaAttributionCtwaAttribution=e,l.mergeCtwaAttributionMixin=u}),98);
__d("WASmaxOutMessagePublishClickToWhatsAppTypeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.sourceUrlElementValue,n=o("WASmaxJsx").smax("source_url",null,t);return n}function s(t){var n,r,a=t.sourceUrlArgs,i=t.ctwaConversionSource,l=t.ctwaConversionData,s=t.ctwaSourceType,u=t.ctwaEntryPointConversionSource,c=t.ctwaEntryPointConversionApp,d=t.ctwaSignals,m=o("WASmaxJsx").smax("ctwa",{conversion_source:(n=o("WASmaxAttrs")).OPTIONAL((r=o("WAWap")).CUSTOM_STRING,i),conversion_data:n.OPTIONAL(r.CUSTOM_STRING,l),source_type:n.OPTIONAL(r.CUSTOM_STRING,s),entry_point_conversion_source:n.OPTIONAL(r.CUSTOM_STRING,u),entry_point_conversion_app:n.OPTIONAL(r.CUSTOM_STRING,c),signals:n.OPTIONAL(r.CUSTOM_STRING,d)},o("WASmaxChildren").OPTIONAL_CHILD(e,a));return m}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeClickToWhatsAppTypeSourceUrl=e,l.mergeClickToWhatsAppTypeMixin=u}),98);
__d("WASmaxOutMessagePublishCtwaConversionMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishClickToWhatsAppTypeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishClickToWhatsAppTypeMixin").mergeClickToWhatsAppTypeMixin(o("WASmaxJsx").smax("ctwa",null),e);return t}function s(t){var n=t.ctwaArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCtwaConversionCtwa=e,l.mergeCtwaConversionMixin=u}),98);
__d("WASmaxOutMessagePublishDeliveryContextMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.deliveryContextHsmMaxBid,a=e.deliveryContextOptimizationGoal,i=e.deliveryContextTemplateId,l=e.deliveryContextCampaignId,s=e.deliveryContextSourceType,u=e.deliveryContextTierType,c=e.deliveryContextDeliveryType,d=e.deliveryContextClientToken,m=e.deliveryContextPrice,p=e.deliveryContextWabaId,_=e.deliveryContextQualityFlag,f=e.deliveryContextIsZeroRatedTemplate,g=e.deliveryContextPartnerId,h=e.deliveryContextAppId,y=e.deliveryContextVertical,C=e.deliveryContextBmMessageLimitStatus,b=e.deliveryContextDisableIosAutofill,v=e.deliveryContextAuthBlockRecentRegisters,S=e.deliveryContextMaskLinkedDevicesWithoutResend,R=e.deliveryContextEncryptedDeterministicTemplateId,L=e.deliveryContextShouldBypassIntegrityPhoneLimit,E=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("delivery_context",{hsm_max_bid:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).INT,r),optimization_goal:t.OPTIONAL(n.CUSTOM_STRING,a),template_id:t.OPTIONAL(n.CUSTOM_STRING,i),campaign_id:t.OPTIONAL(n.CUSTOM_STRING,l),source_type:t.OPTIONAL(n.CUSTOM_STRING,s),tier_type:t.OPTIONAL(n.CUSTOM_STRING,u),delivery_type:t.OPTIONAL(n.CUSTOM_STRING,c),client_token:t.OPTIONAL(n.CUSTOM_STRING,d),price:t.OPTIONAL(n.INT,m),waba_id:t.OPTIONAL(n.CUSTOM_STRING,p),quality_flag:t.OPTIONAL(n.CUSTOM_STRING,_),is_zero_rated_template:t.OPTIONAL(n.CUSTOM_STRING,f),partner_id:t.OPTIONAL(n.CUSTOM_STRING,g),app_id:t.OPTIONAL(n.CUSTOM_STRING,h),vertical:t.OPTIONAL(n.INT,y),bm_message_limit_status:t.OPTIONAL(n.CUSTOM_STRING,C),disable_ios_autofill:t.OPTIONAL(n.CUSTOM_STRING,b),auth_block_recent_registers:t.OPTIONAL(n.CUSTOM_STRING,v),mask_linked_devices_without_resend:t.OPTIONAL(n.CUSTOM_STRING,S),encrypted_deterministic_template_id:t.OPTIONAL(n.CUSTOM_STRING,R),should_bypass_integrity_phone_limit:t.OPTIONAL(n.CUSTOM_STRING,L)})));return E}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeliveryContextMixin=s}),98);
__d("WASmaxOutMessagePublishCapabilitiesMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasFeatureV1,n=o("WASmaxJsx").smax("feature",{name:"full_catalog",v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)});return n}function s(t){var n=t.featureArgs,r=o("WASmaxJsx").smax("hsm",null,o("WASmaxJsx").smax("capabilities",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeCapabilitiesCapabilitiesFeature=e,l.mergeCapabilitiesMixin=u}),98);
__d("WASmaxOutMessagePublishHSMReviewMetadataMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.anyCategory,a=e.anyTag,i=e.anyId,l=e.anySubTag,s=e.anyLibraryTemplateId,u=e.anyIsTemplateFromLibraryEdited,c=o("WASmaxJsx").smax("smax$any",{category:(t=o("WASmaxAttrs")).OPTIONAL((n=o("WAWap")).CUSTOM_STRING,r),tag:t.OPTIONAL(n.CUSTOM_STRING,a),id:t.OPTIONAL(n.CUSTOM_STRING,i),sub_tag:t.OPTIONAL(n.CUSTOM_STRING,l),library_template_id:t.OPTIONAL(n.CUSTOM_STRING,s),is_template_from_library_edited:t.OPTIONAL(n.CUSTOM_STRING,u)});return c}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeHSMReviewMetadataMixin=s}),98);
__d("WASmaxOutMessagePublishQualityTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasQualityTokenV1,n=e.qualityTokenElementValue,r=o("WASmaxJsx").smax("hsm",null,o("WASmaxJsx").smax("quality_token",{v:o("WASmaxAttrs").OPTIONAL_LITERAL("1",t)},n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeQualityTokenMixin=s}),98);
__d("WASmaxOutMessagePublishHsmMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishCapabilitiesMixin","WASmaxOutMessagePublishHSMReviewMetadataMixin","WASmaxOutMessagePublishQualityTokenMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageTtl,r=e.hasHsmV1,a=e.hasHsmButtons1,i=e.hsmObjective,l=e.hSMReviewMetadataMixinArgs,s=e.capabilitiesMixinArgs,u=e.qualityTokenMixinArgs,c=o("WASmaxJsx").smax("message",{ttl:(t=o("WASmaxAttrs")).OPTIONAL(o("WAWap").INT,n)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishQualityTokenMixin").mergeQualityTokenMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishCapabilitiesMixin").mergeCapabilitiesMixin,o("WASmaxOutMessagePublishHSMReviewMetadataMixin").mergeHSMReviewMetadataMixin(o("WASmaxJsx").smax("hsm",{v:t.OPTIONAL_LITERAL("1",r),buttons:t.OPTIONAL_LITERAL("1",a),objective:t.OPTIONAL(o("WAWap").CUSTOM_STRING,i)}),l),s),u));return c}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeHsmMixin=s}),98);
__d("WASmaxOutMessagePublishQualityControlMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.decisionSourceValue,n=o("WASmaxJsx").smax("decision_source",{value:o("WAWap").CUSTOM_STRING(t)});return n}function s(t){var n=t.decisionSourceArgs,r=t.qualityControlSourceType,a=t.qualityControlDecisionId,i=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("quality_control",{source_type:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r),decision_id:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,a)},o("WASmaxChildren").REPEATED_CHILD(e,n,0,1/0))));return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeQualityControlBizQualityControlDecisionSource=e,l.mergeQualityControlMixin=u}),98);
__d("WASmaxOutMessagePublishBizMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAuthMixin","WASmaxOutMessagePublishBizAcceptTsMixin","WASmaxOutMessagePublishBizAutoResponseMixin","WASmaxOutMessagePublishBizCampaignMixin","WASmaxOutMessagePublishBizEngagementDataMixin","WASmaxOutMessagePublishBizMetadataMixin","WASmaxOutMessagePublishBizPricingDataMixin","WASmaxOutMessagePublishBizRolesMixin","WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup","WASmaxOutMessagePublishConversionRecipientStatusMixin","WASmaxOutMessagePublishCtwaAttributionMixin","WASmaxOutMessagePublishCtwaConversionMixin","WASmaxOutMessagePublishDeliveryContextMixin","WASmaxOutMessagePublishHsmMixin","WASmaxOutMessagePublishQualityControlMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.hsmMixinArgs,r=e.bizRolesMixinArgs,a=e.bizAutoResponseMixinArgs,i=e.bizAcceptTsMixinArgs,l=e.bizCampaignMixinArgs,s=e.deliveryContextMixinArgs,u=e.qualityControlMixinArgs,c=e.authMixinArgs,d=e.conversionRecipientStatusMixinArgs,m=e.ctwaConversionMixinArgs,p=e.bizMetadataMixinArgs,_=e.ctwaAttributionMixinArgs,f=e.bizEngagementDataMixinArgs,g=e.bizPricingDataMixinArgs,h=e.buttonsOrNativeFlowOrInteractiveMixinGroupArgs,y=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishButtonsOrNativeFlowOrInteractiveMixinGroup").mergeButtonsOrNativeFlowOrInteractiveMixinGroup,t.optionalMerge(o("WASmaxOutMessagePublishBizPricingDataMixin").mergeBizPricingDataMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizEngagementDataMixin").mergeBizEngagementDataMixin,t.optionalMerge(o("WASmaxOutMessagePublishCtwaAttributionMixin").mergeCtwaAttributionMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizMetadataMixin").mergeBizMetadataMixin,t.optionalMerge(o("WASmaxOutMessagePublishCtwaConversionMixin").mergeCtwaConversionMixin,t.optionalMerge(o("WASmaxOutMessagePublishConversionRecipientStatusMixin").mergeConversionRecipientStatusMixin,t.optionalMerge(o("WASmaxOutMessagePublishAuthMixin").mergeAuthMixin,t.optionalMerge(o("WASmaxOutMessagePublishQualityControlMixin").mergeQualityControlMixin,t.optionalMerge(o("WASmaxOutMessagePublishDeliveryContextMixin").mergeDeliveryContextMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizCampaignMixin").mergeBizCampaignMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizAcceptTsMixin").mergeBizAcceptTsMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizAutoResponseMixin").mergeBizAutoResponseMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizRolesMixin").mergeBizRolesMixin,t.optionalMerge(o("WASmaxOutMessagePublishHsmMixin").mergeHsmMixin,o("WASmaxJsx").smax("message",null),n),r),a),i),l),s),u),c),d),m),p),_),f),g),h);return y}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBizMixin=s}),98);
__d("WASmaxOutMessagePublishClientFrankingTagMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.frankingTagElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("franking",null,o("WASmaxJsx").smax("franking_tag",null,t)));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClientFrankingTagMixin=s}),98);
__d("WASmaxOutMessagePublishClientReportingTokenMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.reportingTokenV,n=e.reportingTokenElementValue,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("reporting",null,o("WASmaxJsx").smax("reporting_token",{v:o("WAWap").INT(t)},n)));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeClientReportingTokenMixin=s}),98);
__d("WASmaxOutMessagePublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.deviceIdentityElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("device-identity",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeviceIdentityMixin=s}),98);
__d("WASmaxOutMessagePublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.testConfig,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("test",{config:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInternalTestMixin=s}),98);
__d("WASmaxOutMessagePublishLIDSessionDeprecationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaDeprecatedLidSession,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{deprecated_lid_session:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLIDSessionDeprecationMixin=s}),98);
__d("WASmaxOutMessagePublishMessageAssociationTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaMessageAssociationType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{message_association_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMessageAssociationTypeMixin=s}),98);
__d("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("meta",{"decrypt-fail":"hide"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMetaHideDecryptionPlaceholderMixin=s}),98);
__d("WASmaxOutMessagePublishMulticastMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("multicast",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMulticastMixin=s}),98);
__d("WASmaxOutMessagePublishNoExtraFanoutMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{device_fanout:"false"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeNoExtraFanoutMixin=s}),98);
__d("WASmaxOutMessagePublishAnonPaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.taPadElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("ta_pad",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeAnonPaddingMixin=s}),98);
__d("WASmaxOutMessagePublishWireSizePaddingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paddingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("padding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWireSizePaddingMixin=s}),98);
__d("WASmaxOutMessagePublishPaddingMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAnonPaddingMixin","WASmaxOutMessagePublishWireSizePaddingMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anonPaddingMixinArgs,n=e.wireSizePaddingMixinArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishWireSizePaddingMixin").mergeWireSizePaddingMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAnonPaddingMixin").mergeAnonPaddingMixin,o("WASmaxJsx").smax("message",null),t),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePaddingMixin=s}),98);
__d("WASmaxOutMessagePublishPreFilledNumberMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("url_number",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergePreFilledNumberMixin=s}),98);
__d("WASmaxOutMessagePublishPreFilledTextMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("url_text",null));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergePreFilledTextMixin=s}),98);
__d("WASmaxOutMessagePublishSenderIntentMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{sender_intent:"hosted"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeSenderIntentMixin=s}),98);
__d("WASmaxOutMessagePublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestIdElementValue,n=o("WASmaxJsx").smax("trace",null,o("WASmaxJsx").smax("request_id",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestIDMixin=s}),98);
__d("WASmaxOutMessagePublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.edgeIdElementValue,n=o("WASmaxJsx").smax("edge_id",null,t);return n}function s(e){var t=e.deviceArgs,n=e.correlationIdType,r=e.idElementValue,a=o("WASmaxJsx").smax("correlation_id",{type:o("WAWap").CUSTOM_STRING(n)},o("WASmaxJsx").smax("id",null,r),o("WASmaxChildren").OPTIONAL_CHILD(c,t));return a}function u(e){var t=e.observabilityFlagsId,n=o("WASmaxJsx").smax("observability_flags",{id:o("WAWap").INT(t)});return n}function c(e){var t=e.deviceId,n=o("WASmaxJsx").smax("device",{id:o("WAWap").INT(t)});return n}function d(t){var n=t.edgeIdArgs,r=t.correlationIdArgs,a=t.observabilityFlagsArgs,i=t.traceIdElementValue,l=o("WASmaxJsx").smax("trace",null,[o("WASmaxJsx").smax("trace_id",null,i),o("WASmaxChildren").OPTIONAL_CHILD(e,n)].concat(o("WASmaxChildren").REPEATED_CHILD(s,r,0,10),[o("WASmaxChildren").OPTIONAL_CHILD(u,a)]));return l}function m(e,t){var n=d(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeTraceIDEdgeId=e,l.makeTraceIDCorrelationId=s,l.makeTraceIDObservabilityFlags=u,l.makeTraceIDCorrelationIdDevice=c,l.mergeTraceIDMixin=m}),98);
__d("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishRequestIDMixin","WASmaxOutMessagePublishTraceIDMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.requestID)return o("WASmaxOutMessagePublishRequestIDMixin").mergeRequestIDMixin(e,t.requestID);if(t.traceID)return o("WASmaxOutMessagePublishTraceIDMixin").mergeTraceIDMixin(e,t.traceID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRequestOrTraceIDMixinGroup=e}),98);
__d("WASmaxOutMessagePublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishRequestOrTraceIDMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestOrTraceIDMixinGroupArgs,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutMessagePublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(o("WASmaxJsx").smax("trace",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTraceContextMixin=s}),98);
__d("WASmaxOutMessagePublishVerifiedNameNameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageVerifiedName,n=o("WASmaxJsx").smax("message",{verified_name:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeVerifiedNameNameMixin=s}),98);
__d("WASmaxOutMessagePublishWebDriverConfigMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaWebdriverConfig,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{webdriver_config:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWebDriverConfigMixin=s}),98);
__d("WASmaxOutMessagePublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAutomatedMixin","WASmaxOutMessagePublishBizMixin","WASmaxOutMessagePublishClientFrankingTagMixin","WASmaxOutMessagePublishClientReportingTokenMixin","WASmaxOutMessagePublishDeviceIdentityMixin","WASmaxOutMessagePublishInternalTestMixin","WASmaxOutMessagePublishLIDSessionDeprecationMixin","WASmaxOutMessagePublishMessageAssociationTypeMixin","WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin","WASmaxOutMessagePublishMulticastMixin","WASmaxOutMessagePublishNoExtraFanoutMixin","WASmaxOutMessagePublishPaddingMixin","WASmaxOutMessagePublishPreFilledNumberMixin","WASmaxOutMessagePublishPreFilledTextMixin","WASmaxOutMessagePublishSenderIntentMixin","WASmaxOutMessagePublishTraceContextMixin","WASmaxOutMessagePublishVerifiedNameNameMixin","WASmaxOutMessagePublishWebDriverConfigMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.deviceIdentityMixinArgs,r=e.hasNoExtraFanout,a=e.hasMulticast,i=e.hasPreFilledText,l=e.hasPreFilledNumber,s=e.hasAutomated,u=e.bizMixinArgs,c=e.verifiedNameNameMixinArgs,d=e.clientFrankingTagMixinArgs,m=e.clientReportingTokenMixinArgs,p=e.internalTestMixinArgs,_=e.hasMetaHideDecryptionPlaceholder,f=e.traceContextMixinArgs,g=e.hasSenderIntent,h=e.lIDSessionDeprecationMixinArgs,y=e.paddingMixinArgs,C=e.webDriverConfigMixinArgs,b=e.messageAssociationTypeMixinArgs,v=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishMessageAssociationTypeMixin").mergeMessageAssociationTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishWebDriverConfigMixin").mergeWebDriverConfigMixin,t.optionalMerge(o("WASmaxOutMessagePublishPaddingMixin").mergePaddingMixin,t.optionalMerge(o("WASmaxOutMessagePublishLIDSessionDeprecationMixin").mergeLIDSessionDeprecationMixin,t.optionalMerge(o("WASmaxOutMessagePublishSenderIntentMixin").mergeSenderIntentMixin,t.optionalMerge(o("WASmaxOutMessagePublishTraceContextMixin").mergeTraceContextMixin,t.optionalMerge(o("WASmaxOutMessagePublishMetaHideDecryptionPlaceholderMixin").mergeMetaHideDecryptionPlaceholderMixin,t.optionalMerge(o("WASmaxOutMessagePublishInternalTestMixin").mergeInternalTestMixin,t.optionalMerge(o("WASmaxOutMessagePublishClientReportingTokenMixin").mergeClientReportingTokenMixin,t.optionalMerge(o("WASmaxOutMessagePublishClientFrankingTagMixin").mergeClientFrankingTagMixin,t.optionalMerge(o("WASmaxOutMessagePublishVerifiedNameNameMixin").mergeVerifiedNameNameMixin,t.optionalMerge(o("WASmaxOutMessagePublishBizMixin").mergeBizMixin,t.optionalMerge(o("WASmaxOutMessagePublishAutomatedMixin").mergeAutomatedMixin,t.optionalMerge(o("WASmaxOutMessagePublishPreFilledNumberMixin").mergePreFilledNumberMixin,t.optionalMerge(o("WASmaxOutMessagePublishPreFilledTextMixin").mergePreFilledTextMixin,t.optionalMerge(o("WASmaxOutMessagePublishMulticastMixin").mergeMulticastMixin,t.optionalMerge(o("WASmaxOutMessagePublishNoExtraFanoutMixin").mergeNoExtraFanoutMixin,t.optionalMerge(o("WASmaxOutMessagePublishDeviceIdentityMixin").mergeDeviceIdentityMixin,o("WASmaxJsx").smax("message",null),n),r),a),i),l),s),u),c),d),m),p),_),f),g),h),y),C),b);return v}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBaseMixin=s}),98);
__d("WASmaxOutMessagePublishGroupInviteTargetMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaGroupInvite,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{group_invite:o("WAWap").GROUP_JID(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeGroupInviteTargetMixin=s}),98);
__d("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("bot",{type:"feedback"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBotFeedbackMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encCount,n=o("WASmaxJsx").smax("enc",{count:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncRetryMixin=s}),98);
__d("WASmaxOutMessagePublishAvatarStickerTypeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{sticker_type:"avatar"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeAvatarStickerTypeMixin=s}),98);
__d("WASmaxOutMessagePublishMediaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=o("WASmaxJsx").smax("enc",{mediatype:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMediaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encNativeFlowName,n=e.hasAvatarStickerType,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,o("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin(o("WASmaxJsx").smax("enc",{native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}),e),n);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncMediaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encElementValue,n=o("WASmaxJsx").smax("enc",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncPayloadMixin=s}),98);
__d("WASmaxOutMessagePublishEncStateMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encState,n=o("WASmaxJsx").smax("enc",{state:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncStateMixin=s}),98);
__d("WASmaxOutMessagePublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeMixin","WASmaxOutMessagePublishEncPayloadMixin","WASmaxOutMessagePublishEncStateMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encType,n=e.encStateMixinArgs,r=e.encMediaTypeMixinArgs,a=o("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncStateMixin").mergeEncStateMixin,o("WASmaxJsx").smax("enc",{type:o("WAWap").CUSTOM_STRING(t)}),n),r),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeIndividualMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion2Mixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{v:"2"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncVersion2Mixin=s}),98);
__d("WASmaxOutMessagePublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encV,n=o("WASmaxJsx").smax("enc",{v:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncVersionFutureproofMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersionBot",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isEncVersion2)return o("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(e);if(t.encVersionFutureproof)return o("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(e,t.encVersionFutureproof);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncVersionBot=e}),98);
__d("WASmaxOutMessagePublishBotRequestMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMediaTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encRetryMixinArgs,r=e.encTypeIndividualMixinArgs,a=e.mediaTypeMixinArgs,i=e.encVersionBotArgs,l=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishMediaTypeMixin").mergeMediaTypeMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,o("WASmaxJsx").smax("enc",null),n),r),a),i));return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotRequestMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"media"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeMediaMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeTextMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"text"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeTextMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeTextMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.isContentTypeMedia)return o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeTextOrMediaMixinGroup=e}),98);
__d("WASmaxOutMessagePublishBotMetricsEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMetricsEntryPointMixin=s}),98);
__d("WASmaxOutMessagePublishBotClientMultiThreadIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botClientThreadId,n=o("WASmaxJsx").smax("bot",{client_thread_id:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotClientMultiThreadIDMixin=s}),98);
__d("WASmaxOutMessagePublishBotConversationThreadIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botConversationThreadId,n=o("WASmaxJsx").smax("bot",{conversation_thread_id:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotConversationThreadIDMixin=s}),98);
__d("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMixin","WASmaxOutMessagePublishBotConversationThreadIDMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botClientMultiThreadIDMixinArgs,n=e.botConversationThreadIDMixinArgs,r=o("WASmaxJsx").smax("message",null,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishBotConversationThreadIDMixin").mergeBotConversationThreadIDMixin,o("WASmaxOutMessagePublishBotClientMultiThreadIDMixin").mergeBotClientMultiThreadIDMixin(o("WASmaxJsx").smax("bot",null),t),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotClientMultiThreadIDMessageMixin=s}),98);
__d("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botLocalAutomatedType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{local_automated_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotLocalAutomatedTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBotMessageTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMessageTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{thread_origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotMetricsThreadEntryPointMixin=s}),98);
__d("WASmaxOutMessagePublishBotPersonaTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botPersonaType,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{persona_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotPersonaTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botFeedbackRequested,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{feedback_requested:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBusinessBotMessageFeedbackRequestedMixin=s}),98);
__d("WASmaxOutMessagePublishBusinessBotMessageMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.botBizBot,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("bot",{biz_bot:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBusinessBotMessageMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeEventMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaEventType,n=o("WASmaxJsx").smax("message",{type:"event"},o("WASmaxJsx").smax("meta",{event_type:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeEventMixin=s}),98);
__d("WASmaxOutMessagePublishProductListMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("list",{type:"product_list"})));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeProductListMixin=s}),98);
__d("WASmaxOutMessagePublishSingleSelectListMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.listV,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("biz",null,o("WASmaxJsx").smax("list",{type:"single_select",v:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)})));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSingleSelectListMixin=s}),98);
__d("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishProductListMixin","WASmaxOutMessagePublishSingleSelectListMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.singleSelectList)return o("WASmaxOutMessagePublishSingleSelectListMixin").mergeSingleSelectListMixin(e,t.singleSelectList);if(t.isProductList)return o("WASmaxOutMessagePublishProductListMixin").mergeProductListMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeSingleSelectOrProductListMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeListFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"list"}));return e}function s(t){var n=t.toCount,r=t.singleSelectOrProductListMixinGroupArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD_COUNT(e,n)))),r);return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeListFanoutParticipantsTo=e,l.mergeContentTypeListFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishLiveLocationModeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaLivelocMode,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{liveloc_mode:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLiveLocationModeMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishLiveLocationModeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)}));return n}function s(t){var n=t.toArgs,r=t.liveLocationModeMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n)))),r);return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeLiveLocationFanoutParticipantsTo=e,l.mergeContentTypeLiveLocationFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypeMedianotifyMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"medianotify"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeMedianotifyMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeMedia)return o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(e);if(t.isContentTypeMedianotify)return o("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeMediaOrMedianotifyMixinGroup=e}),98);
__d("WASmaxOutMessagePublishSenderContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.senderContentBindingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("sender_content_binding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeSenderContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.hasEncStickerTypeAvatar,r=e.encNativeFlowName,a=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),sticker_type:o("WASmaxAttrs").OPTIONAL_LITERAL("avatar",n),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}));return a}function s(t){var n=t.toArgs,r=t.senderContentBindingMixinArgs,a=t.contentTypeMediaOrMedianotifyMixinGroupArgs,i=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n))),r),a);return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeMediaFanoutDeprecatedParticipantsTo=e,l.mergeContentTypeMediaFanoutDeprecatedMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypeMediaFanoutMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.hasEncStickerTypeAvatar,r=e.encNativeFlowName,a=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:o("WAWap").CUSTOM_STRING(t),sticker_type:o("WASmaxAttrs").OPTIONAL_LITERAL("avatar",n),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}));return a}function s(t){var n=t.toArgs,r=t.senderContentBindingMixinArgs,a=t.contentTypeMediaOrMedianotifyMixinGroupArgs,i=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").HOMOGENEOUS_CHILD(e,n))),r),a);return i}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeContentTypeMediaFanoutParticipantsTo=e,l.mergeContentTypeMediaFanoutMixin=u}),98);
__d("WASmaxOutMessagePublishContentTypePollCreationMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaContenttype,n=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"creation",contenttype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypePollCreationMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"result_snapshot"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypePollResultSnapshotMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePollVoteMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaContenttype,n=o("WASmaxJsx").smax("message",{type:"poll"},o("WASmaxJsx").smax("meta",{polltype:"vote",contenttype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypePollVoteMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeReactionMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"reaction"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypeReactionMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypePayMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{type:"pay"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeContentTypePayMixin=s}),98);
__d("WASmaxOutMessagePublishPayNodeTypeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payType,n=o("WASmaxJsx").smax("pay",{type:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePayNodeTypeMixin=s}),98);
__d("WASmaxOutMessagePublishBasePayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPayNodeTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payCountry,n=e.payVersion,r=e.payIsFirstSend,a=o("WASmaxOutMessagePublishPayNodeTypeMixin").mergePayNodeTypeMixin(o("WASmaxJsx").smax("pay",{country:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),version:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n),is_first_send:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,r)}),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBasePayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishLegacyAmountMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payCurrency,n=e.payAmount,r=o("WASmaxJsx").smax("pay",{currency:o("WAWap").CUSTOM_STRING(t),amount:o("WAWap").CUSTOM_STRING(n)});return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeLegacyAmountMixin=s}),98);
__d("WASmaxOutMessagePublishMoneyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.moneyValue,n=e.moneyOffset,r=e.moneyCurrency,a=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("money",{value:o("WAWap").CUSTOM_STRING(t),offset:o("WAWap").CUSTOM_STRING(n),currency:o("WAWap").CUSTOM_STRING(r)}));return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMoneyMixin=s}),98);
__d("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WASmaxOutMessagePublishLegacyAmountMixin","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("amount",null),e);return t}function s(t){var n=t.amountArgs,r=t.payCredentialId,a=t.payDeviceId,i=t.payRequestId,l=t.legacyAmountMixinArgs,s=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLegacyAmountMixin").mergeLegacyAmountMixin,o("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(o("WASmaxJsx").smax("pay",{"credential-id":o("WAWap").CUSTOM_STRING(r),"device-id":o("WAWap").CUSTOM_STRING(a),"request-id":o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n)),t),l);return s}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeBaseIndividualPublishSendPayNodeAmount=e,l.mergeBaseIndividualPublishSendPayNodeMixin=u}),98);
__d("WASmaxOutMessagePublishInstallmentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishMoneyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("due_amount",null),e);return t}function s(e){var t=o("WASmaxOutMessagePublishMoneyMixin").mergeMoneyMixin(o("WASmaxJsx").smax("interest",null),e);return t}function u(t){var n=t.dueAmountArgs,r=t.interestArgs,a=t.installmentMaxCount,i=t.installmentSelectedCount,l=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("installment",{max_count:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,a),selected_count:o("WAWap").INT(i)},o("WASmaxChildren").OPTIONAL_CHILD(e,n),o("WASmaxChildren").OPTIONAL_CHILD(s,r)));return l}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeInstallmentInstallmentDueAmount=e,l.makeInstallmentInstallmentInterest=s,l.mergeInstallmentMixin=c}),98);
__d("WASmaxOutMessagePublishBeneficiaryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.beneficiaryName,a=e.beneficiaryAddressLine1,i=e.beneficiaryAddressLine2,l=e.beneficiaryCity,s=e.beneficiaryState,u=e.beneficiaryPhoneNumber,c=e.beneficiaryCountry,d=e.beneficiaryPostalCode,m=o("WASmaxJsx").smax("beneficiary",{name:(t=o("WAWap")).CUSTOM_STRING(r),address_line1:t.CUSTOM_STRING(a),address_line2:(n=o("WASmaxAttrs")).OPTIONAL(t.CUSTOM_STRING,i),city:n.OPTIONAL(t.CUSTOM_STRING,l),state:n.OPTIONAL(t.CUSTOM_STRING,s),phone_number:n.OPTIONAL(t.CUSTOM_STRING,u),country:t.CUSTOM_STRING(c),postal_code:t.CUSTOM_STRING(d)});return m}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBeneficiaryMixin=s}),98);
__d("WASmaxOutMessagePublishBeneficiariesMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiaryMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishBeneficiaryMixin").mergeBeneficiaryMixin(o("WASmaxJsx").smax("beneficiary",null),e);return t}function s(t){var n=t.beneficiaryArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,5));return r}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeBeneficiariesBeneficiary=e,l.mergeBeneficiariesMixin=u}),98);
__d("WASmaxOutMessagePublishOrderInPaymentMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBeneficiariesMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishBeneficiariesMixin").mergeBeneficiariesMixin(o("WASmaxJsx").smax("beneficiaries",null),e);return t}function s(t){var n,r=t.beneficiariesArgs,a=t.orderId,i=t.orderMessageId,l=t.orderPaymentConfigId,s=t.orderType,u=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("order",{id:(n=o("WAWap")).CUSTOM_STRING(a),message_id:o("WASmaxAttrs").OPTIONAL(n.STANZA_ID,i),payment_config_id:o("WASmaxAttrs").OPTIONAL(n.CUSTOM_STRING,l),type:o("WASmaxAttrs").OPTIONAL(n.CUSTOM_STRING,s)},o("WASmaxChildren").OPTIONAL_CHILD(e,r)));return u}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeOrderInPaymentOrderBeneficiaries=e,l.mergeOrderInPaymentMixin=u}),98);
__d("WASmaxOutMessagePublishPaymentInitiatorMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPaymentInitiator,n=o("WASmaxJsx").smax("smax$any",{payment_initiator:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePaymentInitiatorMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishInstallmentMixin","WASmaxOutMessagePublishOrderInPaymentMixin","WASmaxOutMessagePublishPaymentInitiatorMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.orderInPaymentMixinArgs,n=e.paymentInitiatorMixinArgs,r=e.installmentMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishInstallmentMixin").mergeInstallmentMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishOrderInPaymentMixin").mergeOrderInPaymentMixin,o("WASmaxJsx").smax("pay",{"transaction-type":"p2m"}),t),n),r);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRPublishSendPayNodeP2MMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("pay",{"transaction-type":"p2p"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBRPublishSendPayNodeP2PMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isBRPublishSendPayNodeP2P)return o("WASmaxOutMessagePublishBRPublishSendPayNodeP2PMixin").mergeBRPublishSendPayNodeP2PMixin(e);if(t.bRPublishSendPayNodeP2M)return o("WASmaxOutMessagePublishBRPublishSendPayNodeP2MMixin").mergeBRPublishSendPayNodeP2MMixin(e,t.bRPublishSendPayNodeP2M);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeBRPublishSendPayNodeP2POrMMixinGroup=e}),98);
__d("WASmaxOutMessagePublishBRSendPayEloNodeMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.eloDeviceSignature,r=e.eloWalletSignature,a=e.eloChallengeId,i=e.eloCardholderVerificationMethod,l=o("WASmaxJsx").smax("pay",null,o("WASmaxJsx").smax("elo",{device_signature:(t=o("WAWap")).CUSTOM_STRING(n),wallet_signature:t.CUSTOM_STRING(r),challenge_id:t.CUSTOM_STRING(a),cardholder_verification_method:t.CUSTOM_STRING(i)}));return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRSendPayEloNodeMixin=s}),98);
__d("WASmaxOutMessagePublishBRPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup","WASmaxOutMessagePublishBRSendPayEloNodeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.payId,r=e.payPaymentRails,a=e.payTrustedDeviceInfo,i=e.payNonce,l=e.bRSendPayEloNodeMixinArgs,s=e.bRPublishSendPayNodeP2POrMMixinGroupArgs,u=o("WASmaxOutMessagePublishBRPublishSendPayNodeP2POrMMixinGroup").mergeBRPublishSendPayNodeP2POrMMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishBRSendPayEloNodeMixin").mergeBRSendPayEloNodeMixin,o("WASmaxJsx").smax("pay",{id:(t=o("WAWap")).CUSTOM_STRING(n),"payment-rails":t.CUSTOM_STRING(r),"trusted-device-info":t.CUSTOM_STRING(a),nonce:t.CUSTOM_STRING(i)}),l),s);return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBRPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishUPILiteDetailsMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.upiLiteDetailsLiteReferenceNumber,r=e.upiLiteDetailsLiteArqc,a=e.upiLiteDetailsLiteTimestamp,i=e.upiLiteDetailsLitePurpose,l=o("WASmaxJsx").smax("upi_lite_details",{lite_reference_number:(t=o("WAWap")).CUSTOM_STRING(n),lite_arqc:t.CUSTOM_STRING(r),lite_timestamp:t.INT(a),lite_purpose:t.CUSTOM_STRING(i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeUPILiteDetailsMixin=s}),98);
__d("WASmaxOutMessagePublishOrderMessageMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n,r=e.orderOrderId,a=e.orderOrderMessageId,i=e.orderExpiryTs,l=e.orderOrderType,s=e.orderDiscountProgramName,u=o("WASmaxJsx").smax("order",{"order-id":(t=o("WAWap")).CUSTOM_STRING(r),"order-message-id":(n=o("WASmaxAttrs")).OPTIONAL(t.CUSTOM_STRING,a),"expiry-ts":n.OPTIONAL(t.INT,i),"order-type":n.OPTIONAL(t.CUSTOM_STRING,l),"discount-program-name":n.OPTIONAL(t.CUSTOM_STRING,s)});return u}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeOrderMessageMixin=s}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishOrderMessageMixin","WASmaxOutMessagePublishPaymentInitiatorMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.orderArgs,n=e.paymentLinkArgs,r=o("WASmaxJsx").smax("upi",null,o("WASmaxChildren").OPTIONAL_CHILD(s,t),o("WASmaxChildren").OPTIONAL_CHILD(u,n));return r}function s(e){var t=o("WASmaxOutMessagePublishOrderMessageMixin").mergeOrderMessageMixin(o("WASmaxJsx").smax("order",null),e);return t}function u(e){var t=e.paymentLinkOrderId,n=e.paymentLinkMessageId,r=o("WASmaxJsx").smax("payment_link",{order_id:o("WAWap").CUSTOM_STRING(t),message_id:o("WAWap").CUSTOM_STRING(n)});return r}function c(t){var n=t.upiArgs,r=t.paymentInitiatorMixinArgs,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishPaymentInitiatorMixin").mergePaymentInitiatorMixin,o("WASmaxJsx").smax("pay",{"transaction-type":"p2m"},o("WASmaxChildren").OPTIONAL_CHILD(e,n)),r);return a}function d(e,t){var n=c(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeUPIPublishSendPayNodeP2MUpi=e,l.makeUPIPublishSendPayNodeP2MUpiOrder=s,l.makeUPIPublishSendPayNodeP2MUpiPaymentLink=u,l.mergeUPIPublishSendPayNodeP2MMixin=d}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.hasPayTransactionTypeP2P,n=o("WASmaxJsx").smax("pay",{"transaction-type":o("WASmaxAttrs").OPTIONAL_LITERAL("p2p",t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeUPIPublishSendPayNodeP2PMixin=s}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.uPIPublishSendPayNodeP2P)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2PMixin").mergeUPIPublishSendPayNodeP2PMixin(e,t.uPIPublishSendPayNodeP2P);if(t.uPIPublishSendPayNodeP2M)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2MMixin").mergeUPIPublishSendPayNodeP2MMixin(e,t.uPIPublishSendPayNodeP2M);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeUPIPublishSendPayNodeP2POrMMixinGroup=e}),98);
__d("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishUPILiteDetailsMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.upiLiteDetailsArgs,n=e.upiToken,r=o("WASmaxJsx").smax("upi",{token:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)},o("WASmaxChildren").OPTIONAL_CHILD(s,t));return r}function s(e){var t=o("WASmaxOutMessagePublishUPILiteDetailsMixin").mergeUPILiteDetailsMixin(o("WASmaxJsx").smax("upi_lite_details",null),e);return t}function u(t){var n,r,a=t.upiArgs,i=t.payId,l=t.payMpin,s=t.payReceiverVpa,u=t.payReceiverVpaId,c=t.payReceiverName,d=t.paySenderVpa,m=t.paySenderVpaId,p=t.paySenderName,_=t.paySeqNo,f=t.payUpiBankInfo,g=t.payMode,h=t.payPurposeCode,y=t.payMcc,C=t.payRefId,b=t.payDeviceSsid,v=t.payNote,S=t.uPIPublishSendPayNodeP2POrMMixinGroupArgs,R=o("WASmaxOutMessagePublishUPIPublishSendPayNodeP2POrMMixinGroup").mergeUPIPublishSendPayNodeP2POrMMixinGroup(o("WASmaxJsx").smax("pay",{id:(n=o("WASmaxAttrs")).OPTIONAL((r=o("WAWap")).CUSTOM_STRING,i),mpin:n.OPTIONAL(r.CUSTOM_STRING,l),"receiver-vpa":r.CUSTOM_STRING(s),"receiver-vpa-id":n.OPTIONAL(r.CUSTOM_STRING,u),"receiver-name":n.OPTIONAL(r.CUSTOM_STRING,c),"sender-vpa":r.CUSTOM_STRING(d),"sender-vpa-id":n.OPTIONAL(r.CUSTOM_STRING,m),"sender-name":n.OPTIONAL(r.CUSTOM_STRING,p),"seq-no":r.CUSTOM_STRING(_),"upi-bank-info":r.CUSTOM_STRING(f),mode:n.OPTIONAL(r.CUSTOM_STRING,g),"purpose-code":n.OPTIONAL(r.CUSTOM_STRING,h),mcc:n.OPTIONAL(r.CUSTOM_STRING,y),"ref-id":n.OPTIONAL(r.CUSTOM_STRING,C),device_ssid:n.OPTIONAL(r.CUSTOM_STRING,b),note:n.OPTIONAL(r.CUSTOM_STRING,v)},o("WASmaxChildren").OPTIONAL_CHILD(e,a)),S);return R}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeUPIPublishSendPayNodeUpi=e,l.makeUPIPublishSendPayNodeUpiUpiLiteDetails=s,l.mergeUPIPublishSendPayNodeMixin=c}),98);
__d("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBRPublishSendPayNodeMixin","WASmaxOutMessagePublishUPIPublishSendPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.bRPublishSendPayNode)return o("WASmaxOutMessagePublishBRPublishSendPayNodeMixin").mergeBRPublishSendPayNodeMixin(e,t.bRPublishSendPayNode);if(t.uPIPublishSendPayNode)return o("WASmaxOutMessagePublishUPIPublishSendPayNodeMixin").mergeUPIPublishSendPayNodeMixin(e,t.uPIPublishSendPayNode);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeBRPublishOrUPIPublishSendPayNodeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.bRPublishOrUPIPublishSendPayNodeMixinGroupArgs,n=o("WASmaxOutMessagePublishBRPublishOrUPIPublishSendPayNodeMixinGroup").mergeBRPublishOrUPIPublishSendPayNodeMixinGroup(o("WASmaxJsx").smax("pay",null),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIntegrationPublishPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIntegrationPublishPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishIntegrationPublishPayNodeMixin").mergeIntegrationPublishPayNodeMixin(o("WASmaxOutMessagePublishBaseIndividualPublishSendPayNodeMixin").mergeBaseIndividualPublishSendPayNodeMixin(o("WASmaxJsx").smax("pay",null),e),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualNonNoviPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishIndividualNonNoviPublishSendPayNodeMixin").mergeIndividualNonNoviPublishSendPayNodeMixin(o("WASmaxJsx").smax("pay",null),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualPublishSendPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualRequestPayNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBasePayNodeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.paySender,n=e.payExpiryTs,r=e.payRequestId,a=o("WASmaxOutMessagePublishBasePayNodeMixin").mergeBasePayNodeMixin(o("WASmaxJsx").smax("pay",{sender:o("WASmaxAttrs").OPTIONAL(o("WAWap").USER_JID,t),"expiry-ts":o("WAWap").CUSTOM_STRING(n),"request-id":o("WAWap").CUSTOM_STRING(r)}),e);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualRequestPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishPayInviteNodeMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.payService,n=o("WASmaxJsx").smax("pay",{type:"invite",service:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePayInviteNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin","WASmaxOutMessagePublishIndividualRequestPayNodeMixin","WASmaxOutMessagePublishPayInviteNodeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualPublishSendPayNode)return o("WASmaxOutMessagePublishIndividualPublishSendPayNodeMixin").mergeIndividualPublishSendPayNodeMixin(e,t.individualPublishSendPayNode);if(t.individualRequestPayNode)return o("WASmaxOutMessagePublishIndividualRequestPayNodeMixin").mergeIndividualRequestPayNodeMixin(e,t.individualRequestPayNode);if(t.payInviteNode)return o("WASmaxOutMessagePublishPayInviteNodeMixin").mergePayInviteNodeMixin(e,t.payInviteNode);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualPublishPayNodeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroupArgs,n=o("WASmaxOutMessagePublishIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup").mergeIndividualPublishSendPayOrIndividualRequestPayOrPayInviteNodeMixinGroup(o("WASmaxJsx").smax("pay",null),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualPublishPayNodeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualPublishPayNodeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishIndividualPublishPayNodeMixin").mergeIndividualPublishPayNodeMixin(o("WASmaxJsx").smax("pay",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualPublishPayNodeMessageMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypePayMixin","WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualIndividualPublishPayNodeMessageMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualPublishPayNodeMessageMixin").mergeIndividualIndividualPublishPayNodeMessageMixin,o("WASmaxOutMessagePublishContentTypePayMixin").mergeContentTypePayMixin(o("WASmaxJsx").smax("message",null)),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualContentTypePayIndividualMixin=s}),98);
__d("WASmaxOutMessagePublishContentFanoutMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListFanoutMixin","WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin","WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin","WASmaxOutMessagePublishContentTypeMediaFanoutMixin","WASmaxOutMessagePublishContentTypeMedianotifyMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.contentTypeMediaFanout)return o("WASmaxOutMessagePublishContentTypeMediaFanoutMixin").mergeContentTypeMediaFanoutMixin(e,t.contentTypeMediaFanout);if(t.contentTypeMediaFanoutDeprecated)return o("WASmaxOutMessagePublishContentTypeMediaFanoutDeprecatedMixin").mergeContentTypeMediaFanoutDeprecatedMixin(e,t.contentTypeMediaFanoutDeprecated);if(t.contentTypeLiveLocationFanout)return o("WASmaxOutMessagePublishContentTypeLiveLocationFanoutMixin").mergeContentTypeLiveLocationFanoutMixin(e,t.contentTypeLiveLocationFanout);if(t.individualContentTypePayIndividual)return o("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(e,t.individualContentTypePayIndividual);if(t.contentTypeListFanout)return o("WASmaxOutMessagePublishContentTypeListFanoutMixin").mergeContentTypeListFanoutMixin(e,t.contentTypeListFanout);if(t.isContentTypeReaction)return o("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(e);if(t.contentTypePollCreation)return o("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(e,t.contentTypePollCreation);if(t.contentTypePollVote)return o("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(e,t.contentTypePollVote);if(t.isContentTypePollResultSnapshot)return o("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(e);if(t.isContentTypeMedianotify)return o("WASmaxOutMessagePublishContentTypeMedianotifyMixin").mergeContentTypeMedianotifyMixin(e);if(t.contentTypeEvent)return o("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(e,t.contentTypeEvent);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentFanoutMixins=e}),98);
__d("WASmaxOutMessagePublishLidChatOriginMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:"ctwa"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeLidChatOriginMixin=s}),98);
__d("WASmaxOutMessagePublishMsgMetaOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaOrigin,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{origin:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMsgMetaOriginMixin=s}),98);
__d("WASmaxOutMessagePublishPeripheralOriginMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaPeripheral,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{peripheral:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeripheralOriginMixin=s}),98);
__d("WASmaxOutMessagePublishTDeprecatedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageT,n=o("WASmaxJsx").smax("message",{t:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishToContentBindingMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.contentBindingElementValue,r=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxJsx").smax("content_binding",null,n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeToContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAvatarStickerTypeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encMediatype,n=e.encNativeFlowName,r=e.hasAvatarStickerType,a=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishAvatarStickerTypeMixin").mergeAvatarStickerTypeMixin,o("WASmaxJsx").smax("enc",{mediatype:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),native_flow_name:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)}),r);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncMediaTypeDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion3Mixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{v:"3"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncVersion3Mixin=s}),98);
__d("WASmaxOutMessagePublishEncVersion",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncVersion2Mixin","WASmaxOutMessagePublishEncVersion3Mixin","WASmaxOutMessagePublishEncVersionFutureproofMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isEncVersion2)return o("WASmaxOutMessagePublishEncVersion2Mixin").mergeEncVersion2Mixin(e);if(t.isEncVersion3)return o("WASmaxOutMessagePublishEncVersion3Mixin").mergeEncVersion3Mixin(e);if(t.encVersionFutureproof)return o("WASmaxOutMessagePublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(e,t.encVersionFutureproof);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncVersion=e}),98);
__d("WASmaxOutMessagePublishToDeviceMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encTypeIndividualMixinArgs,r=e.encMediaTypeDeprecatedMixinArgs,a=e.encVersionArgs,i=o("WASmaxJsx").smax("to",{jid:o("WAWap").JID(t)},o("WASmaxOutMessagePublishEncVersion").mergeEncVersion(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxJsx").smax("enc",null),n),r),a));return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeToDeviceMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentFanoutMixins","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishTDeprecatedMixin","WASmaxOutMessagePublishToContentBindingMixin","WASmaxOutMessagePublishToDeviceMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toContentBindingMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishToContentBindingMixin").mergeToContentBindingMixin,o("WASmaxOutMessagePublishToDeviceMixin").mergeToDeviceMixin(o("WASmaxJsx").smax("to",null),e),t);return n}function s(){var e=o("WASmaxJsx").smax("enc",null);return e}function u(t){var n,r=t.toArgs,a=t.messageTo,i=t.tDeprecatedMixinArgs,l=t.botMessageTypeMixinArgs,s=t.businessBotMessageMixinArgs,u=t.botMetricsEntryPointMixinArgs,c=t.botMetricsThreadEntryPointMixinArgs,d=t.msgMetaOriginMixinArgs,m=t.hasLidChatOrigin,p=t.botLocalAutomatedTypeMixinArgs,_=t.businessBotMessageFeedbackRequestedMixinArgs,f=t.botPersonaTypeMixinArgs,g=t.botClientMultiThreadIDMessageMixinArgs,h=t.peripheralOriginMixinArgs,y=t.contentFanoutMixinsArgs,C=o("WASmaxOutMessagePublishContentFanoutMixins").mergeContentFanoutMixins((n=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin").mergeBotClientMultiThreadIDMessageMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,n.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,n.optionalMerge(o("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,n.optionalMerge(o("WASmaxOutMessagePublishTDeprecatedMixin").mergeTDeprecatedMixin,o("WASmaxJsx").smax("message",{to:o("WAWap").JID(a)},o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(e,r,1,1997))),i),l),s),u),c),d),m),p),_),f),g),h),y);return C}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualIndividualFanoutParticipantsTo=e,l.makeIndividualIndividualFanoutEnc=s,l.mergeIndividualIndividualFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishEncListMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("enc",{mediatype:"list"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeEncListMixin=s}),98);
__d("WASmaxOutMessagePublishContentTypeListMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncListMixin","WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.singleSelectOrProductListMixinGroupArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSingleSelectOrProductListMixinGroup").mergeSingleSelectOrProductListMixinGroup,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncListMixin").mergeEncListMixin(o("WASmaxJsx").smax("enc",null)))),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeListMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncLiveLocationDeprecatedMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encDuration,n=o("WASmaxJsx").smax("enc",{mediatype:"livelocation",duration:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncLiveLocationMixin=s}),98);
__d("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin","WASmaxOutMessagePublishEncLiveLocationMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.encLiveLocation)return o("WASmaxOutMessagePublishEncLiveLocationMixin").mergeEncLiveLocationMixin(e,t.encLiveLocation);if(t.encLiveLocationDeprecated)return o("WASmaxOutMessagePublishEncLiveLocationDeprecatedMixin").mergeEncLiveLocationDeprecatedMixin(e,t.encLiveLocationDeprecated);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin","WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup","WASmaxOutMessagePublishLiveLocationModeMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.liveLocationModeMixinArgs,n=e.encLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroupArgs,r=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishLiveLocationModeMixin").mergeLiveLocationModeMixin,o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup").mergeEncLiveLocationEncLiveLocationOrEncLiveLocationDeprecatedMixinGroup(o("WASmaxJsx").smax("enc",null),n))),t);return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeLiveLocationSingleMixin=s}),98);
__d("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncMediaTypeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.encMediaType)return o("WASmaxOutMessagePublishEncMediaTypeMixin").mergeEncMediaTypeMixin(e,t.encMediaType);if(t.encMediaTypeDeprecated)return o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin(e,t.encMediaTypeDeprecated);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup=e}),98);
__d("WASmaxOutMessagePublishContentTypeMediaSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup","WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup","WASmaxOutMessagePublishSenderContentBindingMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.senderContentBindingMixinArgs,n=e.contentTypeMediaOrMedianotifyMixinGroupArgs,r=e.encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs,a=o("WASmaxOutMessagePublishContentTypeMediaOrMedianotifyMixinGroup").mergeContentTypeMediaOrMedianotifyMixinGroup(o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishSenderContentBindingMixin").mergeSenderContentBindingMixin,o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup").mergeEncMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroup(o("WASmaxJsx").smax("enc",null),r)),t),n);return a}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeContentTypeMediaSingleMixin=s}),98);
__d("WASmaxOutMessagePublishContentMixins",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeEventMixin","WASmaxOutMessagePublishContentTypeListMixin","WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin","WASmaxOutMessagePublishContentTypeMediaSingleMixin","WASmaxOutMessagePublishContentTypePollCreationMixin","WASmaxOutMessagePublishContentTypePollResultSnapshotMixin","WASmaxOutMessagePublishContentTypePollVoteMixin","WASmaxOutMessagePublishContentTypeReactionMixin","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.contentTypeMediaSingle)return o("WASmaxOutMessagePublishContentTypeMediaSingleMixin").mergeContentTypeMediaSingleMixin(e,t.contentTypeMediaSingle);if(t.contentTypeLiveLocationSingle)return o("WASmaxOutMessagePublishContentTypeLiveLocationSingleMixin").mergeContentTypeLiveLocationSingleMixin(e,t.contentTypeLiveLocationSingle);if(t.individualContentTypePayIndividual)return o("WASmaxOutMessagePublishIndividualContentTypePayIndividualMixin").mergeIndividualContentTypePayIndividualMixin(e,t.individualContentTypePayIndividual);if(t.contentTypeList)return o("WASmaxOutMessagePublishContentTypeListMixin").mergeContentTypeListMixin(e,t.contentTypeList);if(t.isContentTypeReaction)return o("WASmaxOutMessagePublishContentTypeReactionMixin").mergeContentTypeReactionMixin(e);if(t.contentTypePollCreation)return o("WASmaxOutMessagePublishContentTypePollCreationMixin").mergeContentTypePollCreationMixin(e,t.contentTypePollCreation);if(t.contentTypePollVote)return o("WASmaxOutMessagePublishContentTypePollVoteMixin").mergeContentTypePollVoteMixin(e,t.contentTypePollVote);if(t.isContentTypePollResultSnapshot)return o("WASmaxOutMessagePublishContentTypePollResultSnapshotMixin").mergeContentTypePollResultSnapshotMixin(e);if(t.contentTypeEvent)return o("WASmaxOutMessagePublishContentTypeEventMixin").mergeContentTypeEventMixin(e,t.contentTypeEvent);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentMixins=e}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipient,n=o("WASmaxJsx").smax("message",{recipient:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualRetryToPeerMixin=s}),98);
__d("WASmaxOutMessagePublishRetryMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageT,n=e.encRetryMixinArgs,r=o("WASmaxJsx").smax("message",{t:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishEncRetryMixin").mergeEncRetryMixin,o("WASmaxJsx").smax("enc",null),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRetryMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin","WASmaxOutMessagePublishRetryMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.individualIndividualRetryToPeerMixinArgs,n=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualRetryToPeerMixin").mergeIndividualIndividualRetryToPeerMixin,o("WASmaxOutMessagePublishRetryMixin").mergeRetryMixin(o("WASmaxJsx").smax("message",null),e),t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualRetryMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualSingleContentBindingMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.contentBindingElementValue,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("content_binding",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualSingleContentBindingMixin=s}),98);
__d("WASmaxOutMessagePublishReceiverAccountKindMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaReceiverAccountKind,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{receiver_account_kind:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeReceiverAccountKindMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin","WASmaxOutMessagePublishBotLocalAutomatedTypeMixin","WASmaxOutMessagePublishBotMessageTypeMixin","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin","WASmaxOutMessagePublishBotPersonaTypeMixin","WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin","WASmaxOutMessagePublishBusinessBotMessageMixin","WASmaxOutMessagePublishContentMixins","WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin","WASmaxOutMessagePublishEncTypeIndividualMixin","WASmaxOutMessagePublishEncVersion","WASmaxOutMessagePublishIndividualIndividualRetryMixin","WASmaxOutMessagePublishIndividualSingleContentBindingMixin","WASmaxOutMessagePublishLidChatOriginMixin","WASmaxOutMessagePublishMsgMetaOriginMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishReceiverAccountKindMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageTo,r=e.individualIndividualRetryMixinArgs,a=e.individualSingleContentBindingMixinArgs,i=e.botMessageTypeMixinArgs,l=e.businessBotMessageMixinArgs,s=e.botMetricsEntryPointMixinArgs,u=e.botMetricsThreadEntryPointMixinArgs,c=e.msgMetaOriginMixinArgs,d=e.hasLidChatOrigin,m=e.botLocalAutomatedTypeMixinArgs,p=e.businessBotMessageFeedbackRequestedMixinArgs,_=e.botPersonaTypeMixinArgs,f=e.botClientMultiThreadIDMessageMixinArgs,g=e.peripheralOriginMixinArgs,h=e.receiverAccountKindMixinArgs,y=e.contentMixinsArgs,C=e.encTypeIndividualMixinArgs,b=e.encMediaTypeDeprecatedMixinArgs,v=e.encVersionArgs,S=o("WASmaxOutMessagePublishContentMixins").mergeContentMixins((t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishReceiverAccountKindMixin").mergeReceiverAccountKindMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotClientMultiThreadIDMessageMixin").mergeBotClientMultiThreadIDMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotPersonaTypeMixin").mergeBotPersonaTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageFeedbackRequestedMixin").mergeBusinessBotMessageFeedbackRequestedMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotLocalAutomatedTypeMixin").mergeBotLocalAutomatedTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishLidChatOriginMixin").mergeLidChatOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishMsgMetaOriginMixin").mergeMsgMetaOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMetricsThreadEntryPointMixin").mergeBotMetricsThreadEntryPointMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin,t.optionalMerge(o("WASmaxOutMessagePublishBusinessBotMessageMixin").mergeBusinessBotMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishBotMessageTypeMixin").mergeBotMessageTypeMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualSingleContentBindingMixin").mergeIndividualSingleContentBindingMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualRetryMixin").mergeIndividualIndividualRetryMixin,o("WASmaxJsx").smax("message",{to:o("WAWap").JID(n)},o("WASmaxOutMessagePublishEncVersion").mergeEncVersion(t.optionalMerge(o("WASmaxOutMessagePublishEncMediaTypeDeprecatedMixin").mergeEncMediaTypeDeprecatedMixin,o("WASmaxOutMessagePublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxJsx").smax("enc",null),C),b),v)),r),a),i),l),s),u),c),d),m),p),_),f),g),h),y);return S}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualIndividualSingleMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishBotMetricsEntryPointMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualIndividualSingle)return o("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(e,t.individualIndividualSingle);if(t.individualIndividualFanout)return o("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(e,t.individualIndividualFanout);if(t.botMetricsEntryPoint)return o("WASmaxOutMessagePublishBotMetricsEntryPointMixin").mergeBotMetricsEntryPointMixin(e,t.botMetricsEntryPoint);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualBotRequestMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotFeedbackMessageTypeMixin","WASmaxOutMessagePublishBotRequestMixin","WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup","WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageTo,n=e.contentTypeTextOrMediaMixinGroupArgs,r=e.individualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroupArgs,a=e.hasBotFeedbackMessageType,i=e.botRequestMixinArgs,l=o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup").mergeIndividualIndividualSingleOrIndividualIndividualFanoutOrBotMetricsEntryPointMixinGroup,o("WASmaxOutMessagePublishContentTypeTextOrMediaMixinGroup").mergeContentTypeTextOrMediaMixinGroup(o("WASmaxJsx").smax("message",{to:o("WAWap").USER_JID(t)},o("WASmaxMixins").optionalMerge(o("WASmaxOutMessagePublishBotFeedbackMessageTypeMixin").mergeBotFeedbackMessageTypeMixin,o("WASmaxJsx").smax("bot",null,o("WASmaxOutMessagePublishBotRequestMixin").mergeBotRequestMixin(o("WASmaxJsx").smax("to",null),i)),a)),n),r);return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualBotRequestMessageMixin=s}),98);
__d("WASmaxOutMessagePublishBotResponseMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.botEditTargetId,r=e.botSenderTimestampMs,a=e.botEdit,i=e.hasBotTypeVoice,l=o("WASmaxJsx").smax("bot",{edit_target_id:(t=o("WASmaxAttrs")).OPTIONAL(o("WAWap").CUSTOM_STRING,n),sender_timestamp_ms:t.OPTIONAL(o("WAWap").INT,r),edit:t.OPTIONAL(o("WAWap").CUSTOM_STRING,a),type:t.OPTIONAL_LITERAL("voice",i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBotResponseMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishContentTypeMediaMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toCount,n=o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD_COUNT(s,t,2,2));return n}function s(){var e=o("WASmaxJsx").smax("to",null,o("WASmaxJsx").smax("enc",{mediatype:"image"}));return e}function u(t){var n=t.participantsArgs,r=o("WASmaxOutMessagePublishContentTypeMediaMixin").mergeContentTypeMediaMixin(o("WASmaxJsx").smax("message",null,o("WASmaxChildren").OPTIONAL_CHILD(e,n)));return r}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualContentTypeBotResponseMediaFanoutParticipants=e,l.makeIndividualContentTypeBotResponseMediaFanoutParticipantsTo=s,l.mergeIndividualContentTypeBotResponseMediaFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishContentTypeTextMixin","WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isContentTypeText)return o("WASmaxOutMessagePublishContentTypeTextMixin").mergeContentTypeTextMixin(e);if(t.individualContentTypeBotResponseMediaFanout)return o("WASmaxOutMessagePublishIndividualContentTypeBotResponseMediaFanoutMixin").mergeIndividualContentTypeBotResponseMediaFanoutMixin(e,t.individualContentTypeBotResponseMediaFanout);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup=e}),98);
__d("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishEncPayloadMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxOutMessagePublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxJsx").smax("enc",{type:"msmsg"}),e);return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeMessageSecretMessageMixin=s}),98);
__d("WASmaxOutMessagePublishMessageTargetMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.metaTargetId,r=e.metaTargetSenderJid,a=e.metaTargetChatJid,i=e.metaTargetChatJidLid,l=o("WASmaxJsx").smax("meta",{target_id:(t=o("WAWap")).STANZA_ID(n),target_sender_jid:o("WASmaxAttrs").OPTIONAL(t.USER_JID,r),target_chat_jid:o("WASmaxAttrs").OPTIONAL(t.JID,a),target_chat_jid_lid:o("WASmaxAttrs").OPTIONAL(t.JID,i)});return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMessageTargetMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishBotResponseMixin","WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup","WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin","WASmaxOutMessagePublishEncVersionBot","WASmaxOutMessagePublishMessageTargetMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toArgs,n=o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(s,t,2,2));return n}function s(e){var t=e.toJid,n=o("WASmaxJsx").smax("to",{jid:o("WAWap").USER_JID(t)});return n}function u(t){var n,r=t.participantsArgs,a=t.messageTo,i=t.contentTypeTextOrIndividualBotResponseMediaFanoutMixinGroupArgs,l=t.botResponseMixinArgs,s=t.messageTargetMixinArgs,u=t.encTypeMessageSecretMessageMixinArgs,c=t.encVersionBotArgs,d=o("WASmaxOutMessagePublishContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup").mergeContentTypeTextOrIndividualBotResponseMediaFanoutMixinGroup((n=o("WASmaxJsx")).smax("message",{to:o("WAWap").USER_JID(a)},o("WASmaxOutMessagePublishBotResponseMixin").mergeBotResponseMixin(n.smax("bot",null),l),o("WASmaxOutMessagePublishMessageTargetMixin").mergeMessageTargetMixin(n.smax("meta",null),s),o("WASmaxOutMessagePublishEncVersionBot").mergeEncVersionBot(o("WASmaxOutMessagePublishEncTypeMessageSecretMessageMixin").mergeEncTypeMessageSecretMessageMixin(n.smax("enc",null),u),c),o("WASmaxChildren").OPTIONAL_CHILD(e,r)),i);return d}function c(e,t){var n=u(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeIndividualBotResponseFanoutParticipants=e,l.makeIndividualBotResponseFanoutParticipantsTo=s,l.mergeIndividualBotResponseFanoutMixin=c}),98);
__d("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishIndividualBotRequestMessageMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutMixin","WASmaxOutMessagePublishIndividualIndividualFanoutMixin","WASmaxOutMessagePublishIndividualIndividualSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.individualBotResponseFanout)return o("WASmaxOutMessagePublishIndividualBotResponseFanoutMixin").mergeIndividualBotResponseFanoutMixin(e,t.individualBotResponseFanout);if(t.individualBotRequestMessage)return o("WASmaxOutMessagePublishIndividualBotRequestMessageMixin").mergeIndividualBotRequestMessageMixin(e,t.individualBotRequestMessage);if(t.individualIndividualSingle)return o("WASmaxOutMessagePublishIndividualIndividualSingleMixin").mergeIndividualIndividualSingleMixin(e,t.individualIndividualSingle);if(t.individualIndividualFanout)return o("WASmaxOutMessagePublishIndividualIndividualFanoutMixin").mergeIndividualIndividualFanoutMixin(e,t.individualIndividualFanout);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup=e}),98);
__d("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipient,n=o("WASmaxJsx").smax("message",{recipient:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIndividualRecipientDeprecaredMixin=s}),98);
__d("WASmaxOutMessagePublishMessageEditMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"1"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMessageEditMixin=s}),98);
__d("WASmaxOutMessagePublishMessagePinMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"2"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeMessagePinMixin=s}),98);
__d("WASmaxOutMessagePublishRevokeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",{edit:"7"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeRevokeMixin=s}),98);
__d("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishMessageEditMixin","WASmaxOutMessagePublishMessagePinMixin","WASmaxOutMessagePublishRevokeMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.isMessageEdit)return o("WASmaxOutMessagePublishMessageEditMixin").mergeMessageEditMixin(e);if(t.isMessagePin)return o("WASmaxOutMessagePublishMessagePinMixin").mergeMessagePinMixin(e);if(t.isRevoke)return o("WASmaxOutMessagePublishRevokeMixin").mergeRevokeMixin(e);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeMessageEditOrMessagePinOrRevokeMixinGroup=e}),98);
__d("WASmaxOutMessagePublishMetaConverstationThreadIdMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaConversationThreadId,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{conversation_thread_id:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMetaConverstationThreadIdMixin=s}),98);
__d("WASmaxOutMessagePublishMetaDestinationIdMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaDestinationId,n=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{destination_id:o("WAWap").CUSTOM_STRING(t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeMetaDestinationIdMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientUsernameMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientUsername,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_username:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientUsernameMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientLIDMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientLid,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_lid:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientLIDMixin=s}),98);
__d("WASmaxOutMessagePublishPeerRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyPeerRecipientPn,n=o("WASmaxJsx").smax("smax$any",{peer_recipient_pn:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerRecipientPNMixin=s}),98);
__d("WASmaxOutMessagePublishRecipientPNMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.messageRecipientPn,n=o("WASmaxJsx").smax("message",{recipient_pn:o("WAWap").JID(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRecipientPNMixin=s}),98);
__d("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishPeerRecipientLIDMixin","WASmaxOutMessagePublishPeerRecipientPNMixin","WASmaxOutMessagePublishRecipientPNMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.recipientPN)return o("WASmaxOutMessagePublishRecipientPNMixin").mergeRecipientPNMixin(e,t.recipientPN);if(t.peerRecipientPN)return o("WASmaxOutMessagePublishPeerRecipientPNMixin").mergePeerRecipientPNMixin(e,t.peerRecipientPN);if(t.peerRecipientLID)return o("WASmaxOutMessagePublishPeerRecipientLIDMixin").mergePeerRecipientLIDMixin(e,t.peerRecipientLID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup=e}),98);
__d("WASmaxOutMessagePublishStatusMentionMessageMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{is_status_mention:"true"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeStatusMentionMessageMixin=s}),98);
__d("WASmaxOutMessagePublishPrivacyTokenContentsMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePrivacyTokenContentsMixin=s}),98);
__d("WASmaxOutMessagePublishTCTokenMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishPrivacyTokenContentsMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.tctokenT,n=e.privacyTokenContentsMixinArgs,r=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutMessagePublishPrivacyTokenContentsMixin").mergePrivacyTokenContentsMixin(o("WASmaxJsx").smax("tctoken",{t:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,t)}),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTCTokenMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadType,n=o("WASmaxJsx").smax("meta",{thread_type:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagEnumMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagLegacyMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.metaThreadType,n=o("WASmaxJsx").smax("meta",{thread_type:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagLegacyMixin=s}),98);
__d("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutMessagePublishThreadTypeTagEnumMixin","WASmaxOutMessagePublishThreadTypeTagLegacyMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.threadTypeTagEnum)return o("WASmaxOutMessagePublishThreadTypeTagEnumMixin").mergeThreadTypeTagEnumMixin(e,t.threadTypeTagEnum);if(t.threadTypeTagLegacy)return o("WASmaxOutMessagePublishThreadTypeTagLegacyMixin").mergeThreadTypeTagLegacyMixin(e,t.threadTypeTagLegacy);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeThreadTypeTagEnumOrLegacyMixinGroup=e}),98);
__d("WASmaxOutMessagePublishThreadTypeTagMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.threadTypeTagEnumOrLegacyMixinGroupArgs,n=o("WASmaxJsx").smax("message",null,o("WASmaxOutMessagePublishThreadTypeTagEnumOrLegacyMixinGroup").mergeThreadTypeTagEnumOrLegacyMixinGroup(o("WASmaxJsx").smax("meta",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeThreadTypeTagMixin=s}),98);
__d("WASmaxOutMessagePublishViewOnceMetaAttributeMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("message",null,o("WASmaxJsx").smax("meta",{view_once:"true"}));return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeViewOnceMetaAttributeMixin=s}),98);
__d("WASmaxOutMessagePublishIndividualRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutMessagePublishAppdataMetaAttributeMixin","WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin","WASmaxOutMessagePublishBaseMixin","WASmaxOutMessagePublishGroupInviteTargetMixin","WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup","WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin","WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup","WASmaxOutMessagePublishMetaConverstationThreadIdMixin","WASmaxOutMessagePublishMetaDestinationIdMixin","WASmaxOutMessagePublishPeerRecipientUsernameMixin","WASmaxOutMessagePublishPeripheralOriginMixin","WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup","WASmaxOutMessagePublishStatusMentionMessageMixin","WASmaxOutMessagePublishTCTokenMixin","WASmaxOutMessagePublishThreadTypeTagMixin","WASmaxOutMessagePublishViewOnceMetaAttributeMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.messageId,r=e.groupInviteTargetMixinArgs,a=e.threadTypeTagMixinArgs,i=e.peerRecipientUsernameMixinArgs,l=e.individualRecipientDeprecaredMixinArgs,s=e.appdataMetaAttributeMixinArgs,u=e.hasStatusMentionMessage,c=e.tCTokenMixinArgs,d=e.hasViewOnceMetaAttribute,m=e.metaDestinationIdMixinArgs,p=e.metaConverstationThreadIdMixinArgs,_=e.peripheralOriginMixinArgs,f=e.armadilloOriginalMessageTimestampMixinArgs,g=e.individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs,h=e.messageEditOrMessagePinOrRevokeMixinGroupArgs,y=e.recipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroupArgs,C=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutMessagePublishRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup").mergeRecipientPNOrPeerRecipientPNOrPeerRecipientLIDMixinGroup,t.optionalMerge(o("WASmaxOutMessagePublishMessageEditOrMessagePinOrRevokeMixinGroup").mergeMessageEditOrMessagePinOrRevokeMixinGroup,o("WASmaxOutMessagePublishIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup").mergeIndividualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroup(t.optionalMerge(o("WASmaxOutMessagePublishArmadilloOriginalMessageTimestampMixin").mergeArmadilloOriginalMessageTimestampMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeripheralOriginMixin").mergePeripheralOriginMixin,t.optionalMerge(o("WASmaxOutMessagePublishMetaConverstationThreadIdMixin").mergeMetaConverstationThreadIdMixin,t.optionalMerge(o("WASmaxOutMessagePublishMetaDestinationIdMixin").mergeMetaDestinationIdMixin,t.optionalMerge(o("WASmaxOutMessagePublishViewOnceMetaAttributeMixin").mergeViewOnceMetaAttributeMixin,t.optionalMerge(o("WASmaxOutMessagePublishTCTokenMixin").mergeTCTokenMixin,t.optionalMerge(o("WASmaxOutMessagePublishStatusMentionMessageMixin").mergeStatusMentionMessageMixin,t.optionalMerge(o("WASmaxOutMessagePublishAppdataMetaAttributeMixin").mergeAppdataMetaAttributeMixin,t.optionalMerge(o("WASmaxOutMessagePublishIndividualRecipientDeprecaredMixin").mergeIndividualRecipientDeprecaredMixin,t.optionalMerge(o("WASmaxOutMessagePublishPeerRecipientUsernameMixin").mergePeerRecipientUsernameMixin,t.optionalMerge(o("WASmaxOutMessagePublishThreadTypeTagMixin").mergeThreadTypeTagMixin,t.optionalMerge(o("WASmaxOutMessagePublishGroupInviteTargetMixin").mergeGroupInviteTargetMixin,o("WASmaxOutMessagePublishBaseMixin").mergeBaseMixin(o("WASmaxJsx").smax("message",{id:o("WAWap").STANZA_ID(n)}),e),r),a),i),l),s),u),c),d),m),p),_),f),g),h),y);return C}l.makeIndividualRequest=e}),98);
__d("WASmaxMessagePublishIndividualRPC",["WAComms","WASmaxInMessagePublishIndividualResponseNegative","WASmaxInMessagePublishIndividualResponseSuccess","WASmaxOutMessagePublishIndividualRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutMessagePublishIndividualRequest").makeIndividualRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInMessagePublishIndividualResponseNegative").parseIndividualResponseNegative(r,n);if(a.success)return{name:"IndividualResponseNegative",value:a.value};var i=o("WASmaxInMessagePublishIndividualResponseSuccess").parseIndividualResponseSuccess(r,n);if(i.success)return{name:"IndividualResponseSuccess",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Individual",{Negative:a,Success:i}))}),s.apply(this,arguments)}l.sendIndividualRPC=e}),98);
__d("WASendMsgRPC",["WADeprecatedSendIq","WADeprecatedWapParser","WAFrankingTypes","WAGetDeviceIdentityMixin","WAJids","WALogger","WAParseFranking","WASmaxMessagePublishIndividualRPC","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t,n,r,o){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r,a){a===void 0&&(a=!1);var i=o("WAJids").interpretAsGroupJid(e.protocolMsgId.chat),l=e.messageType.type==="text"&&e.messageType.invitedParticipantUserJid!=null;if(t.type==="direct_user"){var s={individualIndividualSingle:{messageTo:t.message.to,individualIndividualRetryMixinArgs:_(e.count,t.recipient),contentMixinsArgs:p(e,t.message),encTypeIndividualMixinArgs:f(t.message),encVersionArgs:g(t.message)}},u=e.type==="direct"?e.originalMsgTimestampMs:void 0,c={messageId:e.externalId,deviceIdentityMixinArgs:o("WAGetDeviceIdentityMixin").getDeviceIdentityMixin(e.deviceIdentity),hasNoExtraFanout:e.messageType.isInvisible===!0?!0:null,messageEditOrMessagePinOrRevokeMixinGroupArgs:h(e.messageType),clientFrankingTagMixinArgs:n!=null&&n.frankingTag?{frankingTagElementValue:n.frankingTag}:null,hasMetaHideDecryptionPlaceholder:C(e.messageType)?!0:null,groupInviteTargetMixinArgs:l&&i!=null?{metaGroupInvite:i}:null,individualBotResponseFanoutOrIndividualBotRequestMessageOrIndividualIndividualSingleOrIndividualIndividualFanoutMixinGroupArgs:s,internalTestMixinArgs:a?{testConfig:"armadillo_express"}:null,armadilloOriginalMessageTimestampMixinArgs:u!=null?{metaOriginalMsgT:u}:null};r==null||r.addPoint("send_individual_rpc");var b=yield o("WASmaxMessagePublishIndividualRPC").sendIndividualRPC(c);if(b.name==="IndividualResponseSuccess"){var v,S=((v=b.value.deviceListStaleMixin)==null?void 0:v.phash)!=null?{type:"mismatch",local:null,server:b.value.deviceListStaleMixin.phash}:{type:"ok"},R=b.value.serverFrankingTagMixin!=null&&n!=null?babelHelpers.extends({},n,{reportingTag:o("WAFrankingTypes").castToReportingTag(b.value.serverFrankingTagMixin.frankingReportingTagElementValue)}):null;return{type:"success",ts:o("WATimeUtils").castToUnixTime(b.value.t),phash:S,count:null,reportingMeta:R}}else{var L,E;return b.name,{type:"error",errorCode:parseInt(b.value.error,10),backoff:parseInt((L=b.value.messageNackRetryAttributesMixin)==null?void 0:L.backoff,10),applicationError:(E=b.value.applicationNegativeAckMixin)==null?void 0:E.applicationError}}}var k=e.messageType.isInvisible===!0?"false":o("WAWap").DROP_ATTR,I=t.participant!=null?o("WAWap").JID(t.participant):o("WAWap").DROP_ATTR,T=t.phash!=null&&t.type==="group"?o("WAWap").CUSTOM_STRING(t.phash):o("WAWap").DROP_ATTR;function D(){return e.messageType.type==="text"&&e.messageType.isRevoked?"7":e.messageType.type==="text"&&e.messageType.isEdit===!0?"1":o("WAWap").DROP_ATTR}var x=D();function $(){return l&&i!=null?o("WAWap").wap("meta",{"decrypt-fail":"hide",group_invite:o("WAWap").CUSTOM_STRING(i)}):C(e.messageType)?o("WAWap").wap("meta",{"decrypt-fail":"hide"}):null}var P=$(),N=a?o("WAWap").wap("test",{config:o("WAWap").CUSTOM_STRING("armadillo_express")}):null,M=e.deviceIdentity!=null?o("WAWap").wap("device-identity",null,e.deviceIdentity):null,w=(n==null?void 0:n.frankingTag)!=null?o("WAWap").wap("franking",null,o("WAWap").wap("franking_tag",null,n.frankingTag)):null,A=null;t.participants!=null&&(A=o("WAWap").wap("participants",null,t.participants.map(function(e){return d(e)})));var F=null;t.message!=null&&(F=d(t.message,!0));var O=o("WAWap").wap("message",{device_fanout:k,edit:x,id:o("WAWap").CUSTOM_STRING(e.externalId),participant:I,phash:T,to:o("WAWap").JID(t.messageTo),type:e.messageType.type},P,w,A,F,M,N);y(e.externalId),r==null||r.addPoint("send_stanza_and_return_ack");var B=yield o("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(O,{id:e.externalId,class:"message",from:t.messageTo,participant:t.participant!=null?t.participant:null});r==null||r.addPoint("send_msg_ack_parser");var W=m.parse(B);if(W.success){r==null||r.addPoint("send_msg_ack_parser_success");var q=W.success,U=q.applicationError,V=q.backoff,H=q.errorCode;if(H==null){var G,z=W.success,j=z.count,K=z.phash,Q=z.ts,X=n!=null?babelHelpers.extends({},n,{reportingTag:(G=W.success.reportingMeta)==null?void 0:G.reportingTag}):null;return{type:"success",ts:Q,phash:K==null||K===t.phash?{type:"ok"}:{type:"mismatch",local:t.phash,server:K},count:j,reportingMeta:X}}else return r==null||r.addPoint("send_msg_ack_parser_failed",{int:{errorCode:H,applicationError:U}}),{type:"error",errorCode:H,applicationError:U,backoff:V}}else return{type:"parsing_error"}}),c.apply(this,arguments)}function d(e,t){t===void 0&&(t=!1);var n=o("WAWap").wap("enc",{count:e.count!=null?o("WAWap").INT(e.count):o("WAWap").DROP_ATTR,mediatype:e.mediaType!=null?o("WAWap").CUSTOM_STRING(e.mediaType):o("WAWap").DROP_ATTR,type:o("WAWap").CUSTOM_STRING(e.type),v:o("WAWap").CUSTOM_STRING(e.v)},e.ciphertext);return t||e.encType==="group"?n:o("WAWap").wap("to",{jid:o("WAWap").DEVICE_JID(e.to)},n)}var m=new(r("WADeprecatedWapParser"))("sendMsgAck",function(e){return e.assertTag("ack"),{count:e.maybeAttrInt("count"),errorCode:e.maybeAttrInt("error"),phash:e.maybeAttrString("phash"),applicationError:e.maybeAttrInt("application_error"),ts:e.attrTime("t"),reportingMeta:o("WAParseFranking").parseFrankingNode(e.maybeChild("franking")),backoff:e.maybeAttrInt("backoff")}});function p(t,n){if(t.messageType.type==="reaction")return{isContentTypeReaction:!0};if(t.messageType.type==="text")return{isContentTypeText:!0};if(t.messageType.type,n.mediaType!=null){var r={contentTypeMediaOrMedianotifyMixinGroupArgs:{isContentTypeMedia:!0},encMediaTypeEncMediaTypeOrEncMediaTypeDeprecatedMixinGroupArgs:{encMediaType:{encMediatype:n.mediaType}}};return{contentTypeMediaSingle:r}}return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["WASendMsgRPC: Wrong media type: ",""])),t.messageType.mediaType),{isContentTypeText:!0}}function _(e,t){var n=e!=null?{encCount:e}:null,r=t!=null?{messageRecipient:t}:null;return{encRetryMixinArgs:n,individualIndividualRetryToPeerMixinArgs:r}}function f(e){return{encType:e.type,encElementValue:e.ciphertext}}function g(e){return e.v==="2"?{isEncVersion2:!0}:{isEncVersion3:!0}}function h(e){return e.type==="text"&&e.isRevoked?{isRevoke:!0}:null}function y(e){try{var t=BigInt(e)}catch(t){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[WASendMsgRPC] Sending message with not allowed stanzaId: ",", error: ",""])),e,t)}}function C(e){return e.type==="reaction"||e.isInvisible===!0||e.isEdit===!0}l.sendStanza=u,l.createEncWapNode=d}),98);
__d("WASendMsgInternal",["FBLogger","Promise","WABridge","WADevicesState","WAEncGroupMsg","WAEncUserMsg","WAGlobals","WAJids","WALogger","WAMarkSenderKeyAsSentApi","WAOdsEnums","WAQueryGroupsAndSync","WAResultOrError","WASendMsgRPC","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=10002,f=10009;function g(e,t){return h.apply(this,arguments)}function h(){return h=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n,a,i,l;t.addPoint("encrypt_start",{string:{sentMessageType:e.messageType.isRevoked===!0?"revoke":e.messageType.type},bool:{isInvisibleMsg:e.messageType.type==="text"&&e.messageType.isInvisible===!0}});var s=yield o("WAGlobals").getWaOneQueue().enqueue(function(n){var r=n.cryptoManager;return e.type==="chat"?L(e,t,2,{cryptoManager:r}):S(e,{cryptoManager:r},2)},{operationType:"encrypt",flush:!0});if(t.addPoint("finish_encrypt",{string:{chatType:s.success?s.value.type:s.error}}),s.success===!1)throw r("FBLogger")("wmi").mustfixThrow("Encryption failed %s",s.error);var u=s.value;t.addPoint("sending_stanza_start",{string:{encryptionType:u.type},int:{ciphertextByteLength:(n=(a=(i=u.message)==null||(i=i.ciphertext)==null?void 0:i.length)!=null?a:(l=u.participants)==null||(l=l[0].ciphertext)==null?void 0:l.length)!=null?n:0}});var c=yield o("WASendMsgRPC").sendStanza(e,u,e.reportingMeta,t);return t.addPoint("sending_stanza_end",{bool:{wai:c.type==="success"}}),{serverResponse:c,encryption:u}}),h.apply(this,arguments)}function y(e,t,n){return C.apply(this,arguments)}function C(){return C=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,r){var a,i,l,s;r===void 0&&(r=!1),D(e,t);var u=r?3:2,c=function(r){return e.type==="chat"?L(e,t,u,{cryptoManager:r}):S(e,{cryptoManager:r},u)},m=yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return c(t)},{operationType:"encrypt",flush:!0}),f=m.success?m.value.type:m.error;if(t.addPoint("finish_encrypt",{string:{chatType:f}}),m.success===!1)return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMsg Failed to encrypt message for "," message"])),f),o("WAResultOrError").makeError({type:"encryption-error",isRetriable:!1});var g=m.value;t.addPoint("sending_stanza_start",{string:{encryptionType:g.type},int:{ciphertextByteLength:(a=(i=(l=g.message)==null||(l=l.ciphertext)==null?void 0:l.length)!=null?i:(s=g.participants)==null||(s=s[0].ciphertext)==null?void 0:s.length)!=null?a:0}});var h=yield o("WASendMsgRPC").sendStanza(e,g,e.reportingMeta,t,r);if(t.addPoint("sending_stanza_end"),h.type==="success"){t.addPoint("send_stanza_success");try{var y,C=yield(p||(p=n("Promise"))).all([E(e,g,h,t),I(g)]),b=C[0];return t.addPoint("mark_sender_key_sent"),o("WAResultOrError").makeResult({baseKey:(y=g.message)==null?void 0:y.baseKey,reportingMeta:h.reportingMeta,serverTs:h.ts,meta:{pOrDhashMismatch:b}})}catch(e){throw t.addPoint("send_stanza_failed"),e}}if(h.type,x(h,f,t),h.applicationError===_&&(yield o("WAGlobals").getDependencies().handleReachabilityErrorAdminMsg(e.chat)),h.type==="parsing_error")return o("WAResultOrError").makeError({type:"result-parsing-error",isRetriable:!0});if(h.type==="error"){var v=h.errorCode!=null&&h.errorCode>=500;return v?o("WAResultOrError").makeError({type:"retryable-error",backoff:h.backoff,isRetriable:!0}):o("WAResultOrError").makeError({type:"non-retryable-error",applicationErrorCode:h.applicationError,errorCode:h.errorCode,isRetriable:!1})}return o("WAResultOrError").makeError({type:"unexpected-message-codepath",details:"impossible-server-error-result",isRetriable:!0,applicationErrorCode:h.applicationError})}),C.apply(this,arguments)}function b(e){return o("WADevicesState").getDevicesState().reset([e]),o("WADevicesState").getDevicesState().waitForUserDevices([e],"SendMsgUtil_recoverUser",!0)}function v(e){return o("WAJids").switchOnChatJidType(e,{interopUser:b,msgrUser:b,lidUser:b,phoneUser:b,group:function(t){return o("WAQueryGroupsAndSync").queryGroupsAndSync({groupJids:[t],ignoreDhash:!0})}})}function S(e,t,n){return R.apply(this,arguments)}function R(){return R=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){var r=e.backupDirective,a=e.chat,i=e.count,l=e.identityKey,s=e.messageBytes,u=e.messageType,c=e.sessionInfo,d=e.to,m=yield o("WAEncUserMsg").encryptDeviceJidMessage(d,{type:"message",chat:a,messageBytes:s,messageType:u,applicationPayloadVersion:n,backupDirective:r},t,i,c,l);return o("WAJids").switchOnUserChatJidType(a,{user:function(n){return m!=null?o("WAResultOrError").makeResult({type:"direct_user",messageTo:e.to,message:m,recipient:o("WAGlobals").isPeerDevice(e.to)?n:null}):o("WAResultOrError").makeError("direct_user")},group:function(n){return m!=null?o("WAResultOrError").makeResult({type:"direct_group",messageTo:n,participant:e.to,message:m}):o("WAResultOrError").makeError("direct_group")}})}),R.apply(this,arguments)}function L(t,r,a,i){var l=t.backupDirective,u=t.chat,c=t.messageBytes,d=t.messageType,m=t.recipients;return o("WAJids").switchOnUserChatJidType(u,{user:(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=yield o("WAEncUserMsg").encryptUserMsg(m,{type:"message",messageBytes:c,messageType:d,chat:e,applicationPayloadVersion:a,backupDirective:l},i,r),n=t.participants;return n!=null&&n.length>0?o("WAResultOrError").makeResult({type:"user",messageTo:e,participants:n,phash:t.phash}):o("WAResultOrError").makeError("user")});function t(t){return e.apply(this,arguments)}return t})(),group:(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- group message"])));var n=yield o("WAEncGroupMsg").encryptGroupMsg(t,m,c,d,i,l,r);o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg -- encryptChatMessage -- finish encrypt group message"])));var a=n.encNode,u=n.participants;return u==null&&a==null?o("WAResultOrError").makeError("group"):o("WAResultOrError").makeResult({type:"group",messageTo:t,participants:u,message:a,senderKeyDistributionInfo:n.senderKeyDistributionInfo,phash:n.phash})});function a(e){return t.apply(this,arguments)}return a})()})}function E(e,t,n,r){return k.apply(this,arguments)}function k(){return k=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,r){if(n.type!=="success")return!1;var a=n.phash;return a.type==="mismatch"?(r.addPoint("phash_mismatch"),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch, local[","] server[","]"])),a.local,a.server),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:t.type}),yield v(e.chat),r.addPoint("participant_recovery_finished"),!0):!1}),k.apply(this,arguments)}function I(e){return T.apply(this,arguments)}function T(){return T=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(e.senderKeyDistributionInfo!=null){var t=e.senderKeyDistributionInfo,n=t.group,r=t.knowsSenderKey,a=t.senderKeyId;yield o("WAMarkSenderKeyAsSentApi").markSenderKeyAsSent(n,a,r)}}),T.apply(this,arguments)}function D(e,t){var n=0;e.type==="chat"&&(n=e.recipients.reduce(function(e,t){return e+t.devicesInfo.length},0)),t.addPoint("start_encrypt",{int:{numDevices:n},bool:{isInvisibleMsg:e.messageType.type==="text"&&e.messageType.isInvisible===!0}})}function x(e,t,n){if(e.type!=="success"){e.type==="parsing_error"&&(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is false, chatType:",""])),t),n.addPoint("ack_parse_fail"));var r=e.applicationError,a=e.errorCode;r===_&&n.addPoint("reachability_error_code"),o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["sendMessage ack success is true, error: ",", applicationError: ",", chatType:",""])),a,r,t),a!=null&&n.addPoint("ack_success_error_"+a,{int:{applicationError:r}}),r===f&&n.addPoint("sender_blocked",{})}}l.sendMessageV2=g,l.sendMessage=y}),98);
__d("WASentBytesCacheApi",["MAWTransactionMode","WADbTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e=o("WADbTransactor")).makeSignalTransactor({sentBytesCache:(s=o("MAWTransactionMode")).READWRITE},"deleteSentBytes",function(e){return function(t){return e.sentBytesCache.bulkDelete(t)}}),c=e.makeSignalTransactor({sentBytesCache:s.READONLY},"loadExpired",function(e){return function(t){return e.sentBytesCache.where("ts").belowOrEqual(t).toArray().then(function(e){return e.map(function(e){return e.waMsgId})})}}),d=e.makeSignalTransactor({sentBytesCache:s.READONLY},"loadSentBytes",function(e){return function(t){return e.sentBytesCache.bulkGet(t).then(function(e){return e.filter(Boolean)})}}),m=e.makeSignalTransactor({sentBytesCache:s.READWRITE},"saveSentBytes",function(e){return function(t){return e.sentBytesCache.put(t).then(function(){})}});l.deleteSentBytes=u,l.loadExpired=c,l.loadSentBytes=d,l.saveSentBytes=m}),98);
__d("WASentBytesCache",["WAGlobals","WAJids","WAMsg","WASentBytesCacheApi","WATagsLogger","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["SentBytesCache"]),c=720*60*60,d=(function(){function t(){var t=this;o("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){t.$1().catch(function(t){u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to prune sent bytes: ",""])),t)})})}var a=t.prototype;return a.loadSentBytes=function(t){return o("WASentBytesCacheApi").loadSentBytes(t)},a.getMsgsForRetry=(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=Array.from(new Set(e.map(function(e){var t=e.deviceJid;return o("WAJids").extractUserJid(t)}))),n=new Map;try{n=yield o("WAGlobals").getWaOneQueue().enqueue(function(e){var n=e.cryptoManager;return n.storage.bulkLoadIdentities(t)},{operationType:"retries_load_identities",flush:!1,afterInit:!0})}catch(e){var a=r("getErrorSafe")(e);u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["It fails to bulkLoadIdentities: ",""])),a.toString())}var i=yield this.loadSentBytes(e.map(function(e){var t=e.protocolMsgId;return o("WAMsg").craftWAMsgIdString({author:t.author,chat:t.chat,externalId:t.externalId})}));return e.map(function(e){var t,r=e.deviceJid,a=e.protocolMsgId,l=o("WAMsg").craftWAMsgIdString({author:a.author,chat:a.chat,externalId:a.externalId}),s=(t=n.get(o("WAJids").extractUserJid(r)))==null?void 0:t.get(r);if(s==null)return{type:"unauthorized"};var u=i.find(function(e){return e.waMsgId===l});return u==null?{type:"missing"}:o("WATimeUtils").happenedWithin(u.ts,c)?{frankingKey:u.frankingKey,frankingVersion:u.frankingVersion,messageBytes:u.messageBytes,backupDirective:u.backupDirective,messageType:u.messageType,protocolMsgId:u.protocolMsgId,retryCount:e.retryCount+1,type:"unacked",serverTs:u.ts}:{type:"unauthorized"}})});function t(t){return e.apply(this,arguments)}return t})(),a.saveSentBytes=function(t){return o("WASentBytesCacheApi").saveSentBytes(t)},a.$1=function(){return o("WASentBytesCacheApi").loadExpired(o("WATimeUtils").pastUnixTime(c)).then(function(e){return o("WASentBytesCacheApi").deleteSentBytes(e)})},t})(),m=new d;function p(){return m}l.SentBytesCache=d,l.sentBytesCache=p}),98);
__d("WASmaxInAppdataPublishAckMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",r.value);if(!a.success)return a;var i=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"class","appdata");if(!i.success)return i;var l=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",l.value);if(!s.success)return s;var u=o("WASmaxParseUtils").attrIntRange(e,"t",0,void 0);return u.success?o("WAResultOrError").makeResult({class:i.value,t:u.value}):u}l.parseAckMixin=e}),98);
__d("WASmaxInAppdataPublishPeerResponseNegative",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"error");if(!r.success)return r;var a=o("WASmaxInAppdataPublishAckMixin").parseAckMixin(e,t);return a.success?o("WAResultOrError").makeResult(babelHelpers.extends({error:r.value},a.value)):a}l.parsePeerResponseNegative=e}),98);
__d("WASmaxInAppdataPublishDeviceListStaleMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"ack");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"phash");return n.success?o("WAResultOrError").makeResult({phash:n.value}):n}l.parseDeviceListStaleMixin=e}),98);
__d("WASmaxInAppdataPublishPeerResponseSuccess",["WAResultOrError","WASmaxInAppdataPublishAckMixin","WASmaxInAppdataPublishDeviceListStaleMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"ack");if(!n.success)return n;var r=o("WASmaxInAppdataPublishAckMixin").parseAckMixin(e,t);if(!r.success)return r;var a=o("WASmaxInAppdataPublishDeviceListStaleMixin").parseDeviceListStaleMixin(e);return o("WAResultOrError").makeResult(babelHelpers.extends({},r.value,{deviceListStaleMixin:a.success?a.value:null}))}l.parsePeerResponseSuccess=e}),98);
__d("WASmaxOutAppdataPublishDeviceIdentityMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.deviceIdentityElementValue,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("device-identity",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeDeviceIdentityMixin=s}),98);
__d("WASmaxOutAppdataPublishInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.testConfig,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxJsx").smax("test",{config:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t)}));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeInternalTestMixin=s}),98);
__d("WASmaxOutAppdataPublishRequestIDMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestIdElementValue,n=o("WASmaxJsx").smax("trace",null,o("WASmaxJsx").smax("request_id",null,t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRequestIDMixin=s}),98);
__d("WASmaxOutAppdataPublishTraceIDMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.edgeIdElementValue,n=o("WASmaxJsx").smax("edge_id",null,t);return n}function s(e){var t=e.deviceArgs,n=e.correlationIdType,r=e.idElementValue,a=o("WASmaxJsx").smax("correlation_id",{type:o("WAWap").CUSTOM_STRING(n)},o("WASmaxJsx").smax("id",null,r),o("WASmaxChildren").OPTIONAL_CHILD(u,t));return a}function u(e){var t=e.deviceId,n=o("WASmaxJsx").smax("device",{id:o("WAWap").INT(t)});return n}function c(t){var n=t.edgeIdArgs,r=t.correlationIdArgs,a=t.traceIdElementValue,i=o("WASmaxJsx").smax("trace",null,[o("WASmaxJsx").smax("trace_id",null,a),o("WASmaxChildren").OPTIONAL_CHILD(e,n)].concat(o("WASmaxChildren").REPEATED_CHILD(s,r,0,10)));return i}function d(e,t){var n=c(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makeTraceIDEdgeId=e,l.makeTraceIDCorrelationId=s,l.makeTraceIDCorrelationIdDevice=u,l.mergeTraceIDMixin=d}),98);
__d("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishRequestIDMixin","WASmaxOutAppdataPublishTraceIDMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.requestID)return o("WASmaxOutAppdataPublishRequestIDMixin").mergeRequestIDMixin(e,t.requestID);if(t.traceID)return o("WASmaxOutAppdataPublishTraceIDMixin").mergeTraceIDMixin(e,t.traceID);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergeRequestOrTraceIDMixinGroup=e}),98);
__d("WASmaxOutAppdataPublishTraceContextMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup"],(function(t,n,r,o,a,i,l){function e(e){var t=e.requestOrTraceIDMixinGroupArgs,n=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutAppdataPublishRequestOrTraceIDMixinGroup").mergeRequestOrTraceIDMixinGroup(o("WASmaxJsx").smax("trace",null),t));return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeTraceContextMixin=s}),98);
__d("WASmaxOutAppdataPublishWithDeviceListCheckMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataDeviceListCheck,n=o("WASmaxJsx").smax("appdata",{device_list_check:o("WAWap").CUSTOM_STRING(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeWithDeviceListCheckMixin=s}),98);
__d("WASmaxOutAppdataPublishBaseMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishDeviceIdentityMixin","WASmaxOutAppdataPublishInternalTestMixin","WASmaxOutAppdataPublishTraceContextMixin","WASmaxOutAppdataPublishWithDeviceListCheckMixin"],(function(t,n,r,o,a,i,l){function e(e){var t,n=e.deviceIdentityMixinArgs,r=e.withDeviceListCheckMixinArgs,a=e.internalTestMixinArgs,i=e.traceContextMixinArgs,l=(t=o("WASmaxMixins")).optionalMerge(o("WASmaxOutAppdataPublishTraceContextMixin").mergeTraceContextMixin,t.optionalMerge(o("WASmaxOutAppdataPublishInternalTestMixin").mergeInternalTestMixin,t.optionalMerge(o("WASmaxOutAppdataPublishWithDeviceListCheckMixin").mergeWithDeviceListCheckMixin,t.optionalMerge(o("WASmaxOutAppdataPublishDeviceIdentityMixin").mergeDeviceIdentityMixin,o("WASmaxJsx").smax("appdata",null),n),r),a),i);return l}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeBaseMixin=s}),98);
__d("WASmaxOutAppdataPublishEncPayloadMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encElementValue,n=o("WASmaxJsx").smax("enc",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncPayloadMixin=s}),98);
__d("WASmaxOutAppdataPublishEncTypeIndividualMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncPayloadMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encType,n=o("WASmaxOutAppdataPublishEncPayloadMixin").mergeEncPayloadMixin(o("WASmaxJsx").smax("enc",{type:o("WAWap").CUSTOM_STRING(t)}),e);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncTypeIndividualMixin=s}),98);
__d("WASmaxOutAppdataPublishEncVersionFutureproofMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encV,n=o("WASmaxJsx").smax("enc",{v:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncVersionFutureproofMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerPeerFanoutMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.toJid,n=e.encVersionFutureproofMixinArgs,r=e.encTypeIndividualMixinArgs,a=o("WASmaxJsx").smax("to",{jid:o("WAWap").DEVICE_JID(t)},o("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(o("WASmaxJsx").smax("enc",null),n),r));return a}function s(t){var n=t.toArgs,r=t.appdataTo,a=o("WASmaxJsx").smax("appdata",{to:o("WAWap").USER_JID(r)},o("WASmaxJsx").smax("participants",null,o("WASmaxChildren").REPEATED_CHILD(e,n,1,24)));return a}function u(e,t){var n=s(t);return o("WASmaxMixins").mergeStanzas(e,n)}l.makePeerPeerFanoutParticipantsTo=e,l.mergePeerPeerFanoutMixin=u}),98);
__d("WASmaxOutAppdataPublishEncRetryMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.encCount,n=o("WASmaxJsx").smax("enc",{count:o("WAWap").INT(t)});return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeEncRetryMixin=s}),98);
__d("WASmaxOutAppdataPublishRetryMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataT,n=e.encRetryMixinArgs,r=o("WASmaxJsx").smax("appdata",{t:o("WAWap").INT(t)},o("WASmaxOutAppdataPublishEncRetryMixin").mergeEncRetryMixin(o("WASmaxJsx").smax("enc",null),n));return r}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeRetryMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerPeerSingleMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutAppdataPublishEncTypeIndividualMixin","WASmaxOutAppdataPublishEncVersionFutureproofMixin","WASmaxOutAppdataPublishRetryMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataTo,n=e.retryMixinArgs,r=e.encVersionFutureproofMixinArgs,a=e.encTypeIndividualMixinArgs,i=o("WASmaxMixins").optionalMerge(o("WASmaxOutAppdataPublishRetryMixin").mergeRetryMixin,o("WASmaxJsx").smax("appdata",{to:o("WAWap").DEVICE_JID(t)},o("WASmaxOutAppdataPublishEncTypeIndividualMixin").mergeEncTypeIndividualMixin(o("WASmaxOutAppdataPublishEncVersionFutureproofMixin").mergeEncVersionFutureproofMixin(o("WASmaxJsx").smax("enc",null),r),a)),n);return i}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergePeerPeerSingleMixin=s}),98);
__d("WASmaxOutAppdataPublishPeerMsgTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutAppdataPublishPeerPeerFanoutMixin","WASmaxOutAppdataPublishPeerPeerSingleMixin"],(function(t,n,r,o,a,i,l){function e(e,t){if(t.peerPeerFanout)return o("WASmaxOutAppdataPublishPeerPeerFanoutMixin").mergePeerPeerFanoutMixin(e,t.peerPeerFanout);if(t.peerPeerSingle)return o("WASmaxOutAppdataPublishPeerPeerSingleMixin").mergePeerPeerSingleMixin(e,t.peerPeerSingle);throw new(o("WASmaxMixinGroupExhaustiveError")).SmaxMixinGroupExhaustiveError}l.mergePeerMsgTypes=e}),98);
__d("WASmaxOutAppdataPublishPeerRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAppdataPublishBaseMixin","WASmaxOutAppdataPublishPeerMsgTypes","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.appdataId,n=e.appdataPushPriority,r=e.peerMsgTypesArgs,a=o("WASmaxOutAppdataPublishPeerMsgTypes").mergePeerMsgTypes(o("WASmaxOutAppdataPublishBaseMixin").mergeBaseMixin(o("WASmaxJsx").smax("appdata",{id:o("WAWap").STANZA_ID(t),category:"peer",push_priority:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,n)}),e),r);return a}l.makePeerRequest=e}),98);
__d("WASmaxAppdataPublishPeerRPC",["WAComms","WASmaxInAppdataPublishPeerResponseNegative","WASmaxInAppdataPublishPeerResponseSuccess","WASmaxOutAppdataPublishPeerRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var n=o("WASmaxOutAppdataPublishPeerRequest").makePeerRequest(e),r=yield o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInAppdataPublishPeerResponseNegative").parsePeerResponseNegative(r,n);if(a.success)return{name:"PeerResponseNegative",value:a.value};var i=o("WASmaxInAppdataPublishPeerResponseSuccess").parsePeerResponseSuccess(r,n);if(i.success)return{name:"PeerResponseSuccess",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Peer",{Negative:a,Success:i}))}),s.apply(this,arguments)}l.sendPeerRPC=e}),98);