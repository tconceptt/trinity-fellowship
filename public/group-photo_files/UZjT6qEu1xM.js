;/*FB_PKG_DELIM*/

__d("BotFeedbackKind",[],(function(t,n,r,o,a,i){var e=Object.freeze({BOT_FEEDBACK_POSITIVE:0,BOT_FEEDBACK_NEGATIVE_GENERIC:1,BOT_FEEDBACK_NEGATIVE_HELPFUL:2,BOT_FEEDBACK_NEGATIVE_INTERESTING:3,BOT_FEEDBACK_NEGATIVE_ACCURATE:4,BOT_FEEDBACK_NEGATIVE_SAFE:5,BOT_FEEDBACK_NEGATIVE_OTHER:6,BOT_FEEDBACK_NEGATIVE_REFUSED:7,BOT_FEEDBACK_NEGATIVE_NOT_VISUALLY_APPEALING:8,BOT_FEEDBACK_NEGATIVE_NOT_RELEVANT_TO_TEXT:9,BOT_FEEDBACK_NEGATIVE_PERSONALIZED:10,BOT_FEEDBACK_NEGATIVE_CLARITY:11,BOT_FEEDBACK_NEGATIVE_DOESNT_LOOK_LIKE_THE_PERSON:12,BOT_FEEDBACK_NEGATIVE_HALLUCINATION_INTERNAL_ONLY:13,BOT_FEEDBACK_NEGATIVE:14,BOT_FEEDBACK_NEGATIVE_DONT_SHOW_AGAIN:15,BOT_FEEDBACK_NEGATIVE_INCORRECT_OWNERSHIP:16,BOT_FEEDBACK_NEGATIVE_NOT_RELEVANT_TO_RESPONSE:17,BOT_FEEDBACK_NEGATIVE_TOO_REPETITIVE:18});i.default=e}),66);
__d("IGDBroadcastChannelLoggingShapes",[],(function(t,n,r,o,a,i){"use strict";var e={action:"tap",event:"message_options_rendered",parent_surface:"broadcast",source:"message_options_dot_menu",surface:"thread_view"},l={action:"tap",event:"end_chat_dialog_rendered",parent_surface:"broadcast",source:"end_chat_cta_button",surface:"thread_details"},s={action:"tap",event:"thread_end_successful",parent_surface:"broadcast",source:"end_chat",surface:"thread_details"},u={action:"tap",event:"thread_end_attempt",parent_surface:"broadcast",source:"end_chat_dialog",surface:"thread_details"},c={action:"tap",event:"thread_end_error",parent_surface:"broadcast",source:"end_chat",surface:"thread_details"},d={action:"tap",event:"thread_end_cancel",parent_surface:"broadcast",source:"end_chat_dialog",surface:"thread_details"},m={action:"view",event:"retrieve_polls_responses_details",parent_surface:"instagram",source:"poll_responses",surface:"thread_view"},p={action:"view",event:"poll_responses_render_error",parent_surface:"instagram",source:"poll_responses",surface:"thread_view"},_={action:"view",event:"poll_responses_render_successful",parent_surface:"instagram",source:"poll_responses",surface:"thread_view"},f={action:"tap",event:"retrieve_message_reactions_details",parent_surface:"instagram",source:"view_reactions_button",surface:"thread_view"},g={action:"view",event:"message_reactions_render_error",parent_surface:"instagram",source:"message_reactions",surface:"thread_view"},h={action:"view",event:"message_reactions_render_successful",parent_surface:"instagram",source:"message_reactions",surface:"thread_view"},y={action:"view",event:"fetch_seen_active_count_error",parent_surface:"instagram",source:"view_seen_active_count",surface:"thread_view"},C={action:"view",event:"fetch_seen_active_count_successful",parent_surface:"instagram",source:"view_seen_active_count",surface:"thread_view"},b={action:"tap",event:"thread_create_attempt",parent_surface:"broadcast",source:"create_broadcast_chat_button",surface:"chat_setup"},v={action:"view",event:"thread_create_successful",parent_surface:"broadcast",source:"create_broadcast_chat",surface:"thread_view"},S={action:"view",event:"thread_create_error",parent_surface:"broadcast",source:"create_broadcast_chat",surface:"chat_setup"},R={action:"view",event:"broadcast_chat_option_viewed",parent_surface:"broadcast",source:"omnipicker_view",surface:"dm_creation_omnipicker"},L={action:"tap",event:"creator_nux_sheet_rendered",parent_surface:"broadcast",source:"create_broadcast_chat_item",surface:"dm_creation_omnipicker"},E={action:"tap",event:"chat_setup_sheet_rendered",parent_surface:"broadcast",source:"create_broadcast_chat_item",surface:"dm_creation_omnipicker"},k={action:"tap",event:"chat_setup_sheet_rendered",parent_surface:"broadcast",source:"get_started_button",surface:"broadcast_chat_creator_nux"},I={action:"impression",event:"exit_chat_setup_sheet",parent_surface:"broadcast",source:"back_button",surface:"chat_setup"};function T(e){return{action:"impression",event:"thread_view_desktop_web_rendered",extra:{threadIgid:e},parent_surface:"broadcast",source:"broadcast_chat_invite_link",surface:"thread_view"}}function D(e){return{action:"impression",event:"thread_view_mobile_web_rendered",extra:{threadIgid:e},parent_surface:"broadcast",source:"broadcast_chat_invite_link",surface:"thread_view"}}function x(e){return{action:"impression",event:"download_ig_button_rendered",extra:{threadIgid:e},parent_surface:"broadcast",source:"download_ig_button",surface:"thread_view"}}i.MESSAGE_OPTIONS_RENDERED_SHAPE=e,i.END_CHAT_DIALOG_RENDERED_SHAPE=l,i.THREAD_END_SUCCESSFUL_SHAPE=s,i.THREAD_END_ATTEMPT_SHAPE=u,i.THREAD_END_ERROR_SHAPE=c,i.THREAD_END_CANCEL_SHAPE=d,i.POLL_DETAIL_DIALOG_RENDERED_SHAPE=m,i.POLL_DETAIL_DIALOG_RESPONSE_FETCH_FAILED_SHAPE=p,i.POLL_DETAIL_DIALOG_RESPONSE_FETCH_SUCCESSFUL_SHAPE=_,i.REACTIONS_FOOTER_BUTTON_CLICK_SHAPE=f,i.REACTIONS_DIALOG_RESPONSE_FETCH_FAILED_SHAPE=g,i.REACTIONS_DIALOG_RESPONSE_FETCH_SUCCESSFUL_SHAPE=h,i.SEEN_COUNT_RESPONSE_FETCH_FAILED_SHAPE=y,i.SEEN_COUNT_RESPONSE_FETCH_SUCCESSFUL_SHAPE=C,i.CREATE_BROADCAST_CHANNEL_ATTEMPT_SHAPE=b,i.CREATE_BROADCAST_CHANNEL_SUCCESS_SHAPE=v,i.BROADCAST_CHANNEL_SUCCESS_FAILURE_SHAPE=S,i.BROADCAST_CHAT_OPTION_VIEWED_SHAPE=R,i.CREATOR_NUX_SHEET_RENDERED_SHAPE=L,i.CHAT_SETUP_SHEET_RENDERED_SHAPE=E,i.CHAT_SETUP_SHEET_RENDERED_FROM_NUX_SHAPE=k,i.EXIT_CHAT_SETUP_SHEET_SHAPE=I,i.DESKTOP_WEB_LOGGED_OUT_PREVIEW_IMPRESSION=T,i.MOBILE_WEB_LOGGED_OUT_PREVIEW_IMPRESSION=D,i.MOBILE_WEB_LOGGED_OUT_DOWNLOAD_APP_BUTTON_IMPRESSION=x}),66);
__d("LSDeleteReaction",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.forEach(t.filter(t.db.table(8).fetch([[[e[0],e[1],e[2]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]&&t.i64.eq(n.actorId,e[2])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))}),function(e){return e.delete()})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxDeleteReactionStoredProcedure",e.__tables__=["reactions"],a.exports=e}),null);
__d("LSMediaUrlAttachment",["I64","LSMediaUrlUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){var t=e.previewUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.previewUrlFallback:e.previewUrl}function u(e){var t=e.previewUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.previewUrlFallback:e.previewUrlLarge}function c(e){var t=e.playableUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.playableUrlFallback:e.playableUrl}function d(e){var t=e.imageUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.imageUrlFallback:e.imageUrl}function m(e){var t=e.faviconUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.faviconUrlFallback:e.faviconUrl}function p(t){try{var n=t.listItemContactUrlExpirationTimestampList1;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemContactUrlFallbackList1:t.listItemContactUrlList1}catch(e){return t.listItemContactUrlList1}}function _(t){try{var n=t.listItemContactUrlExpirationTimestampList2;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemContactUrlFallbackList2:t.listItemContactUrlList2}catch(e){return t.listItemContactUrlList2}}function f(t){try{var n=t.listItemContactUrlExpirationTimestampList3;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemContactUrlFallbackList3:t.listItemContactUrlList3}catch(e){return t.listItemContactUrlList3}}function g(e){var t=e.headerImageUrlExpirationTimestampMs;return t!=null&&o("LSMediaUrlUtils").isTimestampExpired(t)?e.headerImageUrlFallback:e.headerImageUrl}function h(t){try{var n=t.listItemProfilePictureUrlExpirationTimestamp1;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemProfilePictureUrlFallback1:t.listItemProfilePictureUrl1}catch(e){return t.listItemProfilePictureUrl1}}function y(t){try{var n=t.listItemProfilePictureUrlExpirationTimestamp2;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemProfilePictureUrlFallback2:t.listItemProfilePictureUrl2}catch(e){return t.listItemProfilePictureUrl2}}function C(t){try{var n=t.listItemProfilePictureUrlExpirationTimestamp3;return n!=null&&o("LSMediaUrlUtils").isTimestampExpired((e||(e=o("I64"))).of_string(n))?t.listItemProfilePictureUrlFallback3:t.listItemProfilePictureUrl3}catch(e){return t.listItemProfilePictureUrl3}}l.previewUrl=s,l.previewUrlLarge=u,l.playableUrl=c,l.imageUrl=d,l.faviconUrl=m,l.listItemContactUrlList1=p,l.listItemContactUrlList2=_,l.listItemContactUrlList3=f,l.headerImageUrl=g,l.listItemProfilePictureUrl1=h,l.listItemProfilePictureUrl2=y,l.listItemProfilePictureUrl3=C}),98);
__d("LSOptimisticUpsertReaction",["LSCancelTaskByQueueName","LSDeleteReaction","LSIssueNewTask","LSUpsertReaction"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[0]=t.i64.cast([0,1]):(n=a.item,r[21]=n.syncGroup,t.i64.neq(r[21],void 0)?r[20]=r[21]:r[20]=t.i64.cast([0,1]),r[0]=r[20])})},function(o){return r[2]=new t.Map,r[2].set("thread_key",e[0]),r[2].set("timestamp_ms",e[1]),r[2].set("message_id",e[2]),r[2].set("actor_id",e[3]),r[2].set("reaction",e[4]),r[2].set("reaction_style",void 0),r[2].set("sync_group",r[0]),r[3]=t.createArray(),r[4]=(r[3].push("reaction"),r[3]),r[5]=r[2].get("message_id"),r[6]=(r[3].push(r[5]),r[3]),r[7]=t.toJSON(r[3]),t.storedProcedure(n("LSCancelTaskByQueueName"),r[7],t.i64.cast([0,29]))},function(o){return e[4]===""?t.sequence([function(r){return t.storedProcedure(n("LSDeleteReaction"),e[0],e[2],e[3])},function(e){return r[8]=void 0}]):t.sequence([function(o){return e[4]==="\u2764\uFE0F"||e[4]==="\u2764\uFE0F"?r[20]="\u2764":r[20]=e[4],t.storedProcedure(n("LSUpsertReaction"),e[0],e[1],e[2],e[3],r[20],t.i64.cast([0,20]),void 0)},function(e){return r[8]=void 0}])},function(n){return r[9]=!0,r[9]?r[10]=void 0:(r[20]=new t.Map,r[20].set("feature_tags",void 0),r[21]=new t.Map,r[21].set("logging_metadata",r[20]),r[22]=t.toJSON(r[21]),r[10]=r[22]),t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[11]=t.i64.cast([0,1]):(n=a.item,r[21]=n.syncGroup,t.i64.neq(r[21],void 0)?r[20]=r[21]:r[20]=t.i64.cast([0,1]),r[11]=r[20])})},function(o){return r[13]=new t.Map,r[13].set("thread_key",e[0]),r[13].set("timestamp_ms",e[1]),r[13].set("message_id",e[2]),r[13].set("actor_id",e[3]),r[13].set("reaction",e[4]),r[13].set("reaction_style",void 0),r[13].set("sync_group",r[11]),r[13].set("send_attribution",e[5]),r[13].set("dataclass_params",r[10]),r[13].set("attachment_fbid",void 0),r[14]=t.createArray(),r[15]=(r[14].push("reaction"),r[14]),r[16]=r[13].get("message_id"),r[17]=(r[14].push(r[16]),r[14]),r[18]=t.toJSON(r[14]),r[19]=t.toJSON(r[13]),t.storedProcedure(n("LSIssueNewTask"),r[18],t.i64.cast([0,29]),r[19],void 0,void 0,e[6]==null?t.i64.cast([0,0]):e[6],t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticUpsertReactionStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSOptimisticUpsertReactionStoredProcedure",["LSOptimisticUpsertReaction","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticUpsertReaction"),a.threadKey,a.timestampMs,a.messageId,a.actorId,a.reaction,a.sendAttribution,a.pluginType);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSUpdateOrInsertReactionV2",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.db.table(226).fetch([[[e[0],e[1],e[2]]]]).next().then(function(r,o){var a=r.done,i=r.value;return a?t.db.table(12).fetch([[[e[1]]],"messageId"]).next().then(function(n,r){var o=n.done,a=n.value;return o?0:(r=a.item,t.sequence([function(n){return t.forEach(t.filter(t.db.table(226).fetch([[[e[0],e[1],e[2]]],"optimistic"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]&&t.i64.eq(n.reactionFbid,e[2])&&t.i64.lt(n.authorityLevel,e[5])}),function(e){return e.delete()})},function(n){return t.db.table(226).add({messageId:e[1],threadKey:e[0],reactionFbid:e[2],messageTimestamp:r.timestampMs,authorityLevel:e[5],count:e[4],viewerIsReactor:e[6],viewerReactionTimestampMs:e[7],lastUpdatedTimestampMs:e[8]})}]))}):(o=i.item,n[2]=o.lastUpdatedTimestampMs,n[1]=o.authorityLevel,t.i64.eq(e[5],t.i64.cast([0,20]))||t.i64.eq(n[1],t.i64.cast([0,80]))&&t.i64.eq(e[5],t.i64.cast([0,80]))||t.i64.eq(n[1],t.i64.cast([0,20]))&&t.i64.eq(e[5],t.i64.cast([0,80]))&&t.i64.le(t.i64.add(n[2],t.i64.cast([0,2e3])),e[8])||t.i64.eq(n[1],t.i64.cast([0,20]))&&t.i64.eq(e[5],t.i64.cast([0,60]))||t.i64.eq(n[1],t.i64.cast([0,60]))&&t.i64.eq(e[5],t.i64.cast([0,80]))&&t.i64.le(n[2],e[8])?n[3]=!0:n[3]=!1,n[3]?t.db.table(226).put({messageId:e[1],threadKey:e[0],reactionFbid:e[2],messageTimestamp:o.messageTimestamp,reactionLiteral:e[3],count:e[4],authorityLevel:e[5],viewerIsReactor:e[6],viewerReactionTimestampMs:t.i64.cast([0,0]),lastUpdatedTimestampMs:e[8]}):t.resolve())})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxUpdateOrInsertReactionV2StoredProcedure",e.__tables__=["reactions_v2","messages"],a.exports=e}),null);
__d("LSOptimisticUpsertReactionV2",["LSCancelTaskByQueueName","LSDeleteReaction","LSIssueNewTaskWithExtraOperations","LSUpdateOrInsertReactionV2","LSUpsertReaction"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return t.i64.eq(e[8],t.i64.cast([0,2]))?t.sequence([function(n){return t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[16]=t.i64.cast([0,1]):(n=a.item,r[25]=n.syncGroup,t.i64.neq(r[25],void 0)?r[24]=r[25]:r[24]=t.i64.cast([0,1]),r[16]=r[24])})},function(o){return r[18]=new t.Map,r[18].set("thread_id",e[1]),r[18].set("message_id",e[2]),r[18].set("message_timestamp",e[3]),r[18].set("actor_id",e[0]),r[18].set("reaction_fbid",e[4]),r[18].set("reaction_style",e[7]),r[18].set("operation",e[8]),r[18].set("viewer_is_reactor",e[6]),r[18].set("current_count",e[5]),r[18].set("reaction_literal",e[9]),r[18].set("sync_group",r[16]),r[19]=t.createArray(),r[20]=(r[19].push("reaction_v2"),r[19]),r[21]=r[18].get("message_id"),r[22]=(r[19].push(r[21]),r[19]),r[23]=t.toJSON(r[19]),t.storedProcedure(n("LSCancelTaskByQueueName"),r[23],t.i64.cast([0,604]))}]):t.resolve()},function(o){return[t.i64.cast([0,2]),t.i64.cast([0,3])].some(function(n){return t.i64.eq(e[8],n)})?r[0]=t.i64.add(e[5],t.i64.cast([-1,4294967295])):r[0]=t.i64.add(e[5],t.i64.cast([0,1])),[t.i64.cast([0,2]),t.i64.cast([0,3])].some(function(n){return t.i64.eq(e[8],n)})?r[1]=!1:r[1]=!0,r[2]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSUpdateOrInsertReactionV2"),e[1],e[2],e[4],e[9],r[0],t.i64.cast([0,20]),r[1],t.i64.cast([0,0]),r[2])},function(n){return t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,t){var n=e.done,o=e.value;return n?r[3]=void 0:(t=o.item,r[3]=t.threadType)})},function(o){return t.i64.neq(r[3],t.i64.cast([0,23]))?[t.i64.cast([0,2]),t.i64.cast([0,3])].some(function(n){return t.i64.eq(e[8],n)})?t.i64.eq(e[8],t.i64.cast([0,2]))?t.storedProcedure(n("LSDeleteReaction"),e[1],e[2],e[0]):t.sequence([function(n){return t.filter(t.db.table(8).fetch([[[e[1],e[2],e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[1])&&n.messageId===e[2]&&t.i64.eq(n.actorId,e[0])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[16]=void 0:(t=o.item,r[16]=t.reaction)})},function(o){return e[9]!==void 0?(e[9]==="\u2764\uFE0F"||e[9]==="\u2764\uFE0F"?r[18]="\u2764":r[18]=e[9],r[18]===r[16]?t.storedProcedure(n("LSDeleteReaction"),e[1],e[2],e[0]):t.resolve()):t.resolve()}]):e[9]!==void 0?(e[9]==="\u2764\uFE0F"||e[9]==="\u2764\uFE0F"?r[16]="\u2764":r[16]=e[9],r[17]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSUpsertReaction"),e[1],e[3],e[2],e[0],r[16],t.i64.cast([0,20]),r[17])):t.resolve():t.resolve()},function(n){return t.db.table(9).fetch([[[e[1]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[5]=t.i64.cast([0,1]):(n=a.item,r[17]=n.syncGroup,t.i64.neq(r[17],void 0)?r[16]=r[17]:r[16]=t.i64.cast([0,1]),r[5]=r[16])})},function(n){return r[7]=new t.Map,r[7].set("thread_id",e[1]),r[7].set("message_id",e[2]),r[7].set("message_timestamp",e[3]),r[7].set("actor_id",e[0]),r[7].set("reaction_fbid",e[4]),r[7].set("reaction_style",e[7]),r[7].set("current_count",e[5]),r[7].set("viewer_is_reactor",e[6]),r[7].set("operation",e[8]),r[7].set("reaction_literal",e[9]),r[7].set("entry_point",void 0),r[7].set("sync_group",r[5]),t.db.table(9).fetch([[[e[1]]]]).next().then(function(n,o){var a=n.done,i=n.value;return a?r[8]=!1:(o=i.item,t.sequence([function(n){return t.filter(t.db.table(14).fetch([[[o.threadKey,e[0]]]]),function(n){return t.i64.eq(n.threadKey,o.threadKey)&&t.i64.eq(t.i64.cast([0,0]),o.mailboxType)&&t.i64.eq(n.contactId,e[0])}).next().then(function(e,n){var a=e.done,i=e.value;return a?r[16]=!1:(n=i.item,t.i64.eq(o.threadType,t.i64.cast([0,152]))?(r[19]=n.threadRoles,t.i64.lt(t.i64.cast([0,7]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,7]),t.i64.cast([0,11]))?r[20]=!1:r[20]=!t.i64.eq(t.i64.and_(t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.cast([0,7]))),r[19]),t.i64.cast([0,0])),r[21]=o.capabilities,r[22]=o.capabilities2,r[23]=o.capabilities3,r[24]=o.capabilities4,r[25]=o.capabilities5,r[27]=t.i64.div(t.i64.cast([0,223]),t.i64.cast([0,64])),r[28]=t.i64.lsl_(t.i64.cast([0,1]),t.i64.to_int32(t.i64.sub(t.i64.cast([0,223]),t.i64.mul(r[27],t.i64.cast([0,64]))))),t.i64.lt(t.i64.cast([0,223]),t.i64.cast([0,0]))||t.i64.gt(t.i64.cast([0,223]),t.i64.cast([0,306]))?r[26]=!1:(t.i64.eq(r[27],t.i64.cast([0,0]))?r[29]=!t.i64.eq(t.i64.and_(r[28],r[21]),t.i64.cast([0,0])):(t.i64.eq(r[27],t.i64.cast([0,1]))?r[30]=!t.i64.eq(t.i64.and_(r[28],r[22]),t.i64.cast([0,0])):(t.i64.eq(r[27],t.i64.cast([0,2]))?r[31]=!t.i64.eq(t.i64.and_(r[28],r[23]),t.i64.cast([0,0])):(t.i64.eq(r[27],t.i64.cast([0,3]))?r[32]=!t.i64.eq(t.i64.and_(r[28],r[24]),t.i64.cast([0,0])):(t.i64.eq(r[27],t.i64.cast([0,4]))?r[33]=!t.i64.eq(t.i64.and_(r[28],r[25]),t.i64.cast([0,0])):r[33]=!1,r[32]=r[33]),r[31]=r[32]),r[30]=r[31]),r[29]=r[30]),r[26]=r[29]),r[20]!==r[26]&&((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),t.throw("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),r[18]=r[20]):r[18]=!1,r[16]=r[18])})},function(e){return r[8]=r[16]}]))})},function(e){return r[8]&&r[7].set("perform_action_as_page",!0),r[10]=t.createArray(),r[11]=(r[10].push("reaction_v2"),r[10]),r[12]=r[7].get("message_id"),r[13]=(r[10].push(r[12]),r[10]),r[14]=t.toJSON(r[10]),r[15]=t.toJSON(r[7]),t.storedProcedure(n("LSIssueNewTaskWithExtraOperations"),r[14],t.i64.cast([0,604]),r[15],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),void 0,t.i64.cast([0,0]))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxOptimisticUpsertReactionV2StoredProcedure",e.__tables__=["threads","reactions","participants"],a.exports=e}),null);
__d("LSOptimisticUpsertReactionV2StoredProcedure",["LSOptimisticUpsertReactionV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptimisticUpsertReactionV2"),a.actorId,a.threadId,a.messageId,a.messageTimestamp,a.reactionFbid,a.currentCount,a.viewerIsReactor,a.reactionStyle,a.operation,a.reactionLiteral);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWChatMessageId",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){if(e.type==="sent")return e.value.messageId}function u(e){if(e.type==="sent")return e.value.threadId}function c(e){if(e.type==="sent")return e.value.timestamp}function d(t,n,r){return{type:"sent",value:{messageId:n,threadId:(e||(e=o("I64"))).of_string(t),timestamp:e.of_string(r)}}}function m(t){return{type:"sent",value:{messageId:t,threadId:(e||(e=o("I64"))).zero,timestamp:e.zero}}}var p={type:"sent",value:{messageId:"",threadId:(e||(e=o("I64"))).zero,timestamp:e.zero}};l.getMessageId=s,l.getThreadId=u,l.getTimestamp=c,l.makeSent=d,l.emptyForExamplesWithId=m,l.emptyForExamples=p}),98);
__d("getMessengerTimeBucket",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["TODAY","WEEK_AGO","CURRENT_YEAR","OTHER_YEAR"]),l=864e5,s=6*l;function u(t){var n=new Date(t),r=new Date,o=new Date(r.getFullYear(),r.getMonth(),r.getDate());return o<n?e.TODAY:o.getTime()-s<n.getTime()?e.WEEK_AGO:o.getFullYear()===n.getFullYear()?e.CURRENT_YEAR:e.OTHER_YEAR}function c(t){return u(t)===e.TODAY}i.MessengerTimeBucket=e,i.getMessengerTimeBucket=u,i.isTimeOnlyTimestamp=c}),66);
__d("getMessengerPreciseTimestamp",["formatDate","getMessengerTimeBucket"],(function(t,n,r,o,a,i,l){"use strict";var e=Object.freeze({CURRENT_YEAR:"F jS, g:ia",OTHER_YEAR:"F j, Y g:i a",TODAY:"g:ia",WEEK_AGO:"l g:ia"});function s(t){var n=o("getMessengerTimeBucket").getMessengerTimeBucket(t);switch(n){case o("getMessengerTimeBucket").MessengerTimeBucket.TODAY:return e.TODAY;case o("getMessengerTimeBucket").MessengerTimeBucket.WEEK_AGO:return e.WEEK_AGO;case o("getMessengerTimeBucket").MessengerTimeBucket.CURRENT_YEAR:return e.CURRENT_YEAR;case o("getMessengerTimeBucket").MessengerTimeBucket.OTHER_YEAR:return e.OTHER_YEAR}}function u(e,t){return r("formatDate")(new Date(e),s(e),void 0,t)}l.default=u}),98);
__d("MWMessageDeliveryStatus",["fbt","I64","LSIntEnum","getFBTSafeGenderFromGenderConst","getMessengerPreciseTimestamp","intlList","intlSummarizeNumber"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u;function c(e){if(e.length!==1)return{heads:e,type:"MultipleSeenHeads"};var t=e[0];return{head:t,type:"SingleSeenHead"}}function d(e,t){return{delivered:t,heads:e,type:"DeliveredAndRead"}}function m(e){return{count:e,type:"SeenCount"}}function p(e){return e.timestamp>0?s._(/*BTDS*/"_j{\"*\":\"Seen by {full name} at {seen time}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender)),s._param("seen time",r("getMessengerPreciseTimestamp")(e.timestamp))]):s._(/*BTDS*/"_j{\"*\":\"Seen by {full name}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender))])}function _(e,t){if(e.length===0)return"";if(t)return s._(/*BTDS*/"Seen by everyone").toString();var n=e.map(function(e){return s._(/*BTDS*/"_j{\"*\":\"{full name}\"}",[s._name("full name",e.name,r("getFBTSafeGenderFromGenderConst")(e.gender))])}),o=r("intlList")(n,r("intlList").CONJUNCTIONS.AND,r("intlList").DELIMITERS.COMMA);return s._(/*BTDS*/"Seen by {full name}",[s._param("full name",o)]).toString()}function f(e){var t=r("intlSummarizeNumber")(e);return s._(/*BTDS*/"Seen by {seen count}",[s._param("seen count",t)]).toString()}var g={delivered:s._(/*BTDS*/"Delivered"),error:s._(/*BTDS*/"Couldn't send"),loading:s._(/*BTDS*/"Loading..."),retriableError:s._(/*BTDS*/"Click to retry."),sending:s._(/*BTDS*/"Sending"),sent:s._(/*BTDS*/"Sent")};function h(e){switch(e.type){case"Sending":return g.sending;case"Sent":case"Delivered":return g.sent;case"Error":return g.error;case"SingleSeenHead":return p(e.head);case"NoneStatus":case"MultipleSeenHeads":return"";case"DeliveredAndRead":return _(e.heads,e.delivered);case"SeenCount":return f(e.count);case"Loading":return g.loading;case"RetriableError":return g.retriableError;case"ValidationError":return""}}function y(e){switch(e.type){case"Sending":return g.sending;case"Sent":return g.sent;case"Delivered":return g.delivered;case"Error":case"RetriableError":return g.error;case"SingleSeenHead":return p(e.head);case"DeliveredAndRead":return _(e.heads,e.delivered);default:return""}}function C(t){return(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(1))?{type:"Sending"}:(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(2))||(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(6))?{type:"Sent"}:(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(4))||(e||(e=o("I64"))).equal(t,(u||(u=o("LSIntEnum"))).ofNumber(5))?{type:"Error"}:{type:"NoneStatus"}}function b(t,n,r){var a=C(t.sendStatusV2);return(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(4))||(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(5))||(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(1))?a:!r&&(e||(e=o("I64"))).equal(t.sendStatusV2,(u||(u=o("LSIntEnum"))).ofNumber(2))?{type:"NoneStatus"}:(e||(e=o("I64"))).ge(n,t.timestampMs)?{type:"Delivered"}:a}function v(e){return["SingleSeenHead","Sending","MultipleSeenHeads","Error","RetriableError"].includes(e.type)}l.seenHead=c,l.deliveredAndRead=d,l.seenCount=m,l.getSingleSeenHead=p,l.getSeenCount=f,l.Titles=g,l.getBroadcastStatusTitle=h,l.getStatusTitle=y,l.getFromSendStatus=C,l.getDeliveryStatusForMessageSentByYou=b,l.isAlwaysShownStatus=v}),226);
__d("MWPBaseMessageListRowActions.react",["react","react-strict-dom"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=e.useContext,c={hidden:{visibility:"xlshs6z",$$css:!0},incoming:{flexDirection:"x1q0g3np",$$css:!0},outgoing:{flexDirection:"x15zctf7",$$css:!0},root:{alignItems:"x6s0dn4",columnGap:"xl5lk40",display:"x78zum5",width:"x1mqs8db",$$css:!0}},d=s.createContext("full");function m(){return s.jsx(o("react-strict-dom").html.div,{role:"none",style:c.root})}m.displayName=m.name+" [from "+i.id+"]";function p(e){var t=e.children,n=e.outgoing;return s.jsx(o("react-strict-dom").html.div,{role:"none",style:[c.root,n?c.outgoing:c.incoming],children:t})}p.displayName=p.name+" [from "+i.id+"]";function _(e){var t=e.children,n=e.showWith,r=n===void 0?"full":n,a=u(d),i=a==="partial"&&r!=="partial";return s.jsx(o("react-strict-dom").html.div,{"aria-hidden":i,style:i&&c.hidden,children:t})}_.displayName=_.name+" [from "+i.id+"]";function f(e){var t=e.ariaHidden,n=e.children,r=e.onMouseEnter,a=e.onMouseLeave,i=e.outgoing,l=e.visibility,u=l===void 0?"full":l,c=e.xstyle;return s.jsx(d.Provider,{value:u,children:s.jsx(o("react-strict-dom").html.div,{"aria-hidden":t!=null?t:!1,onMouseEnter:r,onMouseLeave:a,style:[g.root,i?g.outgoing:g.incoming,c],children:s.jsx(p,{outgoing:i,children:n})})})}f.displayName=f.name+" [from "+i.id+"]";var g={incoming:{paddingInlineStart:"xaso8d8",$$css:!0},outgoing:{paddingInlineEnd:"x1gabggj",$$css:!0},root:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"x2lah0s",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1mqs8db",zIndex:"x1n327nk",$$css:!0}};l.MWPBaseMessageListRowActionsEmptyList=m,l.MWPBaseMessageListRowActionsList=p,l.MWPBaseMessageListRowActionsListItem=_,l.MWPBaseMessageListRowActionsContainer=f}),98);
__d("MWUnvaultedText",["cr:2472","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useMemo,u=function(t,r){return n("cr:2472")==null||r==null||r===""?r:t?n("cr:2472").unvaultOrThrow(r):n("cr:2472").unvault(r,!0)};function c(e,t){var n=s(function(){return u(e,t)},[e,t]);return n}l.getMWUnvaultedText=u,l.useMWUnvaultedText=c}),98);
__d("MessageReactionOperation",[],(function(t,n,r,o,a,i){var e=Object.freeze({ADD:1,REMOVE:2,REMOVE_MULTI_REACT:3});i.default=e}),66);
__d("MessageReactionStyle",[],(function(t,n,r,o,a,i){var e=Object.freeze({NONE:0,BASIC_SUPER_REACT_ANIMATION:1,FB_EMOJI:2,FB_NON_DEFAULT_EMOJI:3});i.default=e}),66);
__d("MessagingCommunityType",[],(function(t,n,r,o,a,i){var e=Object.freeze({FB_COMMUNITY:0,STANDALONE_COMMUNITY:1});i.default=e}),66);
__d("isMWEditedMessage",["I64"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.editCount!=null&&(e||(e=o("I64"))).gt(t.editCount,(e||(e=o("I64"))).zero);return n&&!t.isUnsent}l.default=s}),98);
__d("mwCMisStandAloneCommunity",["I64","LSIntEnum","MessagingCommunityType"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){return t==null?!1:(e||(e=o("I64"))).equal(t,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingCommunityType").STANDALONE_COMMUNITY))}l.default=u}),98);
__d("useIGDOptimisticReactMessage",["I64","LSAuthorityLevel","MAWTimeUtils","WATimeUtils","asyncToGeneratorRuntime","err","getErrorSafe","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(e||(e=o("react"))).useCallback;function c(){return u(function(e,t,a,l,u){return e.runInTransaction((function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){try{if(u==null){var n=yield e.reactions.get(t,a,l);return yield e.reactions.delete(t,a,l),{removedReaction:n}}else{var i={actorId:l,authorityLevel:(s||(s=o("I64"))).of_int32(r("LSAuthorityLevel").OPTIMISTIC),messageId:a,reaction:u!=null?u:"",threadKey:t,timestampMs:o("MAWTimeUtils").toTimestamp(o("WATimeUtils").unixTime()),transportKey:"Instamadillo"};return yield e.reactions.upsert([t,a,l],i),{addedReaction:i}}}catch(e){throw r("err")("Instamadillo: Failed to send or unsend optimistic reaction: "+r("getErrorSafe")(e).message+" ")}});return function(t){return e.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":40")},[])}l.default=c}),98);
__d("useIsChatPreviewsEnabled",["MWLSThread","ReQL","ReQLSuspense","isUnjoinedCMThread","mwCMisStandAloneCommunity","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n,a=(e||(e=r("useReStore")))(),l=o("MWLSThread").useThread(t,function(e){return e.parentThreadKey}),s=o("ReQLSuspense").useFirst(function(){return l!=null?o("ReQL").fromTableAscending(a.tables.community_folders).getKeyRange(l):o("ReQL").empty()},[a,l],i.id+":27");return(n=o("MWLSThread").useThread(t,function(e){return u(e,s==null?void 0:s.communityType)}))!=null?n:!1}function u(e,t){return e.needsAdminApprovalForNewParticipant===!0||!o("isUnjoinedCMThread").isUnjoinedCMThread(e.threadType)?!1:r("mwCMisStandAloneCommunity")(t)}l.useIsChatPreviewsEnabled=s,l.isChatPreviewsEnabled=u}),98);
__d("useIsMultiReactionEnabled",["LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","ReQL","ReQLSuspense","isUnjoinedCMThread","mwCMIsAnyCMThread","useIsChatPreviewsEnabled","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n,a=(e||(e=r("useReStore")))(),l=o("MWLSThread").useThread(t,function(e){return e.parentThreadKey}),s=o("ReQLSuspense").useFirst(function(){return l!=null?o("ReQL").fromTableAscending(a.tables.community_folders).getKeyRange(l):o("ReQL").empty()},[a,l],i.id+":28");return(n=o("MWLSThread").useThread(t,function(e){if(o("isUnjoinedCMThread").isUnjoinedCMThread(e.threadType))return o("useIsChatPreviewsEnabled").isChatPreviewsEnabled(e,s==null?void 0:s.communityType);if(!o("LSThreadBitOffset").has(156,e))return!1;if(r("mwCMIsAnyCMThread")(e.threadType)||o("LSMessagingThreadTypeUtil").isDiscoverableChannel(e.threadType))return!0}))!=null?n:!1}l.useIsMultiReactEnabled=s}),98);
__d("useIsReactionsV2Enabled",["LSMessagingThreadTypeUtil","LSThreadBitOffset","MWCMThreadTypes.react","MWLSThread","ReQL","ReQLSuspense","useIsChatPreviewsEnabled","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n,a=(e||(e=r("useReStore")))(),l=o("MWLSThread").useThread(t,function(e){return e.parentThreadKey}),s=o("ReQLSuspense").useFirst(function(){return l!=null?o("ReQL").fromTableAscending(a.tables.community_folders).getKeyRange(l):o("ReQL").empty()},[a,l],i.id+":34");return(n=o("MWLSThread").useThread(t,function(e){return u(e,s==null?void 0:s.communityType)}))!=null?n:!1}function u(e,t){if(o("LSMessagingThreadTypeUtil").isOpenFnFThread(e)&&!o("MWCMThreadTypes.react").isIGBroadcastChannelThread(e.threadSubtype))return!1;if(o("LSThreadBitOffset").has(139,e))return!0;var n=o("useIsChatPreviewsEnabled").isChatPreviewsEnabled(e,t);return!!n}function c(e,t){var n=o("LSMessagingThreadTypeUtil").isUnjoinedDiscoverablePublicBroadcastChannel(e.threadType)||o("LSMessagingThreadTypeUtil").isSocialChannelUnjoined(e.threadType),r=o("useIsChatPreviewsEnabled").isChatPreviewsEnabled(e,t);return n||r}l.useIsReactionsV2Enabled=s,l.isReactionsV2Enabled=u,l.isReactionsV2ReadOnly=c}),98);
__d("useMWLSDefaultThreadSourceAndResetAttribution",["LSThreadAttributionTypeUtil","react","useLSMessagingSource"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(e||(e=o("react"))).useCallback;function u(){var e=r("useLSMessagingSource")();return s(function(t){return o("LSThreadAttributionTypeUtil").getSourceAndResetAttribution(t,e)},[e])}l.default=u}),98);
__d("useMWPSendOrUnsendReaction",["FBLogger","I64","Int64Hooks","LSFactory","LSIntEnum","LSOptimisticUpsertReactionStoredProcedure","LSOptimisticUpsertReactionV2StoredProcedure","MWPActor.react","MessageReactionOperation","MessageReactionStyle","ReQL","asyncToGeneratorRuntime","promiseDone","useIsMultiReactionEnabled","useIsReactionsV2Enabled","useMWLSDefaultThreadSourceAndResetAttribution","useReStore","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t,n,a,l,u){r("promiseDone")(e.runInTransaction(function(e){return r("LSOptimisticUpsertReactionV2StoredProcedure")(r("LSFactory")(e),{actorId:t,currentCount:l,messageId:n.messageId,messageTimestamp:n.timestampMs,operation:(s||(s=o("LSIntEnum"))).ofNumber(r("MessageReactionOperation").ADD),reactionFbid:a,reactionLiteral:u,reactionStyle:s.ofNumber(r("MessageReactionStyle").BASIC_SUPER_REACT_ANIMATION),threadId:n.threadKey,viewerIsReactor:!0})},"readwrite",void 0,void 0,i.id+":43"))}function d(e,t,n,r,o,a,i){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n,a,l,u,c){r("vulture")("b9tArDq9oTSm5i_RdYBsfvzdL6w="),yield e.runInTransaction(function(e){return r("LSOptimisticUpsertReactionV2StoredProcedure")(r("LSFactory")(e),{actorId:t,currentCount:a,messageId:n.messageId,messageTimestamp:n.timestampMs,operation:(s||(s=o("LSIntEnum"))).ofNumber(c?r("MessageReactionOperation").REMOVE_MULTI_REACT:r("MessageReactionOperation").REMOVE),reactionFbid:l,reactionLiteral:u,reactionStyle:s.ofNumber(r("MessageReactionStyle").BASIC_SUPER_REACT_ANIMATION),threadId:n.threadKey,viewerIsReactor:!1})},"readwrite",void 0,void 0,i.id+":76")}),m.apply(this,arguments)}function p(e,t,n,a,i){r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.reactions_v2).getKeyRange(n.threadKey,n.messageId,a)).then(function(r){r!=null?c(e,t,n,a,r.count,i):c(e,t,n,a,(u||(u=o("I64"))).zero,i)}))}function _(t){var a=(e||(e=r("useReStore")))(),l=o("MWPActor.react").useActor(),s=r("useMWLSDefaultThreadSourceAndResetAttribution")(),c=o("useIsMultiReactionEnabled").useIsMultiReactEnabled(t.threadKey);return o("Int64Hooks").useCallbackInt64(function(e){r("promiseDone")(n("asyncToGeneratorRuntime").asyncToGenerator(function*(){var n=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.threads).getKeyRange(t.threadKey)),m=n?o("useIsReactionsV2Enabled").isReactionsV2Enabled(n):!1;if(m){var _=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.reaction_v2_types).filter(function(t){return t.reactionLiteral===e||t.reactionLiteralVariant16===e}));if(_!=null){var f=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(a.tables.reactions_v2).getKeyRange(t.threadKey,t.messageId).filter(function(e){return(!c||(u||(u=o("I64"))).equal(e.reactionFbid,_.reactionFbid))&&e.viewerIsReactor}));if(f==null)return p(a,l,t,_.reactionFbid,e);var g=(u||(u=o("I64"))).equal(f.reactionFbid,_.reactionFbid);(!c||g)&&(yield d(a,l,t,f.count,f.reactionFbid,e,c)),g||(yield p(a,l,t,_.reactionFbid,e))}else r("FBLogger")("messenger_web").warn("Reactions v2: trying to send reaction that is not in reaction_v2_types table");return}return a.runInTransaction(function(n){return r("LSOptimisticUpsertReactionStoredProcedure")(r("LSFactory")(n),{actorId:l,messageId:t.messageId,reaction:e,sendAttribution:s(t.threadKey),threadKey:t.threadKey,timestampMs:(u||(u=o("I64"))).of_float(Date.now())})},"readwrite",void 0,void 0,i.id+":231")})())},[a,t,c,l,s])}l.default=_}),98);
__d("useIGDGlobalReactMessage",["FBLogger","I64","IGDBridgedAPI","Int64Hooks","LSAuthorityLevel","MWPActor.react","ReQL","ReQLSuspense","asyncToGeneratorRuntime","promiseDone","react-compiler-runtime","requireDeferred","useIGDOptimisticReactMessage","useMWPSendOrUnsendReaction","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("MWLogMessageAction").__setRef("useIGDGlobalReactMessage");function c(e,t){var a=o("react-compiler-runtime").c(18),l=(s||(s=r("useReStore")))(),c=o("MWPActor.react").useActor(),m=e.transportKey==="Instamadillo",p=r("useIGDOptimisticReactMessage")(),_;a[0]!==l.tables.e2ee_igMessageAuxiliaryInfo||a[1]!==e.messageId?(_=function(){return o("ReQL").fromTableAscending(l.tables.e2ee_igMessageAuxiliaryInfo).getKeyRange(e.messageId)},a[0]=l.tables.e2ee_igMessageAuxiliaryInfo,a[1]=e.messageId,a[2]=_):_=a[2];var f;a[3]!==l||a[4]!==e.messageId?(f=[l,e.messageId],a[3]=l,a[4]=e.messageId,a[5]=f):f=a[5];var g=o("ReQLSuspense").useFirst(_,f,i.id+":51"),h=!!(g!=null&&g.openEb),y=r("useMWPSendOrUnsendReaction")(e),C,b;return a[6]!==c||a[7]!==p||a[8]!==l||a[9]!==m||a[10]!==h||a[11]!==e.messageId||a[12]!==e.senderId||a[13]!==e.threadKey||a[14]!==y||a[15]!==t?(C=function(){return(function(){var o=n("asyncToGeneratorRuntime").asyncToGenerator(function*(o,a){if(m||h){var i=yield p(l,e.threadKey,e.messageId,c,o),s=i.removedReaction,_={messageId:e.messageId,reaction:s!=null?s.reaction:o,reactionStatus:s!=null?"deleted":"created",threadKey:e.threadKey};r("promiseDone")(r("IGDBridgedAPI").sendOrRemoveReaction(_).catch((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){throw yield d(l,e.threadKey,e.messageId,c,s),r("FBLogger")("igd_web").catching(t).warn("Instamadillo: Failed to send or unsend reaction: %s.",t)});return function(e){return t.apply(this,arguments)}})()))}else y(o!=null?o:"");u.onReady(function(n){return r("promiseDone")(n.log(l,e.messageId,e.threadKey,t,a,void 0,void 0,void 0,e.senderId,void 0,c))})});return function(e,t){return o.apply(this,arguments)}})()},b=[m,h,p,e.threadKey,e.messageId,e.senderId,l,c,y,t],a[6]=c,a[7]=p,a[8]=l,a[9]=m,a[10]=h,a[11]=e.messageId,a[12]=e.senderId,a[13]=e.threadKey,a[14]=y,a[15]=t,a[16]=C,a[17]=b):(C=a[16],b=a[17]),o("Int64Hooks").useMemoInt64(C,b)}function d(t,a,l,s,u){return t.runInTransaction((function(){var i=n("asyncToGeneratorRuntime").asyncToGenerator(function*(n){if(u!=null)return n.reactions.upsert([u.threadKey,u.messageId,u.actorId],babelHelpers.extends({},u));var i=yield o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.reactions).getKeyRange(a,l,s).filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,e.of_int32(r("LSAuthorityLevel").OPTIMISTIC))}));if(i!=null)return n.reactions.delete(i.threadKey,i.messageId,i.actorId)});return function(e){return i.apply(this,arguments)}})(),"readwrite",void 0,void 0,i.id+":147")}l.default=c}),98);
__d("useIsSecureMessage",["LSMessagingThreadTypeUtil","ReQL","ReQLSuspense"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r,a=(r=o("ReQLSuspense").useFirst(function(){return t==null?o("ReQL").empty():o("ReQL").fromTableAscending(e.tables.threads,["threadType"]).getKeyRange(t.threadKey).map(function(e){var t=e.threadType;return t})},[e,t],i.id+":37"))!=null?r:n.fallbackThreadType;if(a==null){var l;return(l=n.fallbackIsSecure)!=null?l:!1}return o("LSMessagingThreadTypeUtil").isArmadilloSecure(a)}l.default=e}),98);
__d("useMWGetOtherUserContact",["I64","LSMessagingThreadTypeUtil","MWPActor.react","ReQL","ReQLSuspense","react","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(u||(u=o("react"))).useMemo;function d(t,n,a){var l=(e||(e=r("useReStore")))(),u=o("MWPActor.react").useActor(),d=(s||(s=o("I64"))).equal(u,t),m=c(function(){return a},[].concat(a));return o("ReQLSuspense").useFirst(function(){return o("LSMessagingThreadTypeUtil").isOneToOne(n)?o("ReQL").mergeJoin(o("ReQL").fromTableAscending(l.tables.participants,["contactId"]).getKeyRange(t),o("ReQL").fromTableAscending(l.tables.contacts,a)).filter(function(e){var t=e[0],n=e[1];return d||!(s||(s=o("I64"))).equal(t.contactId,u)}).map(function(e){var t=e[0],n=e[1];return n}):o("ReQL").empty()},[n,l,t,d,u,m],i.id+":35")}l.default=d}),98);